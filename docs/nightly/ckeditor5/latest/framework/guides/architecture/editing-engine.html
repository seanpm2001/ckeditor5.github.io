<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Editing engine - CKEditor 5 Documentation</title>
    <meta name="description" content="Learn how to install, integrate and configure CKEditor 5 Builds and how to work with CKEditor 5 Framework, customize it, create your own plugins and custom editors, change the UI or even bring your own UI to the editor. API reference and examples included.">
    <meta name="twitter:card" content="Learn how to install, integrate and configure CKEditor 5 Builds and how to work with CKEditor 5 Framework, customize it, create your own plugins and custom editors, change the UI or even bring your own UI to the editor. API reference and examples included.">
    <meta name="twitter:site" content="@ckeditor">
    <meta name="x-generated-at" content="Tue Feb 21 2023 04:15:07 GMT+0000 (Coordinated Universal Time)">
    <meta property="og:title" content="Editing engine - CKEditor 5 Documentation">
    <meta property="og:description" content="Learn how to install, integrate and configure CKEditor 5 Builds and how to work with CKEditor 5 Framework, customize it, create your own plugins and custom editors, change the UI or even bring your own UI to the editor. API reference and examples included.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://ckeditor.com/docs/ckeditor5/latest/framework/guides/architecture/editing-engine.html">
    <meta property="DC.language" content="en">
    <meta property="DC.publisher" content="CKSource">
    <meta property="DC.creator" content="CKEditor">
    <meta property="DC.title" content="Editing engine - CKEditor 5 Documentation">
    <meta property="DC.format" content="text/html">
    <meta property="DC.type" content="Text">
    <meta property="DC.description" content="Learn how to install, integrate and configure CKEditor 5 Builds and how to work with CKEditor 5 Framework, customize it, create your own plugins and custom editors, change the UI or even bring your own UI to the editor. API reference and examples included.">
    <link rel="canonical" href="https://ckeditor.com/docs/ckeditor5/latest/framework/guides/architecture/editing-engine.html">
    <link rel="icon" type="image/png" href="../../../assets/img/favicons/16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="../../../assets/img/favicons/32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="../../../assets/img/favicons/96x96.png" sizes="96x96">
    <link rel="apple-touch-icon" type="image/png" href="../../../assets/img/favicons/200x200.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css">
    <link rel="stylesheet" href="../../../../../assets/2.4.0/css/styles.css" type="text/css" media="all">
    <link rel="stylesheet" href="../../../assets/styles.css" type="text/css">
    <script>if ( ["ckeditor5.github.io"].indexOf( location.hostname ) !== -1 ) {
      	function pageView() {
      		ga( 'send', 'pageview', location.pathname + location.search + location.hash );
      	}
      
      	(function( i, s, o, g, r, a, m ) {
      		i[ 'GoogleAnalyticsObject' ] = r;
      		i[ r ] = i[ r ] || function() {
      				(i[ r ].q = i[ r ].q || []).push( arguments )
      			}, i[ r ].l = 1 * new Date();
      		a = s.createElement( o ),
      			m = s.getElementsByTagName( o )[ 0 ];
      		a.async = 1;
      		a.src = g;
      		m.parentNode.insertBefore( a, m )
      	})( window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga' );
      
      	ga( 'create', {"trackingId":"UA-271067-19","cookieDomain":"ckeditor5.github.io"} );
      
      	pageView();
      
      	window.addEventListener( 'hashchange', pageView );
      }
    </script>
  <meta name="generator" content="Hexo 6.3.0"></head>
  <body>
    <header class="top" data-project="ckeditor5">
      <div class="header__main">
        <div class="header__main-rwd-button"><a href="#"><span></span><span></span><span></span></a></div>
        <div class="header__main-title"><a class="header__main-title-home" href="../../../../../index.html">CKEditor Ecosystem Documentation</a></div>
        <div class="top__search">
          <input class="top__search__box" type="text" id="docsearch_input" placeholder="Search in CKEditor 5">
          <div class="top__search__button"><img src="../../../../../assets/2.4.0/img/loupe.svg" alt="Search"></div>
        </div>
      </div>
      <div class="header__sub">
        <ul class="top__menu">
          <li class="top__menu-project-logo"><a href="../../../index.html">CKEditor 5</a></li>
          <li><a href="../../../installation/index.html">Getting started</a></li>
          <li><a href="../../../features/index.html">Features</a></li>
          <li><a href="../../../examples/index.html">Examples</a></li>
          <li><a href="../../../updating/index.html">Updating</a></li>
          <li><a href="../../../support/index.html">Support</a></li>
          <li><a class="top__menu__item--active" href="../../index.html">Framework</a></li>
          <li><a class="top__menu__api" href="../../../api/index.html">API</a></li>
          <li><a class="top__menu-github-link" href="https://github.com/ckeditor/ckeditor5" target="_blank" title="CKEditor 5 on GitHub."><svg viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a></li>
        </ul>
      </div>
      <div class="header__menu-rwd">
        <ul class="header__menu-rwd__projects">
          <li data-project="ckeditor5"><a href="../../../../latest/index.html">CKEditor 5</a>
            <ul class="tree header__menu-rwd__projects-pages">
              <li data-group="installation"><a href="../../../installation/index.html">Getting started</a>
              </li>
              <li data-group="features"><a href="../../../features/index.html">Features</a>
              </li>
              <li data-group="examples"><a href="../../../examples/index.html">Examples</a>
              </li>
              <li data-group="updating"><a href="../../../updating/index.html">Updating</a>
              </li>
              <li data-group="support"><a href="../../../support/index.html">Support</a>
              </li>
              <li data-group="framework"><a href="../../index.html">Framework</a>
                <ul class="header__menu-rwd__projects-subpages">
                          <li><a href="../../index.html">
                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Overview</span>
                              </div></a></li>
                          <li>
                            <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Guides</span>
                            </div>
                            <ul class="tree__item-nested-list">
                                  <li><a href="../quick-start.html">
                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Quick start</span>
                                      </div></a></li>
                                  <li><a href="../development-tools.html">
                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Development tools</span>
                                      </div></a></li>
                                  <li>
                                    <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Architecture</span>
                                    </div>
                                    <ul class="tree__item-nested-list">
                                          <li><a href="intro.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Introduction</span>
                                              </div></a></li>
                                          <li><a href="core-editor-architecture.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Core editor architecture</span>
                                              </div></a></li>
                                          <li><a href="">
                                              <div class="tree__item__wrapper tree__item__wrapper--active"><span class="tree__item--guide tree__item__text">Editing engine</span>
                                              </div></a></li>
                                          <li><a href="ui-library.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">UI library</span>
                                              </div></a></li>
                                    </ul>
                                  </li>
                                  <li>
                                    <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Developing custom plugins</span>
                                    </div>
                                    <ul class="tree__item-nested-list">
                                          <li><a href="../plugins/creating-simple-plugin-timestamp.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Creating a basic plugin</span>
                                              </div></a></li>
                                          <li>
                                            <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Creating an abbreviation plugin</span>
                                            </div>
                                            <ul class="tree__item-nested-list">
                                                  <li><a href="../plugins/abbreviation-plugin/abbreviation-plugin-level-1.html">
                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Defining a model and a view</span>
                                                      </div></a></li>
                                                  <li><a href="../plugins/abbreviation-plugin/abbreviation-plugin-level-2.html">
                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Getting user input with a custom UI</span>
                                                      </div></a></li>
                                                  <li><a href="../plugins/abbreviation-plugin/abbreviation-plugin-level-3.html">
                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Improving accessibility and adding a command</span>
                                                      </div></a></li>
                                            </ul>
                                          </li>
                                          <li>
                                            <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Package Generator</span>
                                            </div>
                                            <ul class="tree__item-nested-list">
                                                  <li><a href="../plugins/package-generator/using-package-generator.html">
                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Using package generator</span>
                                                      </div></a></li>
                                                  <li><a href="../plugins/package-generator/javascript-package.html">
                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">JavaScript package</span>
                                                      </div></a></li>
                                                  <li><a href="../plugins/package-generator/typescript-package.html">
                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">TypeScript package</span>
                                                      </div></a></li>
                                            </ul>
                                          </li>
                                    </ul>
                                  </li>
                                  <li>
                                    <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Advanced tutorials</span>
                                    </div>
                                    <ul class="tree__item-nested-list">
                                          <li><a href="../tutorials/implementing-a-block-widget.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Implementing a block widget</span>
                                              </div></a></li>
                                          <li><a href="../tutorials/implementing-an-inline-widget.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Implementing an inline widget</span>
                                              </div></a></li>
                                          <li><a href="../tutorials/data-from-external-source.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Data from an external source</span>
                                              </div></a></li>
                                          <li><a href="../tutorials/using-react-in-a-widget.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Using a React component in a widget</span>
                                              </div></a></li>
                                    </ul>
                                  </li>
                                  <li>
                                    <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Deep dive</span>
                                    </div>
                                    <ul class="tree__item-nested-list">
                                          <li><a href="../deep-dive/clipboard.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Clipboard</span>
                                              </div></a></li>
                                          <li><a href="../deep-dive/upload-adapter.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Custom upload adapter</span>
                                              </div></a></li>
                                          <li><a href="../deep-dive/event-system.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Event system</span>
                                              </div></a></li>
                                          <li><a href="../deep-dive/observables.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Observables</span>
                                              </div></a></li>
                                          <li><a href="../deep-dive/schema.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Schema</span>
                                              </div></a></li>
                                          <li>
                                            <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Conversion</span>
                                            </div>
                                            <ul class="tree__item-nested-list">
                                                  <li><a href="../deep-dive/conversion/intro.html">
                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Introduction</span>
                                                      </div></a></li>
                                                  <li><a href="../deep-dive/conversion/downcast.html">
                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Model to view (downcast)</span>
                                                      </div></a></li>
                                                  <li><a href="../deep-dive/conversion/upcast.html">
                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">View to model (upcast)</span>
                                                      </div></a></li>
                                                  <li>
                                                    <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Conversion helpers</span>
                                                    </div>
                                                    <ul class="tree__item-nested-list">
                                                          <li><a href="../deep-dive/conversion/helpers/intro.html">
                                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Introduction</span>
                                                              </div></a></li>
                                                          <li><a href="../deep-dive/conversion/helpers/downcast.html">
                                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Downcast helpers</span>
                                                              </div></a></li>
                                                          <li><a href="../deep-dive/conversion/helpers/upcast.html">
                                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Upcast helpers</span>
                                                              </div></a></li>
                                                    </ul>
                                                  </li>
                                            </ul>
                                          </li>
                                          <li>
                                            <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">User interface</span>
                                            </div>
                                            <ul class="tree__item-nested-list">
                                                  <li><a href="../deep-dive/ui/focus-tracking.html">
                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Focus tracking</span>
                                                      </div></a></li>
                                                  <li><a href="../deep-dive/ui/widget-internals.html">
                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Widget internals</span>
                                                      </div></a></li>
                                                  <li><a href="../deep-dive/ui/theme-customization.html">
                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Theme customization</span>
                                                      </div></a></li>
                                                  <li><a href="../deep-dive/ui/external-ui.html">
                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Third–party UI</span>
                                                      </div></a></li>
                                                  <li><a href="../deep-dive/ui/document-editor.html">
                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Document editor</span>
                                                      </div></a></li>
                                                  <li><a href="../deep-dive/ui/custom-editor-creator.html">
                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Creating custom editor</span>
                                                      </div></a></li>
                                                  <li><a href="../deep-dive/ui/localization.html">
                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Localization</span>
                                                      </div></a></li>
                                            </ul>
                                          </li>
                                    </ul>
                                  </li>
                                  <li>
                                    <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Contributing</span>
                                    </div>
                                    <ul class="tree__item-nested-list">
                                          <li><a href="../contributing/contributing.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Contributing</span>
                                              </div></a></li>
                                          <li><a href="../contributing/development-environment.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Development environment</span>
                                              </div></a></li>
                                          <li><a href="../contributing/testing-environment.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Testing environment</span>
                                              </div></a></li>
                                          <li><a href="../contributing/code-style.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Code style</span>
                                              </div></a></li>
                                          <li><a href="../contributing/package-metadata.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Package metadata</span>
                                              </div></a></li>
                                          <li><a href="../contributing/git-commit-message-convention.html">
                                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Git commit message convention</span>
                                              </div></a></li>
                                    </ul>
                                  </li>
                            </ul>
                          </li>
                </ul>
              </li>
              <li data-group="api-reference"><a href="../../../api/index.html">API</a>
              </li>
            </ul>
          </li>
        </ul>
      </div>
    </header>
    <main class="main">
      <section class="main__content formatted">
        <div class="main__content-inner">
          <div class="github-contrib"><a href="https://github.com/ckeditor/ckeditor5/blob/master/docs/framework/guides/architecture/editing-engine.md" title="Contribute to this guide"><img src="../../../../../assets/2.4.0/img/edit.svg" alt="Contribute to this guide"></a>
          </div>
          <div class="rwd-breadcrumbs"><a href="../../../../../index.html">Home</a><span class="rwd-breadcrumbs__separator">/</span><a href="../../../index.html">CKEditor 5</a><span class="rwd-breadcrumbs__separator">/</span><a href="../../index.html">Framework</a>
          </div>
          <h1 class="main__content-title"><img src="../../../../../assets/2.4.0/img/book.svg" alt="guide">Editing engine
          </h1><nav class="secondary-navigation"><h3>Table of contents</h3><ol><li><a href="#overview">Overview</a></li><li><a href="#model">Model</a><ol><li><a href="#changing-the-model">Changing the model</a></li><li><a href="#text-attributes">Text attributes</a></li><li><a href="#selection-attributes">Selection attributes</a></li><li><a href="#indexes-and-offsets">Indexes and offsets</a></li><li><a href="#positions-ranges-and-selections">Positions, ranges and selections</a></li><li><a href="#markers">Markers</a></li><li><a href="#schema">Schema</a></li></ol></li><li><a href="#view">View</a><ol><li><a href="#element-types-and-custom-data">Element types and custom data</a><ol><li><a href="#non-semantic-views">Non-semantic views</a></li></ol></li><li><a href="#changing-the-view">Changing the view</a></li><li><a href="#positions">Positions</a></li><li><a href="#observers">Observers</a></li></ol></li><li><a href="#conversion">Conversion</a><ol><li><a href="#data-pipeline">Data pipeline</a></li><li><a href="#editing-pipeline">Editing pipeline</a></li><li><a href="#more-information">More information</a></li></ol></li><li><a href="#read-next">Read next</a></li></ol></nav>
<p>The <a href="https://www.npmjs.com/package/@ckeditor/ckeditor5-engine"><code>@ckeditor/ckeditor5-engine</code></a> package is by far the biggest package of all. Therefore, this guide will only scratch the surface here by introducing the main architecture layers and concepts. More detailed guides will follow.</p>
<div class="info-box notice"><p>We recommend using the official <a href="../development-tools.html#ckeditor-5-inspector">CKEditor 5 inspector</a> for development and debugging. It will give you tons of useful information about the state of the editor such as internal data structures, selection, commands, and many more.</p></div>
<h2 id="overview"><a class="headerlink" href="#overview">#</a> Overview</h2>
<p>The editing engine implements an MVC architecture. The shape of it is not enforced by the engine itself but in most implementations it can be described by this diagram:</p>
<p><a href="../../../assets/img/framework-architecture-engine-diagram.png"><img src="../../../assets/img/framework-architecture-engine-diagram.png" data-lightbox="true" alt="Diagram of the engine’s MVC architecture."></a></p>
<p>What you can see, are three layers: <strong>model</strong>, <strong>controller</strong> and <strong>view</strong>. There is one <strong>model document</strong> which is <a href="../deep-dive/conversion/intro.html"><strong>converted</strong></a> into separate views — the <a href="#editing-pipeline"><strong>editing view</strong></a> and the <a href="#data-pipeline"><strong>data view</strong></a>. These two views represent, respectively, the content that the user is editing (the DOM structure that you see in the browser) and the editor input and output data (in a format that the plugged data processor understands). Both views feature virtual DOM structures (custom, DOM-like structures) on which converters and features work and which are then <strong>rendered</strong> to the DOM.</p>
<p>The green blocks are the code introduced by editor features (plugins). These features control what changes are made to the model, how they are converted to the view and how the model needs to be changed based on fired events (the view’s and model’s ones).</p>
<p>Let’s now talk about each layer separately.</p>
<h2 id="model"><a class="headerlink" href="#model">#</a> Model</h2>
<p>The model is implemented by a DOM-like tree structure of <a href="../../../api/module_engine_model_element-Element.html">elements</a> and <a href="../../../api/module_engine_model_text-Text.html">text nodes</a>. Unlike in the actual DOM, in the model, both elements and text nodes can have attributes.</p>
<p>Like in the DOM, the model structure is contained within a <a href="../../../api/module_engine_model_document-Document.html">document</a> that contains <a href="../../../api/module_engine_model_document-Document.html#member-roots">root elements</a> (the model, as well as the view, may have multiple roots). The document also holds its <a href="../../../api/module_engine_model_documentselection-DocumentSelection.html">selection</a> and the <a href="../../../api/module_engine_model_history-History.html">history of its changes</a>.</p>
<p>Finally, the document, its <a href="../../../api/module_engine_model_schema-Schema.html">schema</a> and <a href="../../../api/module_engine_model_markercollection-MarkerCollection.html">document markers</a> are properties of the <a href="../../../api/module_engine_model_model-Model.html"><code>Model</code></a>. An instance of the <code>Model</code> class is available in the <a href="../../../api/module_core_editor_editor-Editor.html#member-model"><code>editor.model</code></a> property. The model, besides holding the properties described above, provides the API for changing the document and its markers, too.</p>
<pre class="highlight"><code class="js">editor.model;                       // -&gt; The data model.
editor.model.document;              // -&gt; The document.
editor.model.document.getRoot();    // -&gt; The document's root.
editor.model.document.selection;    // -&gt; The document's selection.
editor.model.schema;                // -&gt; The model's schema.
</code></pre>
<h3 id="changing-the-model"><a class="headerlink" href="#changing-the-model">#</a> Changing the model</h3>
<p>All changes in the document structure, of the document’s selection and even the creation of elements, can only be done by using the <a href="../../../api/module_engine_model_writer-Writer.html">model writer</a>. Its instance is available in <a href="../../../api/module_engine_model_model-Model.html#function-change"><code>change()</code></a> and <a href="../../../api/module_engine_model_model-Model.html#function-enqueueChange"><code>enqueueChange()</code></a> blocks.</p>
<pre class="highlight"><code class="js">// Inserts text "foo" at the selection position.
editor.model.change( writer =&gt; {
    writer.insertText( 'foo', editor.model.document.selection.getFirstPosition() );
} );

// Apply bold to the entire selection.
editor.model.change( writer =&gt; {
    for ( const range of editor.model.document.selection.getRanges() ) {
        writer.setAttribute( 'bold', true, range );
    }
} );
</code></pre>
<p>All changes done within a single <code>change()</code> block are combined into one undo step (they are added to a single <a href="../../../api/module_engine_model_batch-Batch.html">batch</a>). When nesting <code>change()</code> blocks, all changes are added to the outermost <code>change()</code> block’s batch. For example, the code below will create a single undo step:</p>
<pre class="highlight"><code class="js">editor.model.change( writer =&gt; {
    writer.insertText( 'foo', paragraph, 'end' ); // foo.

    editor.model.change( writer =&gt; {
        writer.insertText( 'bar', paragraph, 'end' ); // foobar.
    } );

    writer.insertText( 'bom', paragraph, 'end' ); // foobarbom.
} );
</code></pre>
<div class="info-box notice"><p>All changes made to the document structure are done by applying <a href="../../../api/module_engine_model_operation_operation-Operation.html">operations</a>. The concept of operations comes from <a href="https://en.wikipedia.org/wiki/Operational_transformation">Operational Transformation</a> (in short: OT), a technology enabling collaboration functionality. Since OT requires a system to be able to transform every operation by every other one (to figure out the result of concurrently applied operations), the set of operations needs to be small. CKEditor 5 features a non-linear model (normally, OT implementations use flat, array-like models while CKEditor 5 uses a tree structure), hence the set of potential semantic changes is more complex. Operations are grouped in <a href="../../../api/module_engine_model_batch-Batch.html">batches</a>. A batch may be understood as a single undo step.</p></div>
<h3 id="text-attributes"><a class="headerlink" href="#text-attributes">#</a> Text attributes</h3>
<p>Text styles such as “bold” and “italic” are kept in the model not as elements but as text attributes (think — like element attributes). The following DOM structure:</p>
<pre class="highlight"><code class="html">&lt;p&gt;
    "Foo "
    &lt;strong&gt;
        "bar"
    &lt;/strong&gt;
&lt;/p&gt;
</code></pre>
<p>would translate to the following model structure:</p>
<pre class="highlight"><code class="html">&lt;paragraph&gt;
    "Foo "  // text node
    "bar"   // text node with the bold=true attribute
&lt;/paragraph&gt;
</code></pre>
<p>Such representation of inline text styling allows to significantly reduce the complexity of algorithms operating on the model. For instance, if you have the following DOM structure:</p>
<pre class="highlight"><code class="html">&lt;p&gt;
    "Foo "
    &lt;strong&gt;
        "bar"
    &lt;/strong&gt;
&lt;/p&gt;
</code></pre>
<p>and you have a selection before the letter <code>"b"</code> (<code>"Foo ^bar"</code>), is this position inside or outside <code>&lt;strong&gt;</code>? If you use <a href="https://developer.mozilla.org/en-US/docs/Web/API/Selection">native DOM Selection</a>, you may get both positions — one anchored in <code>&lt;p&gt;</code> and the other anchored in <code>&lt;strong&gt;</code>. In CKEditor 5 this position translates exactly to <code>"Foo ^bar"</code>.</p>
<h3 id="selection-attributes"><a class="headerlink" href="#selection-attributes">#</a> Selection attributes</h3>
<p>OK, but how to let CKEditor 5 know that I want the selection to “be bold” in the case described above? This is important information because it affects whether or not the typed text will be bold, too.</p>
<p>To handle that, the selection also <a href="../../../api/module_engine_model_selection-Selection.html#function-setAttribute">has attributes</a>. If the selection is placed in <code>"Foo ^bar"</code> and it has the attribute <code>bold=true</code>, you know that the user will type bold text.</p>
<h3 id="indexes-and-offsets"><a class="headerlink" href="#indexes-and-offsets">#</a> Indexes and offsets</h3>
<p>However, it has just been said that inside <code>&lt;paragraph&gt;</code> there are two text nodes: <code>"Foo "</code> and <code>"bar"</code>. If you know how <a href="https://developer.mozilla.org/en-US/docs/Web/API/Range">native DOM Ranges</a> work you might thus ask: “But if the selection is at the boundary of two text nodes, is it anchored in the left one, the right one, or in the containing element?”</p>
<p>This is, indeed, another problem with DOM APIs. Not only can positions outside and inside some element be identical visually but also they can be anchored inside or outside a text node (if the position is at a text node boundary). This all creates extreme complications when implementing editing algorithms.</p>
<p>To avoid such troubles, and to make collaborative editing possible for real, CKEditor 5 uses the concepts of <strong>indexes</strong> and <strong>offsets</strong>. Indexes relate to nodes (elements and text nodes) while offsets relate to positions. For example, in the following structure:</p>
<pre class="highlight"><code class="html">&lt;paragraph&gt;
    "Foo "
    &lt;imageInline&gt;&lt;/imageInline&gt;
    "bar"
&lt;/paragraph&gt;
</code></pre>
<p>The <code>"Foo "</code> text node is at index <code>0</code> in its parent, <code>&lt;imageInline&gt;&lt;/imageInline&gt;</code> is at index <code>1</code> and <code>"bar"</code> is at index <code>2</code>.</p>
<p>On the other hand, offset <code>x</code> in <code>&lt;paragraph&gt;</code> translates to:</p>
<table>
<thead>
<tr>
<th>Offset</th>
<th>Position</th>
<th>Node</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>0</code></td>
<td><code>&lt;paragraph&gt;^Foo &lt;imageInline&gt;&lt;/imageInline&gt;bar&lt;/paragraph&gt;</code></td>
<td><code>"Foo "</code></td>
</tr>
<tr>
<td><code>1</code></td>
<td><code>&lt;paragraph&gt;F^oo &lt;imageInline&gt;&lt;/imageInline&gt;bar&lt;/paragraph&gt;</code></td>
<td><code>"Foo "</code></td>
</tr>
<tr>
<td><code>4</code></td>
<td><code>&lt;paragraph&gt;Foo ^&lt;imageInline&gt;&lt;/imageInline&gt;bar&lt;/paragraph&gt;</code></td>
<td><code>&lt;imageInline&gt;</code></td>
</tr>
<tr>
<td><code>6</code></td>
<td><code>&lt;paragraph&gt;Foo &lt;imageInline&gt;&lt;/imageInline&gt;b^ar&lt;/paragraph&gt;</code></td>
<td><code>"bar"</code></td>
</tr>
</tbody>
</table>
<h3 id="positions-ranges-and-selections"><a class="headerlink" href="#positions-ranges-and-selections">#</a> Positions, ranges and selections</h3>
<p>The engine also defines three levels of classes that operate on offsets:</p>
<ul>
<li>A <a href="../../../api/module_engine_model_position-Position.html"><code>Position</code></a> instance contains an <a href="../../../api/module_engine_model_position-Position.html#member-path">array of offsets</a> (which is called a “path”). See the examples in the <a href="../../../api/module_engine_model_position-Position.html#member-path"><code>Position#path</code> API documentation</a> to better understand how paths work.</li>
<li>A <a href="../../../api/module_engine_model_range-Range.html"><code>Range</code></a> contains two positions: <a href="../../../api/module_engine_model_range-Range.html#member-start">start</a> and <a href="../../../api/module_engine_model_range-Range.html#member-end">end</a> ones.</li>
<li>Finally, there is a <a href="../../../api/module_engine_model_selection-Selection.html"><code>Selection</code></a> which contains one or more ranges, attributes, and has a direction (whether it was done from left to right or right to left). You can make as many instances of it as you need and you can freely modify it whenever you want. Additionally, there is a single <a href="../../../api/module_engine_model_documentselection-DocumentSelection.html"><code>DocumentSelection</code></a>. It represents the document’s selection and can only be changed through the <a href="../../../api/module_engine_model_writer-Writer.html">model writer</a>. It is automatically updated when the document’s structure is changed.</li>
</ul>
<h3 id="markers"><a class="headerlink" href="#markers">#</a> Markers</h3>
<p>Markers are a special type of ranges.</p>
<ul>
<li>They are managed by <a href="../../../api/module_engine_model_markercollection-MarkerCollection.html"><code>MarkerCollection</code></a>.</li>
<li>They can only be created and changed through the <a href="../../../api/module_engine_model_writer-Writer.html">model writer</a>.</li>
<li>They can be synchronized over the network with other collaborating clients.</li>
<li>They are automatically updated when the document’s structure is changed.</li>
<li>They can be converted to the editing view to show them in the editor (as <a href="../../../api/module_engine_conversion_downcasthelpers-DowncastHelpers.html#function-markerToHighlight">highlights</a> or <a href="../../../api/module_engine_conversion_downcasthelpers-DowncastHelpers.html#function-markerToElement">elements</a>).</li>
<li>They can be <a href="../../../api/module_engine_conversion_downcasthelpers-DowncastHelpers.html#function-markerToData">converted to the data view</a> to store them with the document data.</li>
<li>They can be <a href="../../../api/module_engine_conversion_upcasthelpers-UpcastHelpers.html#function-dataToMarker">loaded with the document data</a>.</li>
</ul>
<p>Markers are perfect for storing and maintaining additional data related to portions of the document such as comments or selections of other users.</p>
<h3 id="schema"><a class="headerlink" href="#schema">#</a> Schema</h3>
<p>The <a href="../../../api/module_engine_model_schema-Schema.html">model’s schema</a> defines several aspects of how the model should look:</p>
<ul>
<li>Where a node is allowed or disallowed (e.g. <code>paragraph</code> is allowed in <code>$root</code>, but not in <code>heading1</code>).</li>
<li>What attributes are allowed for a certain node (e.g. <code>image</code> can have the <code>src</code> and <code>alt</code> attributes).</li>
<li>Additional semantics of model nodes (e.g. <code>image</code> is of the “object” type and paragraph of the “block” type).</li>
</ul>
<p>This information is then used by the features and the engine to make decisions on how to process the model. For instance, the information from the schema will affect:</p>
<ul>
<li>What happens with the pasted content and what is filtered out (note: in case of pasting the other important mechanism is the <a href="../deep-dive/conversion/upcast.html">conversion</a>. HTML elements and attributes which are not upcasted by any of the registered converters are filtered out before they even become model nodes, so the schema is not applied to them; the conversion will be covered later in this guide).</li>
<li>To which elements the heading feature can be applied (which blocks can be turned to headings and which elements are blocks in the first place).</li>
<li>Which elements can be wrapped with a block quote.</li>
<li>Whether the bold button is enabled when the selection is in a heading (and whether the text in this heading can be bolded).</li>
<li>Where the selection can be placed (which is — only in text nodes and on object elements).</li>
<li>etc.</li>
</ul>
<p>The schema is, by default, configured by editor plugins. It is recommended that every editor feature comes with rules that enable and preconfigure it in the editor. This will make sure that the plugin user can enable it without worrying to re-configure their schema.</p>
<div class="info-box notice"><p>Currently, there is <a href="https://github.com/ckeditor/ckeditor5-engine/issues/1367">no straightforward way to override the schema</a> preconfigured by features. If you want to override the default settings when initializing the editor, the best solution is to replace <code>editor.model.schema</code> with a new instance of it. This, however, requires rebuilding the editor.</p></div>
<p>The instance of the schema is available in <a href="../../../api/module_engine_model_model-Model.html#member-schema"><code>editor.model.schema</code></a>. Read an extensive guide about using the schema API in the <a href="../deep-dive/schema.html">Schema deep dive</a> guide.</p>
<h2 id="view"><a class="headerlink" href="#view">#</a> View</h2>
<p>Let’s again take a look at the editing engine’s architecture:</p>
<p><a href="../../../assets/img/framework-architecture-engine-diagram.png"><img src="../../../assets/img/framework-architecture-engine-diagram.png" data-lightbox="true" alt="Diagram of the engine’s MVC architecture."></a></p>
<p>So far, we talked about the topmost layer of this diagram — the model. The role of the model layer is to create an abstraction over the data. Its format was designed to allow storing and modifying the data in the most convenient way, while enabling implementation of complex features. Most features operate on the model (read from it and change it).</p>
<p>The view, on the other hand, is an abstract representation of the DOM structure which should be presented to the user (for editing) and which should (in most cases) represent the editor’s input and output (i.e. the data returned by <code>editor.getData()</code>, the data set by <code>editor.setData()</code>, pasted content, etc.).</p>
<p>What this means is that:</p>
<ul>
<li>The view is yet another custom structure.</li>
<li>It resembles the DOM. While the model’s tree structure only slightly resembled the DOM (e.g. by introducing text attributes), the view is much closer to the DOM. In other words, it is a <strong>virtual DOM</strong>.</li>
<li>There are two “pipelines”: the <a href="#editing-pipeline"><strong>editing pipeline</strong></a> (also called the “editing view”) and the <a href="#data-pipeline"><strong>data pipeline</strong></a> (the “data view”). Treat them as two separate views of one model. The editing pipeline renders and handles the DOM that the user sees and can edit. The data pipeline is used when you call <code>editor.getData()</code>, <code>editor.setData()</code> or paste content into the editor.</li>
<li>The views are rendered to the DOM by the <a href="../../../api/module_engine_view_renderer-Renderer.html"><code>Renderer</code></a> which handles all the quirks required to tame the <code>contentEditable</code> used in the editing pipeline.</li>
</ul>
<p>The fact that there are two views is visible in the API:</p>
<pre class="highlight"><code class="js">editor.editing;                 // The editing pipeline (EditingController).
editor.editing.view;            // The editing view's controller.
editor.editing.view.document;   // The editing view's document.
editor.data;                    // The data pipeline (DataController).
</code></pre>
<div class="info-box notice"><p>Technically, the data pipeline does not have a document and a view controller. It operates on detached view structures, created for the purposes of processing data.</p><p>It is much simpler than the editing pipeline and in the following part of this section we will be talking about the editing view.</p><p>Check out the <a href="../../../api/module_engine_controller_editingcontroller-EditingController.html"><code>EditingController</code></a>'s and <a href="../../../api/module_engine_controller_datacontroller-DataController.html"><code>DataController</code></a>'s API for more details.</p></div>
<h3 id="element-types-and-custom-data"><a class="headerlink" href="#element-types-and-custom-data">#</a> Element types and custom data</h3>
<p>The structure of the view resembles the structure in the DOM very closely. The semantics of HTML is defined in its specification. The view structure comes “DTD-free”, so in order to provide additional information and to better express the semantics of the content, the view structure implements 6 element types (<a href="../../../api/module_engine_view_containerelement-ContainerElement.html"><code>ContainerElement</code></a>, <a href="../../../api/module_engine_view_attributeelement-AttributeElement.html"><code>AttributeElement</code></a>, <a href="../../../api/module_engine_view_emptyelement-EmptyElement.html"><code>EmptyElement</code></a>, <a href="../../../api/module_engine_view_rawelement-RawElement.html"><code>RawElement</code></a>, <a href="../../../api/module_engine_view_uielement-UIElement.html"><code>UIElement</code></a>, and <a href="../../../api/module_engine_view_editableelement-EditableElement.html"><code>EditableElement</code></a>) and so called <a href="../../../api/module_engine_view_element-Element.html#function-getCustomProperty">“custom properties”</a> (i.e. custom element properties which are not rendered). This additional information provided by the editor features is then used by the <a href="../../../api/module_engine_view_renderer-Renderer.html"><code>Renderer</code></a> and <a href="#conversion">converters</a>.</p>
<p>The element types can be defined as follows:</p>
<ul>
<li><strong>Container element</strong> – The elements that build the structure of the content. Used for block elements such as <code>&lt;p&gt;</code>, <code>&lt;h1&gt;</code>, <code>&lt;blockQuote&gt;</code>, <code>&lt;li&gt;</code>, etc.</li>
<li><strong>Attribute element</strong> – The elements that cannot hold container elements inside them. Most model text attributes are converted to view attribute elements. They are used mostly for inline styling elements such as <code>&lt;strong&gt;</code>, <code>&lt;i&gt;</code>, <code>&lt;a&gt;</code>, <code>&lt;code&gt;</code>. Similar attribute elements are flattened by the view writer, so e.g. <code>&lt;a href="..."&gt;&lt;a class="bar"&gt;x&lt;/a&gt;&lt;/a&gt;</code> would automatically be optimized to <code>&lt;a href="..." class="bar"&gt;x&lt;/a&gt;</code>.</li>
<li><strong>Empty element</strong> – The elements that must not have any child nodes, for example <code>&lt;img&gt;</code>.</li>
<li><strong>UI element</strong> – The elements that are not a part of the “data” but need to be “inlined” in the content. They are ignored by the selection (it jumps over them) and the view writer in general. The contents of these elements and events coming from them are filtered out, too.</li>
<li><strong>Raw element</strong> – The elements that work as data containers (“wrappers”, “sandboxes”) but their children are transparent to the editor. Useful when non-standard data must be rendered but the editor should not be concerned what it is and how it works. Users cannot put the selection inside a raw element, split it into smaller chunks or directly modify its content.</li>
<li><strong>Editable element</strong> – The elements used as “nested editables” of non-editable fragments of the content, for example a caption in the image widget, where the <code>&lt;figure&gt;</code> wrapping the image is not editable (it is a widget) and the <code>&lt;figcaption&gt;</code> inside it is an editable element.</li>
</ul>
<p>Additionally, you can define <a href="../../../api/module_engine_view_element-Element.html#function-getCustomProperty">custom properties</a> which may be used to store information like:</p>
<ul>
<li>Whether an element is a widget (added by <a href="../../../api/module_widget_utils.html#function-toWidget"><code>toWidget()</code></a>).</li>
<li>How an element should be marked when a <a href="#markers">marker</a> highlights it.</li>
<li>Whether an element belongs to a certain feature — if it is a link, progress bar, caption, etc.</li>
</ul>
<h4 id="non-semantic-views"><a class="headerlink" href="#non-semantic-views">#</a> Non-semantic views</h4>
<p>Not all view trees need to (and can) be build with semantic element types. View structures generated straight from input data (e.g. pasted HTML or with <code>editor.setData()</code>) consists only of <a href="../../../api/module_engine_view_element-Element.html">base element</a> instances. Those view structures are (usually) <a href="#conversion">converted to model structures</a> and then converted back to view structures for editing or data retrieval purposes, at which point they become semantic views again.</p>
<p>The additional information conveyed in the semantic views and special types of operations that feature developers want to perform on those tree (compared to simple tree operations on non-semantic views) means that both structures need to be <a href="#changing-the-view">modified by different tools</a>.</p>
<p>We will explain the <a href="#conversion">conversion</a> later in this guide. For now, it is only important for you to know that there are semantic views for rendering and data retrieval purposes and non-semantic views for data input.</p>
<h3 id="changing-the-view"><a class="headerlink" href="#changing-the-view">#</a> Changing the view</h3>
<p>Do not change the view manually, unless you really know what you are doing. If the view needs to be changed, in most cases, it means that the model should be changed first. Then the changes you apply to the model are converted (<a href="#conversion">conversion</a> is covered below) to the view by specific converters.</p>
<p>The view may need to be changed manually if the cause of such change is not represented in the model. For example, the model does not store information about the focus, which is a <a href="../../../api/module_engine_view_document-Document.html#member-isFocused">property of the view</a>. When the focus changes, and you want to represent that in some element’s class, you need to change that class manually.</p>
<p>For that, just like in the model, you should use the <code>change()</code> block (of the view) in which you will have access to the view downcast writer.</p>
<pre class="highlight"><code class="js">editor.editing.view.change( writer =&gt; {
    writer.insert( position, writer.createText( 'foo' ) );
} );
</code></pre>
<div class="info-box notice"><p>There are two view writers:</p><ul>
<li><a href="../../../api/module_engine_view_downcastwriter-DowncastWriter.html"><code>DowncastWriter</code></a> — available in the <code>change()</code> blocks, used during downcasting the model to the view. It operates on a “semantic view” so a view structure which differentiates between different types of elements (see <a href="#element-types-and-custom-data">Element types and custom data</a>).</li>
<li><a href="../../../api/module_engine_view_upcastwriter-UpcastWriter.html"><code>UpcastWriter</code></a> — a writer to be used when pre-processing the “input” data (e.g. pasted content) which happens usually before the conversion (upcasting) to the model. It operates on <a href="#non-semantic-views">“non-semantic views”</a>.</li>
</ul>
</div>
<h3 id="positions"><a class="headerlink" href="#positions">#</a> Positions</h3>
<p>Just like <a href="#positions-ranges-and-selections">in the model</a>, there are 3 levels of classes in the view that describe points in the view structure: <strong>positions</strong>, <strong>ranges</strong> and <strong>selections</strong>. A position is a single point in the document. A range consists of two positions (start and end). A selection consists of one or more ranges and has a direction (whether it was done from left to right or from right to left).</p>
<p>A view range is very similar to its <a href="https://www.w3.org/TR/DOM-Level-2-Traversal-Range/ranges.html">DOM counterpart</a> as view positions are represented by a parent and an offset in that parent. This means that, unlike model offsets, view offsets describe:</p>
<ul>
<li>points between child nodes of the position’s parent if it is an element,</li>
<li>or points between the character of a text node if position’s parent is a text node.</li>
</ul>
<p>Therefore, you can say that view offsets work more like model indexes than model offsets.</p>
<table>
<thead>
<tr>
<th>Parent</th>
<th>Offset</th>
<th>Position</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;p&gt;</code></td>
<td><code>0</code></td>
<td><code>&lt;p&gt;^Foo&lt;img&gt;&lt;/img&gt;bar&lt;/p&gt;</code></td>
</tr>
<tr>
<td><code>&lt;p&gt;</code></td>
<td><code>1</code></td>
<td><code>&lt;p&gt;Foo^&lt;img&gt;&lt;/img&gt;bar&lt;/p&gt;</code></td>
</tr>
<tr>
<td><code>&lt;p&gt;</code></td>
<td><code>2</code></td>
<td><code>&lt;p&gt;Foo&lt;img&gt;&lt;/img&gt;^bar&lt;/p&gt;</code></td>
</tr>
<tr>
<td><code>&lt;img&gt;</code></td>
<td><code>0</code></td>
<td><code>&lt;p&gt;Foo&lt;img&gt;^&lt;/img&gt;bar&lt;/p&gt;</code></td>
</tr>
<tr>
<td><code>Foo</code></td>
<td><code>1</code></td>
<td><code>&lt;p&gt;F^oo&lt;img&gt;&lt;/img&gt;bar&lt;/p&gt;</code></td>
</tr>
<tr>
<td><code>Foo</code></td>
<td><code>3</code></td>
<td><code>&lt;p&gt;Foo^&lt;img&gt;&lt;/img&gt;bar&lt;/p&gt;</code></td>
</tr>
</tbody>
</table>
<p>As you can see, two of these positions represent what you can consider the same point in the document:</p>
<ul>
<li><code>{ parent: paragraphElement, offset: 1 }</code></li>
<li><code>{ parent: fooTextNode, offset: 3 }</code></li>
</ul>
<p>Some browsers (Safari, Chrome and Opera) consider them identical, too (when used in a selection) and often normalize the first position (anchored in an element) to a position anchored in a text node (the second position). Do not be surprised that the view selection is not directly where you would like it to be. The good news is that the CKEditor 5 renderer can tell that two positions are identical and avoids re-rendering the DOM selection unnecessarily.</p>
<div class="info-box notice"><p>Sometimes you may find in the documentation that positions are marked in HTML with the <code>{}</code> and <code>[]</code> characters. The difference between them is that the former indicates positions anchored in text nodes and the latter in elements. So, for example, the following example:</p><pre class="highlight"><code class="html">&lt;p&gt;{Foo]&lt;b&gt;Bar&lt;/b&gt;&lt;/p&gt;
</code></pre><p>describes a range which starts in the text node <code>Foo</code> at offset <code>0</code> and ends in the <code>&lt;p&gt;</code> element at offset <code>1</code>.</p></div>
<p>The far-from-convenient representation of DOM positions is yet one more reason to think about and work with model positions.</p>
<h3 id="observers"><a class="headerlink" href="#observers">#</a> Observers</h3>
<p>In order to create a safer and more useful abstraction over native DOM events, the view implements the concept of <a href="../../../api/module_engine_view_observer_observer-Observer.html">observers</a>. It improves the testability of the editor as well as simplifies the listeners added by editor features by transforming the native events into a more useful form.</p>
<p>An observer listens to one or more DOM events, does preliminary processing of this event and then fires a custom event on the <a href="../../../api/module_engine_view_document-Document.html">view document</a>. An observer not only creates an abstraction on the event itself but also on its data. Ideally, an event’s consumer should not have any access to the native DOM.</p>
<p>By default, the view adds the following observers:</p>
<ul>
<li><a href="../../../api/module_engine_view_observer_mutationobserver-MutationObserver.html"><code>MutationObserver</code></a></li>
<li><a href="../../../api/module_engine_view_observer_selectionobserver-SelectionObserver.html"><code>SelectionObserver</code></a></li>
<li><a href="../../../api/module_engine_view_observer_focusobserver-FocusObserver.html"><code>FocusObserver</code></a></li>
<li><a href="../../../api/module_engine_view_observer_keyobserver-KeyObserver.html"><code>KeyObserver</code></a></li>
<li><a href="../../../api/module_engine_view_observer_fakeselectionobserver-FakeSelectionObserver.html"><code>FakeSelectionObserver</code></a></li>
<li><a href="../../../api/module_engine_view_observer_compositionobserver-CompositionObserver.html"><code>CompositionObserver</code></a></li>
<li><a href="../../../api/module_engine_view_observer_arrowkeysobserver-ArrowKeysObserver.html"><code>ArrowKeysObserver</code></a></li>
</ul>
<p>Additionally, some features add their own observers. For instance, the <a href="../../../api/module_clipboard_clipboard-Clipboard.html">clipboard feature</a> adds <a href="../../../api/module_clipboard_clipboardobserver-ClipboardObserver.html"><code>ClipboardObserver</code></a>.</p>
<div class="info-box notice"><p>For a complete list of events fired by observers check the <a href="../../../api/module_engine_view_document-Document.html"><code>Document</code></a>'s list of events.</p></div>
<p>You can add your own observer (which should be a subclass of <a href="../../../api/module_engine_view_observer_observer-Observer.html"><code>Observer</code></a>) by using the <a href="../../../api/module_engine_view_view-View.html#function-addObserver"><code>view.addObserver()</code></a> method. Check the code of existing observers to learn how to write them: <a href="https://github.com/ckeditor/ckeditor5-engine/tree/master/src/view/observer">https://github.com/ckeditor/ckeditor5-engine/tree/master/src/view/observer</a>.</p>
<div class="info-box notice"><p>Since all events are by default fired on <a href="../../../api/module_engine_view_document-Document.html"><code>Document</code></a>, it is recommended that third party packages prefix their events with an identifier of the project to avoid name collisions. For example, MyApp’s features should fire <code>myApp:keydown</code> instead of <code>keydown</code>.</p></div>
<h2 id="conversion"><a class="headerlink" href="#conversion">#</a> Conversion</h2>
<p>So far, we talked about the model and the view as about two completely independent subsystems. It is time to connect them. The three main situations in which these two layers meet are:</p>
<table>
<thead>
<tr>
<th>Conversion&nbsp;name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="../deep-dive/conversion/upcast.html">Data&nbsp;upcasting</a></td>
<td><strong>Loading the data to the editor.</strong><br> First, the data (e.g. an HTML string) is processed by a <a href="../../../api/module_engine_dataprocessor_dataprocessor-DataProcessor.html"><code>DataProcessor</code></a> to a view <a href="../../../api/module_engine_view_documentfragment-DocumentFragment.html"><code>DocumentFragment</code></a>. Then, this view document fragment is converted to a model <a href="../../../api/module_engine_model_documentfragment-DocumentFragment.html">document fragment</a>. Finally, the model document’s <a href="../../../api/module_engine_model_document-Document.html#member-roots">root</a> is filled with this content.</td>
</tr>
<tr>
<td><a href="../deep-dive/conversion/downcast.html#downcast-pipelines">Data&nbsp;downcasting</a></td>
<td><strong>Retrieving the data from the editor.</strong><br> First, the content of the model’s root is converted to a view document fragment. Then this view document fragment is processed by a data processor to the target data format.</td>
</tr>
<tr>
<td><a href="../deep-dive/conversion/downcast.html#downcast-pipelines">Editing&nbsp;downcasting</a></td>
<td><strong>Rendering the editor content to the user for editing.</strong><br> This process takes place for the entire time when the editor is initialized. First, the model’s root is converted to the view’s root once <em>data upcasting</em> finishes. After that this view root is rendered to the user in the editor’s <code>contentEditable</code> DOM element (also called “the editable element”). Then, every time the model changes, those changes are converted to changes in the view. Finally, the view can be re-rendered to the DOM if needed (if the DOM differs from the view).</td>
</tr>
</tbody>
</table>
<p>Let’s take a look at the diagram of the engine’s MVC architecture and see where each of the conversion processes happen in it:</p>
<p><a href="../../../assets/img/framework-architecture-engine-diagram.png"><img src="../../../assets/img/framework-architecture-engine-diagram.png" data-lightbox="true" alt="Diagram of the engine’s MVC architecture."></a></p>
<h3 id="data-pipeline"><a class="headerlink" href="#data-pipeline">#</a> Data pipeline</h3>
<p><a href="../deep-dive/conversion/upcast.html"><strong>Data upcasting</strong></a> is a process which starts in the bottom right corner of the diagram (in the view layer), passes from the data view, through a converter (green box) in the controller layer to the model document in the top right-hand corner. As you can see, it goes from the bottom to the top, hence “upcasting”. Also, it is handled by the <em>data pipeline</em> (the right branch of the diagram), hence “data upcasting”. Note: Data upcasting is also used to process pasted content (which is similar to loading data).</p>
<p><a href="../deep-dive/conversion/downcast.html#downcast-pipelines"><strong>Data downcasting</strong></a> is the opposite process to <em>data upcasting</em>. It starts in the top right-hand corner and goes down to the bottom right-hand corner. Again, the name of the conversion process matches the direction and the pipeline.</p>
<h3 id="editing-pipeline"><a class="headerlink" href="#editing-pipeline">#</a> Editing pipeline</h3>
<p><a href="../deep-dive/conversion/downcast.html#downcast-pipelines"><strong>Editing downcasting</strong></a> is a bit different process than the other two.</p>
<ul>
<li>It takes place in the “editing pipeline” (the left branch of the diagram).</li>
<li>It does not have its counterpart — there is no <em>editing upcasting</em> because all user actions are handled by editor features by listening to <a href="#observers">view events</a>, analyzing what happened and applying necessary changes to the model. Hence, this process does not involve conversion.</li>
<li>Unlike <a href="../../../api/module_engine_controller_datacontroller-DataController.html"><code>DataController</code></a> (which handles the <em>data pipeline</em>), <a href="../../../api/module_engine_controller_editingcontroller-EditingController.html"><code>EditingController</code></a> maintains a single instance of the <a href="../../../api/module_engine_view_document-Document.html"><code>Document</code></a> view document’s for its entire life. Every change in the model is converted to changes in that view so changes in that view can then be rendered to the DOM (if needed — i.e. if the DOM actually differs from the view at this stage).</li>
</ul>
<h3 id="more-information"><a class="headerlink" href="#more-information">#</a> More information</h3>
<p>A more in-depth introduction with examples can be found in the <a href="../deep-dive/conversion/intro.html">dedicated conversion guide</a>.</p>
<p>For additional information, you can also check out the <a href="../tutorials/implementing-a-block-widget.html#defining-converters">Implementing a block widget</a> and <a href="../tutorials/implementing-an-inline-widget.html#defining-converters">Implementing an inline widget</a> tutorials.</p>
<!--TODO: upcasting, downcasting, mapping nodes and positions, API.

## Architecture of a typical feature
-->
<h2 id="read-next"><a class="headerlink" href="#read-next">#</a> Read next</h2>
<p>Once you have learnt how to implement editing features, it is time to add a UI for them. You can read about the CKEditor 5 standard UI framework and UI library in the <a href="ui-library.html">UI library</a> guide.</p>

          <div class="info-box notice notice__feedback">
            <p>
              Every day, we work hard to keep our documentation complete. Have you spotted outdated information? Is something missing?
              Please report it via our <a href="https://github.com/ckeditor/ckeditor5/issues/new?labels=squad%3Accx%2Ctype%3Adocs&amp;template=7-docs-issue-community.yml&amp;title=Docs+issue+report+from+%22framework%2Fguides%2Farchitecture%2Fediting-engine.html%22&amp;project-version=36.0.1" id="report-widget-issue-tracker">issue tracker</a>.
            </p>
          </div>
          <script>
            ( () => {
                const issueTracker = document.getElementById( 'report-widget-issue-tracker' );
                const hrefUrl = new URL( issueTracker.href );
                hrefUrl.searchParams.set( 'user-agent', navigator.userAgent )
                hrefUrl.searchParams.set( 'origin-url', location.href )
                issueTracker.href = hrefUrl.toString();
            } )();
          </script>
        </div>
      </section>
      <div class="side-navigation">
        <div class="side-navigation__wrapper">
          <nav class="side-navigation__inner">
            <ul class="tree guide-tree">
                          <li><a href="../../index.html">
                              <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Overview</span>
                              </div></a></li>
                          <li>
                            <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Guides</span>
                            </div>
                            <ul class="tree__item-nested-list">
                                    <li><a href="../quick-start.html">
                                        <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Quick start</span>
                                        </div></a></li>
                                    <li><a href="../development-tools.html">
                                        <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Development tools</span>
                                        </div></a></li>
                                    <li>
                                      <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Architecture</span>
                                      </div>
                                      <ul class="tree__item-nested-list">
                                              <li><a href="intro.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Introduction</span>
                                                  </div></a></li>
                                              <li><a href="core-editor-architecture.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Core editor architecture</span>
                                                  </div></a></li>
                                              <li><a href="">
                                                  <div class="tree__item__wrapper tree__item__wrapper--active"><span class="tree__item--guide tree__item__text">Editing engine</span>
                                                  </div></a></li>
                                              <li><a href="ui-library.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">UI library</span>
                                                  </div></a></li>
                                      </ul>
                                    </li>
                                    <li>
                                      <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Developing custom plugins</span>
                                      </div>
                                      <ul class="tree__item-nested-list">
                                              <li><a href="../plugins/creating-simple-plugin-timestamp.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Creating a basic plugin</span>
                                                  </div></a></li>
                                              <li>
                                                <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Creating an abbreviation plugin</span>
                                                </div>
                                                <ul class="tree__item-nested-list">
                                                        <li><a href="../plugins/abbreviation-plugin/abbreviation-plugin-level-1.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Defining a model and a view</span>
                                                            </div></a></li>
                                                        <li><a href="../plugins/abbreviation-plugin/abbreviation-plugin-level-2.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Getting user input with a custom UI</span>
                                                            </div></a></li>
                                                        <li><a href="../plugins/abbreviation-plugin/abbreviation-plugin-level-3.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Improving accessibility and adding a command</span>
                                                            </div></a></li>
                                                </ul>
                                              </li>
                                              <li>
                                                <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Package Generator</span>
                                                </div>
                                                <ul class="tree__item-nested-list">
                                                        <li><a href="../plugins/package-generator/using-package-generator.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Using package generator</span>
                                                            </div></a></li>
                                                        <li><a href="../plugins/package-generator/javascript-package.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">JavaScript package</span>
                                                            </div></a></li>
                                                        <li><a href="../plugins/package-generator/typescript-package.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">TypeScript package</span>
                                                            </div></a></li>
                                                </ul>
                                              </li>
                                      </ul>
                                    </li>
                                    <li>
                                      <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Advanced tutorials</span>
                                      </div>
                                      <ul class="tree__item-nested-list">
                                              <li><a href="../tutorials/implementing-a-block-widget.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Implementing a block widget</span>
                                                  </div></a></li>
                                              <li><a href="../tutorials/implementing-an-inline-widget.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Implementing an inline widget</span>
                                                  </div></a></li>
                                              <li><a href="../tutorials/data-from-external-source.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Data from an external source</span>
                                                  </div></a></li>
                                              <li><a href="../tutorials/using-react-in-a-widget.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Using a React component in a widget</span>
                                                  </div></a></li>
                                      </ul>
                                    </li>
                                    <li>
                                      <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Deep dive</span>
                                      </div>
                                      <ul class="tree__item-nested-list">
                                              <li><a href="../deep-dive/clipboard.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Clipboard</span>
                                                  </div></a></li>
                                              <li><a href="../deep-dive/upload-adapter.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Custom upload adapter</span>
                                                  </div></a></li>
                                              <li><a href="../deep-dive/event-system.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Event system</span>
                                                  </div></a></li>
                                              <li><a href="../deep-dive/observables.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Observables</span>
                                                  </div></a></li>
                                              <li><a href="../deep-dive/schema.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Schema</span>
                                                  </div></a></li>
                                              <li>
                                                <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Conversion</span>
                                                </div>
                                                <ul class="tree__item-nested-list">
                                                        <li><a href="../deep-dive/conversion/intro.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Introduction</span>
                                                            </div></a></li>
                                                        <li><a href="../deep-dive/conversion/downcast.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Model to view (downcast)</span>
                                                            </div></a></li>
                                                        <li><a href="../deep-dive/conversion/upcast.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">View to model (upcast)</span>
                                                            </div></a></li>
                                                        <li>
                                                          <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Conversion helpers</span>
                                                          </div>
                                                          <ul class="tree__item-nested-list">
                                                                  <li><a href="../deep-dive/conversion/helpers/intro.html">
                                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Introduction</span>
                                                                      </div></a></li>
                                                                  <li><a href="../deep-dive/conversion/helpers/downcast.html">
                                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Downcast helpers</span>
                                                                      </div></a></li>
                                                                  <li><a href="../deep-dive/conversion/helpers/upcast.html">
                                                                      <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Upcast helpers</span>
                                                                      </div></a></li>
                                                          </ul>
                                                        </li>
                                                </ul>
                                              </li>
                                              <li>
                                                <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">User interface</span>
                                                </div>
                                                <ul class="tree__item-nested-list">
                                                        <li><a href="../deep-dive/ui/focus-tracking.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Focus tracking</span>
                                                            </div></a></li>
                                                        <li><a href="../deep-dive/ui/widget-internals.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Widget internals</span>
                                                            </div></a></li>
                                                        <li><a href="../deep-dive/ui/theme-customization.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Theme customization</span>
                                                            </div></a></li>
                                                        <li><a href="../deep-dive/ui/external-ui.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Third–party UI</span>
                                                            </div></a></li>
                                                        <li><a href="../deep-dive/ui/document-editor.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Document editor</span>
                                                            </div></a></li>
                                                        <li><a href="../deep-dive/ui/custom-editor-creator.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Creating custom editor</span>
                                                            </div></a></li>
                                                        <li><a href="../deep-dive/ui/localization.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Localization</span>
                                                            </div></a></li>
                                                </ul>
                                              </li>
                                      </ul>
                                    </li>
                                    <li>
                                      <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Contributing</span>
                                      </div>
                                      <ul class="tree__item-nested-list">
                                              <li><a href="../contributing/contributing.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Contributing</span>
                                                  </div></a></li>
                                              <li><a href="../contributing/development-environment.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Development environment</span>
                                                  </div></a></li>
                                              <li><a href="../contributing/testing-environment.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Testing environment</span>
                                                  </div></a></li>
                                              <li><a href="../contributing/code-style.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Code style</span>
                                                  </div></a></li>
                                              <li><a href="../contributing/package-metadata.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Package metadata</span>
                                                  </div></a></li>
                                              <li><a href="../contributing/git-commit-message-convention.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Git commit message convention</span>
                                                  </div></a></li>
                                      </ul>
                                    </li>
                            </ul>
                          </li>
            </ul>
          </nav>
        </div>
      </div>
    </main>
    <footer class="footer footer--bordered">
      <p>&copy; 2003-2023 <a href="http://cksource.com">CKSource</a>. All rights reserved.</p>
    </footer>
    <script src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript">
docsearch({
apiKey:'fc463c26455365ad403d5ec51796cd73',indexName:'ckeditor_nightly',inputSelector:'#docsearch_input',algoliaOptions:{hitsPerPage:250,attributesToRetrieve:'*'},
transformData: function( hits ) {var sortingFn = function( a, b ) {a.custom_ranking = a.custom_ranking || 0;b.custom_ranking = b.custom_ranking || 0;if ( a.custom_ranking === b.custom_ranking ) return a.index - b.index;if ( a.custom_ranking > b.custom_ranking ) return -1;if ( a.custom_ranking < b.custom_ranking ) return 1;};var result = [];var tags = [ 'installation', 'features', 'examples', 'updating', 'support', 'framework', 'api' ];var hitsGrouped = { api: [] };hitsGrouped[ 'framework' ] = hits.filter( function( h ) {return h.tags.includes( 'ckeditor5' ) && h.tags.includes( 'framework' );} ).slice( 0, 7 ).map( function( item, idx ) {item.index = idx;return item;} ).sort( sortingFn );tags.forEach( function( tag ) {if ( tag !== 'framework' ) {hitsGrouped[ tag ] = hits.filter( function( h ) {return h.tags.includes( 'ckeditor5' ) && h.tags.includes( tag );} ).slice( 0, 10 ).map( function( item, idx ) {item.index = idx;return item;} ).sort( sortingFn ).slice( 0, 3 );}} );var apiSearchHits = [];if ( window.apiSearch ) apiSearchHits = window.apiSearch();hitsGrouped.api = hitsGrouped.api.filter( function( h ) {var isDuplicated = false;for ( var i = 0; i < apiSearchHits.length; i++ ) {if ( h.url.includes( apiSearchHits[ i ].urlShort ) ) {isDuplicated = true;break;}}return !isDuplicated;} );hitsGrouped.api = ( apiSearchHits || [] ).concat( hitsGrouped.api );result = result.concat( hitsGrouped[ 'framework' ] );tags.forEach( function( tag ) {if ( tag !== 'framework' ) result = result.concat( hitsGrouped[ tag ].slice( 0, 4 ) );} );return result;}
});
</script>
    <script src="../../../../../assets/2.4.0/scripts/app.js"></script>
    <script src="../../../assets/buildwarningbanner.js" async></script>
  </body>
</html>