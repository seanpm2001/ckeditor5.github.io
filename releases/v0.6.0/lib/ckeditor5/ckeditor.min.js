var ClassicEditor=function(){"use strict";function t(){return function t(){t.called=!0}}function e(){for(var t="e",e=0;e<8;e++)t+=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return t}function n(t){return t._events||Object.defineProperty(t,"_events",{value:{}}),t._events}function r(){return{callbacks:[],childEvents:[]}}function i(t,e){var i=n(t);if(!i[e]){for(var o=e,a=null,s=[];""!==o&&!i[o];)i[o]=r(),s.push(i[o]),a&&i[o].childEvents.push(a),a=o,o=o.substr(0,o.lastIndexOf(":"));if(""!==o){var u=!0,l=!1,c=void 0;try{for(var f,h=s[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var d=f.value;d.callbacks=i[o].callbacks.slice()}}catch(t){l=!0,c=t}finally{try{!u&&h.return&&h.return()}finally{if(l)throw c}}i[o].childEvents.push(a)}}}function o(t,e){var r=n(t)[e];if(!r)return[];for(var i=[r.callbacks],a=0;a<r.childEvents.length;a++){var s=o(t,r.childEvents[a]);i=i.concat(s)}return i}function a(t,e){var n=void 0;return t._events&&(n=t._events[e])&&n.callbacks.length?n.callbacks:e.indexOf(":")>-1?a(t,e.substr(0,e.lastIndexOf(":"))):null}function s(t,e,n){var r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=Bs(a.value,2),l=u[0],c=u[1];c?"function"==typeof c&&(c=c(e.name)):c=e.name;var f=new Ls(e.source,c);f.path=[].concat(Ds(e.path)),l.fire.apply(l,[f].concat(Ds(n)))}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}}function u(t){return Hs(Object(t))}function l(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function c(t){return!!t&&"object"==("undefined"==typeof t?"undefined":Vs(t))}function f(t){if(!c(t)||Gs.call(t)!=$s||l(t))return!1;var e=u(t);if(null===e)return!0;var n=Js.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&Ws.call(n)==Us}function h(t,e){return t===e||t!==t&&e!==e}function d(t,e,n){var r=t[e];Zs.call(t,e)&&h(r,n)&&(void 0!==n||e in t)||(t[e]=n)}function v(t,e,n,r){n||(n={});for(var i=-1,o=e.length;++i<o;){var a=e[i],s=r?r(n[a],t[a],a,n,t):t[a];d(n,a,s)}return n}function y(t){return function(e){return null==e?void 0:e[t]}}function p(t){var e="undefined"==typeof t?"undefined":Vs(t);return!!t&&("object"==e||"function"==e)}function m(t){var e=p(t)?iu.call(t):"";return e==eu||e==nu}function g(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=ou}function b(t){return null!=t&&g(tu(t))&&!m(t)}function _(t,e){return e=null==e?au:e,!!e&&("number"==typeof t||su.test(t))&&t>-1&&t%1==0&&t<e}function w(t,e,n){if(!p(n))return!1;var r="undefined"==typeof e?"undefined":Vs(e);return!!("number"==r?b(n)&&_(e,n.length):"string"==r&&e in n)&&h(n[e],t)}function k(t,e,n){var r=n.length;switch(r){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function x(t){return"symbol"==("undefined"==typeof t?"undefined":Vs(t))||c(t)&&cu.call(t)==uu}function O(t){if("number"==typeof t)return t;if(x(t))return fu;if(p(t)){var e=m(t.valueOf)?t.valueOf():t;t=p(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(hu,"");var n=vu.test(t);return n||yu.test(t)?pu(t.slice(2),n?2:8):du.test(t)?fu:+t}function S(t){if(!t)return 0===t?t:0;if(t=O(t),t===mu||t===-mu){var e=t<0?-1:1;return e*gu}return t===t?t:0}function P(t){var e=S(t),n=e%1;return e===e?n?e-n:e:0}function A(t,e){if("function"!=typeof t)throw new TypeError(bu);return e=_u(void 0===e?t.length-1:P(e),0),function(){for(var n=arguments,r=-1,i=_u(n.length-e,0),o=Array(i);++r<i;)o[r]=n[e+r];switch(e){case 0:return t.call(this,o);case 1:return t.call(this,n[0],o);case 2:return t.call(this,n[0],n[1],o)}var a=Array(e+1);for(r=-1;++r<e;)a[r]=n[r];return a[e]=o,k(t,this,a)}}function C(t){return A(function(e,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(o=t.length>3&&"function"==typeof o?(i--,o):void 0,a&&w(n[0],n[1],a)&&(o=i<3?void 0:o,i=1),e=Object(e);++r<i;){var s=n[r];s&&t(e,s,r,o)}return e})}function T(t){var e=t&&t.constructor,n="function"==typeof e&&e.prototype||wu;return t===n}function E(t){return t&&t.Object===Object?t:null}function R(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}function V(t){t=null==t?t:Object(t);var e=[];for(var n in t)e.push(n);return e}function F(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function N(t){return c(t)&&b(t)}function j(t){return N(t)&&Iu.call(t,"callee")&&(!Du.call(t,"callee")||Bu.call(t)==ju)}function M(t){return"string"==typeof t||!Lu(t)&&c(t)&&Hu.call(t)==zu}function I(t){var e=t?t.length:void 0;return g(e)&&(Lu(t)||M(t)||j(t))?F(e,String):null}function B(t){for(var e=-1,n=T(t),r=Nu(t),i=r.length,o=I(t),a=!!o,s=o||[],u=s.length;++e<i;){var l=r[e];a&&("length"==l||_(l,u))||"constructor"==l&&(n||!Ku.call(t,l))||s.push(l)}return s}function D(t){Yu in t||(Object.defineProperty(t,Yu,{value:new Map}),Object.defineProperty(t,Qu,{value:new Map}),Object.defineProperty(t,Xu,{value:new Map}))}function L(){var t=this,e=q.apply(void 0,arguments),n=Array.from(this._bindings.keys()),r=n.length;if(!e.callback&&e.to.length>1)throw new Qs("observable-bind-to-no-callback: Binding multiple observables only possible with callback.");if(r>1&&e.callback)throw new Qs("observable-bind-to-extra-callback: Cannot bind multiple attributes and use a callback in one binding.");e.to.forEach(function(e){if(e.attrs.length&&e.attrs.length!==r)throw new Qs("observable-bind-to-attrs-length: The number of attributes must match.");e.attrs.length||(e.attrs=t._bindAttrs)}),this._to=e.to,e.callback&&(this._bindings.get(n[0]).callback=e.callback),W(this._observable,this._to),$(this),this._bindAttrs.forEach(function(e){K(t._observable,e)})}function z(t){return t.every(function(t){return"string"==typeof t})}function q(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];if(!e.length)throw new Qs("observable-bind-to-parse-error: Invalid argument syntax in `to()`.");var r={to:[]},i=void 0;return"function"==typeof e[e.length-1]&&(r.callback=e.pop()),e.forEach(function(t){if("string"==typeof t)i.attrs.push(t);else{if("object"!=("undefined"==typeof t?"undefined":Vs(t)))throw new Qs("observable-bind-to-parse-error: Invalid argument syntax in `to()`.");i={observable:t,attrs:[]},r.to.push(i)}}),r}function H(t,e,n,r){var i=t[Qu],o=i.get(n),a=o||{};a[r]||(a[r]=new Set),a[r].add(e),o||i.set(n,a)}function $(t){var e=void 0;t._bindings.forEach(function(n,r){t._to.forEach(function(i){e=i.attrs[n.callback?0:t._bindAttrs.indexOf(r)],n.to.push([i.observable,e]),H(t._observable,n,i.observable,e)})})}function K(t,e){var n=t[Xu],r=n.get(e),i=void 0;r.callback?i=r.callback.apply(t,r.to.map(function(t){return t[0][t[1]]})):(i=r.to[0],i=i[0][i[1]]),t.hasOwnProperty(e)?t[e]=i:t.set(e,i)}function W(t,e){e.forEach(function(e){var n=t[Qu],r=void 0;n.get(e.observable)||t.listenTo(e.observable,"change",function(i,o){r=n.get(e.observable)[o],r&&r.forEach(function(e){K(t,e.attr)})})})}function J(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];n.forEach(function(e){Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e)).forEach(function(n){if(!(n in t.prototype)){var r=Object.getOwnPropertyDescriptor(e,n);r.enumerable=!1,Object.defineProperty(t.prototype,n,r)}})})}function U(t){var e=new Map;for(var n in t)e.set(n,t[n]);return e}function G(t){return f(t)?U(t):new Map(t)}function Y(t){return!(!t||!t[Symbol.iterator])}function Q(t){return"string"==typeof t?[new al(t)]:(Y(t)||(t=[t]),Array.from(t).map(function(t){return"string"==typeof t?new al(t):t}))}function X(t){return"string"==typeof t?[new al(t)]:(Y(t)||(t=[t]),Array.from(t).map(function(t){return"string"==typeof t?new al(t):t}))}function Z(t){var e=t?t.length:0;return e?t[e-1]:void 0}function tt(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++)if(t[r]!=e[r])return r;return t.length==e.length?"same":t.length<e.length?"prefix":"extension"}function et(t,e,n,r,i){return{done:!1,value:{type:t,item:e,previousPosition:n,nextPosition:r,length:i}}}function nt(t,e){if("function"==typeof e)return e(t);var n={};return e.name&&(n.name=rt(e.name,t.name),!n.name)?null:e.attribute&&(n.attribute=it(e.attribute,t),!n.attribute)?null:!(e.class&&(n.class=ot(e.class,t),!n.class))&&(!(e.style&&(n.style=at(e.style,t),!n.style))&&n)}function rt(t,e){return t instanceof RegExp?t.test(e):t===e}function it(t,e){var n=[];for(var r in t){var i=t[r];if(!e.hasAttribute(r))return null;var o=e.getAttribute(r);if(i instanceof RegExp){if(!i.test(o))return null;n.push(r)}else{if(o!==i)return null;n.push(r)}}return n}function ot(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;if(u instanceof RegExp){var l=e.getClassNames(),c=!0,f=!1,h=void 0;try{for(var d,v=l[Symbol.iterator]();!(c=(d=v.next()).done);c=!0){var y=d.value;u.test(y)&&n.push(y)}}catch(t){f=!0,h=t}finally{try{!c&&v.return&&v.return()}finally{if(f)throw h}}if(0===n.length)return null}else{if(!e.hasClass(u))return null;n.push(u)}}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}function at(t,e){var n=[];for(var r in t){var i=t[r];if(!e.hasStyle(r))return null;var o=e.getStyle(r);if(i instanceof RegExp){if(!i.test(o))return null;n.push(r)}else{if(o!==i)return null;n.push(r)}}return n}function st(t,e){var n=/\s*([^:;\s]+)\s*:\s*([^;]+)\s*(?=;|$)/g,r=void 0;for(t.clear();null!==(r=n.exec(e));)t.set(r[1],r[2].trim())}function ut(t,e){var n=e.split(/\s+/);t.clear(),n.forEach(function(e){return t.add(e)})}function lt(t){return"string"==typeof t?[new vl(t)]:(Y(t)||(t=[t]),Array.from(t).map(function(t){return"string"==typeof t?new vl(t):t}))}function ct(){return 0===this.childCount?0:null}function ft(){if(this.childCount)return null;for(var t=this.parent;t instanceof Al;){if(t.childCount>1)return null;t=t.parent}return!t||t.childCount>1?null:0}function ht(){throw new Qs("view-emptyelement-cannot-add: Cannot add child nodes to EmptyElement instance.")}function dt(){return null}function vt(t){return"string"==typeof t?[new vl(t)]:(Y(t)||(t=[t]),Array.from(t).map(function(t){return"string"==typeof t?new vl(t):t}))}function yt(t){return t instanceof _l?Tt(t):Ct(t)}function pt(t){var e=t.parent;if(!(e instanceof gl))throw new Qs("view-writer-break-non-container-element: Trying to break an element which is not a container element.");if(!e.parent)throw new Qs("view-writer-break-root: Trying to break root element.");if(t.isAtStart)return _l.createBefore(e);if(!t.isAtEnd){var n=e.clone(!1);_t(_l.createAfter(e),n);var r=new kl(t,_l.createAt(e,"end")),i=new _l(n,0);kt(r,i)}return _l.createAfter(e)}function mt(t){var e=t.offset,n=t.parent;if(n instanceof vl)return t;if(n instanceof Al&&0===n.childCount){var r=n.parent,i=n.index;return n.remove(),mt(new _l(r,i))}var o=n.getChild(e-1),a=n.getChild(e);if(!o||!a)return t;if(o instanceof gl||a instanceof gl)return t;if(o instanceof Cl||a instanceof Cl)return t;if(o instanceof vl&&a instanceof vl)return Nt(o,a);if(o.isSimilar(a)){var s=o.childCount;return o.appendChildren(a.getChildren()),a.remove(),mt(new _l(o,s))}return t}function gt(t){var e=t.nodeBefore,n=t.nodeAfter;if(!(e&&n&&e instanceof gl&&n instanceof gl))throw new Qs("view-writer-merge-containers-invalid-position: Element before and after given position cannot be merged.");var r=e.getChild(e.childCount-1),i=r instanceof vl?_l.createAt(r,"end"):_l.createAt(e,"end");return kt(kl.createIn(n),_l.createAt(e,"end")),wt(kl.createOn(n)),i}function bt(t){var e=[],n=new wl({boundaries:t}),r=t.start,i=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;l.item instanceof gl&&(r.isEqual(l.previousPosition)||e.push(new kl(r,l.previousPosition)),r=l.nextPosition)}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}return e.push(new kl(r,t.end)),e}function _t(t,e){e=Y(e)?[].concat(Ds(e)):[e],Bt(e);var n=At(t);if(!n)throw new Qs("view-writer-invalid-position-container");var r=Tt(t,!0),i=n.insertChildren(r.offset,e),o=r.getShiftedBy(i),a=mt(r);if(0===i)return new kl(a,a);a.isEqual(r)||o.offset--;var s=mt(o);return new kl(a,s)}function wt(t){if(Lt(t),t.isCollapsed)return new Tl;var e=Ct(t,!0),n=e.start,r=e.end,i=n.parent,o=r.offset-n.offset,a=i.removeChildren(n.offset,o),s=mt(n);return t.start=s,t.end=_l.createFromPosition(s),new Tl(a)}function kt(t,e){var n=void 0;if(e.isAfter(t.end)){e=Tt(e,!0);var r=e.parent,i=r.childCount;t=Ct(t,!0),n=wt(t),e.offset+=r.childCount-i}else n=wt(t);return _t(e,n)}function xt(t,e){if(!(e instanceof Al))throw new Qs("view-writer-wrap-invalid-attribute");if(Lt(t),t.isCollapsed)return t;if(t.end.isEqual(t.start.getShiftedBy(1))){var n=t.start.nodeAfter;if(n instanceof Al&&jt(e,n))return t}if(It(t)&&jt(e,t.start.parent)){var r=t.start.parent.parent,i=t.start.parent.index;return kl.createFromParentsAndOffsets(r,i,r,i+1)}var o=Ct(t,!0),a=o.start,s=o.end,u=a.parent,l=Et(u,a.offset,s.offset,e),c=Rt(u,l.start.offset,l.end.offset,e),f=mt(c.start);f.isEqual(c.start)||c.end.offset--;var h=mt(c.end);return new kl(f,h)}function Ot(t,e){if(!(e instanceof Al))throw new Qs("view-writer-wrap-invalid-attribute");if(e.isSimilar(t.parent))return Vt(_l.createFromPosition(t));t.parent instanceof vl&&(t=Ft(t));var n=new Al;n.priority=Number.POSITIVE_INFINITY,n.isSimilar=function(){return!1},t.parent.insertChildren(t.offset,n);var r=new kl(t,t.getShiftedBy(1));xt(r,e);var i=new _l(n.parent,n.index);n.remove();var o=i.nodeBefore,a=i.nodeAfter;return o instanceof vl&&a instanceof vl?Nt(o,a):Vt(i)}function St(t,e){if(!(e instanceof Al))throw new Qs("view-writer-unwrap-invalid-attribute");if(Lt(t),t.isCollapsed)return t;if(t.end.isEqual(t.start.getShiftedBy(1))){var n=t.start.nodeAfter;if(!e.isSimilar(n)&&n instanceof Al&&Mt(e,n))return t}var r=Ct(t,!0),i=r.start,o=r.end,a=i.parent,s=Et(a,i.offset,o.offset,e),u=mt(s.start);u.isEqual(s.start)||s.end.offset--;var l=mt(s.end);return new kl(u,l)}function Pt(t,e){var n=new gl(e,t.getAttributes());return _t(_l.createAfter(t),n),kt(kl.createIn(t),_l.createAt(n)),wt(kl.createOn(t)),n}function At(t){for(var e=t.parent;!Dt(e);){if(!e)return;e=e.parent}return e}function Ct(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.start,r=t.end;if(Lt(t),t.isCollapsed){var i=Tt(t.start,e);return new kl(i,i)}var o=Tt(r,e),a=o.parent.childCount,s=Tt(n,e);return o.offset+=o.parent.childCount-a,new kl(s,o)}function Tt(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.offset,r=t.parent;if(t.parent instanceof Cl)throw new Qs("view-writer-cannot-break-empty-element");if(!e&&r instanceof vl&&Dt(r.parent))return _l.createFromPosition(t);if(Dt(r))return _l.createFromPosition(t);if(r instanceof vl)return Tt(Ft(t),e);var i=r.childCount;if(n==i){var o=new _l(r.parent,r.index+1);return Tt(o,e)}if(0===n){var a=new _l(r.parent,r.index);return Tt(a,e)}var s=r.index+1,u=r.clone();r.parent.insertChildren(s,u);var l=r.childCount-n,c=r.removeChildren(n,l);u.appendChildren(c);var f=new _l(r.parent,s);return Tt(f,e)}function Et(t,e,n,r){for(var i=e,o=[];i<n;){var a=t.getChild(i);if(a.isSimilar(r)){var s=a.getChildren(),u=a.childCount;a.remove(),t.insertChildren(i,s),o.push(new _l(t,i),new _l(t,i+u)),i+=u,n+=u-1}else a instanceof Al&&Et(a,0,a.childCount,r),i++}var l=0,c=!0,f=!1,h=void 0;try{for(var d,v=o[Symbol.iterator]();!(c=(d=v.next()).done);c=!0){var y=d.value;if(y.offset-=l,y.offset!=e&&y.offset!=n){var p=mt(y);p.isEqual(y)||(l++,n--)}}}catch(t){f=!0,h=t}finally{try{!c&&v.return&&v.return()}finally{if(f)throw h}}return kl.createFromParentsAndOffsets(t,e,t,n)}function Rt(t,e,n,r){for(var i=e,o=[];i<n;){var a=t.getChild(i),s=a instanceof vl,u=a instanceof Al,l=a instanceof Cl;if(s||l||u&&r.priority<=a.priority){var c=r.clone();a.remove(),c.appendChildren(a),t.insertChildren(i,c),o.push(new _l(t,i))}else a instanceof Al&&Rt(a,0,a.childCount,r);i++}var f=0,h=!0,d=!1,v=void 0;try{for(var y,p=o[Symbol.iterator]();!(h=(y=p.next()).done);h=!0){var m=y.value;if(m.offset!=e){var g=mt(m);g.isEqual(m)||(f++,n--)}}}catch(t){d=!0,v=t}finally{try{!h&&p.return&&p.return()}finally{if(d)throw v}}return kl.createFromParentsAndOffsets(t,e,t,n)}function Vt(t){var e=t.nodeBefore;if(e&&e instanceof vl)return new _l(e,e.data.length);var n=t.nodeAfter;return n&&n instanceof vl?new _l(n,0):t}function Ft(t){if(t.offset==t.parent.data.length)return new _l(t.parent.parent,t.parent.index+1);if(0===t.offset)return new _l(t.parent.parent,t.parent.index);var e=t.parent.data.slice(t.offset);return t.parent.data=t.parent.data.slice(0,t.offset),t.parent.parent.insertChildren(t.parent.index+1,new vl(e)),new _l(t.parent.parent,t.parent.index+1)}function Nt(t,e){var n=t.data.length;return t.data+=e.data,e.remove(),new _l(t,n)}function jt(t,e){if(t.name!==e.name||t.priority!==e.priority)return!1;var n=!0,r=!1,i=void 0;try{for(var o,a=t.getAttributeKeys()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if("class"!==s&&"style"!==s&&e.hasAttribute(s)&&e.getAttribute(s)!==t.getAttribute(s))return!1}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}var u=!0,l=!1,c=void 0;try{for(var f,h=t.getStyleNames()[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var d=f.value;if(e.hasStyle(d)&&e.getStyle(d)!==t.getStyle(d))return!1}}catch(t){l=!0,c=t}finally{try{!u&&h.return&&h.return()}finally{if(l)throw c}}var v=!0,y=!1,p=void 0;try{for(var m,g=t.getAttributeKeys()[Symbol.iterator]();!(v=(m=g.next()).done);v=!0){var b=m.value;"class"!==b&&"style"!==b&&(e.hasAttribute(b)||e.setAttribute(b,t.getAttribute(b)))}}catch(t){y=!0,p=t}finally{try{!v&&g.return&&g.return()}finally{if(y)throw p}}var _=!0,w=!1,k=void 0;try{for(var x,O=t.getStyleNames()[Symbol.iterator]();!(_=(x=O.next()).done);_=!0){var S=x.value;e.hasStyle(S)||e.setStyle(S,t.getStyle(S))}}catch(t){w=!0,k=t}finally{try{!_&&O.return&&O.return()}finally{if(w)throw k}}var P=!0,A=!1,C=void 0;try{for(var T,E=t.getClassNames()[Symbol.iterator]();!(P=(T=E.next()).done);P=!0){var R=T.value;e.hasClass(R)||e.addClass(R)}}catch(t){A=!0,C=t}finally{try{!P&&E.return&&E.return()}finally{if(A)throw C}}return!0}function Mt(t,e){if(t.name!==e.name||t.priority!==e.priority)return!1;var n=!0,r=!1,i=void 0;try{for(var o,a=t.getAttributeKeys()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if("class"!==s&&"style"!==s&&(!e.hasAttribute(s)||e.getAttribute(s)!==t.getAttribute(s)))return!1}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}if(!e.hasClass.apply(e,Ds(t.getClassNames())))return!1;var u=!0,l=!1,c=void 0;try{for(var f,h=t.getStyleNames()[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var d=f.value;if(!e.hasStyle(d)||e.getStyle(d)!==t.getStyle(d))return!1}}catch(t){l=!0,c=t}finally{try{!u&&h.return&&h.return()}finally{if(l)throw c}}var v=!0,y=!1,p=void 0;try{for(var m,g=t.getAttributeKeys()[Symbol.iterator]();!(v=(m=g.next()).done);v=!0){var b=m.value;"class"!==b&&"style"!==b&&e.removeAttribute(b)}}catch(t){y=!0,p=t}finally{try{!v&&g.return&&g.return()}finally{if(y)throw p}}return e.removeClass.apply(e,Ds(t.getClassNames())),e.removeStyle.apply(e,Ds(t.getStyleNames())),!0}function It(t){return t.start.parent==t.end.parent&&t.start.parent instanceof Al&&0===t.start.offset&&t.end.offset===t.start.parent.childCount}function Bt(t){var e=!0,n=!1,r=void 0;try{for(var i,o=t[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;if(!(a instanceof vl||a instanceof Al||a instanceof gl||a instanceof Cl))throw new Qs("view-writer-insert-invalid-node");a instanceof vl||Bt(a.getChildren())}}catch(t){n=!0,r=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw r}}}function Dt(t){return t instanceof gl||t instanceof Tl}function Lt(t){var e=At(t.start),n=At(t.end);if(!e||!n||e!==n)throw new Qs("view-writer-invalid-range-container")}function zt(t){return function(e,n,r,i){if(r.consume(n.item,"insert")){var o=i.mapper.toViewPosition(n.range.start),a=t instanceof ml?t.clone(!0):t(n,r,i);i.mapper.bindElements(n.item,a),El.insert(o,a)}}}function qt(){return function(t,e,n,r){if(n.consume(e.item,"insert")){var i=r.mapper.toViewPosition(e.range.start),o=new vl(e.item.data);El.insert(i,o)}}}function Ht(t){return t=t||function(t,e){return{value:t,key:e}},function(e,n,r,i){if(r.consume(n.item,ee(e.name))){var o=t(n.attributeNewValue,n.attributeKey,n,r,i),a=o.key,s=o.value;i.mapper.toViewElement(n.item).setAttribute(a,s)}}}function $t(t){return t=t||function(t,e){return{key:e}},function(e,n,r,i){if(r.consume(n.item,ee(e.name))){var o=t(n.attributeOldValue,n.attributeKey,n,r,i),a=o.key;i.mapper.toViewElement(n.item).removeAttribute(a)}}}function Kt(t){return function(e,n,r,i){var o=i.mapper.toViewRange(n.range),a=t instanceof ml?t.clone(!0):t(n.attributeNewValue,n,r,i);if(a){if(!r.consume(n.item,ee(e.name)))return;if(null!==n.attributeOldValue&&!(t instanceof ml)){var s=t(n.attributeOldValue,n,r,i);o=El.unwrap(o,s)}El.wrap(o,a)}}}function Wt(t){return function(e,n,r,i){if(r.consume(n.item,ee(e.name))){var o=i.mapper.toViewRange(n.range),a=t instanceof ml?t.clone(!0):t(n.attributeOldValue,n,r,i);El.unwrap(o,a)}}}function Jt(t){return function(e,n,r,i){var o=i.mapper.toViewRange(n.range),a=t instanceof ml?t.clone(!0):t(n,r,i);if(a){if(!r.consume(n.range,"addMarker"))return;if(o.isCollapsed)El.wrapPosition(o.start,a);else{var s=El.breakViewRangePerContainer(o),u=!0,l=!1,c=void 0;try{for(var f,h=s[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var d=f.value;El.wrap(d,a)}}catch(t){l=!0,c=t}finally{try{!u&&h.return&&h.return()}finally{if(l)throw c}}}}}}function Ut(t){return function(e,n,r,i){if(r.consume(n.range,"removeMarker")){var o=t instanceof ml?t.clone(!0):t(n,r,i);if(n.range.isCollapsed){var a=n.range.start,s=i.mapper.toViewPosition(a);s.parent instanceof vl&&(s=_l.createAfter(s.parent));var u=Gt(s,i.mapper);El.unwrap(u,o)}else{var l=i.mapper.toViewRange(n.range),c=El.breakViewRangePerContainer(l),f=!0,h=!1,d=void 0;try{for(var v,y=c[Symbol.iterator]();!(f=(v=y.next()).done);f=!0){var p=v.value;El.unwrap(p,o)}}catch(t){h=!0,d=t}finally{try{!f&&y.return&&y.return()}finally{if(h)throw d}}}}}}function Gt(t,e){for(var n=_l.createFromPosition(t),r=_l.createFromPosition(t);r.nodeAfter&&0===e.getModelLength(r.nodeAfter);)r.offset++;return new kl(n,r)}function Yt(){return function(t,e,n,r){if(n.consume(e.item,"move")){var i=hl.createFromPositionAndShift(e.sourcePosition,e.item.offsetSize),o=r.mapper.toViewRange(i),a=r.mapper.toViewPosition(e.targetPosition);El.move(o,a)}}}function Qt(){return function(t,e,n,r){if(n.consume(e.item,"remove")){var i=hl.createFromPositionAndShift(e.sourcePosition,e.item.offsetSize),o=r.mapper.toViewRange(i);El.remove(o),r.mapper.unbindModelElement(e.item)}}}function Xt(){return function(t,e,n,r){if(n.consume(e.element,"rename")){var i=new sl(e.oldName,e.element.getAttributes());e.element.parent.insertChildren(e.element.index,i);var o=r.mapper.toViewElement(e.element);r.mapper.unbindModelElement(e.element),r.mapper.bindElements(i,o);var a=hl.createFromParentsAndOffsets(e.element.parent,e.element.startOffset,e.element,0),s=ll.createAt(i,0),u=hl.createIn(e.element),l=hl.createOn(i);r.dispatcher.convertInsertion(a),r.dispatcher.convertMove(s,u),r.dispatcher.convertRemove(l.start,l),i.remove()}}}function Zt(t){return function(e,n,r,i){var o=!0,a=!1,s=void 0;try{for(var u,l=t[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=Bs(u.value,2),f=c[0],h=c[1];h.containsPosition(n.range.start)&&i.dispatcher.convertMarker("addMarker",f,n.range)}}catch(t){a=!0,s=t}finally{try{!o&&l.return&&l.return()}finally{if(a)throw s}}}}function te(t){return function(e,n,r,i){var o=n.sourcePosition._getTransformedByInsertion(n.targetPosition,n.item.offsetSize),a=hl.createOn(n.item),s=!0,u=!1,l=void 0;try{for(var c,f=t[Symbol.iterator]();!(s=(c=f.next()).done);s=!0){var h=Bs(c.value,2),d=h[0],v=h[1],y=v.containsPosition(o)||v.start.isEqual(o)||v.end.isEqual(o),p=a.getIntersection(v);y&&null===p?i.dispatcher.convertMarker("removeMarker",d,a):null!==p&&i.dispatcher.convertMarker("addMarker",d,p)}}catch(t){u=!0,l=t}finally{try{!s&&f.return&&f.return()}finally{if(u)throw l}}}}function ee(t){var e=t.split(":");return e[0]+":"+e[1]}function ne(t,e){e=se(e);var n=e.reduce(function(t,e){return t+e.offsetSize},0),r=t.parent;le(t);var i=t.index;return r.insertChildren(i,e),ue(r,i+e.length),ue(r,i),new hl(t,t.getShiftedBy(n))}function re(t){if(!t.isFlat)throw new Qs("model-writer-remove-range-not-flat: Trying to remove a range that starts and ends in different element.");var e=t.start.parent;le(t.start),le(t.end);var n=e.removeChildren(t.start.index,t.end.index-t.start.index);return ue(e,t.start.index),n}function ie(t,e){if(!t.isFlat)throw new Qs("model-writer-move-range-not-flat: Trying to move a range that starts and ends in different element.");var n=this.remove(t);return e=e._getTransformedByDeletion(t.start,t.end.offset-t.start.offset),this.insert(e,n)}function oe(t,e,n){le(t.start),le(t.end);var r=!0,i=!1,o=void 0;try{for(var a,s=t.getItems()[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value,l=u instanceof cl?u.textNode:u;null!==n?l.setAttribute(e,n):l.removeAttribute(e),ue(l.parent,l.index)}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}ue(t.end.parent,t.end.index)}function ae(t,e){this.setAttribute(t,e,null)}function se(t){var e=[];t instanceof Array||(t=[t]);for(var n=0;n<t.length;n++)if("string"==typeof t[n])e.push(new al(t[n]));else if(t[n]instanceof cl)e.push(new al(t[n].data,t[n].getAttributes()));else if(t[n]instanceof ul||t[n]instanceof ol){var r=!0,i=!1,o=void 0;try{for(var a,s=t[n][Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;e.push(u)}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}}else t[n]instanceof il&&e.push(t[n]);for(var l=1;l<e.length;l++){var c=e[l],f=e[l-1];c instanceof al&&f instanceof al&&ce(c,f)&&(e.splice(l-1,2,new al(f.data+c.data,f.getAttributes())),l--)}return e}function ue(t,e){var n=t.getChild(e-1),r=t.getChild(e);if(n instanceof al&&r instanceof al&&ce(n,r)){var i=new al(n.data+r.data,n.getAttributes());t.removeChildren(e-1,2),t.insertChildren(e-1,i)}}function le(t){var e=t.textNode,n=t.parent;if(e){var r=t.offset-e.startOffset,i=e.index;n.removeChildren(i,1);var o=new al(e.data.substr(0,r),e.getAttributes()),a=new al(e.data.substr(r),e.getAttributes());n.insertChildren(i,[o,a])}}function ce(t,e){var n=t.getAttributes(),r=e.getAttributes(),i=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;if(l[1]!==e.getAttribute(l[0]))return!1;r.next()}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}return r.next().done}function fe(){return function(t,e,n,r){if(!e.output&&n.consume(e.input,{name:!0})){var i=r.convertChildren(e.input,n,e);e.output=new ul(se(i))}}}function he(){return function(t,e,n,r){var i={name:"$text",inside:e.context};r.schema.check(i)&&n.consume(e.input)&&(e.output=new al(e.input.data))}}function de(){var t=this,e=new Set(["insert","move","remove","reinsert"]);this.listenTo(this.root.document,"change",function(n,r,i){e.has(r)&&ve.call(t,r,i.range,i.sourcePosition)},{priority:"high"})}function ve(t,e,n){var r=e.end.offset-e.start.offset,i=void 0;switch(t){case"insert":var o="sticksToNext"==this.stickiness;i=this._getTransformedByInsertion(e.start,r,o);break;case"move":case"remove":case"reinsert":var a=hl.createFromPositionAndShift(n,r),s=a.containsPosition(this)||a.start.isEqual(this)&&"sticksToNext"==this.stickiness||a.end.isEqual(this)&&"sticksToPrevious"==this.stickiness;if(s)i=this._getCombined(n,e.start);else{var u="sticksToNext"==this.stickiness;i=this._getTransformedByMove(n,e.start,r,u)}}if(!this.isEqual(i)){var l=ll.createFromPosition(this);this.path=i.path,this.root=i.root,this.fire("change",l)}}function ye(t,e,n,r){r||(r=t.model.batch()),n.isCollapsed||t.deleteContent(n,r,{merge:!0});var i=new Il(t,r,n.anchor);i.handleNodes(e.getChildren(),{isFirst:!0,isLast:!0});var o=i.getSelectionRange();o?n.setRanges([o]):el.warn("insertcontent-no-range: Cannot determine a proper selection range after insertion.")}function pe(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t.isCollapsed){var r=t.getFirstRange(),i=r.start,o=Ml.createFromPosition(r.end);if(r.isEmpty||e.remove(r),n.merge){var a=o.path,s=Math.min(i.path.length-1,a.length-1),u=tt(i.path,a);if("number"==typeof u)for(;u<s;u++){var l=i.path.slice(0,u);l.push(i.path[u]+1);var c=new ll(o.root,l),f=c.nodeAfter;f.childCount>0?e.merge(c):e.remove(f)}}if(t.collapse(i),me(e.document,i)){var h=new sl("paragraph");e.insert(i,h),t.collapse(h)}o.detach()}}function me(t,e){var n=t.schema.check({name:"$text",inside:e}),r=t.schema.check({name:"paragraph",inside:e});return!n&&r}function ge(t){return!!t&&1==t.length&&/[\u0300-\u036f\u1ab0-\u1aff\u1dc0-\u1dff\u20d0-\u20ff\ufe20-\ufe2f]/.test(t)}function be(t){return!!t&&1==t.length&&/[\ud800-\udbff]/.test(t)}function _e(t){return!!t&&1==t.length&&/[\udc00-\udfff]/.test(t)}function we(t,e){return be(t.charAt(e-1))&&_e(t.charAt(e))}function ke(t,e){return ge(t.charAt(e))}function xe(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.model.schema,i="backward"!=n.direction;n.unit=n.unit?n.unit:"character";var o=e.focus,a=new fl({boundaries:Se(o,i),singleCharacters:!0,direction:i?"forward":"backward"}),s=a.next();if(!s.done){var u=s.value;if("text"==u.type)return void e.setFocus(Oe(a,n.unit));if(u.type==(i?"elementStart":"elementEnd"))return void e.setFocus(u.item,i?"after":"before");if(s=a.next(),!s.done)if(u=s.value,"text"==u.type)e.setFocus(u.previousPosition);else{var l=r.objects.has(u.item.name),c=l?i?"after":"before":i?0:"end";e.setFocus(u.item,c)}}}function Oe(t,e){var n=t.position.textNode;if(n)for(var r=n.data,i=t.position.offset-n.startOffset;we(r,i)||"character"==e&&ke(r,i);)t.next(),i=t.position.offset-n.startOffset;return t.position}function Se(t,e){var n=t.root,r=ll.createAt(n,e?"end":0);return e?new hl(t,r):new hl(r,t)}function Pe(t){var e=new ul,n=t.getFirstRange();if(!n||n.isCollapsed)return e;var r=n.start.root,i=n.start.getCommonPath(n.end),o=r.getNodeByPath(i),a=void 0;a=n.start.parent==n.end.parent?n:hl.createFromParentsAndOffsets(o,n.start.path[i.length],o,n.end.path[i.length]+1);var s=a.end.offset-a.start.offset,u=!0,l=!1,c=void 0;try{for(var f,h=a.getItems({shallow:!0})[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var d=f.value;d instanceof cl?e.appendChildren(new al(d.data,d.getAttributes())):e.appendChildren(d.clone(!0))}}catch(t){l=!0,c=t}finally{try{!u&&h.return&&h.return()}finally{if(l)throw c}}if(a!=n){var v=n._getTransformedByMove(a.start,ll.createAt(e,0),s)[0],y=new hl(ll.createAt(e),v.start),p=new hl(v.end,ll.createAt(e,"end"));Ae(p),Ae(y)}return e}function Ae(t){var e=[];Array.from(t.getItems({direction:"backward"})).map(function(t){return hl.createOn(t)}).filter(function(e){var n=(e.start.isAfter(t.start)||e.start.isEqual(t.start))&&(e.end.isBefore(t.end)||e.end.isEqual(t.end));return n}).forEach(function(t){e.push(t.start.parent),re(t)}),e.forEach(function(t){for(var e=t;e.parent&&e.isEmpty;){var n=hl.createOn(e);e=e.parent,re(n)}})}function Ce(){this.__data__=[]}function Te(t,e){for(var n=t.length;n--;)if(h(t[n][0],e))return n;return-1}function Ee(t){var e=this.__data__,n=Te(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():Ll.call(e,n,1),!0}function Re(t){var e=this.__data__,n=Te(e,t);return n<0?void 0:e[n][1]}function Ve(t){return Te(this.__data__,t)>-1}function Fe(t,e){var n=this.__data__,r=Te(n,t);return r<0?n.push([t,e]):n[r][1]=e,this}function Ne(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function je(){this.__data__=new Ne}function Me(t){return this.__data__.delete(t)}function Ie(t){return this.__data__.get(t)}function Be(t){return this.__data__.has(t)}function De(t){if(null!=t){try{return zl.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Le(t){if(!p(t))return!1;var e=m(t)||l(t)?Jl:Hl;
return e.test(De(t))}function ze(t,e){var n=t[e];return Le(n)?n:void 0}function qe(){this.__data__=Ul?Ul(null):{}}function He(t){return this.has(t)&&delete this.__data__[t]}function $e(t){var e=this.__data__;if(Ul){var n=e[t];return n===Gl?void 0:n}return Ql.call(e,t)?e[t]:void 0}function Ke(t){var e=this.__data__;return Ul?void 0!==e[t]:Zl.call(e,t)}function We(t,e){var n=this.__data__;return n[t]=Ul&&void 0===e?tc:e,this}function Je(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Ue(){this.__data__={hash:new Je,map:new(ec||Ne),string:new Je}}function Ge(t){var e="undefined"==typeof t?"undefined":Vs(t);return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}function Ye(t,e){var n=t.__data__;return Ge(e)?n["string"==typeof e?"string":"hash"]:n.map}function Qe(t){return Ye(this,t).delete(t)}function Xe(t){return Ye(this,t).get(t)}function Ze(t){return Ye(this,t).has(t)}function tn(t,e){return Ye(this,t).set(t,e),this}function en(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function nn(t,e){var n=this.__data__;return n instanceof Ne&&n.__data__.length==nc&&(n=this.__data__=new en(n.__data__)),n.set(t,e),this}function rn(t){this.__data__=new Ne(t)}function on(t,e){for(var n=-1,r=t.length;++n<r&&e(t[n],n,t)!==!1;);return t}function an(t,e){return ic.call(t,e)||"object"==("undefined"==typeof t?"undefined":Vs(t))&&e in t&&null===u(t)}function sn(t){return oc(Object(t))}function un(t){var e=T(t);if(!e&&!b(t))return sn(t);var n=I(t),r=!!n,i=n||[],o=i.length;for(var a in t)!an(t,a)||r&&("length"==a||_(a,o))||e&&"constructor"==a||i.push(a);return i}function ln(t,e){return t&&v(e,un(e),t)}function cn(t,e){if(e)return t.slice();var n=new t.constructor(t.length);return t.copy(n),n}function fn(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}function hn(t){return ac(Object(t))}function dn(t,e){return v(t,sc(t),e)}function vn(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function yn(t,e,n){var r=e(t);return Lu(t)?r:vn(r,n(t))}function pn(t){return yn(t,un,sc)}function mn(t){return bc.call(t)}function gn(t){var e=t.length,n=t.constructor(e);return e&&"string"==typeof t[0]&&Ac.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function bn(t){var e=new t.constructor(t.byteLength);return new Cc(e).set(new Cc(t)),e}function _n(t,e){var n=e?bn(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}function wn(t,e){return t.set(e[0],e[1]),t}function kn(t,e,n,r){var i=-1,o=t.length;for(r&&o&&(n=t[++i]);++i<o;)n=e(n,t[i],i,t);return n}function xn(t){var e=-1,n=Array(t.size);return t.forEach(function(t,r){n[++e]=[r,t]}),n}function On(t,e,n){var r=e?n(xn(t),!0):xn(t);return kn(r,wn,new t.constructor)}function Sn(t){var e=new t.constructor(t.source,Tc.exec(t));return e.lastIndex=t.lastIndex,e}function Pn(t,e){return t.add(e),t}function An(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}function Cn(t,e,n){var r=e?n(An(t),!0):An(t);return kn(r,Pn,new t.constructor)}function Tn(t){return Vc?Object(Vc.call(t)):{}}function En(t,e){var n=e?bn(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Rn(t,e,n,r){var i=t.constructor;switch(e){case zc:return bn(t);case Fc:case Nc:return new i((+t));case qc:return _n(t,r);case Hc:case $c:case Kc:case Wc:case Jc:case Uc:case Gc:case Yc:case Qc:return En(t,r);case jc:return On(t,r,n);case Mc:case Dc:return new i(t);case Ic:return Sn(t);case Bc:return Cn(t,r,n);case Lc:return Tn(t)}}function Vn(t){return p(t)?Xc(t):{}}function Fn(t){return"function"!=typeof t.constructor||T(t)?{}:Vn(u(t))}function Nn(t){return function(){return t}}function jn(t,e,n,r,i,o,a){var s;if(r&&(s=o?r(t,i,o,a):r(t)),void 0!==s)return s;if(!p(t))return t;var u=Lu(t);if(u){if(s=gn(t),!e)return fn(t,s)}else{var c=Sc(t),f=c==ff||c==hf;if(of(t))return cn(t,e);if(c==yf||c==af||f&&!o){if(l(t))return o?t:{};if(s=Fn(f?{}:t),!e)return dn(t,ln(s,t))}else{if(!Vf[c])return o?t:{};s=Rn(t,c,jn,e)}}a||(a=new rn);var h=a.get(t);if(h)return h;if(a.set(t,s),!u)var v=n?pn(t):un(t);return on(v||t,function(i,o){v&&(o=i,i=t[o]),d(s,o,jn(i,e,n,r,o,t,a))}),s}function Mn(t){return jn(t,!1,!0)}function In(t){return this.__data__.set(t,Nf),this}function Bn(t){return this.__data__.has(t)}function Dn(t){var e=-1,n=t?t.length:0;for(this.__data__=new en;++e<n;)this.add(t[e])}function Ln(t,e){for(var n=-1,r=t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function zn(t,e,n,r,i,o){var a=i&Mf,s=t.length,u=e.length;if(s!=u&&!(a&&u>s))return!1;var l=o.get(t);if(l)return l==e;var c=-1,f=!0,h=i&jf?new Dn:void 0;for(o.set(t,e);++c<s;){var d=t[c],v=e[c];if(r)var y=a?r(v,d,c,e,t,o):r(d,v,c,t,e,o);if(void 0!==y){if(y)continue;f=!1;break}if(h){if(!Ln(e,function(t,e){if(!h.has(e)&&(d===t||n(d,t,r,i,o)))return h.add(e)})){f=!1;break}}else if(d!==v&&!n(d,v,r,i,o)){f=!1;break}}return o.delete(t),f}function qn(t,e,n,r,i,o,a){switch(n){case Gf:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Uf:return!(t.byteLength!=e.byteLength||!r(new Cc(t),new Cc(e)));case Df:case Lf:return+t==+e;case zf:return t.name==e.name&&t.message==e.message;case Hf:return t!=+t?e!=+e:t==+e;case $f:case Wf:return t==e+"";case qf:var s=xn;case Kf:var u=o&Bf;if(s||(s=An),t.size!=e.size&&!u)return!1;var l=a.get(t);return l?l==e:(o|=If,a.set(t,e),zn(s(t),s(e),r,i,o,a));case Jf:if(Qf)return Qf.call(t)==Qf.call(e)}return!1}function Hn(t,e,n,r,i,o){var a=i&Xf,s=un(t),u=s.length,l=un(e),c=l.length;if(u!=c&&!a)return!1;for(var f=u;f--;){var h=s[f];if(!(a?h in e:an(e,h)))return!1}var d=o.get(t);if(d)return d==e;var v=!0;o.set(t,e);for(var y=a;++f<u;){h=s[f];var p=t[h],m=e[h];if(r)var g=a?r(m,p,h,e,t,o):r(p,m,h,t,e,o);if(!(void 0===g?p===m||n(p,m,r,i,o):g)){v=!1;break}y||(y="constructor"==h)}if(v&&!y){var b=t.constructor,_=e.constructor;b!=_&&"constructor"in t&&"constructor"in e&&!("function"==typeof b&&b instanceof b&&"function"==typeof _&&_ instanceof _)&&(v=!1)}return o.delete(t),v}function $n(t){return c(t)&&g(t.length)&&!!xh[Sh.call(t)]}function Kn(t,e,n,r,i,o){var a=Lu(t),s=Lu(e),u=Ch,c=Ch;a||(u=Sc(t),u=u==Ah?Th:u),s||(c=Sc(e),c=c==Ah?Th:c);var f=u==Th&&!l(t),h=c==Th&&!l(e),d=u==c;if(d&&!f)return o||(o=new rn),a||$n(t)?zn(t,e,n,r,i,o):qn(t,e,u,n,r,i,o);if(!(i&Ph)){var v=f&&Rh.call(t,"__wrapped__"),y=h&&Rh.call(e,"__wrapped__");if(v||y){var p=v?t.value():t,m=y?e.value():e;return o||(o=new rn),n(p,m,r,i,o)}}return!!d&&(o||(o=new rn),Hn(t,e,n,r,i,o))}function Wn(t,e,n,r,i){return t===e||(null==t||null==e||!p(t)&&!c(e)?t!==t&&e!==e:Kn(t,e,Wn,n,r,i))}function Jn(t,e){return Wn(t,e)}function Un(t,e){if(Kh.prototype[t])throw new Qs("model-batch-register-taken: This batch method name is already taken.",{name:t});Kh.prototype[t]=e}function Gn(t,e,n,r){r instanceof hl?Qn(t,t.document,e,n,r):Yn(t,t.document,e,n,r)}function Yn(t,e,n,r,i){var o=i.getAttribute(n),a=void 0,s=void 0,u=i instanceof jl?new Jh:new Wh;t.addDelta(u),o!=r&&(i instanceof jl?s=new Dh(i,n,o,r,e.version):(a=i instanceof sl?new hl(ll.createBefore(i),ll.createFromParentAndOffset(i,0)):new hl(ll.createBefore(i),ll.createAfter(i)),s=new Vh(a,n,o,r,e.version)),u.addOperation(s),e.applyOperation(s))}function Qn(t,e,n,r,i){function o(){var t=new hl(s,u),i=new Vh(t,n,l,r,e.version);a.addOperation(i),e.applyOperation(i)}var a=new Wh;t.addDelta(a);var s=i.start,u=void 0,l=void 0,c=void 0,f=!0,h=!1,d=void 0;try{for(var v,y=i[Symbol.iterator]();!(f=(v=y.next()).done);f=!0){var p=v.value;c=p.item.getAttribute(n),u&&l!=c&&(l!=r&&o(),s=u),u=p.nextPosition,l=c}}catch(t){h=!0,d=t}finally{try{!f&&y.return&&y.return()}finally{if(h)throw d}}u instanceof ll&&u!=s&&l!=r&&o()}function Xn(t,e,n,r,i){var o=new Fh(n,r,i,t.document.version);e.addOperation(o),t.document.applyOperation(o)}function Zn(t,e,n,r){var i=new jh(n,r,t.document.version);e.addOperation(i),t.document.applyOperation(i)}function tr(t,e,n){e.addOperation(n),t.document.applyOperation(n)}function er(t,e,n){var r=void 0,i=void 0;t instanceof Mh?r=rd.InsertOperation:t instanceof Vh?r=rd.AttributeOperation:t instanceof Dh?r=rd.RootAttributeOperation:t instanceof Bh?r=rd.RenameOperation:t instanceof Fh?r=rd.MoveOperation:i=nr,r&&(i=e instanceof Mh?r.InsertOperation:e instanceof Vh?r.AttributeOperation:e instanceof Dh?r.RootAttributeOperation:e instanceof Bh?r.RenameOperation:e instanceof Fh?r.MoveOperation:nr);var o=i(t,e,n);return rr(t.baseVersion,o)}function nr(t){return[t.clone()]}function rr(t,e){for(var n=0;n<e.length;n++)e[n].baseVersion=t+n+1;return e}function ir(t,e){return null===t.targetPosition._getTransformedByDeletion(e.sourcePosition,e.howMany)}function or(t){return 0===t.length?null:1==t.length?t[0]:(t[0].end=t[t.length-1].end,t[0])}function ar(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),n=n>i?i:n,n<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var o=Array(i);++r<i;)o[r]=t[r+e];return o}function sr(t,e,n){e=(n?w(t,e,n):void 0===e)?1:od(P(e),0);var r=t?t.length:0;if(!r||e<1)return[];for(var i=0,o=0,a=Array(id(r/e));i<r;)a[o++]=ar(t,i,i+=e);return a}function ur(t){for(var e=-1,n=t?t.length:0,r=0,i=[];++e<n;){var o=t[e];o&&(i[r++]=o)}return i}function lr(t){return Lu(t)||j(t)}function cr(t,e,n,r,i){var o=-1,a=t.length;for(n||(n=lr),i||(i=[]);++o<a;){var s=t[o];e>0&&n(s)?e>1?cr(s,e-1,n,r,i):vn(i,s):r||(i[i.length]=s)}return i}function fr(){for(var t=arguments.length,e=Array(t?t-1:0),n=arguments[0],r=t;r--;)e[r-1]=arguments[r];return t?vn(Lu(n)?fn(n):[n],cr(e,1)):[]}function hr(t,e,n){for(var r=t.length,i=e+(n?0:-1);n?i--:++i<r;){var o=t[i];if(o!==o)return i}return-1}function dr(t,e,n){if(e!==e)return hr(t,n);for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function vr(t,e){return!!t.length&&dr(t,e,0)>-1}function yr(t,e,n){for(var r=-1,i=t.length;++r<i;)if(n(e,t[r]))return!0;return!1}function pr(t,e){for(var n=-1,r=t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}function mr(t){return function(e){return t(e)}}function gr(t,e){return t.has(e)}function br(t,e,n,r){var i=-1,o=vr,a=!0,s=t.length,u=[],l=e.length;if(!s)return u;n&&(e=pr(e,mr(n))),r?(o=yr,a=!1):e.length>=ad&&(o=gr,a=!1,e=new Dn(e));t:for(;++i<s;){var c=t[i],f=n?n(c):c;if(c=r||0!==c?c:0,a&&f===f){for(var h=l;h--;)if(e[h]===f)continue t;u.push(c)}else o(e,f,r)||u.push(c)}return u}function _r(t,e,n,r){var i=n.length,o=i,a=!r;if(null==t)return!o;for(t=Object(t);i--;){var s=n[i];if(a&&s[2]?s[1]!==t[s[0]]:!(s[0]in t))return!1}for(;++i<o;){s=n[i];var u=s[0],l=t[u],c=s[1];if(a&&s[2]){if(void 0===l&&!(u in t))return!1}else{var f=new rn;if(r)var h=r(l,c,u,t,e,f);if(!(void 0===h?Wn(c,l,r,ud|ld,f):h))return!1}}return!0}function wr(t){return t===t&&!p(t)}function kr(t,e){return pr(e,function(e){return[e,t[e]]})}function xr(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=[t,t]}),n}function Or(t){return function(e){var n=Sc(e);return n==cd?xn(e):n==fd?xr(e):kr(e,t(e))}}function Sr(t){for(var e=hd(t),n=e.length;n--;)e[n][2]=wr(e[n][1]);return e}function Pr(t,e){return function(n){return null!=n&&(n[t]===e&&(void 0!==e||t in Object(n)))}}function Ar(t){var e=Sr(t);return 1==e.length&&e[0][2]?Pr(e[0][0],e[0][1]):function(n){return n===t||_r(n,t,e)}}function Cr(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError(dd);var n=function n(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=t.apply(this,r);return n.cache=o.set(i,a),a};return n.cache=new(Cr.Cache||en),n}function Tr(t){if("string"==typeof t)return t;if(x(t))return pd?pd.call(t):"";var e=t+"";return"0"==e&&1/t==-vd?"-0":e}function Er(t){return null==t?"":Tr(t)}function Rr(t){return Lu(t)?t:bd(t)}function Vr(t,e){if(Lu(t))return!1;var n="undefined"==typeof t?"undefined":Vs(t);return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!x(t))||(wd.test(t)||!_d.test(t)||null!=e&&t in Object(e))}function Fr(t){if("string"==typeof t||x(t))return t;var e=t+"";return"0"==e&&1/t==-kd?"-0":e}function Nr(t,e){e=Vr(e,t)?[e]:Rr(e);for(var n=0,r=e.length;null!=t&&n<r;)t=t[Fr(e[n++])];return n&&n==r?t:void 0}function jr(t,e,n){var r=null==t?void 0:Nr(t,e);return void 0===r?n:r}function Mr(t,e){return e in Object(t)}function Ir(t,e,n){e=Vr(e,t)?[e]:Rr(e);for(var r,i=-1,o=e.length;++i<o;){var a=Fr(e[i]);if(!(r=null!=t&&n(t,a)))break;t=t[a]}if(r)return r;var o=t?t.length:0;return!!o&&g(o)&&_(a,o)&&(Lu(t)||M(t)||j(t))}function Br(t,e){return null!=t&&Ir(t,e,Mr)}function Dr(t,e){return Vr(t)&&wr(e)?Pr(Fr(t),e):function(n){var r=jr(n,t);return void 0===r&&r===e?Br(n,t):Wn(e,r,void 0,xd|Od)}}function Lr(t){return t}function zr(t){return function(e){return Nr(e,t)}}function qr(t){return Vr(t)?y(Fr(t)):zr(t)}function Hr(t){return"function"==typeof t?t:null==t?Lr:"object"==("undefined"==typeof t?"undefined":Vs(t))?Lu(t)?Dr(t[0],t[1]):Ar(t):qr(t)}function $r(t,e,n){var r=t?t.length:0;return r?(e=n||void 0===e?1:P(e),ar(t,e<0?0:e,r)):[]}function Kr(t,e,n){var r=t?t.length:0;return r?(e=n||void 0===e?1:P(e),e=r-e,ar(t,0,e<0?0:e)):[]}function Wr(t,e,n,r){for(var i=t.length,o=r?i:-1;(r?o--:++o<i)&&e(t[o],o,t););return n?ar(t,r?0:o,r?o+1:i):ar(t,r?o+1:0,r?i:o)}function Jr(t,e){return t&&t.length?Wr(t,Hr(e,3),!0,!0):[]}function Ur(t,e){return t&&t.length?Wr(t,Hr(e,3),!0):[]}function Gr(t,e,n){return t===t&&(void 0!==n&&(t=t<=n?t:n),void 0!==e&&(t=t>=e?t:e)),t}function Yr(t){return t?Gr(P(t),0,Ad):0}function Qr(t,e,n,r){var i=t.length;for(n=P(n),n<0&&(n=-n>i?0:i+n),r=void 0===r||r>i?i:P(r),r<0&&(r+=i),r=n>r?0:Yr(r);n<r;)t[n++]=e;return t}function Xr(t,e,n,r){var i=t?t.length:0;return i?(n&&"number"!=typeof n&&w(t,e,n)&&(n=0,r=i),Qr(t,e,n,r)):[]}function Zr(t,e,n){for(var r=t.length,i=n?r:-1;n?i--:++i<r;)if(e(t[i],i,t))return i;return-1}function ti(t,e){return t&&t.length?Zr(t,Hr(e,3)):-1}function ei(t,e){return t&&t.length?Zr(t,Hr(e,3),!0):-1}function ni(t){return t&&t.length?t[0]:void 0}function ri(t){var e=t?t.length:0;return e?cr(t,1):[]}function ii(t){var e=t?t.length:0;return e?cr(t,Cd):[]}function oi(t,e){var n=t?t.length:0;return n?(e=void 0===e?1:P(e),cr(t,e)):[]}function ai(t){for(var e=-1,n=t?t.length:0,r={};++e<n;){var i=t[e];r[i[0]]=i[1]}return r}function si(t,e,n){var r=t?t.length:0;return r?(n=P(n),n<0&&(n=Td(r+n,0)),dr(t,e,n)):-1}function ui(t){return Kr(t,1)}function li(t,e,n){for(var r=n?yr:vr,i=t[0].length,o=t.length,a=o,s=Array(o),u=1/0,l=[];a--;){var c=t[a];a&&e&&(c=pr(c,mr(e))),u=Ed(c.length,u),s[a]=!n&&(e||i>=120&&c.length>=120)?new Dn(a&&c):void 0}c=t[0];var f=-1,h=s[0];t:for(;++f<i&&l.length<u;){var d=c[f],v=e?e(d):d;if(d=n||0!==d?d:0,!(h?gr(h,v):r(l,v,n))){for(a=o;--a;){var y=s[a];if(!(y?gr(y,v):r(t[a],v,n)))continue t}h&&h.push(v),l.push(d)}}return l}function ci(t){return N(t)?t:[]}function fi(t,e){return t?jd.call(t,e):""}function hi(t,e,n){var r=t?t.length:0;if(!r)return-1;var i=r;if(void 0!==n&&(i=P(n),i=(i<0?Md(r+i,0):Id(i,r-1))+1),e!==e)return hr(t,i,!0);for(;i--;)if(t[i]===e)return i;return-1}function di(t,e){var n=t.length;if(n)return e+=e<0?n:0,_(e,n)?t[e]:void 0}function vi(t,e){return t&&t.length?di(t,P(e)):void 0}function yi(t,e,n,r){for(var i=n-1,o=t.length;++i<o;)if(r(t[i],e))return i;return-1}function pi(t,e,n,r){var i=r?yi:dr,o=-1,a=e.length,s=t;for(n&&(s=pr(t,mr(n)));++o<a;)for(var u=0,l=e[o],c=n?n(l):l;(u=i(s,c,u,r))>-1;)s!==t&&Dd.call(s,u,1),Dd.call(t,u,1);return t}function mi(t,e){return t&&t.length&&e&&e.length?pi(t,e):t}function gi(t,e,n){return t&&t.length&&e&&e.length?pi(t,e,Hr(n)):t}function bi(t,e,n){return t&&t.length&&e&&e.length?pi(t,e,void 0,n):t}function _i(t,e){for(var n=-1,r=null==t,i=e.length,o=Array(i);++n<i;)o[n]=r?void 0:jr(t,e[n]);return o}function wi(t,e){return 1==e.length?t:Nr(t,ar(e,0,-1))}function ki(t,e){for(var n=t?e.length:0,r=n-1;n--;){var i=e[n];if(n==r||i!==o){var o=i;if(_(i))qd.call(t,i,1);else if(Vr(i,t))delete t[Fr(i)];else{var a=Rr(i),s=wi(t,a);null!=s&&delete s[Fr(Z(a))]}}}return t}function xi(t,e){if(t!==e){var n=void 0!==t,r=null===t,i=t===t,o=x(t),a=void 0!==e,s=null===e,u=e===e,l=x(e);if(!s&&!l&&!o&&t>e||o&&a&&u&&!s&&!l||r&&a&&u||!n&&u||!i)return 1;if(!r&&!o&&!l&&t<e||l&&n&&i&&!r&&!o||s&&n&&i||!a&&i||!u)return-1}return 0}function Oi(t,e){var n=[];if(!t||!t.length)return n;var r=-1,i=[],o=t.length;for(e=Hr(e,3);++r<o;){var a=t[r];e(a,r,t)&&(n.push(a),i.push(r))}return ki(t,i),n}function Si(t){return t?Kd.call(t):t}function Pi(t,e,n){var r=t?t.length:0;return r?(n&&"number"!=typeof n&&w(t,e,n)?(e=0,n=r):(e=null==e?0:P(e),n=void 0===n?r:P(n)),ar(t,e,n)):[]}function Ai(t,e,n,r){e=n(e);for(var i=0,o=t?t.length:0,a=e!==e,s=null===e,u=x(e),l=void 0===e;i<o;){var c=Ud((i+o)/2),f=n(t[c]),h=void 0!==f,d=null===f,v=f===f,y=x(f);if(a)var p=r||v;else p=l?v&&(r||h):s?v&&h&&(r||!d):u?v&&h&&!d&&(r||!y):!d&&!y&&(r?f<=e:f<e);p?i=c+1:o=c}return Gd(o,Jd)}function Ci(t,e,n){var r=0,i=t?t.length:r;if("number"==typeof e&&e===e&&i<=Qd){for(;r<i;){var o=r+i>>>1,a=t[o];null!==a&&!x(a)&&(n?a<=e:a<e)?r=o+1:i=o}return i}return Ai(t,e,Lr,n)}function Ti(t,e){return Ci(t,e)}function Ei(t,e,n){return Ai(t,e,Hr(n))}function Ri(t,e){var n=t?t.length:0;if(n){var r=Ci(t,e);if(r<n&&h(t[r],e))return r}return-1}function Vi(t,e){return Ci(t,e,!0)}function Fi(t,e,n){return Ai(t,e,Hr(n),!0)}function Ni(t,e){var n=t?t.length:0;if(n){var r=Ci(t,e,!0)-1;if(h(t[r],e))return r}return-1}function ji(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n],s=e?e(a):a;if(!n||!h(s,u)){var u=s;o[i++]=0===a?0:a}}return o}function Mi(t){return t&&t.length?ji(t):[]}function Ii(t,e){return t&&t.length?ji(t,Hr(e)):[]}function Bi(t){return $r(t,1)}function Di(t,e,n){return t&&t.length?(e=n||void 0===e?1:P(e),ar(t,0,e<0?0:e)):[]}function Li(t,e,n){var r=t?t.length:0;return r?(e=n||void 0===e?1:P(e),e=r-e,ar(t,e<0?0:e,r)):[]}function zi(t,e){return t&&t.length?Wr(t,Hr(e,3),!1,!0):[]}function qi(t,e){return t&&t.length?Wr(t,Hr(e,3)):[]}function Hi(){}function $i(t,e,n){var r=-1,i=vr,o=t.length,a=!0,s=[],u=s;if(n)a=!1,i=yr;else if(o>=tv){var l=e?null:Zd(t);if(l)return An(l);a=!1,i=gr,u=new Dn}else u=e?[]:s;t:for(;++r<o;){var c=t[r],f=e?e(c):c;if(c=n||0!==c?c:0,a&&f===f){for(var h=u.length;h--;)if(u[h]===f)continue t;e&&u.push(f),s.push(c)}else i(u,f,n)||(u!==s&&u.push(f),s.push(c))}return s}function Ki(t){return t&&t.length?$i(t):[]}function Wi(t,e){return t&&t.length?$i(t,Hr(e)):[]}function Ji(t,e){return t&&t.length?$i(t,void 0,e):[]}function Ui(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n];e(a,n,t)&&(o[i++]=a)}return o}function Gi(t){if(!t||!t.length)return[];var e=0;return t=Ui(t,function(t){if(N(t))return e=iv(t.length,e),!0}),F(e,function(e){return pr(t,y(e))})}function Yi(t,e){if(!t||!t.length)return[];var n=Gi(t);return null==e?n:pr(n,function(t){return k(e,void 0,t)})}function Qi(t,e,n){for(var r=-1,i=t.length;++r<i;)var o=o?vn(br(o,t[r],e,n),br(t[r],o,e,n)):t[r];return o&&o.length?$i(o,e,n):[]}function Xi(t,e,n){for(var r=-1,i=t.length,o=e.length,a={};++r<i;){var s=r<o?e[r]:void 0;n(a,t[r],s)}return a}function Zi(t,e){return Xi(t||[],e||[],d)}function to(t,e,n,r){e=Vr(e,t)?[e]:Rr(e);for(var i=-1,o=e.length,a=o-1,s=t;null!=s&&++i<o;){var u=Fr(e[i]);if(p(s)){var l=n;if(i!=a){var c=s[u];l=r?r(c,u,s):void 0,void 0===l&&(l=null==c?_(e[i+1])?[]:{}:c)}d(s,u,l)}s=s[u]}return t}function eo(t,e){return Xi(t||[],e||[],to)}function no(t,e,n){var r=ao(t,e)||io,i=r(t,e,n),o=fv.last(e.operations).baseVersion;return ro(o,i)}function ro(t,e){var n=!0,r=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,u=!0,l=!1,c=void 0;try{for(var f,h=s.operations[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var d=f.value;d.baseVersion=++t}}catch(t){l=!0,c=t}finally{try{!u&&h.return&&h.return()}finally{if(l)throw c}}}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return e}function io(t,e,n){n=so(t.constructor,e.constructor,n);var r=new t.constructor,i=e.operations,o=[],a=!0,s=!1,u=void 0;try{for(var l,c=t.operations[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var f=l.value,h=[f],d=!0,v=!1,y=void 0;try{for(var p,m=i[Symbol.iterator]();!(d=(p=m.next()).done);d=!0)for(var g=p.value,b=0;b<h.length;b++){var _=h[b];Array.prototype.push.apply(o,er(g,_,!n));var w=er(_,g,n);Array.prototype.splice.apply(h,[b,1].concat(w)),b+=w.length-1}}catch(t){v=!0,y=t}finally{try{!d&&m.return&&m.return()}finally{if(v)throw y}}i=o,o=[];var k=!0,x=!1,O=void 0;try{for(var S,P=h[Symbol.iterator]();!(k=(S=P.next()).done);k=!0){var A=S.value;r.addOperation(A)}}catch(t){x=!0,O=t}finally{try{!k&&P.return&&P.return()}finally{if(x)throw O}}}}catch(t){s=!0,u=t}finally{try{!a&&c.return&&c.return()}finally{if(s)throw u}}return[r]}function oo(t,e,n){var r=hv.get(t);r||(r=new Map,hv.set(t,r)),r.set(e,n)}function ao(t,e){var n=hv.get(t.constructor);if(!n||!n.get(e.constructor)){var r=hv.keys(),i=!0,o=!1,a=void 0;try{for(var s,u=r[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;if(t instanceof l&&hv.get(l).get(e.constructor)){n=hv.get(l);break}}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}if(n)return n.get(e.constructor)}function so(t,e,n){return t._priority>e._priority||!(t._priority<e._priority)&&n}function uo(t,e,n){for(var r=Array.from(t),i=Array.from(e),o=0;o<r.length;o++){for(var a=[r[o]],s=0;s<i.length;s++){for(var u=[i[s]],l=0;l<a.length;l++)for(var c=0;c<u.length;c++){var f=no(a[l],u[c],n),h=no(u[c],a[l],!n);a.splice.apply(a,[l,1].concat(Ds(f))),l+=f.length-1,u.splice.apply(u,[c,1].concat(Ds(h))),c+=h.length-1}i.splice.apply(i,[s,1].concat(u)),s+=u.length-1}r.splice.apply(r,[o,1].concat(a)),o+=a.length-1}var d=lo(r)-lo(t),v=lo(i)-lo(e);return v<d?co(i,d-v):d<v&&co(r,v-d),{deltasA:r,deltasB:i}}function lo(t){return t.reduce(function(t,e){return t+e.operations.length},0)}function co(t,e){for(var n=t[t.length-1],r=n.operations.length+n.baseVersion,i=new $h,o=0;o<e;o++)i.addOperation(new Ih((r++)));t.push(i)}function fo(t,e){function n(){var n=new hl(t.position.getShiftedBy(a),t.position.getShiftedBy(s)),i=new Vh(n,e.key,o,e.value,0);r.addOperation(i)}for(var r=new Wh,i=t.nodes,o=i.getNode(0).getAttribute(e.key),a=0,s=i.getNode(0).offsetSize,u=1;u<i.length;u++){var l=i.getNode(u),c=l.getAttribute(e.key);c!=o&&(o!=e.value&&n(),o=c,a=s),s+=l.offsetSize}return n(),r}function ho(){var t=new $h;return t.addOperation(new Ih(0)),t}function vo(){var t=this,e=new Set(["insert","move","remove","reinsert"]);this.listenTo(this.root.document,"change",function(n,r,i){e.has(r)&&yo.call(t,r,i.range,i.sourcePosition)},{priority:"high"})}function yo(t,e,n){var r=e.end.offset-e.start.offset,i=e.start;"move"==t&&(i=i._getTransformedByInsertion(n,r));var o=this._getTransformedByDocumentChange(t,i,r,n);"move"!=t||3!=o.length||o[1].isEmpty||(o[2]=e);var a=hl.createFromRanges(o);if(!a.isEqual(this)){var s=hl.createFromRange(this);this.start=a.start,this.end=a.end,this.fire("change",s)}}function po(t,e){if(t.size!=e.size)return!1;var n=!0,r=!1,i=void 0;try{for(var o,a=t.entries()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,u=JSON.stringify(s[1]),l=JSON.stringify(e.get(s[0]));if(u!==l)return!1}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return!0}function mo(t){return t instanceof cl||t instanceof al?t.getAttributes():null}function go(t,e,n){for(var r=n.length-1,i=e.length-1;r>=0&&i>=0;){var o=e[i];if(!t.hasItem(o))return!1;var a=t._extensionChains.get(o);if(!a.includes(n[r]))return!1;r--,i--}return!0}function bo(t){var e=t.textNode;if(e){var n=e.data,r=t.offset-e.startOffset;return!we(n,r)&&!ke(n,r)}return!0}function _o(t,e){var n,r,i;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:n=!1;case 1:if(n){o.next=17;break}if(n=!0,!t){o.next=9;break}if(r=t.next(),r.done){o.next=9;break}return n=!1,o.next=9,{walker:t,value:r.value};case 9:if(!e){o.next=15;break}if(i=e.next(),i.done){o.next=15;break}return n=!1,o.next=15,{walker:e,value:i.value};case 15:o.next=1;break;case 17:case"end":return o.stop()}},kv[0],this)}function wo(t){return t.indexOf("macintosh")>-1}function ko(t){var e=void 0;if("string"==typeof t){if(e=Cv[t.toLowerCase()],!e)throw new Qs("keyboard-unknown-key: Unknown key name.",{key:t})}else e=t.keyCode+(t.altKey?Cv.alt:0)+(t.ctrlKey?Cv.ctrl:0)+(t.shiftKey?Cv.shift:0);return e}function xo(t){return"string"==typeof t&&(t=Po(t)),t.map(function(t){return"string"==typeof t?ko(t):t}).reduce(function(t,e){return e+t},0)}function Oo(t){var e=Po(t);return Av.mac&&"ctrl"==e[0].toLowerCase()?"⌘"+(e[1]||""):t}function So(){for(var t={arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,backspace:8,delete:46,enter:13,esc:27,tab:9,ctrl:1114112,cmd:1114112,shift:2228224,alt:4456448},e=65;e<=90;e++){var n=String.fromCharCode(e);t[n.toLowerCase()]=e}for(var r=48;r<=57;r++)t[r-48]=r;return t}function Po(t){return t.split(/\s*\+\s*/)}function Ao(t){return t instanceof Text&&t.data.substr(0,Fv)===Nv}function Co(t){return t.data.length==Fv&&Ao(t)}function To(t){return Ao(t)?t.data.slice(Fv):t.data}function Eo(t,e){var n=Mv.get(e);return n||(n=e(window.document),Mv.set(e,n)),t.isEqualNode(n)}function Ro(t){t.on("keydown",Vo)}function Vo(t,e){if(e.keyCode==Cv.arrowleft){var n=e.domTarget.ownerDocument.defaultView.getSelection();if(1==n.rangeCount&&n.getRangeAt(0).collapsed){var r=n.getRangeAt(0).startContainer,i=n.getRangeAt(0).startOffset;if(Ao(r)&&i<=Fv){var o=new Range;o.setStart(r,0),o.collapse(!0),n.removeAllRanges(),n.addRange(o)}}}}function Fo(t,e,n){function r(r){var a=(void 0!==f[r-1]?f[r-1]:-1)+1,l=void 0!==f[r+1]?f[r+1]:-1,h=a>l?-1:1;c[r+h]&&(c[r]=c[r+h].slice(0)),c[r]||(c[r]=[]),c[r].push(a>l?i:o);for(var d=Math.max(a,l),v=d-r;v<s&&d<u&&n(t[v],e[d]);)v++,d++,c[r].push("equal");return d}n=n||function(t,e){return t===e};var i=void 0,o=void 0;if(e.length<t.length){var a=t;t=e,e=a,i="delete",o="insert"}else i="insert",o="delete";var s=t.length,u=e.length,l=u-s,c={},f={},h=0,d=void 0;do{for(d=-h;d<l;d++)f[d]=r(d);for(d=l+h;d>l;d--)f[d]=r(d);f[l]=r(l),h++}while(f[l]!==u);return c[l].slice(1)}function No(t,e,n){t.insertBefore(n,t.childNodes[e]||null)}function jo(t){var e=t.parentNode;e&&e.removeChild(t)}function Mo(t){for(var e=0;t.previousSibling;)t=t.previousSibling,e++;return e}function Io(t){for(var e=[];t&&t.nodeType!=Node.DOCUMENT_NODE;)e.unshift(t),t=t.parentNode;return e}function Bo(t,e){for(var n=Io(t),r=Io(e),i=0;n[i]==r[i]&&n[i];)i++;return 0===i?null:n[i-1]}function Do(t,e,n){var r=Io(t);return n&&(r=r.slice(r.indexOf(n)+1)),r.some(function(t){return t.tagName&&e.includes(t.tagName.toLowerCase())})}function Lo(t){return t["data-ck-expando"]||(t["data-ck-expando"]=e())}function zo(t){return t&&Le(t.addEventListener)}function qo(t){return t==Cv.arrowright||t==Cv.arrowleft||t==Cv.arrowup||t==Cv.arrowdown}function Ho(t,e){return function(n,r){var i=r.newSelection,o=new yv,a=[],s=!0,u=!1,l=void 0;try{for(var c,f=i.getRanges()[Symbol.iterator]();!(s=(c=f.next()).done);s=!0){var h=c.value;a.push(e.toModelRange(h))}}catch(t){u=!0,l=t}finally{try{!s&&f.return&&f.return()}finally{if(u)throw l}}o.setRanges(a,i.isBackward),o.isEqual(t.selection)||t.enqueueChanges(function(){t.selection.setTo(o)})}}function $o(){return function(t,e,n,r){var i=e.selection;if(!i.isCollapsed&&n.consume(i,"selection")){r.viewSelection.removeAllRanges();var o=!0,a=!1,s=void 0;try{for(var u,l=i.getRanges()[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value,f=r.mapper.toViewRange(c);r.viewSelection.addRange(f,i.isBackward)}}catch(t){a=!0,s=t}finally{try{!o&&l.return&&l.return()}finally{if(a)throw s}}}}}function Ko(){return function(t,e,n,r){var i=e.selection;if(i.isCollapsed&&n.consume(i,"selection")){var o=i.getFirstPosition(),a=r.mapper.toViewPosition(o),s=El.breakAttributes(a);r.viewSelection.removeAllRanges(),r.viewSelection.addRange(new kl(s,s))}}}function Wo(t){return function(e,n,r,i){var o=n.selection;if(o.isCollapsed&&r.consume(o,"selectionAttribute:"+n.key)){var a=i.viewSelection.getFirstPosition();i.viewSelection.removeAllRanges();var s=t instanceof ml?t.clone(!0):t(n.value,n,o,r,i);a=El.wrapPosition(a,s),i.viewSelection.addRange(new kl(a,a))}}}function Jo(){return function(t,e,n,r){var i=!0,o=!1,a=void 0;try{for(var s,u=r.viewSelection.getRanges()[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;l.isCollapsed&&l.end.parent.document&&El.mergeAttributes(l.start)}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}r.viewSelection.removeAllRanges()}}function Uo(){return function(t,e,n,r){return r.viewSelection.setFake(!1)}}function Go(t){return t instanceof HTMLTextAreaElement?t.value:t.innerHTML}function Yo(t,e){t instanceof HTMLTextAreaElement&&(t.value=e),t.innerHTML=e}function Qo(t){return t.every(function(t){return"string"==typeof t})}function Xo(t,e){return jn(t,!0,!0,e)}function Zo(t){return!!t&&(t.value&&(t=t.value),Array.isArray(t)?t.some(Zo):t instanceof uy)}function ta(t,e){return t.map(function(t){return t instanceof uy?t.getValue(e):t})}function ea(t,e,n){var r=ta(t,e);r=1==t.length&&t[0]instanceof cy?r[0]:r.reduce(ha,""),ya(r)?n.remove():n.set(r)}function na(t){return{set:function(e){t.textContent=e},remove:function(){t.textContent=""}}}function ra(t,e,n){return{set:function(r){t.setAttributeNS(n,e,r)},remove:function(){t.removeAttributeNS(n,e)}}}function ia(t,e){return{set:function(n){t.style[e]=n},remove:function(){t.style[e]=null}}}function oa(t){var e=Xo(t,function(t){if(t&&(t instanceof uy||pa(t)||ma(t)))return t});return e}function aa(t){if("string"==typeof t?t=la(t):t.text&&ca(t),t.on&&(t.eventListeners=ua(t.on),delete t.on),!t.text){t.attributes&&sa(t.attributes);var e=new iy;if(t.children)if(ma(t.children))e.add(t.children);else{var n=!0,r=!1,i=void 0;try{for(var o,a=t.children[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;pa(s)?e.add(s):e.add(new sy(s))}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}}t.children=e}return t}function sa(t){for(var e in t)t[e].value&&(t[e].value=[].concat(t[e].value)),fa(t,e)}function ua(t){for(var e in t)fa(t,e);return t}function la(t){return{text:[t]}}function ca(t){Array.isArray(t.text)||(t.text=[t.text])}function fa(t,e){Array.isArray(t[e])||(t[e]=[t[e]])}function ha(t,e){return ya(e)?t:ya(t)?e:t+" "+e}function da(t,e){for(var n in e)if(t[n]){var r;(r=t[n]).push.apply(r,Ds(e[n]))}else t[n]=e[n]}function va(t,e){if(e.attributes&&(t.attributes||(t.attributes={}),da(t.attributes,e.attributes)),e.eventListeners&&(t.eventListeners||(t.eventListeners={}),da(t.eventListeners,e.eventListeners)),e.text){var n;(n=t.text).push.apply(n,Ds(e.text))}if(e.children&&e.children.length){if(t.children.length!=e.children.length)throw new Qs("ui-template-extend-children-mismatch: The number of children in extended definition does not match.");var r=0,i=!0,o=!1,a=void 0;try{for(var s,u=e.children[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;va(t.children.get(r++),l)}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}}function ya(t){return!t&&0!==t}function pa(t){return t instanceof fy}function ma(t){return t instanceof oy}function ga(t){return function(e){return e+t}}function ba(t,e,n){var r=[],i=!0,o=!1,a=void 0;try{for(var s,u=e[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){for(var l=s.value,c=new fl({boundaries:l,mergeCharacters:!0}),f=c.next(),h=l.start,d=l.start,v=l.end;!f.done;){var y=f.value.item.name||"$text",p=ll.createBefore(f.value.item);n.check({name:y,inside:p,attributes:t})||(d.isEqual(h)||r.push(new hl(d,h)),d=c.position),h=c.position,f=c.next()}d&&!d.isEqual(v)&&r.push(new hl(d,v))}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}return r}function _a(t){return Array.from(t.getChildren()).reduce(function(t,e){return t+e.data},"")}function wa(){return new Ey}function ka(t,e,n,r){if(Y(t)){var i=!0,o=!1,a=void 0;try{for(var s,u=t[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;ka(l,e,n,r)}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}else{var c=Array.from(t.getAttributeKeys());c.push(e.key);
var f={name:t.name||"$text",attributes:c,inside:n.context};r.schema.check(f)&&t.setAttribute(e.key,e.value)}}function xa(){return new Ry}function Oa(t,e,n,r,i){if(r.test(n.input)&&t.schema.check({name:"paragraph",inside:n.context})){var o=new sl("paragraph");Fy.add(o),n.context.push(o);var a=i.convertItem(n.input,r,n);a&&(n.output=o,o.appendChildren(a)),n.context.pop()}}function Sa(t,e,n,r,i){if(Vy.paragraphLikeElements.has(n.input.name)&&r.test(n.input,{name:!0})&&!Aa(n.input)&&t.schema.check({name:"paragraph",inside:n.context})){r.consume(n.input,{name:!0});var o=new sl("paragraph");n.context.push(o);var a=i.convertChildren(n.input,r,n);o.appendChildren(Nl.normalizeNodes(a)),n.context.pop(),n.output=o}}function Pa(t,e){if(e.output){var n=void 0;for(n=Lu(e.output)?e.output[0]:e.output.getChild(0);n&&n.nextSibling;){var r=n.nextSibling;Fy.has(n)&&Fy.has(r)?(Nl.insert(ll.createAt(n,"end"),Array.from(r.getChildren())),Nl.remove(hl.createOn(r))):n=n.nextSibling}}}function Aa(t){var e=kl.createIn(t),n=!0,r=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if(s.item instanceof ml&&Vy.paragraphLikeElements.has(s.item.name))return!0}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return!1}function Ca(t,e){e.isEnabled=!1}function Ta(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=t.parent;if(n instanceof jl)return e?t.nodeAfter:t.nodeBefore;for(;!(n.parent instanceof jl);)n=n.parent;return n}function Ea(t){return Array.from(t.getAncestors()).find(function(t){return"listItem"==t.name})||null}function Ra(t,e){for(var n=Va(t.getFirstPosition(),e),r=t.getLastPosition(),i=[];null!==n&&n.isBefore(r);)i.push(n.nodeAfter),n.offset++,n=Va(n,e);return i}function Va(t,e){var n=t.nodeAfter;for(n||(n=t.parent);null!==n&&!e.itemExtends(n.name||"$text","$block");)n=n.parent;return null!==n&&null!==n.parent?ll.createBefore(n):null}function Fa(){var t=!this.isEmpty&&("ul"==this.getChild(0).name||"ol"==this.getChild(0).name);return this.isEmpty||t?0:null}function Na(t,e,n,r){if(n.test(e.item,"insert")&&n.test(e.item,"addAttribute:type")&&n.test(e.item,"addAttribute:indent")){n.consume(e.item,"insert"),n.consume(e.item,"addAttribute:type"),n.consume(e.item,"addAttribute:indent");var i=e.item,o=Ka(i,r.mapper);Ua(i,o,r.mapper)}}function ja(t,e,n,r){if(n.consume(e.item,"changeAttribute:type")){var i=r.mapper.toViewElement(e.item);El.breakContainer(_l.createBefore(i)),El.breakContainer(_l.createAfter(i));var o=i.parent,a="numbered"==e.attributeNewValue?"ol":"ul";o=El.rename(o,a),Ja(o,o.nextSibling),Ja(o.previousSibling,o)}}function Ma(t,e,n,r){if(n.consume(e.item,"remove")){var i=r.mapper.toViewElement(e.item);El.breakContainer(_l.createBefore(i)),El.breakContainer(_l.createAfter(i));var o=i.parent;El.remove(kl.createOn(o))}}function Ia(t,e,n,r){if(n.consume(e.item,"move")){var i=r.mapper.toViewElement(e.item);El.breakContainer(_l.createBefore(i)),El.breakContainer(_l.createAfter(i));var o=i.parent,a=o.previousSibling,s=o.nextSibling,u=r.mapper.toViewPosition(e.targetPosition);"ol"!=u.parent.name&&"ul"!=u.parent.name||(u=El.breakContainer(u)),El.move(kl.createOn(o),u),Ja(a,s),Ja(o,o.nextSibling),Ja(o.previousSibling,o)}}function Ba(t,e,n,r){if(n.consume(e.item,"changeAttribute:indent")){var i=r.mapper.toViewElement(e.item);El.breakContainer(_l.createBefore(i)),El.breakContainer(_l.createAfter(i));var o=i.parent,a=o.previousSibling;El.remove(kl.createOn(o)),Ja(a,a.nextSibling),Ua(e.item,i,r.mapper)}}function Da(t,e,n,r){if("listItem"!=e.item.name)for(var i=r.mapper.toViewPosition(e.range.start);("ul"==i.parent.name||"ol"==i.parent.name)&&(i=El.breakContainer(i),null!==i.parent.parent);)i=_l.createBefore(i.parent)}function La(t,e,n,r){var i=r.mapper.toViewPosition(e.sourcePosition),o=i.nodeBefore,a=i.nodeAfter;Ja(o,a)}function za(t,e,n,r){if(n.consume(e.input,{name:!0})){var i=new sl("listItem");e.indent=e.indent?e.indent:0;var o="ul"==e.input.parent.name?"bulleted":"numbered";i.setAttribute("type",o),i.setAttribute("indent",e.indent),e.context.push(i),e.indent++;var a=[i],s=!0,u=!1,l=void 0;try{for(var c,f=e.input.getChildren()[Symbol.iterator]();!(s=(c=f.next()).done);s=!0){var h=c.value,d=r.convertItem(h,n,e);"ul"==h.name||"ol"==h.name?a=a.concat(Array.from(d.getChildren())):i.appendChildren(d)}}catch(t){u=!0,l=t}finally{try{!s&&f.return&&f.return()}finally{if(u)throw l}}e.indent--,e.context.pop(),e.output=e.output?e.output.concat(a):a}}function qa(t,e,n){if(n.test(e.input,{name:!0})){var r=Array.from(e.input.getChildren()),i=!0,o=!1,a=void 0;try{for(var s,u=r[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;l.name&&"li"==l.name||l.remove()}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}}function Ha(t,e){"li"==e.viewPosition.parent.name&&"listItem"!=e.modelPosition.parent.name&&(e.viewPosition=_l.createBefore(e.viewPosition.parent),t.stop())}function $a(t,e){var n=e.viewPosition,r=e.mapper,i=n.nodeAfter,o=n.nodeBefore,a=void 0;if(i)"ul"==i.name||"ol"==i.name?a=r.toModelElement(i.getChild(0)):"li"==i.name&&(a=r.toModelElement(i)),a&&(e.modelPosition=ll.createBefore(a));else if(o){var s=void 0;if("ul"==o.name||"ol"==o.name?s=o.getChild(o.childCount-1):"li"==o.name&&(s=o),s){a=r.toModelElement(s);var u=r.getModelLength(s);e.modelPosition=ll.createBefore(a).getShiftedBy(u)}}null!==e.modelPosition&&t.stop()}function Ka(t,e){var n="numbered"==t.getAttribute("type")?"ol":"ul",r=new Ly,i=new gl(n,null);return i.appendChildren(r),e.bindElements(t,r),r}function Wa(t,e){for(var n=e.getNext?"nextSibling":"previousSibling",r=!!e.checkAllSiblings,i=!!e.sameIndent,o=!!e.biggerIndent,a=t.getAttribute("indent"),s=t[n];s&&"listItem"==s.name;){var u=s.getAttribute("indent");if(i&&a==u||o&&a<u)return s;if(!r||a>u)return null;s=s[n]}return null}function Ja(t,e){t&&e&&("ul"==t.name||"ol"==t.name)&&t.name==e.name&&El.mergeContainers(_l.createAfter(t))}function Ua(t,e,n){var r=e.parent,i=Wa(t,{sameIndent:!0,biggerIndent:!0});if(i){var o=n.toViewElement(i),a=_l.createAfter(o);El.breakContainer(a)}var s=Wa(t,{sameIndent:!0,checkAllSiblings:!0}),u=void 0;if(s){var l=n.toViewElement(s),c=_l.createAfter(l);u=El.breakContainer(c)}else{var f=t.previousSibling;u=f&&"listItem"==f.name?_l.createAt(n.toViewElement(f),"end"):n.toViewPosition(ll.createBefore(t))}El.insert(u,r);var h=Wa(t,{getNext:!0,biggerIndent:!0}),d=n.toViewElement(h);if(d){var v=kl.createOn(d.parent),y=_l.createAt(e,"end");El.move(v,y)}Ja(r,r.nextSibling),Ja(r.previousSibling,r)}function Ga(t,e,n){if(e.isCollapsed)return n.check({name:"$text",inside:e.getFirstPosition(),attributes:t});var r=e.getRanges(),i=!0,o=!1,a=void 0;try{for(var s,u=r[Symbol.iterator]();!(i=(s=u.next()).done);i=!0)for(var l=s.value,c=new fl({boundaries:l,mergeCharacters:!0}),f=c.position,h=c.next();!h.done;){var d=h.value.item.name||"$text";if(n.check({name:d,inside:f,attributes:t}))return!0;f=c.position,h=c.next()}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}return!1}function Ya(t){return t=t.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n\n/g,"</p><p>").replace(/\n/g," ").replace(/^\s/,"&nbsp;").replace(/\s$/,"&nbsp;").replace(/\s\s/g," &nbsp;"),t.indexOf("</p><p>")>-1&&(t="<p>"+t+"</p>"),t}function Qa(t){return t.replace(/<span class="Apple-converted-space">(\s+)<\/span>/g,function(t,e){return 1==e.length?" ":e})}function Xa(t,e,n){var r=n.isCollapsed,i=n.getFirstRange(),o=i.start.parent,a=i.end.parent;if(o.root==o)return void(r||t.deleteContent(n,e));if(r)Za(e,n,i.start);else{var s=i.start.isAtStart&&i.end.isAtEnd,u=o==a;t.deleteContent(n,e,{merge:s}),s||(u?Za(e,n,n.focus):n.collapse(a))}}function Za(t,e,n){if(n.isAtEnd){var r=n.parent,i=new r.constructor(r.name,r.getAttributes());t.insert(ll.createAfter(n.parent),i)}else t.split(n);e.collapse(n.parent.nextSibling)}function ts(t,e){var n=new Gy(e);n.bind("label","isOn","isEnabled","withText","keystroke").to(t);var r=new sp(e);return new ap(e,n,r)}function es(t,e){var n=ts(t,e),r=n.listView=new ip(e);return r.items.bindTo(t.items).as(function(t){var n=new op(e);return n.bind.apply(n,Ds(Object.keys(t))).to(t),n}),r.items.delegate("execute").to(n),n.panelView.children.add(r),n.on("change:isOpen",function(t,e,r){r?ns(n):n.stopListening(document)}),n.on("execute",function(){n.isOpen=!1}),n}function ns(t){t.listenTo(document,"click",function(e,n){var r=n.target;t.element==r||t.element.contains(r)||(t.isOpen=!1)})}function rs(t){return!!t.getCustomProperty(lp)}function is(t){return t.setAttribute("contenteditable",!1),t.getFillerOffset=os,t.addClass(cp),t.setCustomProperty(lp,!0),t}function os(){return null}function as(t){return t.setCustomProperty(dp,!0),is(t)}function ss(t){return!!t.getCustomProperty(dp)&&rs(t)}function us(){return function(t,e,n,r){var i=e.input;if(n.test(i,{name:!0,class:"image"})&&r.schema.check({name:"image",inside:e.context,attributes:"src"})){var o=i.getChild(0);if(o&&"img"==o.name&&n.test(o,{name:!0,attribute:"src"})){n.consume(i,{name:!0,class:"image"}),n.consume(o,{name:!0,attribute:"src"});var a=new sl("image",{src:o.getAttribute("src")});n.consume(o,{attribute:["alt"]})&&a.setAttribute("alt",o.getAttribute("alt")),e.output=a}}}}function ls(t){return function(e,n,r,i){var o=i.viewSelection,a=o.getSelectedElement();if(a&&ss(a)){var s=t("image widget"),u=a.getChild(0),l=u.getAttribute("alt");l&&(s=l+" "+s),o.setFake(!0,{label:s})}}}function cs(t){var e=new Cl("img",{src:t.getAttribute("src")});return t.hasAttribute("alt")&&e.setAttribute("alt",t.getAttribute("alt")),new gl("figure",{class:"image"},e)}function fs(t){return t==Cv.arrowright||t==Cv.arrowleft||t==Cv.arrowup||t==Cv.arrowdown}function hs(t){return t==Cv.delete||t==Cv.backspace}function ds(t,e){return new hl(vs(t,e,!0),vs(t,e,!1))}function vs(t,e,n){for(var r=t.textNode||(n?t.nodeBefore:t.nodeAfter),i=null;r&&r.getAttribute("linkHref")==e;)i=r,r=n?r.previousSibling:r.nextSibling;return i?ll.createAt(i,n?"before":"after"):t}function ys(t){var e=t.emitter,n=t.activator,r=t.callback,i=t.contextElement;e.listenTo(document,"mouseup",function(t,e){var o=e.target;n()&&!i.contains(o)&&r()})}function ps(t){var e=t.emitter,n=t.activator,r=t.callback;e.listenTo(document,"keydown",function(t,e){var i=e.keyCode;i==Cv.esc&&n()&&r()})}function ms(t){return"[object Range]"==Object.prototype.toString.apply(t)}function gs(t){return!!t&&1===t.nodeType&&c(t)&&!f(t)}function bs(t){for(;t&&"html"!=t.tagName.toLowerCase();){if("static"!=wy.window.getComputedStyle(t).position)return t;t=t.parentElement}return null}function _s(t){var e=t.element,n=t.target,r=t.positions,i=t.limiter,o=t.fitInViewport,a=bs(e.parentElement),s=new Op(e),u=new Op(n),l=void 0,c=void 0;if(i||o){var f=i&&new Op(i),h=o&&Op.getViewportRect(),d=ks(r,u,s,f,h)||ws(r[0],u,s),v=Bs(d,2);c=v[0],l=v[1]}else{var y=ws(r[0],u,s),p=Bs(y,2);c=p[0],l=p[1]}var m=xs(l),g=m.left,b=m.top;if(a){var _=xs(new Op(a));g-=_.left,b-=_.top}return{left:g,top:b,name:c}}function ws(t,e,n){var r=t(e,n),i=r.left,o=r.top,a=r.name;return[a,n.clone().moveTo(i,o)]}function ks(t,e,n,r,i){var o=0,a=0,s=void 0,u=void 0,l=n.getArea();return t.some(function(t){function c(){a=p,o=y,s=v,u=d}var f=ws(t,e,n),h=Bs(f,2),d=h[0],v=h[1],y=void 0,p=void 0;if(r)if(i){var m=r.getIntersection(i);y=m?m.getIntersectionArea(v):0}else y=r.getIntersectionArea(v);return i&&(p=i.getIntersectionArea(v)),i&&!r?p>a&&c():!i&&r?y>o&&c():p>a&&y>=o?c():p>=a&&y>o&&c(),y===l}),s?[u,s]:null}function xs(t){var e=t.left,n=t.top,r=wy.window,i=r.scrollX,o=r.scrollY;return{left:e+i,top:n+o}}function Os(t){var e=t.view;e.listenTo(e.element,"submit",function(t,n){n.preventDefault(),e.fire("submit")},{useCapture:!0})}function Ss(t){return t.parent.getAncestors().find(function(t){return t instanceof bp})}function Ps(t){var e=0,n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){o.value;e++}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return e}function As(t,e){function n(){a&&(i.push(a),a=null)}function r(t){return a&&a.type==t}var i=[],o=0,a=void 0;return t.forEach(function(t){"equal"==t?(n(),o++):"insert"==t?(r("insert")?a.values.push(e[o]):(n(),a={type:"insert",index:o,values:[e[o]]}),o++):r("delete")?a.howMany++:(n(),a={type:"delete",index:o,howMany:1})}),n(),i}function Cs(t){return!!t.ctrlKey||Mp.includes(t.keyCode)}function Ts(t,e){return t instanceof vl&&e instanceof vl?t.data===e.data:t===e}function Es(t,e){var n=Rs([t],e);n.sort(function(t,e){return t.start.isBefore(e.start)?-1:1});for(var r=1;r<n.length;r++){var i=n[r-1],o=n[r];i.end.isTouching(o.start)&&(i.end=o.end,n.splice(r,1),r--)}return n}function Rs(t,e){var n=!0,r=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,u=!0,l=!1,c=void 0;try{for(var f,h=s.operations[Symbol.iterator]();!(u=(f=h.next()).done);u=!0)for(var d=f.value,v=0;v<t.length;v++){var y=void 0;switch(d.type){case"insert":y=t[v]._getTransformedByInsertion(d.position,d.nodes.maxOffset,!0);break;case"move":case"remove":case"reinsert":y=t[v]._getTransformedByMove(d.sourcePosition,d.targetPosition,d.howMany,!0)}y&&(t.splice.apply(t,[v,1].concat(Ds(y))),v=v+y.length-1)}}catch(t){l=!0,c=t}finally{try{!u&&h.return&&h.return()}finally{if(l)throw c}}}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return t}var Vs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fs=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},Ns=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),js=function t(e,n,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,n);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},Ms=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},Is=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},Bs=function(){function t(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),Ds=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)};!function(t){function e(t,e,n,i){var o=e&&e.prototype instanceof r?e:r,a=Object.create(o.prototype),s=new f(i||[]);return a._invoke=u(t,n,s),a}function n(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}function r(){}function i(){}function o(){}function a(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function s(t){function e(r,i,o,a){var s=n(t[r],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"===("undefined"==typeof l?"undefined":Vs(l))&&y.call(l,"__await")?Promise.resolve(l.__await).then(function(t){e("next",t,o,a)},function(t){e("throw",t,o,a)}):Promise.resolve(l).then(function(t){u.value=t,o(u)},a)}a(s.arg)}function r(t,n){function r(){return new Promise(function(r,i){e(t,n,r,i)})}return i=i?i.then(r,r):r()}"object"===("undefined"==typeof process?"undefined":Vs(process))&&process.domain&&(e=process.domain.bind(e));var i;this._invoke=r}function u(t,e,r){var i=w;return function(o,a){if(i===x)throw new Error("Generator is already running");if(i===O){if("throw"===o)throw a;return d()}for(;;){var s=r.delegate;if(s){if("return"===o||"throw"===o&&s.iterator[o]===v){r.delegate=null;var u=s.iterator.return;if(u){var l=n(u,s.iterator,a);if("throw"===l.type){o="throw",a=l.arg;continue}}if("return"===o)continue}var l=n(s.iterator[o],s.iterator,a);if("throw"===l.type){r.delegate=null,o="throw",a=l.arg;continue}o="next",a=v;var c=l.arg;if(!c.done)return i=k,c;r[s.resultName]=c.value,r.next=s.nextLoc,r.delegate=null}if("next"===o)r.sent=r._sent=a;else if("throw"===o){if(i===w)throw i=O,a;r.dispatchException(a)&&(o="next",a=v)}else"return"===o&&r.abrupt("return",a);i=x;var l=n(t,e,r);if("normal"===l.type){i=r.done?O:k;var c={value:l.arg,done:r.done};if(l.arg!==S)return c;r.delegate&&"next"===o&&(a=v)}else"throw"===l.type&&(i=O,o="throw",a=l.arg)}}}function l(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function c(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function f(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(l,this),this.reset(!0)}function h(t){if(t){var e=t[m];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function e(){for(;++n<t.length;)if(y.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=v,e.done=!0,e};return r.next=r}}return{next:d}}function d(){return{value:v,done:!0}}var v,y=Object.prototype.hasOwnProperty,p="function"==typeof Symbol?Symbol:{},m=p.iterator||"@@iterator",g=p.toStringTag||"@@toStringTag",b="object"===("undefined"==typeof module?"undefined":Vs(module)),_=t.regeneratorRuntime;if(_)return void(b&&(module.exports=_));_=t.regeneratorRuntime=b?module.exports:{},_.wrap=e;var w="suspendedStart",k="suspendedYield",x="executing",O="completed",S={},P=o.prototype=r.prototype;i.prototype=P.constructor=o,o.constructor=i,o[g]=i.displayName="GeneratorFunction",_.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===i||"GeneratorFunction"===(e.displayName||e.name))},_.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,o):(t.__proto__=o,g in t||(t[g]="GeneratorFunction")),t.prototype=Object.create(P),t},_.awrap=function(t){return{__await:t}},a(s.prototype),_.AsyncIterator=s,_.async=function(t,n,r,i){var o=new s(e(t,n,r,i));return _.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},a(P),P[m]=function(){return this},P[g]="Generator",P.toString=function(){return"[object Generator]"},_.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},_.values=h,f.prototype={constructor:f,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=v,this.done=!1,this.delegate=null,this.tryEntries.forEach(c),!t)for(var e in this)"t"===e.charAt(0)&&y.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=v)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){function e(e,r){return o.type="throw",o.arg=t,n.next=e,!!r}if(this.done)throw t;for(var n=this,r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var a=y.call(i,"catchLoc"),s=y.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&y.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=e,i?this.next=i.finallyLoc:this.complete(o),S},complete:function(t,e){if("throw"===t.type)throw t.arg;"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=t.arg,this.next="end"):"normal"===t.type&&e&&(this.next=e)},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),c(n),S}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;c(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:h(t),resultName:e,nextLoc:n},S}}}("object"===("undefined"==typeof global?"undefined":Vs(global))?global:"object"===("undefined"==typeof window?"undefined":Vs(window))?window:"object"===("undefined"==typeof self?"undefined":Vs(self))?self:void 0);var Ls=function e(n,r){Fs(this,e),this.source=n,this.name=r,this.path=[],this.stop=t(),this.off=t()},zs={get:function(t){return"number"!=typeof t?this[t]||this.normal:t},highest:1e5,high:1e3,normal:0,low:-1e3,lowest:-1e5},qs={on:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};i(this,t);var r=o(this,t),a=zs.get(n.priority);e={callback:e,context:n.context||this,priority:a};var s=!0,u=!1,l=void 0;try{for(var c,f=r[Symbol.iterator]();!(s=(c=f.next()).done);s=!0){for(var h=c.value,d=!1,v=0;v<h.length;v++)if(h[v].priority<a){h.splice(v,0,e),d=!0;break}d||h.push(e)}}catch(t){u=!0,l=t}finally{try{!s&&f.return&&f.return()}finally{if(u)throw l}}},once:function(t,e,n){var r=function(t){t.off(),e.apply(this,arguments)};this.on(t,r,n)},off:function(t,e,n){var r=o(this,t),i=!0,a=!1,s=void 0;try{for(var u,l=r[Symbol.iterator]();!(i=(u=l.next()).done);i=!0)for(var c=u.value,f=0;f<c.length;f++)c[f].callback==e&&(n&&n!=c[f].context||(c.splice(f,1),f--))}catch(t){a=!0,s=t}finally{try{!i&&l.return&&l.return()}finally{if(a)throw s}}},listenTo:function(t,n,r,i){var o=void 0,a=void 0,s=void 0,u=void 0;(o=this._listeningTo)||(o=this._listeningTo={}),(a=t._emitterId)||(a=t._emitterId=e()),(s=o[a])||(s=o[a]={emitter:t,callbacks:{}}),(u=s.callbacks[n])||(u=s.callbacks[n]=[]),u.push(r),t.on(n,r,i)},stopListening:function(t,e,n){var r=this._listeningTo,i=t&&t._emitterId,o=r&&i&&r[i],a=o&&e&&o.callbacks[e];if(!(!r||t&&!o||e&&!a))if(n)t.off(e,n);else if(a){for(;n=a.pop();)t.off(e,n);delete o.callbacks[e]}else if(o){for(e in o.callbacks)this.stopListening(t,e);delete r[i]}else{for(i in r)this.stopListening(r[i].emitter);delete this._listeningTo}},fire:function(t){var e=t instanceof Ls?t:new Ls(this,t),n=e.name,r=a(this,n);e.path.push(this);for(var i=arguments.length,o=Array(i>1?i-1:0),u=1;u<i;u++)o[u-1]=arguments[u];if(r){var l=[e].concat(o);r=Array.from(r);for(var c=0;c<r.length&&(r[c].callback.apply(r[c].context,l),e.off.called&&(delete e.off.called,this.off(n,r[c].callback,r[c].context)),!e.stop.called);c++);}if(this._delegations){var f=this._delegations.get(n),h=this._delegations.get("*");f&&s(f,e,o),h&&s(h,e,o)}},delegate:function(){for(var t=this,e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return{to:function(e,r){t._delegations||(t._delegations=new Map);var i=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value,c=t._delegations.get(l);c?c.set(e,r):t._delegations.set(l,new Map([[e,r]]))}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}}},stopDelegating:function(t,e){if(this._delegations)if(t)if(e){var n=this._delegations.get(t);n&&n.delete(e)}else this._delegations.delete(t);else this._delegations.clear()}},Hs=Object.getPrototypeOf,$s="[object Object]",Ks=Object.prototype,Ws=Function.prototype.toString,Js=Ks.hasOwnProperty,Us=Ws.call(Object),Gs=Ks.toString,Ys=function(){function t(e){Fs(this,t),this._config={},e&&this._setObjectToTarget(this._config,e)}return Ns(t,[{key:"set",value:function(t,e){this._setToTarget(this._config,t,e)}},{key:"define",value:function(t,e){var n=!0;this._setToTarget(this._config,t,e,n)}},{key:"get",value:function(t){return this._getFromSource(this._config,t)}},{key:"_setToTarget",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(f(e))return void this._setObjectToTarget(t,e,r);var i=e.split(".");e=i.pop();var o=!0,a=!1,s=void 0;try{for(var u,l=i[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value;f(t[c])||(t[c]={}),t=t[c]}}catch(t){a=!0,s=t}finally{try{!o&&l.return&&l.return()}finally{if(a)throw s}}return f(n)?(f(t[e])||(t[e]={}),t=t[e],void this._setObjectToTarget(t,n,r)):void(r&&"undefined"!=typeof t[e]||(t[e]=n))}},{key:"_getFromSource",value:function(t,e){var n=e.split(".");e=n.pop();var r=!0,i=!1,o=void 0;try{for(var a,s=n[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;if(!f(t[u])){t=null;break}t=t[u]}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return t?t[e]:void 0}},{key:"_setObjectToTarget",value:function(t,e,n){var r=this;Object.keys(e).forEach(function(i){r._setToTarget(t,i,e[i],n)})}}]),t}(),Qs=function(t){function e(t,n){Fs(this,e),n&&(t+=" "+JSON.stringify(n));var r=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.name="CKEditorError",r.data=n,r}return Ms(e,t),Ns(e,null,[{key:"isCKEditorError",value:function(t){return t instanceof e}}]),e}(Error),Xs=Object.prototype,Zs=Xs.hasOwnProperty,tu=y("length"),eu="[object Function]",nu="[object GeneratorFunction]",ru=Object.prototype,iu=ru.toString,ou=9007199254740991,au=9007199254740991,su=/^(?:0|[1-9]\d*)$/,uu="[object Symbol]",lu=Object.prototype,cu=lu.toString,fu=NaN,hu=/^\s+|\s+$/g,du=/^[-+]0x[0-9a-f]+$/i,vu=/^0b[01]+$/i,yu=/^0o[0-7]+$/i,pu=parseInt,mu=1/0,gu=1.7976931348623157e308,bu="Expected a function",_u=Math.max,wu=Object.prototype,ku={function:!0,object:!0},xu=ku["undefined"==typeof exports?"undefined":Vs(exports)]&&exports&&!exports.nodeType?exports:void 0,Ou=ku["undefined"==typeof module?"undefined":Vs(module)]&&module&&!module.nodeType?module:void 0,Su=E(xu&&Ou&&"object"==("undefined"==typeof global?"undefined":Vs(global))&&global),Pu=E(ku["undefined"==typeof self?"undefined":Vs(self)]&&self),Au=E(ku["undefined"==typeof window?"undefined":Vs(window)]&&window),Cu=E(ku[Vs(void 0)]&&void 0),Tu=Su||Au!==(Cu&&Cu.window)&&Au||Pu||Cu||Function("return this")(),Eu=Tu.Reflect,Ru=Object.prototype,Vu=Eu?Eu.enumerate:void 0,Fu=Ru.propertyIsEnumerable;Vu&&!Fu.call({valueOf:1},"valueOf")&&(V=function(t){return R(Vu(t))});var Nu=V,ju="[object Arguments]",Mu=Object.prototype,Iu=Mu.hasOwnProperty,Bu=Mu.toString,Du=Mu.propertyIsEnumerable,Lu=Array.isArray,zu="[object String]",qu=Object.prototype,Hu=qu.toString,$u=Object.prototype,Ku=$u.hasOwnProperty,Wu=Object.prototype,Ju=Wu.propertyIsEnumerable,Uu=!Ju.call({valueOf:1},"valueOf"),Gu=C(function(t,e){if(Uu||T(e)||b(e))return void v(e,B(e),t);for(var n in e)d(t,n,e[n])}),Yu=Symbol("attributes"),Qu=Symbol("boundObservables"),Xu=Symbol("boundAttributes"),Zu={set:function(t,e){var n=this;if(p(t))return void Object.keys(t).forEach(function(e){n.set(e,t[e])},this);D(this);var r=this[Yu];if(t in this&&!r.has(t))throw new Qs("observable-set-cannot-override: Cannot override an existing property.");Object.defineProperty(this,t,{enumerable:!0,configurable:!0,get:function(){return r.get(t)},set:function(e){var n=r.get(t);n===e&&r.has(t)||(r.set(t,e),this.fire("change:"+t,t,e,n))}}),this[t]=e},bind:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];if(!e.length||!z(e))throw new Qs("observable-bind-wrong-attrs: All attributes must be strings.");if(new Set(e).size!==e.length)throw new Qs("observable-bind-duplicate-attrs: Attributes must be unique.");D(this);var r=this[Xu];e.forEach(function(t){if(r.has(t))throw new Qs("observable-bind-rebind: Cannot bind the same attribute more that once.")});var i=new Map;return e.forEach(function(t){var e={attr:t,to:[]};r.set(t,e),i.set(t,e)}),{to:L,_observable:this,_bindAttrs:e,_to:[],_bindings:i}},unbind:function(){var t=this;if(Yu in this){for(var e=this[Xu],n=this[Qu],r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];if(i.length){if(!z(i))throw new Qs("observable-unbind-wrong-attrs: Attributes must be strings.");i.forEach(function(r){var i=e.get(r),o=void 0,a=void 0,s=void 0,u=void 0;i.to.forEach(function(e){o=e[0],a=e[1],s=n.get(o),u=s[a],u.delete(i),u.size||delete s[a],Object.keys(s).length||(n.delete(o),t.stopListening(o,"change"))}),e.delete(r)})}else n.forEach(function(e,n){t.stopListening(n,"change")}),n.clear(),e.clear()}}};Gu(Zu,qs);var tl=function(){function t(e){Fs(this,t),this.editor=e}return Ns(t,[{key:"init",value:function(){}},{key:"afterInit",value:function(){}},{key:"destroy",value:function(){}}]),t}();J(tl,Zu);var el={error:function(t,e){console.error(t,e)},warn:function(t,e){console.warn(t,e)}},nl=function(){function t(e){Fs(this,t),this._editor=e,this._plugins=new Map}return Ns(t,[{key:Symbol.iterator,value:regeneratorRuntime.mark(function t(){var e,n,r,i,o,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=!0,n=!1,r=void 0,t.prev=3,i=this._plugins[Symbol.iterator]();case 5:if(e=(o=i.next()).done){t.next=13;break}if(a=o.value,"function"!=typeof a[0]){t.next=10;break}return t.next=10,a;case 10:e=!0,t.next=5;break;case 13:t.next=19;break;case 15:t.prev=15,t.t0=t.catch(3),n=!0,r=t.t0;case 19:t.prev=19,t.prev=20,!e&&i.return&&i.return();case 22:if(t.prev=22,!n){t.next=25;break}throw r;case 25:return t.finish(22);case 26:return t.finish(19);case 27:case"end":return t.stop()}},t,this,[[3,15,19,27],[20,,22,26]])})},{key:"get",value:function(t){return this._plugins.get(t)}},{key:"load",value:function(t){function e(t){if(!i.get(t)&&!a.has(t))return n(t).catch(function(e){throw el.error("plugincollection-load: It was not possible to load the plugin.",{plugin:t}),e})}function n(t){return new Promise(function(n){a.add(t),r(t),t.requires&&t.requires.forEach(e);var u=new t(o);i._add(t,u),s.push(u),n()})}function r(t){if(!(t.prototype instanceof tl))throw new Qs("plugincollection-instance: The loaded plugin module is not an instance of Plugin.",{plugin:t})}var i=this,o=this._editor,a=new Set,s=[];return Promise.all(t.map(e)).then(function(){return s})}},{key:"_add",value:function(t,e){this._plugins.set(t,e),t.pluginName&&this._plugins.set(t.pluginName,e)}}]),t}(),rl=function(){function t(e){var n=this;Fs(this,t),this.lang=e||"en",this.t=function(){return n._t.apply(n,arguments)}}return Ns(t,[{key:"_t",value:function(t,e){return e&&(t=t.replace(/\%(\d+)/g,function(t,n){return n<e.length?e[n]:t})),t}}]),t}(),il=function(){function t(e){Fs(this,t),this.parent=null,this._attrs=G(e)}return Ns(t,[{key:"clone",value:function(){return new t(this._attrs)}},{key:"getPath",value:function(){for(var t=[],e=this;e.parent;)t.unshift(e.startOffset),e=e.parent;return t}},{key:"getAncestors",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{includeNode:!1,parentFirst:!1},e=[],n=t.includeNode?this:this.parent;n;)e[t.parentFirst?"push":"unshift"](n),n=n.parent;return e}},{key:"remove",value:function(){this.parent.removeChildren(this.index)}},{key:"hasAttribute",value:function(t){return this._attrs.has(t)}},{key:"getAttribute",value:function(t){return this._attrs.get(t)}},{key:"getAttributes",value:function(){return this._attrs.entries()}},{key:"getAttributeKeys",value:function(){return this._attrs.keys()}},{key:"setAttribute",value:function(t,e){this._attrs.set(t,e)}},{key:"setAttributesTo",value:function(t){this._attrs=G(t)}},{key:"removeAttribute",value:function(t){return this._attrs.delete(t)}},{key:"clearAttributes",value:function(){this._attrs.clear()}},{key:"toJSON",value:function(){var t={};
return this._attrs.size&&(t.attributes=[].concat(Ds(this._attrs))),t}},{key:"index",get:function(){var t=void 0;if(!this.parent)return null;if(null===(t=this.parent.getChildIndex(this)))throw new Qs("model-node-not-found-in-parent: The node's parent does not contain this node.");return t}},{key:"startOffset",get:function(){var t=void 0;if(!this.parent)return null;if(null===(t=this.parent.getChildStartOffset(this)))throw new Qs("model-node-not-found-in-parent: The node's parent does not contain this node.");return t}},{key:"offsetSize",get:function(){return 1}},{key:"endOffset",get:function(){return this.parent?this.startOffset+this.offsetSize:null}},{key:"nextSibling",get:function(){var t=this.index;return null!==t&&this.parent.getChild(t+1)||null}},{key:"previousSibling",get:function(){var t=this.index;return null!==t&&this.parent.getChild(t-1)||null}},{key:"root",get:function(){for(var t=this;t.parent;)t=t.parent;return t}},{key:"document",get:function(){return this.root==this?null:this.root.document||null}}]),t}(),ol=function(){function t(e){Fs(this,t),this._nodes=[],e&&this.insertNodes(0,e)}return Ns(t,[{key:Symbol.iterator,value:function(){return this._nodes[Symbol.iterator]()}},{key:"getNode",value:function(t){return this._nodes[t]||null}},{key:"getNodeIndex",value:function(t){var e=this._nodes.indexOf(t);return e==-1?null:e}},{key:"getNodeStartOffset",value:function(t){var e=this.getNodeIndex(t);return null===e?null:this._nodes.slice(0,e).reduce(function(t,e){return t+e.offsetSize},0)}},{key:"indexToOffset",value:function(t){if(t==this._nodes.length)return this.maxOffset;var e=this._nodes[t];if(!e)throw new Qs("model-nodelist-index-out-of-bounds: Given index cannot be found in the node list.");return this.getNodeStartOffset(e)}},{key:"offsetToIndex",value:function(t){var e=0,n=!0,r=!1,i=void 0;try{for(var o,a=this._nodes[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if(t>=e&&t<e+s.offsetSize)return this.getNodeIndex(s);e+=s.offsetSize}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}if(e!=t)throw new Qs("model-nodelist-offset-out-of-bounds: Given offset cannot be found in the node list.");return this.length}},{key:"insertNodes",value:function(t,e){var n,r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;if(!(u instanceof il))throw new Qs("model-nodelist-insertNodes-not-node: Trying to insert an object which is not a Node instance.")}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}(n=this._nodes).splice.apply(n,[t,0].concat(Ds(e)))}},{key:"removeNodes",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this._nodes.splice(t,e)}},{key:"toJSON",value:function(){return this._nodes.map(function(t){return t.toJSON()})}},{key:"length",get:function(){return this._nodes.length}},{key:"maxOffset",get:function(){return this._nodes.reduce(function(t,e){return t+e.offsetSize},0)}}]),t}(),al=function(t){function e(t,n){Fs(this,e);var r=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n));return r.data=t||"",r}return Ms(e,t),Ns(e,[{key:"clone",value:function(){return new e(this.data,this.getAttributes())}},{key:"toJSON",value:function(){var t=js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"toJSON",this).call(this);return t.data=this.data,t}},{key:"offsetSize",get:function(){return this.data.length}}],[{key:"fromJSON",value:function(t){return new e(t.data,t.attributes)}}]),e}(il),sl=function(t){function e(t,n,r){Fs(this,e);var i=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n));return i.name=t,i._children=new ol,r&&i.insertChildren(0,r),i}return Ms(e,t),Ns(e,[{key:"getChild",value:function(t){return this._children.getNode(t)}},{key:"getChildren",value:function(){return this._children[Symbol.iterator]()}},{key:"getChildIndex",value:function(t){return this._children.getNodeIndex(t)}},{key:"getChildStartOffset",value:function(t){return this._children.getNodeStartOffset(t)}},{key:"clone",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=t?Array.from(this._children).map(function(t){return t.clone()}):Array.from(this._children);return new e(this.name,this.getAttributes(),n)}},{key:"offsetToIndex",value:function(t){return this._children.offsetToIndex(t)}},{key:"appendChildren",value:function(t){this.insertChildren(this.childCount,t)}},{key:"insertChildren",value:function(t,e){e=Q(e);var n=!0,r=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;s.parent=this}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}this._children.insertNodes(t,e)}},{key:"removeChildren",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=this._children.removeNodes(t,e),r=!0,i=!1,o=void 0;try{for(var a,s=n[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;u.parent=null}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}},{key:"getNodeByPath",value:function(t){var e=this,n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;e=e.getChild(s)}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return e}},{key:"toJSON",value:function(){var t=js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"toJSON",this).call(this);if(t.name=this.name,this._children.length>0){t.children=[];var n=!0,r=!1,i=void 0;try{for(var o,a=this._children[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;t.children.push(s.toJSON())}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}}return t}},{key:"childCount",get:function(){return this._children.length}},{key:"maxOffset",get:function(){return this._children.maxOffset}},{key:"isEmpty",get:function(){return 0===this.childCount}}],[{key:"fromJSON",value:function(t){var n=null;if(t.children){n=[];var r=!0,i=!1,o=void 0;try{for(var a,s=t.children[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;u.name?n.push(e.fromJSON(u)):n.push(al.fromJSON(u))}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}}return new e(t.name,t.attributes,n)}}]),e}(il),ul=function(){function t(e){Fs(this,t),this._children=new ol,e&&this.insertChildren(0,e)}return Ns(t,[{key:Symbol.iterator,value:function(){return this.getChildren()}},{key:"getChild",value:function(t){return this._children.getNode(t)}},{key:"getChildren",value:function(){return this._children[Symbol.iterator]()}},{key:"getChildIndex",value:function(t){return this._children.getNodeIndex(t)}},{key:"getChildStartOffset",value:function(t){return this._children.getNodeStartOffset(t)}},{key:"getPath",value:function(){return[]}},{key:"offsetToIndex",value:function(t){return this._children.offsetToIndex(t)}},{key:"appendChildren",value:function(t){this.insertChildren(this.childCount,t)}},{key:"insertChildren",value:function(t,e){e=X(e);var n=!0,r=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;s.parent=this}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}this._children.insertNodes(t,e)}},{key:"removeChildren",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=this._children.removeNodes(t,e),r=!0,i=!1,o=void 0;try{for(var a,s=n[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;u.parent=null}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}},{key:"toJSON",value:function(){var t=[],e=!0,n=!1,r=void 0;try{for(var i,o=this._children[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t.push(a.toJSON())}}catch(t){n=!0,r=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw r}}return t}},{key:"childCount",get:function(){return this._children.length}},{key:"maxOffset",get:function(){return this._children.maxOffset}},{key:"isEmpty",get:function(){return 0===this.childCount}},{key:"root",get:function(){return this}},{key:"parent",get:function(){return null}}],[{key:"fromJSON",value:function(e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;u.name?n.push(sl.fromJSON(u)):n.push(al.fromJSON(u))}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return new t(n)}}]),t}(),ll=function(){function t(e,n){if(Fs(this,t),!(e instanceof sl||e instanceof ul))throw new Qs("model-position-root-invalid: Position root invalid.");if(!(n instanceof Array)||0===n.length)throw new Qs("model-position-path-incorrect: Position path must be an Array with at least one item.",{path:n});n=e.getPath().concat(n),e=e.root,this.root=e,this.path=n}return Ns(t,[{key:"compareWith",value:function(t){if(this.root!=t.root)return"different";var e=tt(this.path,t.path);switch(e){case"same":return"same";case"prefix":return"before";case"extension":return"after";default:return this.path[e]<t.path[e]?"before":"after"}}},{key:"getParentPath",value:function(){return this.path.slice(0,-1)}},{key:"getAncestors",value:function(){return this.parent.getAncestors({includeNode:!0,parentFirst:!0})}},{key:"getCommonPath",value:function(t){if(this.root!=t.root)return[];var e=tt(this.path,t.path),n="string"==typeof e?Math.min(this.path.length,t.path.length):e;return this.path.slice(0,n)}},{key:"getShiftedBy",value:function(e){var n=t.createFromPosition(this),r=n.offset+e;return n.offset=r<0?0:r,n}},{key:"isAfter",value:function(t){return"after"==this.compareWith(t)}},{key:"isBefore",value:function(t){return"before"==this.compareWith(t)}},{key:"isEqual",value:function(t){return"same"==this.compareWith(t)}},{key:"isTouching",value:function(e){var n=null,r=null,i=this.compareWith(e);switch(i){case"same":return!0;case"before":n=t.createFromPosition(this),r=t.createFromPosition(e);break;case"after":n=t.createFromPosition(e),r=t.createFromPosition(this);break;default:return!1}for(var o=n.parent;n.path.length+r.path.length;){if(n.isEqual(r))return!0;if(n.path.length>r.path.length){if(n.offset!==o.maxOffset)return!1;n.path=n.path.slice(0,-1),o=o.parent,n.offset++}else{if(0!==r.offset)return!1;r.path=r.path.slice(0,-1)}}}},{key:"_getTransformedByDeletion",value:function(e,n){var r=t.createFromPosition(this);if(this.root!=e.root)return r;if("same"==tt(e.getParentPath(),this.getParentPath())){if(e.offset<this.offset){if(e.offset+n>this.offset)return null;r.offset-=n}}else if("prefix"==tt(e.getParentPath(),this.getParentPath())){var i=e.path.length-1;if(e.offset<=this.path[i]){if(e.offset+n>this.path[i])return null;r.path[i]-=n}}return r}},{key:"_getTransformedByInsertion",value:function(e,n,r){var i=t.createFromPosition(this);if(this.root!=e.root)return i;if("same"==tt(e.getParentPath(),this.getParentPath()))(e.offset<this.offset||e.offset==this.offset&&r)&&(i.offset+=n);else if("prefix"==tt(e.getParentPath(),this.getParentPath())){var o=e.path.length-1;e.offset<=this.path[o]&&(i.path[o]+=n)}return i}},{key:"_getTransformedByMove",value:function(t,e,n,r,i){var o=this._getTransformedByDeletion(t,n);return e=e._getTransformedByDeletion(t,n),o=null===o||i&&o.isEqual(t)?this._getCombined(t,e):o._getTransformedByInsertion(e,n,r)}},{key:"_getCombined",value:function(e,n){var r=e.path.length-1,i=t.createFromPosition(n);return i.offset=i.offset+this.path[r]-e.offset,i.path=i.path.concat(this.path.slice(r+1)),i}},{key:"offset",get:function(){return Z(this.path)},set:function(t){this.path[this.path.length-1]=t}},{key:"parent",get:function(){for(var t=this.root,e=0;e<this.path.length-1;e++)t=t.getChild(t.offsetToIndex(this.path[e]));return t}},{key:"index",get:function(){return this.parent.offsetToIndex(this.offset)}},{key:"textNode",get:function(){var t=this.parent.getChild(this.index);return t instanceof al&&t.startOffset<this.offset?t:null}},{key:"nodeAfter",get:function(){return null===this.textNode?this.parent.getChild(this.index):null}},{key:"nodeBefore",get:function(){return null===this.textNode?this.parent.getChild(this.index-1):null}},{key:"isAtStart",get:function(){return 0===this.offset}},{key:"isAtEnd",get:function(){return this.offset==this.parent.maxOffset}}],[{key:"createAt",value:function(e,n){if(e instanceof t)return this.createFromPosition(e);var r=e;if("end"==n)n=r.maxOffset;else{if("before"==n)return this.createBefore(r);if("after"==n)return this.createAfter(r);n||(n=0)}return this.createFromParentAndOffset(r,n)}},{key:"createAfter",value:function(t){if(!t.parent)throw new Qs("model-position-after-root: You can not make position after root.",{root:t});return this.createFromParentAndOffset(t.parent,t.endOffset)}},{key:"createBefore",value:function(t){if(!t.parent)throw new Qs("model-position-before-root: You can not make position before root.",{root:t});return this.createFromParentAndOffset(t.parent,t.startOffset)}},{key:"createFromParentAndOffset",value:function(t,e){if(!(t instanceof sl||t instanceof ul))throw new Qs("model-position-parent-incorrect: Position parent have to be a element or document fragment.");var n=t.getPath();return n.push(e),new this(t.root,n)}},{key:"createFromPosition",value:function(t){return new this(t.root,t.path.slice())}},{key:"fromJSON",value:function(e,n){if("$graveyard"===e.root)return new t(n.graveyard,e.path);if(!n.hasRoot(e.root))throw new Qs("model-position-fromjson-no-root: Cannot create position for document. Root with specified name does not exist.",{rootName:e.root});return new t(n.getRoot(e.root),e.path)}}]),t}(),cl=function(){function t(e,n,r){if(Fs(this,t),this.textNode=e,n<0||n>e.offsetSize)throw new Qs("model-textproxy-wrong-offsetintext: Given offsetInText value is incorrect.");if(r<0||n+r>e.offsetSize)throw new Qs("model-textproxy-wrong-length: Given length value is incorrect.");this.data=e.data.substring(n,n+r),this.offsetInText=n}return Ns(t,[{key:"getPath",value:function(){var t=this.textNode.getPath();return t.length>0&&(t[t.length-1]+=this.offsetInText),t}},{key:"getAncestors",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{includeNode:!1,parentFirst:!1},e=[],n=t.includeNode?this:this.parent;n;)e[t.parentFirst?"push":"unshift"](n),n=n.parent;return e}},{key:"hasAttribute",value:function(t){return this.textNode.hasAttribute(t)}},{key:"getAttribute",value:function(t){return this.textNode.getAttribute(t)}},{key:"getAttributes",value:function(){return this.textNode.getAttributes()}},{key:"getAttributeKeys",value:function(){return this.textNode.getAttributeKeys()}},{key:"startOffset",get:function(){return null!==this.textNode.startOffset?this.textNode.startOffset+this.offsetInText:null}},{key:"offsetSize",get:function(){return this.data.length}},{key:"endOffset",get:function(){return null!==this.startOffset?this.startOffset+this.offsetSize:null}},{key:"isPartial",get:function(){return this.offsetSize!==this.textNode.offsetSize}},{key:"parent",get:function(){return this.textNode.parent}},{key:"root",get:function(){return this.textNode.root}},{key:"document",get:function(){return this.textNode.document}}]),t}(),fl=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Fs(this,t),!e.boundaries&&!e.startPosition)throw new Qs("model-tree-walker-no-start-position: Neither boundaries nor starting position have been defined.");var n=e.direction||"forward";if("forward"!=n&&"backward"!=n)throw new Qs("model-tree-walker-unknown-direction: Only `backward` and `forward` direction allowed.",{direction:n});this.direction=n,this.boundaries=e.boundaries||null,e.startPosition?this.position=ll.createFromPosition(e.startPosition):this.position=ll.createFromPosition(this.boundaries["backward"==this.direction?"end":"start"]),this.singleCharacters=!!e.singleCharacters,this.shallow=!!e.shallow,this.ignoreElementEnd=!!e.ignoreElementEnd,this._boundaryStartParent=this.boundaries?this.boundaries.start.parent:null,this._boundaryEndParent=this.boundaries?this.boundaries.end.parent:null,this._visitedParent=this.position.parent}return Ns(t,[{key:Symbol.iterator,value:function(){return this}},{key:"next",value:function(){return"forward"==this.direction?this._next():this._previous()}},{key:"_next",value:function(){var t=this.position,e=ll.createFromPosition(this.position),n=this._visitedParent;if(null===n.parent&&e.offset===n.maxOffset)return{done:!0};if(n===this._boundaryEndParent&&e.offset==this.boundaries.end.offset)return{done:!0};var r=e.textNode?e.textNode:e.nodeAfter;if(r instanceof sl)return this.shallow?e.offset++:(e.path.push(0),this._visitedParent=r),this.position=e,et("elementStart",r,t,e,1);if(r instanceof al){var i=void 0,o=void 0;if(this.singleCharacters)i=1;else{var a=r.endOffset;this._boundaryEndParent==n&&this.boundaries.end.offset<a&&(a=this.boundaries.end.offset),i=a-e.offset}o=e.offset-r.startOffset;var s=new cl(r,o,i);return e.offset+=i,this.position=e,et("text",s,t,e,i)}return e.path.pop(),e.offset++,this.position=e,this._visitedParent=n.parent,this.ignoreElementEnd?this._next():et("elementEnd",n,t,e)}},{key:"_previous",value:function(){var t=this.position,e=ll.createFromPosition(this.position),n=this._visitedParent;if(null===n.parent&&0===e.offset)return{done:!0};if(n==this._boundaryStartParent&&e.offset==this.boundaries.start.offset)return{done:!0};var r=e.textNode?e.textNode:e.nodeBefore;if(r instanceof sl)return e.offset--,this.shallow?(this.position=e,et("elementStart",r,t,e,1)):(e.path.push(r.maxOffset),this.position=e,this._visitedParent=r,this.ignoreElementEnd?this._previous():et("elementEnd",r,t,e));if(r instanceof al){var i=void 0,o=void 0;if(this.singleCharacters)i=1;else{var a=r.startOffset;this._boundaryStartParent==n&&this.boundaries.start.offset>a&&(a=this.boundaries.start.offset),i=e.offset-a}o=e.offset-r.startOffset;var s=new cl(r,o-i,i);return e.offset-=i,this.position=e,et("text",s,t,e,i)}return e.path.pop(),this.position=e,this._visitedParent=n.parent,et("elementStart",n,t,e,1)}}]),t}(),hl=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;Fs(this,t),this.start=ll.createFromPosition(e),this.end=n?ll.createFromPosition(n):ll.createFromPosition(e)}return Ns(t,[{key:Symbol.iterator,value:regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(new fl({boundaries:this,ignoreElementEnd:!0}),"t0",1);case 1:case"end":return t.stop()}},t,this)})},{key:"containsPosition",value:function(t){return t.isAfter(this.start)&&t.isBefore(this.end)}},{key:"containsRange",value:function(t){return this.containsPosition(t.start)&&this.containsPosition(t.end)}},{key:"isEqual",value:function(t){return this.start.isEqual(t.start)&&this.end.isEqual(t.end)}},{key:"isIntersecting",value:function(t){return this.start.isBefore(t.end)&&this.end.isAfter(t.start)}},{key:"getDifference",value:function(e){var n=[];return this.isIntersecting(e)?(this.containsPosition(e.start)&&n.push(new t(this.start,e.start)),this.containsPosition(e.end)&&n.push(new t(e.end,this.end))):n.push(t.createFromRange(this)),n}},{key:"getIntersection",value:function(e){if(this.isIntersecting(e)){var n=this.start,r=this.end;return this.containsPosition(e.start)&&(n=e.start),this.containsPosition(e.end)&&(r=e.end),new t(n,r)}return null}},{key:"getMinimalFlatRanges",value:function(){for(var e=[],n=this.start.getCommonPath(this.end).length,r=ll.createFromPosition(this.start),i=r.parent;r.path.length>n+1;){var o=i.maxOffset-r.offset;0!==o&&e.push(new t(r,r.getShiftedBy(o))),r.path=r.path.slice(0,-1),r.offset++,i=i.parent}for(;r.path.length<=this.end.path.length;){var a=this.end.path[r.path.length-1],s=a-r.offset;0!==s&&e.push(new t(r,r.getShiftedBy(s))),r.offset=a,r.path.push(0)}return e}},{key:"getWalker",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.boundaries=this,new fl(t)}},{key:"getItems",value:regeneratorRuntime.mark(function t(){var e,n,r,i,o,a,s,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:u.boundaries=this,u.ignoreElementEnd=!0,e=new fl(u),n=!0,r=!1,i=void 0,t.prev=6,o=e[Symbol.iterator]();case 8:if(n=(a=o.next()).done){t.next=15;break}return s=a.value,t.next=12,s.item;case 12:n=!0,t.next=8;break;case 15:t.next=21;break;case 17:t.prev=17,t.t0=t.catch(6),r=!0,i=t.t0;case 21:t.prev=21,t.prev=22,!n&&o.return&&o.return();case 24:if(t.prev=24,!r){t.next=27;break}throw i;case 27:return t.finish(24);case 28:return t.finish(21);case 29:case"end":return t.stop()}},t,this,[[6,17,21,29],[22,,24,28]])})},{key:"getPositions",value:regeneratorRuntime.mark(function t(){var e,n,r,i,o,a,s,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return u.boundaries=this,e=new fl(u),t.next=4,e.position;case 4:n=!0,r=!1,i=void 0,t.prev=7,o=e[Symbol.iterator]();case 9:if(n=(a=o.next()).done){t.next=16;break}return s=a.value,t.next=13,s.nextPosition;case 13:n=!0,t.next=9;break;case 16:t.next=22;break;case 18:t.prev=18,t.t0=t.catch(7),r=!0,i=t.t0;case 22:t.prev=22,t.prev=23,!n&&o.return&&o.return();case 25:if(t.prev=25,!r){t.next=28;break}throw i;case 28:return t.finish(25);case 29:return t.finish(22);case 30:case"end":return t.stop()}},t,this,[[7,18,22,30],[23,,25,29]])})},{key:"getTransformedByDelta",value:function(e){var n=[t.createFromRange(this)],r=new Set(["insert","move","remove","reinsert"]),i=!0,o=!1,a=void 0;try{for(var s,u=e.operations[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;if(r.has(l.type))for(var c=0;c<n.length;c++){var f=n[c]._getTransformedByDocumentChange(l.type,l.targetPosition||l.position,l.howMany||l.nodes.maxOffset,l.sourcePosition);n.splice.apply(n,[c,1].concat(Ds(f))),c+=f.length-1}}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}return n}},{key:"_getTransformedByDocumentChange",value:function(t,e,n,r){return"insert"==t?this._getTransformedByInsertion(e,n,!1,!1):this._getTransformedByMove(r,e,n)}},{key:"_getTransformedByInsertion",value:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(r&&this.containsPosition(e))return[new t(this.start,e),new t(e._getTransformedByInsertion(e,n,!0),this.end._getTransformedByInsertion(e,n,this.isCollapsed))];var o=t.createFromRange(this),a=!!o.isCollapsed||!i,s=!!o.isCollapsed||i;return o.start=o.start._getTransformedByInsertion(e,n,a),o.end=o.end._getTransformedByInsertion(e,n,s),[o]}},{key:"_getTransformedByMove",value:function(e,n,r){if(this.isCollapsed){var i=this.start._getTransformedByMove(e,n,r,!0,!0);return[new t(i)]}var o=void 0,a=new t(e,e.getShiftedBy(r)),s=this.getDifference(a),u=null,l=this.getIntersection(a);1==s.length?u=new t(s[0].start._getTransformedByDeletion(e,r),s[0].end._getTransformedByDeletion(e,r)):2==s.length&&(u=new t(this.start,this.end._getTransformedByDeletion(e,r)));var c=n._getTransformedByDeletion(e,r);return o=u?u._getTransformedByInsertion(c,r,null!==l):[],l&&o.push(new t(l.start._getCombined(a.start,c),l.end._getCombined(a.start,c))),o}},{key:"isCollapsed",get:function(){return this.start.isEqual(this.end)}},{key:"isFlat",get:function(){return this.start.parent===this.end.parent}},{key:"isEmpty",get:function(){return this.start.isTouching(this.end)}},{key:"root",get:function(){return this.start.root}}],[{key:"createFromPositionAndShift",value:function(t,e){var n=t,r=t.getShiftedBy(e);return e>0?new this(n,r):new this(r,n)}},{key:"createFromParentsAndOffsets",value:function(t,e,n,r){return new this(ll.createFromParentAndOffset(t,e),ll.createFromParentAndOffset(n,r))}},{key:"createFromRange",value:function(t){return new this(t.start,t.end)}},{key:"createIn",value:function(t){return this.createFromParentsAndOffsets(t,0,t,t.maxOffset)}},{key:"createOn",value:function(t){return this.createFromPositionAndShift(ll.createBefore(t),t.offsetSize)}},{key:"createFromRanges",value:function(e){if(0===e.length)throw new Qs("range-create-from-ranges-empty-array: At least one range has to be passed.");if(1==e.length)return t.createFromRange(e[0]);var n=e[0];e.sort(function(t,e){return t.start.isAfter(e.start)});for(var r=e.indexOf(n),i=new this(n.start,n.end),o=r-1;o>=0&&e[o].end.isTouching(i.start);o++)i.start=ll.createFromPosition(e[o].start);for(var a=r+1;a<e.length&&e[a].start.isTouching(i.end);a++)i.end=ll.createFromPosition(e[a].end);return i}},{key:"fromJSON",value:function(t,e){return new this(ll.fromJSON(t.start,e),ll.fromJSON(t.end,e))}}]),t}(),dl=function(){function t(){Fs(this,t),this.parent=null}return Ns(t,[{key:"getAncestors",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{includeNode:!1,parentFirst:!1},e=[],n=t.includeNode?this:this.parent;n;)e[t.parentFirst?"push":"unshift"](n),n=n.parent;return e}},{key:"remove",value:function(){this.parent.removeChildren(this.index)}},{key:"_fireChange",value:function(t,e){this.fire("change:"+t,e),this.parent&&this.parent._fireChange(t,e)}},{key:"index",get:function(){var t=void 0;if(!this.parent)return null;if((t=this.parent.getChildIndex(this))==-1)throw new Qs("view-node-not-found-in-parent: The node's parent does not contain this node.");return t}},{key:"nextSibling",get:function(){var t=this.index;return null!==t&&this.parent.getChild(t+1)||null}},{key:"previousSibling",get:function(){var t=this.index;return null!==t&&this.parent.getChild(t-1)||null}},{key:"root",get:function(){for(var t=this;t.parent;)t=t.parent;return t}},{key:"document",get:function(){return this.parent instanceof t?this.parent.document:null}}]),t}();J(dl,qs);var vl=function(t){function e(t){Fs(this,e);var n=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n._data=t,n}return Ms(e,t),Ns(e,[{key:"clone",value:function(){return new e(this.data)}},{key:"isSimilar",value:function(t){return t instanceof e&&(this===t||this.data===t.data)}},{key:"data",get:function(){return this._data},set:function(t){this._fireChange("text",this),this._data=t}}]),e}(dl),yl=function(){function t(e,n,r){if(Fs(this,t),this.textNode=e,n<0||n>e.data.length)throw new Qs("view-textproxy-wrong-offsetintext: Given offsetInText value is incorrect.");if(r<0||n+r>e.data.length)throw new Qs("view-textproxy-wrong-length: Given length value is incorrect.");this.data=e.data.substring(n,n+r),this.offsetInText=n}return Ns(t,[{key:"getAncestors",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{includeNode:!1,parentFirst:!1},e=[],n=t.includeNode?this.textNode:this.parent;null!==n;)e[t.parentFirst?"push":"unshift"](n),n=n.parent;return e}},{key:"isPartial",get:function(){return this.data.length!==this.textNode.data.length}},{key:"parent",get:function(){return this.textNode.parent}},{key:"root",get:function(){return this.textNode.root}},{key:"document",get:function(){return this.textNode.document}}]),t}(),pl=function(){function t(){Fs(this,t),this._patterns=[],this.add.apply(this,arguments)}return Ns(t,[{key:"add",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;("string"==typeof u||u instanceof RegExp)&&(u={name:u}),u.class&&("string"==typeof u.class||u.class instanceof RegExp)&&(u.class=[u.class]),this._patterns.push(u)}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}}},{key:"match",value:function t(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value,c=!0,f=!1,h=void 0;try{for(var d,v=this._patterns[Symbol.iterator]();!(c=(d=v.next()).done);c=!0){var y=d.value,t=nt(l,y);if(t)return{element:l,pattern:y,match:t}}}catch(t){f=!0,h=t}finally{try{!c&&v.return&&v.return()}finally{if(f)throw h}}}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}return null}},{key:"matchAll",value:function(){for(var t=[],e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value,c=!0,f=!1,h=void 0;try{for(var d,v=this._patterns[Symbol.iterator]();!(c=(d=v.next()).done);c=!0){var y=d.value,p=nt(l,y);p&&t.push({element:l,pattern:y,match:p})}}catch(t){f=!0,h=t}finally{try{!c&&v.return&&v.return()}finally{if(f)throw h}}}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}return t.length>0?t:null}},{key:"getElementName",value:function(){return 1!=this._patterns.length||!this._patterns[0].name||this._patterns[0].name instanceof RegExp?null:this._patterns[0].name}}]),t}(),ml=function(t){function e(t,n,r){Fs(this,e);var i=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(i.name=t,f(n)?i._attrs=U(n):i._attrs=new Map(n),i._children=[],r&&i.insertChildren(0,r),i._classes=new Set,i._attrs.has("class")){var o=i._attrs.get("class");ut(i._classes,o),i._attrs.delete("class")}return i._styles=new Map,i._attrs.has("style")&&(st(i._styles,i._attrs.get("style")),i._attrs.delete("style")),i._customProperties=new Map,i}return Ms(e,t),Ns(e,[{key:"clone",value:function(t){var e=[];if(t){var n=!0,r=!1,i=void 0;try{for(var o,a=this.getChildren()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;e.push(s.clone(t))}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}}var u=new this.constructor(this.name,this._attrs,e);return u._classes=new Set(this._classes),u._styles=new Map(this._styles),u._customProperties=new Map(this._customProperties),u.getFillerOffset=this.getFillerOffset,u}},{key:"appendChildren",value:function(t){return this.insertChildren(this.childCount,t)}},{key:"getChild",value:function(t){return this._children[t]}},{key:"getChildIndex",value:function(t){return this._children.indexOf(t)}},{key:"getChildren",value:function(){return this._children[Symbol.iterator]()}},{key:"getAttributeKeys",value:regeneratorRuntime.mark(function t(){var e,n,r,i,o,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this._classes.size>0)){t.next=3;break}return t.next=3,"class";case 3:if(!(this._styles.size>0)){t.next=6;break}return t.next=6,"style";case 6:e=!0,n=!1,r=void 0,t.prev=9,i=this._attrs.keys()[Symbol.iterator]();case 11:if(e=(o=i.next()).done){t.next=18;break}return a=o.value,t.next=15,a;case 15:e=!0,t.next=11;break;case 18:t.next=24;break;case 20:t.prev=20,t.t0=t.catch(9),n=!0,r=t.t0;case 24:t.prev=24,t.prev=25,!e&&i.return&&i.return();case 27:if(t.prev=27,!n){t.next=30;break}throw r;case 30:return t.finish(27);case 31:return t.finish(24);case 32:case"end":return t.stop()}},t,this,[[9,20,24,32],[25,,27,31]])})},{key:"getAttributes",value:regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(this._attrs.entries(),"t0",1);case 1:if(!(this._classes.size>0)){t.next=4;break}return t.next=4,["class",this.getAttribute("class")];case 4:if(!(this._styles.size>0)){t.next=7;break}return t.next=7,["style",this.getAttribute("style")];case 7:case"end":return t.stop()}},t,this)})},{key:"getAttribute",value:function(t){if("class"!=t){if("style"!=t)return this._attrs.get(t);if(this._styles.size>0){var e="",n=!0,r=!1,i=void 0;try{for(var o,a=this._styles[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=Bs(o.value,2),u=s[0],l=s[1];e+=u+":"+l+";"}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return e}}else if(this._classes.size>0)return[].concat(Ds(this._classes)).join(" ")}},{key:"hasAttribute",value:function(t){return"class"==t?this._classes.size>0:"style"==t?this._styles.size>0:this._attrs.has(t)}},{key:"setAttribute",value:function(t,e){this._fireChange("attributes",this),"class"==t?ut(this._classes,e):"style"==t?st(this._styles,e):this._attrs.set(t,e);
}},{key:"insertChildren",value:function(t,e){this._fireChange("children",this);var n=0;e=lt(e);var r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;u.parent=this,this._children.splice(t,0,u),t++,n++}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}},{key:"removeAttribute",value:function(t){return this._fireChange("attributes",this),"class"==t?this._classes.size>0&&(this._classes.clear(),!0):"style"==t?this._styles.size>0&&(this._styles.clear(),!0):this._attrs.delete(t)}},{key:"removeChildren",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this._fireChange("children",this);for(var n=t;n<t+e;n++)this._children[n].parent=null;return this._children.splice(t,e)}},{key:"isSimilar",value:function(t){if(!(t instanceof e))return!1;if(this===t)return!0;if(this.name!=t.name)return!1;if(this._attrs.size!==t._attrs.size||this._classes.size!==t._classes.size||this._styles.size!==t._styles.size)return!1;var n=!0,r=!1,i=void 0;try{for(var o,a=this._attrs[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=Bs(o.value,2),u=s[0],l=s[1];if(!t._attrs.has(u)||t._attrs.get(u)!==l)return!1}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}var c=!0,f=!1,h=void 0;try{for(var d,v=this._classes[Symbol.iterator]();!(c=(d=v.next()).done);c=!0){var y=d.value;if(!t._classes.has(y))return!1}}catch(t){f=!0,h=t}finally{try{!c&&v.return&&v.return()}finally{if(f)throw h}}var p=!0,m=!1,g=void 0;try{for(var b,_=this._styles[Symbol.iterator]();!(p=(b=_.next()).done);p=!0){var w=Bs(b.value,2),k=w[0],l=w[1];if(!t._styles.has(k)||t._styles.get(k)!==l)return!1}}catch(t){m=!0,g=t}finally{try{!p&&_.return&&_.return()}finally{if(m)throw g}}return!0}},{key:"addClass",value:function(){var t=this;this._fireChange("attributes",this);for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];n.forEach(function(e){return t._classes.add(e)})}},{key:"removeClass",value:function(){var t=this;this._fireChange("attributes",this);for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];n.forEach(function(e){return t._classes.delete(e)})}},{key:"hasClass",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;if(!this._classes.has(u))return!1}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return!0}},{key:"getClassNames",value:function(){return this._classes.keys()}},{key:"setStyle",value:function(t,e){if(this._fireChange("attributes",this),f(t)){var n=Object.keys(t),r=!0,i=!1,o=void 0;try{for(var a,s=n[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;this._styles.set(u,t[u])}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}}else this._styles.set(t,e)}},{key:"getStyle",value:function(t){return this._styles.get(t)}},{key:"getStyleNames",value:function(){return this._styles.keys()}},{key:"hasStyle",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;if(!this._styles.has(u))return!1}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return!0}},{key:"removeStyle",value:function(){var t=this;this._fireChange("attributes",this);for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];n.forEach(function(e){return t._styles.delete(e)})}},{key:"findAncestor",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=new(Function.prototype.bind.apply(pl,[null].concat(e))),i=this.parent;i;){if(r.match(i))return i;i=i.parent}return null}},{key:"setCustomProperty",value:function(t,e){this._customProperties.set(t,e)}},{key:"getCustomProperty",value:function(t){return this._customProperties.get(t)}},{key:"removeCustomProperty",value:function(t){return this._customProperties.delete(t)}},{key:"getCustomProperties",value:regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(this._customProperties.entries(),"t0",1);case 1:case"end":return t.stop()}},t,this)})},{key:"childCount",get:function(){return this._children.length}},{key:"isEmpty",get:function(){return 0===this._children.length}}]),e}(dl),gl=function(t){function e(t,n,r){Fs(this,e);var i=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r));return i.getFillerOffset=ct,i}return Ms(e,t),e}(ml),bl=function(t){function e(t,n,r,i){Fs(this,e);var o=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r,i));return o._document=t,o.set("isReadOnly",!1),o.bind("isFocused").to(t,"isFocused",function(e){return e&&t.selection.editableElement==o}),o.listenTo(t,"render",function(){o.isFocused=t.isFocused&&t.selection.editableElement==o},{priority:"low"}),o}return Ms(e,t),Ns(e,[{key:"document",get:function(){return this._document}}]),e}(gl);J(bl,Zu);var _l=function(){function t(e,n){Fs(this,t),this.parent=e,this.offset=n}return Ns(t,[{key:"getShiftedBy",value:function(e){var n=t.createFromPosition(this),r=n.offset+e;return n.offset=r<0?0:r,n}},{key:"getAncestors",value:function(){return this.parent.getAncestors({includeNode:!0,parentFirst:!0})}},{key:"isEqual",value:function(t){return this==t||this.parent==t.parent&&this.offset==t.offset}},{key:"isBefore",value:function(t){return"before"==this.compareWith(t)}},{key:"isAfter",value:function(t){return"after"==this.compareWith(t)}},{key:"compareWith",value:function(t){if(this.isEqual(t))return"same";if(this.parent===t.parent)return this.offset-t.offset<0?"before":"after";var e=this.parent.getAncestors({includeNode:!0}),n=t.parent.getAncestors({includeNode:!0}),r=tt(e,n),i=void 0;switch(r){case 0:return"different";case"prefix":i=e.length-1;break;case"extension":i=n.length-1;break;default:i=r-1}var o=e[i],a=e[i+1],s=n[i+1];if(o===this.parent){var u=this.offset-s.index;return u<=0?"before":"after"}if(o===t.parent){var l=a.index-t.offset;return l<0?"before":"after"}var c=a.index-s.index;return c<0?"before":"after"}},{key:"nodeAfter",get:function(){return this.parent instanceof vl?null:this.parent.getChild(this.offset)||null}},{key:"nodeBefore",get:function(){return this.parent instanceof vl?null:this.parent.getChild(this.offset-1)||null}},{key:"isAtStart",get:function(){return 0===this.offset}},{key:"isAtEnd",get:function(){var t=this.parent instanceof vl?this.parent.data.length:this.parent.childCount;return this.offset===t}},{key:"root",get:function(){return this.parent.root}},{key:"editableElement",get:function(){for(var t=this.parent;!(t instanceof bl);){if(!t.parent)return null;t=t.parent}return t}}],[{key:"createAt",value:function(e,n){if(e instanceof t)return this.createFromPosition(e);var r=e;if("end"==n)n=r instanceof vl?r.data.length:r.childCount;else{if("before"==n)return this.createBefore(r);if("after"==n)return this.createAfter(r);n||(n=0)}return new t(r,n)}},{key:"createAfter",value:function(e){if(e instanceof yl)return new t(e.textNode,e.offsetInText+e.data.length);if(!e.parent)throw new Qs("view-position-after-root: You can not make position after root.",{root:e});return new t(e.parent,e.index+1)}},{key:"createBefore",value:function(e){if(e instanceof yl)return new t(e.textNode,e.offsetInText);if(!e.parent)throw new Qs("view-position-before-root: You can not make position before root.",{root:e});return new t(e.parent,e.index)}},{key:"createFromPosition",value:function(t){return new this(t.parent,t.offset)}}]),t}(),wl=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Fs(this,t),!e.boundaries&&!e.startPosition)throw new Qs("view-tree-walker-no-start-position: Neither boundaries nor starting position have been defined.");if(e.direction&&"forward"!=e.direction&&"backward"!=e.direction)throw new Qs("view-tree-walker-unknown-direction: Only `backward` and `forward` direction allowed.",{direction:e.direction});this.boundaries=e.boundaries||null,e.startPosition?this.position=_l.createFromPosition(e.startPosition):this.position=_l.createFromPosition(e.boundaries["backward"==e.direction?"end":"start"]),this.direction=e.direction||"forward",this.singleCharacters=!!e.singleCharacters,this.shallow=!!e.shallow,this.ignoreElementEnd=!!e.ignoreElementEnd,this._boundaryStartParent=this.boundaries?this.boundaries.start.parent:null,this._boundaryEndParent=this.boundaries?this.boundaries.end.parent:null}return Ns(t,[{key:Symbol.iterator,value:function(){return this}},{key:"next",value:function(){return"forward"==this.direction?this._next():this._previous()}},{key:"_next",value:function(){var t=_l.createFromPosition(this.position),e=this.position,n=t.parent;if(null===n.parent&&t.offset===n.childCount)return{done:!0};if(n===this._boundaryEndParent&&t.offset==this.boundaries.end.offset)return{done:!0};var r=void 0;if(r=n instanceof vl?n.data[t.offset]:n.getChild(t.offset),r instanceof ml)return this.shallow?t.offset++:t=new _l(r,0),this.position=t,this._formatReturnValue("elementStart",r,e,t,1);if(r instanceof vl){if(this.singleCharacters)return t=new _l(r,0),this.position=t,this._next();var i=r.data.length,o=r;return r==this._boundaryEndParent?(i=this.boundaries.end.offset,o=new yl(r,0,i),t=_l.createAfter(o)):t.offset++,this.position=t,this._formatReturnValue("text",o,e,t,i)}if("string"==typeof r){var a=void 0;if(this.singleCharacters)a=1;else{var s=n===this._boundaryEndParent?this.boundaries.end.offset:n.data.length;a=s-t.offset}var u=new yl(n,t.offset,a);return t.offset+=a,this.position=t,this._formatReturnValue("text",u,e,t,a)}return t=_l.createAfter(n),this.position=t,this.ignoreElementEnd?this._next():this._formatReturnValue("elementEnd",n,e,t)}},{key:"_previous",value:function(){var t=_l.createFromPosition(this.position),e=this.position,n=t.parent;if(null===n.parent&&0===t.offset)return{done:!0};if(n==this._boundaryStartParent&&t.offset==this.boundaries.start.offset)return{done:!0};var r=void 0;if(r=n instanceof vl?n.data[t.offset-1]:n.getChild(t.offset-1),r instanceof ml)return this.shallow?(t.offset--,this.position=t,this._formatReturnValue("elementStart",r,e,t,1)):(t=new _l(r,r.childCount),this.position=t,this.ignoreElementEnd?this._previous():this._formatReturnValue("elementEnd",r,e,t));if(r instanceof vl){if(this.singleCharacters)return t=new _l(r,r.data.length),this.position=t,this._previous();var i=r.data.length,o=r;if(r==this._boundaryStartParent){var a=this.boundaries.start.offset;o=new yl(r,a,r.data.length-a),i=o.data.length,t=_l.createBefore(o)}else t.offset--;return this.position=t,this._formatReturnValue("text",o,e,t,i)}if("string"==typeof r){var s=void 0;if(this.singleCharacters)s=1;else{var u=n===this._boundaryStartParent?this.boundaries.start.offset:0;s=t.offset-u}t.offset-=s;var l=new yl(n,t.offset,s);return this.position=t,this._formatReturnValue("text",l,e,t,s)}return t=_l.createBefore(n),this.position=t,this._formatReturnValue("elementStart",n,e,t,1)}},{key:"_formatReturnValue",value:function(t,e,n,r,i){return e instanceof yl&&(e.offsetInText+e.data.length==e.textNode.data.length&&("forward"!=this.direction||this.boundaries&&this.boundaries.end.isEqual(this.position)?n=_l.createAfter(e.textNode):(r=_l.createAfter(e.textNode),this.position=r)),0===e.offsetInText&&("backward"!=this.direction||this.boundaries&&this.boundaries.start.isEqual(this.position)?n=_l.createBefore(e.textNode):(r=_l.createBefore(e.textNode),this.position=r))),{done:!1,value:{type:t,item:e,previousPosition:n,nextPosition:r,length:i}}}}]),t}(),kl=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;Fs(this,t),this.start=_l.createFromPosition(e),this.end=n?_l.createFromPosition(n):_l.createFromPosition(e)}return Ns(t,[{key:Symbol.iterator,value:regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(new wl({boundaries:this,ignoreElementEnd:!0}),"t0",1);case 1:case"end":return t.stop()}},t,this)})},{key:"isEqual",value:function(t){return this==t||this.start.isEqual(t.start)&&this.end.isEqual(t.end)}},{key:"containsPosition",value:function(t){return t.isAfter(this.start)&&t.isBefore(this.end)}},{key:"containsRange",value:function(t){return this.containsPosition(t.start)&&this.containsPosition(t.end)}},{key:"getDifference",value:function(e){var n=[];return this.isIntersecting(e)?(this.containsPosition(e.start)&&n.push(new t(this.start,e.start)),this.containsPosition(e.end)&&n.push(new t(e.end,this.end))):n.push(t.createFromRange(this)),n}},{key:"getIntersection",value:function(e){if(this.isIntersecting(e)){var n=this.start,r=this.end;return this.containsPosition(e.start)&&(n=e.start),this.containsPosition(e.end)&&(r=e.end),new t(n,r)}return null}},{key:"getWalker",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.boundaries=this,new wl(t)}},{key:"getItems",value:regeneratorRuntime.mark(function t(){var e,n,r,i,o,a,s,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:u.boundaries=this,u.ignoreElementEnd=!0,e=new wl(u),n=!0,r=!1,i=void 0,t.prev=6,o=e[Symbol.iterator]();case 8:if(n=(a=o.next()).done){t.next=15;break}return s=a.value,t.next=12,s.item;case 12:n=!0,t.next=8;break;case 15:t.next=21;break;case 17:t.prev=17,t.t0=t.catch(6),r=!0,i=t.t0;case 21:t.prev=21,t.prev=22,!n&&o.return&&o.return();case 24:if(t.prev=24,!r){t.next=27;break}throw i;case 27:return t.finish(24);case 28:return t.finish(21);case 29:case"end":return t.stop()}},t,this,[[6,17,21,29],[22,,24,28]])})},{key:"getPositions",value:regeneratorRuntime.mark(function t(){var e,n,r,i,o,a,s,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return u.boundaries=this,e=new wl(u),t.next=4,e.position;case 4:n=!0,r=!1,i=void 0,t.prev=7,o=e[Symbol.iterator]();case 9:if(n=(a=o.next()).done){t.next=16;break}return s=a.value,t.next=13,s.nextPosition;case 13:n=!0,t.next=9;break;case 16:t.next=22;break;case 18:t.prev=18,t.t0=t.catch(7),r=!0,i=t.t0;case 22:t.prev=22,t.prev=23,!n&&o.return&&o.return();case 25:if(t.prev=25,!r){t.next=28;break}throw i;case 28:return t.finish(25);case 29:return t.finish(22);case 30:case"end":return t.stop()}},t,this,[[7,18,22,30],[23,,25,29]])})},{key:"isIntersecting",value:function(t){return this.start.isBefore(t.end)&&this.end.isAfter(t.start)}},{key:"isCollapsed",get:function(){return this.start.isEqual(this.end)}},{key:"isFlat",get:function(){return this.start.parent===this.end.parent}},{key:"root",get:function(){return this.start.root}}],[{key:"createFromParentsAndOffsets",value:function(t,e,n,r){return new this(new _l(t,e),new _l(n,r))}},{key:"createFromRange",value:function(t){return new this(t.start,t.end)}},{key:"createFromPositionAndShift",value:function(t,e){var n=t,r=t.getShiftedBy(e);return e>0?new this(n,r):new this(r,n)}},{key:"createIn",value:function(t){return this.createFromParentsAndOffsets(t,0,t,t.childCount)}},{key:"createOn",value:function(t){return this.createFromPositionAndShift(_l.createBefore(t),1)}}]),t}(),xl=function(){function t(){Fs(this,t),this._modelToViewMapping=new WeakMap,this._viewToModelMapping=new WeakMap,this._viewToModelLengthCallbacks=new Map}return Ns(t,[{key:"bindElements",value:function(t,e){this._modelToViewMapping.set(t,e),this._viewToModelMapping.set(e,t)}},{key:"unbindViewElement",value:function(t){var e=this.toModelElement(t);this._unbindElements(e,t)}},{key:"unbindModelElement",value:function(t){var e=this.toViewElement(t);this._unbindElements(t,e)}},{key:"clearBindings",value:function(){this._modelToViewMapping=new WeakMap,this._viewToModelMapping=new WeakMap}},{key:"toModelElement",value:function(t){return this._viewToModelMapping.get(t)}},{key:"toViewElement",value:function(t){return this._modelToViewMapping.get(t)}},{key:"toModelRange",value:function(t){return new hl(this.toModelPosition(t.start),this.toModelPosition(t.end))}},{key:"toViewRange",value:function(t){return new kl(this.toViewPosition(t.start),this.toViewPosition(t.end))}},{key:"toModelPosition",value:function(t){var e={viewPosition:t,modelPosition:this._defaultToModelPosition(t),mapper:this};return this.fire("viewToModelPosition",e),e.modelPosition}},{key:"_defaultToViewPosition",value:function(t){var e=this._modelToViewMapping.get(t.parent);return this._findPositionIn(e,t.offset)}},{key:"toViewPosition",value:function(t){var e={viewPosition:this._defaultToViewPosition(t),modelPosition:t,mapper:this};return this.fire("modelToViewPosition",e),e.viewPosition}},{key:"_defaultToModelPosition",value:function(t){for(var e=t.parent,n=this._viewToModelMapping.get(e);!n;)e=e.parent,n=this._viewToModelMapping.get(e);var r=this._toModelOffset(t.parent,t.offset,e);return ll.createFromParentAndOffset(n,r)}},{key:"registerViewToModelLength",value:function(t,e){this._viewToModelLengthCallbacks.set(t,e)}},{key:"_toModelOffset",value:function(t,e,n){if(n!=t){var r=this._toModelOffset(t.parent,t.index,n),i=this._toModelOffset(t,e,t);return r+i}if(t instanceof vl)return e;for(var o=0,a=0;a<e;a++)o+=this.getModelLength(t.getChild(a));return o}},{key:"_unbindElements",value:function(t,e){this._viewToModelMapping.delete(e),this._modelToViewMapping.delete(t)}},{key:"getModelLength",value:function(t){if(this._viewToModelMapping.has(t)){var e=this._viewToModelLengthCallbacks.get(t.name);return e?e(t):1}if(t instanceof vl)return t.data.length;var n=0,r=!0,i=!1,o=void 0;try{for(var a,s=t.getChildren()[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;n+=this.getModelLength(u)}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}},{key:"_findPositionIn",value:function(t,e){var n=void 0,r=0,i=0,o=0;if(t instanceof vl)return new _l(t,e);for(;i<e;)n=t.getChild(o),r=this.getModelLength(n),i+=r,o++;return i==e?this._moveViewPositionToTextNode(new _l(t,o)):this._findPositionIn(n,e-(i-r))}},{key:"_moveViewPositionToTextNode",value:function(t){var e=t.nodeBefore,n=t.nodeAfter;return e instanceof vl?new _l(e,e.data.length):n instanceof vl?new _l(n,0):t}}]),t}();J(xl,qs);var Ol=function(){function t(){Fs(this,t),this._consumable=new Map,this._textProxyRegistry=new Map}return Ns(t,[{key:"add",value:function(t,e){t instanceof cl&&(t=this._getSymbolForTextProxy(t)),this._consumable.has(t)||this._consumable.set(t,new Map),this._consumable.get(t).set(e,!0)}},{key:"consume",value:function(t,e){return t instanceof cl&&(t=this._getSymbolForTextProxy(t)),!!this.test(t,e)&&(this._consumable.get(t).set(e,!1),!0)}},{key:"test",value:function(t,e){t instanceof cl&&(t=this._getSymbolForTextProxy(t));var n=this._consumable.get(t);if(void 0===n)return null;var r=n.get(e);return void 0===r?null:r}},{key:"revert",value:function(t,e){t instanceof cl&&(t=this._getSymbolForTextProxy(t));var n=this.test(t,e);return n===!1?(this._consumable.get(t).set(e,!0),!0):n!==!0&&null}},{key:"_getSymbolForTextProxy",value:function(t){var e=null,n=this._textProxyRegistry.get(t.startOffset);if(n){var r=n.get(t.endOffset);r&&(e=r.get(t.parent))}return e||(e=this._addSymbolForTextProxy(t.startOffset,t.endOffset,t.parent)),e}},{key:"_addSymbolForTextProxy",value:function(t,e,n){var r=Symbol(),i=void 0,o=void 0;return i=this._textProxyRegistry.get(t),i||(i=new Map,this._textProxyRegistry.set(t,i)),o=i.get(e),o||(o=new Map,i.set(e,o)),o.set(n,r),r}}]),t}(),Sl=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Fs(this,t),this.conversionApi=Gu({dispatcher:this},e)}return Ns(t,[{key:"convertChange",value:function(t,e){"remove"!==t&&e.range&&"$graveyard"==e.range.root.rootName||"remove"==t&&"$graveyard"==e.sourcePosition.root.rootName||"rename"==t&&"$graveyard"==e.element.root.rootName||("insert"==t||"reinsert"==t?this.convertInsertion(e.range):"move"==t?this.convertMove(e.sourcePosition,e.range):"remove"==t?this.convertRemove(e.sourcePosition,e.range):"addAttribute"==t||"removeAttribute"==t||"changeAttribute"==t?this.convertAttribute(t,e.range,e.key,e.oldValue,e.newValue):"rename"==t&&this.convertRename(e.element,e.oldName))}},{key:"convertInsertion",value:function(t){var e=this._createInsertConsumable(t),n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,u=s.item,l=hl.createFromPositionAndShift(s.previousPosition,s.length),c={item:u,range:l};this._testAndFire("insert",c,e);var f=!0,h=!1,d=void 0;try{for(var v,y=u.getAttributeKeys()[Symbol.iterator]();!(f=(v=y.next()).done);f=!0){var p=v.value;c.attributeKey=p,c.attributeOldValue=null,c.attributeNewValue=u.getAttribute(p),this._testAndFire("addAttribute:"+p,c,e)}}catch(t){h=!0,d=t}finally{try{!f&&y.return&&y.return()}finally{if(h)throw d}}}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}}},{key:"convertMove",value:function(t,e){var n=this._createConsumableForRange(e,"move"),r=Array.from(e.getItems({shallow:!0})),i=t.parent==e.start.parent,o=e.start.isAfter(t),a=0,s=!0,u=!1,l=void 0;try{for(var c,f=r[Symbol.iterator]();!(s=(c=f.next()).done);s=!0){var h=c.value,d={sourcePosition:t,targetPosition:i&&o?e.end:e.start.getShiftedBy(a),item:h};a+=d.item.offsetSize,this._testAndFire("move",d,n)}}catch(t){u=!0,l=t}finally{try{!s&&f.return&&f.return()}finally{if(u)throw l}}}},{key:"convertRemove",value:function(t,e){var n=this._createConsumableForRange(e,"remove"),r=!0,i=!1,o=void 0;try{for(var a,s=e.getItems({shallow:!0})[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value,l={sourcePosition:t,item:u};this._testAndFire("remove",l,n)}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}}},{key:"convertAttribute",value:function(t,e,n,r,i){var o=this._createConsumableForRange(e,t+":"+n),a=!0,s=!1,u=void 0;try{for(var l,c=e[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var f=l.value,h=f.item,d=hl.createFromPositionAndShift(f.previousPosition,f.length),v={item:h,range:d,attributeKey:n,attributeOldValue:r,attributeNewValue:i};this._testAndFire(t+":"+n,v,o,this.conversionApi)}}catch(t){s=!0,u=t}finally{try{!a&&c.return&&c.return()}finally{if(s)throw u}}}},{key:"convertRename",value:function(t,e){var n=new Ol;n.add(t,"rename");var r={element:t,oldName:e};this.fire("rename:"+t.name+":"+e,r,n,this.conversionApi)}},{key:"convertSelection",value:function(t){var e=this._createSelectionConsumable(t),n={selection:t};this.fire("selection",n,e,this.conversionApi);var r=!0,i=!1,o=void 0;try{for(var a,s=t.getAttributeKeys()[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;n.key=u,n.value=t.getAttribute(u),e.test(t,"selectionAttribute:"+n.key)&&this.fire("selectionAttribute:"+n.key,n,e,this.conversionApi)}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}}},{key:"convertMarker",value:function(t,e,n){var r=this._createMarkerConsumable(t,n),i={name:e,range:n};this.fire(t+":"+e,i,r,this.conversionApi)}},{key:"_createInsertConsumable",value:function(t){var e=new Ol,n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,u=s.item;e.add(u,"insert");var l=!0,c=!1,f=void 0;try{for(var h,d=u.getAttributeKeys()[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var v=h.value;e.add(u,"addAttribute:"+v)}}catch(t){c=!0,f=t}finally{try{!l&&d.return&&d.return()}finally{if(c)throw f}}}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return e}},{key:"_createConsumableForRange",value:function(t,e){var n=new Ol,r=!0,i=!1,o=void 0;try{for(var a,s=t.getItems()[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;n.add(u,e)}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}},{key:"_createSelectionConsumable",value:function(t){var e=new Ol;e.add(t,"selection");var n=!0,r=!1,i=void 0;try{for(var o,a=t.getAttributeKeys()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;e.add(t,"selectionAttribute:"+s)}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return e}},{key:"_createMarkerConsumable",value:function(t,e){var n=new Ol;return n.add(e,t),n}},{key:"_testAndFire",value:function(t,e,n){if(n.test(e.item,t))if("insert"===t||"remove"===t||"move"==t)e.item instanceof cl?this.fire(t+":$text",e,n,this.conversionApi):this.fire(t+":"+e.item.name,e,n,this.conversionApi);else{var r=e.item.name||"$text";this.fire(t+":"+r,e,n,this.conversionApi)}}}]),t}();J(Sl,qs);var Pl=10,Al=function(t){function e(t,n,r){Fs(this,e);var i=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r));return i.priority=Pl,i.getFillerOffset=ft,i}return Ms(e,t),Ns(e,[{key:"clone",value:function(t){var n=js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"clone",this).call(this,t);return n.priority=this.priority,n}},{key:"isSimilar",value:function(t){return js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"isSimilar",this).call(this,t)&&this.priority==t.priority}}]),e}(ml);Al.DEFAULT_PRIORITY=Pl;var Cl=function(t){function e(t,n){Fs(this,e);var r=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return arguments.length>2&&ht(),r.getFillerOffset=dt,r}return Ms(e,t),Ns(e,[{key:"clone",value:function(){var t=new this.constructor(this.name,this._attrs);return t._classes=new Set(this._classes),t._styles=new Map(this._styles),t}},{key:"appendChildren",value:function(){ht()}},{key:"insertChildren",value:function(){ht()}}]),e}(ml),Tl=function(){function t(e){Fs(this,t),this._children=[],e&&this.insertChildren(0,e)}return Ns(t,[{key:Symbol.iterator,value:function(){return this._children[Symbol.iterator]()}},{key:"getAncestors",value:function(){return[]}},{key:"appendChildren",value:function(t){return this.insertChildren(this.childCount,t)}},{key:"getChild",value:function(t){return this._children[t]}},{key:"getChildIndex",value:function(t){return this._children.indexOf(t)}},{key:"getChildren",value:function(){return this._children[Symbol.iterator]()}},{key:"insertChildren",value:function(t,e){this._fireChange("children",this);var n=0;e=vt(e);var r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;u.parent=this,this._children.splice(t,0,u),t++,n++}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}},{key:"removeChildren",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this._fireChange("children",this);for(var n=t;n<t+e;n++)this._children[n].parent=null;return this._children.splice(t,e)}},{key:"_fireChange",value:function(t,e){this.fire("change:"+t,e)}},{key:"childCount",get:function(){return this._children.length}},{key:"isEmpty",get:function(){return 0===this.childCount}},{key:"root",get:function(){return this}},{key:"parent",get:function(){return null}}]),t}();J(Tl,qs);var El={breakAttributes:yt,breakContainer:pt,mergeAttributes:mt,mergeContainers:gt,insert:_t,remove:wt,move:kt,wrap:xt,wrapPosition:Ot,unwrap:St,rename:Pt,breakViewRangePerContainer:bt},Rl=function(){function t(){Fs(this,t),this._consumables=new Map}return Ns(t,[{key:"add",value:function(t,e){var n=void 0;return t instanceof vl||t instanceof Tl?void this._consumables.set(t,!0):(this._consumables.has(t)?n=this._consumables.get(t):(n=new Vl,this._consumables.set(t,n)),void n.add(e))}},{key:"test",value:function(t,e){var n=this._consumables.get(t);return void 0===n?null:t instanceof vl||t instanceof Tl?n:n.test(e)}},{key:"consume",value:function(t,e){return!!this.test(t,e)&&(t instanceof vl||t instanceof Tl?this._consumables.set(t,!1):this._consumables.get(t).consume(e),!0)}},{key:"revert",value:function(t,e){var n=this._consumables.get(t);void 0!==n&&(t instanceof vl||t instanceof Tl?this._consumables.set(t,!0):n.revert(e))}}],[{key:"consumablesFromElement",value:function(t){var e={name:!0,attribute:[],class:[],style:[]},n=t.getAttributeKeys(),r=!0,i=!1,o=void 0;try{for(var a,s=n[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;"style"!=u&&"class"!=u&&e.attribute.push(u)}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}var l=t.getClassNames(),c=!0,f=!1,h=void 0;try{for(var d,v=l[Symbol.iterator]();!(c=(d=v.next()).done);c=!0){var y=d.value;e.class.push(y)}}catch(t){f=!0,h=t}finally{try{!c&&v.return&&v.return()}finally{if(f)throw h}}var p=t.getStyleNames(),m=!0,g=!1,b=void 0;try{for(var _,w=p[Symbol.iterator]();!(m=(_=w.next()).done);m=!0){var k=_.value;e.style.push(k)}}catch(t){g=!0,b=t}finally{try{!m&&w.return&&w.return()}finally{if(g)throw b}}return e}},{key:"createFrom",value:function(e,n){if(n||(n=new t),e instanceof vl)return n.add(e),n;e instanceof ml&&n.add(e,t.consumablesFromElement(e)),e instanceof Tl&&n.add(e);var r=!0,i=!1,o=void 0;try{for(var a,s=e.getChildren()[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;n=t.createFrom(u,n)}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}}]),t}(),Vl=function(){function t(){Fs(this,t),this._canConsumeName=null,this._consumables={attribute:new Map,style:new Map,class:new Map}}return Ns(t,[{key:"add",value:function(t){t.name&&(this._canConsumeName=!0);for(var e in this._consumables)e in t&&this._add(e,t[e])}},{key:"test",value:function(t){if(t.name&&!this._canConsumeName)return this._canConsumeName;for(var e in this._consumables)if(e in t){var n=this._test(e,t[e]);if(n!==!0)return n}return!0}},{key:"consume",value:function(t){t.name&&(this._canConsumeName=!1);for(var e in this._consumables)e in t&&this._consume(e,t[e])}},{key:"revert",value:function(t){t.name&&(this._canConsumeName=!0);for(var e in this._consumables)e in t&&this._revert(e,t[e])}},{key:"_add",value:function(t,e){var n=Lu(e)?e:[e],r=this._consumables[t],i=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;if("attribute"===t&&("class"===l||"style"===l))throw new Qs("viewconsumable-invalid-attribute: Classes and styles should be handled separately.");r.set(l,!0)}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}},{key:"_test",value:function(t,e){var n=Lu(e)?e:[e],r=this._consumables[t],i=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;if("attribute"!==t||"class"!==l&&"style"!==l){var c=r.get(l);if(void 0===c)return null;if(!c)return!1}else{var f=this._test(l,[].concat(Ds(this._consumables[l].keys())));if(f!==!0)return f}}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}return!0}},{key:"_consume",value:function(t,e){var n=Lu(e)?e:[e],r=this._consumables[t],i=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;"attribute"!==t||"class"!==l&&"style"!==l?r.set(l,!1):this._consume(l,[].concat(Ds(this._consumables[l].keys())))}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}},{key:"_revert",value:function(t,e){var n=Lu(e)?e:[e],r=this._consumables[t],i=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;if("attribute"!==t||"class"!==l&&"style"!==l){var c=r.get(l);c===!1&&r.set(l,!0)}else this._revert(l,[].concat(Ds(this._consumables[l].keys())))}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}}]),t}(),Fl=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Fs(this,t),this.conversionApi=Gu({},e),this.conversionApi.convertItem=this._convertItem.bind(this),this.conversionApi.convertChildren=this._convertChildren.bind(this)}return Ns(t,[{key:"convert",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire("viewCleanup",t);var n=Rl.createFrom(t);return this._convertItem(t,n,e)}},{key:"_convertItem",value:function(t,e){
var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Gu({},n,{input:t,output:null});return t instanceof ml?this.fire("element:"+t.name,r,e,this.conversionApi):t instanceof vl?this.fire("text",r,e,this.conversionApi):this.fire("documentFragment",r,e,this.conversionApi),r.output}},{key:"_convertChildren",value:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=Array.from(t.getChildren()),o=i.map(function(t){return n._convertItem(t,e,r)});return o.reduce(function(t,e){return e?t.concat(e):t},[])}}]),t}();J(Fl,qs);var Nl={insert:ne,remove:re,move:ie,setAttribute:oe,removeAttribute:ae,normalizeNodes:se},jl=function(t){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"main";Fs(this,e);var i=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n));return i._doc=t,i.rootName=r,i}return Ms(e,t),Ns(e,[{key:"toJSON",value:function(){return this.rootName}},{key:"document",get:function(){return this._doc}}]),e}(sl),Ml=function(t){function e(t,n,r){if(Fs(this,e),!(t instanceof jl))throw new Qs("model-liveposition-root-not-rootelement: LivePosition root has to be an instance of RootElement.");var i=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return i.stickiness=r||"sticksToNext",de.call(i),i}return Ms(e,t),Ns(e,[{key:"detach",value:function(){this.stopListening()}}]),e}(ll);J(Ml,qs);var Il=function(){function t(e,n,r){Fs(this,t),this.dataController=e,this.batch=n,this.position=r,this.canMergeWith=new Set([this.position.parent]),this.schema=e.model.schema}return Ns(t,[{key:"handleNodes",value:function(t,e){t=Array.from(t);for(var n=0;n<t.length;n++){var r=t[n].clone();this._handleNode(r,{isFirst:0===n&&e.isFirst,isLast:n===t.length-1&&e.isLast})}}},{key:"getSelectionRange",value:function(){return this.nodeToSelect?hl.createOn(this.nodeToSelect):this.dataController.model.getNearestSelectionRange(this.position)}},{key:"_handleNode",value:function(t,e){if(this._checkIsObject(t))return void this._handleObject(t,e);var n=this._checkAndSplitToAllowedPosition(t,e);return n?(this._insert(t),void this._mergeSiblingsOf(t,e)):void this._handleDisallowedNode(t,e)}},{key:"_handleObject",value:function(t,e){this._checkAndSplitToAllowedPosition(t)?this._insert(t):this._tryAutoparagraphing(t,e)}},{key:"_handleDisallowedNode",value:function(t,e){t instanceof sl?this.handleNodes(t.getChildren(),e):this._tryAutoparagraphing(t,e)}},{key:"_insert",value:function(t){if(!this._checkIsAllowed(t,[this.position.parent]))return void el.error("insertcontent-wrong-position: The node cannot be inserted on the given position.",{node:t,position:this.position});var e=Ml.createFromPosition(this.position);this.batch.insert(this.position,t),this.position=ll.createFromPosition(e),e.detach(),this._checkIsObject(t)&&!this.schema.check({name:"$text",inside:[this.position.parent]})?this.nodeToSelect=t:this.nodeToSelect=null}},{key:"_mergeSiblingsOf",value:function(t,e){if(t instanceof sl){var n=e.isFirst&&t.previousSibling instanceof sl&&this.canMergeWith.has(t.previousSibling),r=e.isLast&&t.nextSibling instanceof sl&&this.canMergeWith.has(t.nextSibling),i=Ml.createBefore(t),o=Ml.createAfter(t);if(n){var a=Ml.createFromPosition(this.position);this.batch.merge(i),this.position=ll.createFromPosition(a),a.detach()}if(r){var s=void 0;this.position.isEqual(o)||el.error("insertcontent-wrong-position-on-merge: The insertion position should equal the merge position"),this.position=ll.createAt(o.nodeBefore,"end"),s=new Ml(this.position.root,this.position.path,"sticksToPrevious"),this.batch.merge(o),this.position=ll.createFromPosition(s),s.detach()}i.detach(),o.detach()}}},{key:"_tryAutoparagraphing",value:function(t,e){var n=new sl("paragraph");this._getAllowedIn(n,this.position.parent)&&this._checkIsAllowed(t,[n])&&(n.appendChildren(t),this._handleNode(n,e))}},{key:"_checkAndSplitToAllowedPosition",value:function(t){var e=this._getAllowedIn(t,this.position.parent);if(!e)return!1;for(;e!=this.position.parent;)if(this.position.isAtStart){var n=this.position.parent;this.position=ll.createBefore(n),n.isEmpty&&this.batch.remove(n)}else if(this.position.isAtEnd)this.position=ll.createAfter(this.position.parent);else{var r=ll.createAfter(this.position.parent);this.batch.split(this.position),this.position=r,this.canMergeWith.add(this.position.nodeAfter)}return!0}},{key:"_getAllowedIn",value:function(t,e){return this._checkIsAllowed(t,[e])?e:e.parent?this._getAllowedIn(t,e.parent):null}},{key:"_checkIsAllowed",value:function(t,e){return this.schema.check({name:this._getNodeSchemaName(t),attributes:Array.from(t.getAttributeKeys()),inside:e})}},{key:"_checkIsObject",value:function(t){return this.schema.objects.has(this._getNodeSchemaName(t))}},{key:"_getNodeSchemaName",value:function(t){return t instanceof al?"$text":t.name}}]),t}(),Bl=function(){function t(e,n){var r=this;Fs(this,t),this.model=e,this.processor=n,this.mapper=new xl,this.modelToView=new Sl({mapper:this.mapper}),this.modelToView.on("insert:$text",qt(),{priority:"lowest"}),this.viewToModel=new Fl({schema:e.schema}),this.viewToModel.on("text",he(),{priority:"lowest"}),this.viewToModel.on("element",fe(),{priority:"lowest"}),this.viewToModel.on("documentFragment",fe(),{priority:"lowest"}),this.on("insertContent",function(t,e){return ye(r,e.content,e.selection,e.batch)}),this.on("deleteContent",function(t,e){return pe(e.selection,e.batch,e.options)}),this.on("modifySelection",function(t,e){return xe(r,e.selection,e.options)}),this.on("getSelectedContent",function(t,e){e.content=Pe(e.selection)})}return Ns(t,[{key:"get",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";return this.stringify(this.model.getRoot(t))}},{key:"stringify",value:function(t){var e=this.toView(t);return this.processor.toData(e)}},{key:"toView",value:function(t){var e=hl.createIn(t),n=new Tl;return this.mapper.bindElements(t,n),this.modelToView.convertInsertion(e),this.mapper.clearBindings(),n}},{key:"set",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"main",r=this.model.getRoot(n);this.model.enqueueChanges(function(){e.model.selection.removeAllRanges(),e.model.selection.clearAttributes(),e.model.batch("transparent").remove(hl.createIn(r)).insert(ll.createAt(r,0),e.parse(t))})}},{key:"parse",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"$root",n=this.processor.toView(t);return this.toModel(n,e)}},{key:"toModel",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"$root";return this.viewToModel.convert(t,{context:[e]})}},{key:"destroy",value:function(){}},{key:"insertContent",value:function(t,e,n){this.fire("insertContent",{content:t,selection:e,batch:n})}},{key:"deleteContent",value:function(t,e,n){this.fire("deleteContent",{batch:e,selection:t,options:n})}},{key:"modifySelection",value:function(t,e){this.fire("modifySelection",{selection:t,options:e})}},{key:"getSelectedContent",value:function(t){var e={selection:t};return this.fire("getSelectedContent",e),e.content}}]),t}();J(Bl,qs);var Dl=Array.prototype,Ll=Dl.splice;Ne.prototype.clear=Ce,Ne.prototype.delete=Ee,Ne.prototype.get=Re,Ne.prototype.has=Ve,Ne.prototype.set=Fe;var zl=Function.prototype.toString,ql=/[\\^$.*+?()[\]{}|]/g,Hl=/^\[object .+?Constructor\]$/,$l=Object.prototype,Kl=Function.prototype.toString,Wl=$l.hasOwnProperty,Jl=RegExp("^"+Kl.call(Wl).replace(ql,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ul=ze(Object,"create"),Gl="__lodash_hash_undefined__",Yl=Object.prototype,Ql=Yl.hasOwnProperty,Xl=Object.prototype,Zl=Xl.hasOwnProperty,tc="__lodash_hash_undefined__";Je.prototype.clear=qe,Je.prototype.delete=He,Je.prototype.get=$e,Je.prototype.has=Ke,Je.prototype.set=We;var ec=ze(Tu,"Map");en.prototype.clear=Ue,en.prototype.delete=Qe,en.prototype.get=Xe,en.prototype.has=Ze,en.prototype.set=tn;var nc=200;rn.prototype.clear=je,rn.prototype.delete=Me,rn.prototype.get=Ie,rn.prototype.has=Be,rn.prototype.set=nn;var rc=Object.prototype,ic=rc.hasOwnProperty,oc=Object.keys,ac=Object.getOwnPropertySymbols;ac||(hn=function(){return[]});var sc=hn,uc=ze(Tu,"DataView"),lc=ze(Tu,"Promise"),cc=ze(Tu,"Set"),fc=ze(Tu,"WeakMap"),hc="[object Map]",dc="[object Object]",vc="[object Promise]",yc="[object Set]",pc="[object WeakMap]",mc="[object DataView]",gc=Object.prototype,bc=gc.toString,_c=De(uc),wc=De(ec),kc=De(lc),xc=De(cc),Oc=De(fc);(uc&&mn(new uc(new ArrayBuffer(1)))!=mc||ec&&mn(new ec)!=hc||lc&&mn(lc.resolve())!=vc||cc&&mn(new cc)!=yc||fc&&mn(new fc)!=pc)&&(mn=function(t){var e=bc.call(t),n=e==dc?t.constructor:void 0,r=n?De(n):void 0;if(r)switch(r){case _c:return mc;case wc:return hc;case kc:return vc;case xc:return yc;case Oc:return pc}return e});var Sc=mn,Pc=Object.prototype,Ac=Pc.hasOwnProperty,Cc=Tu.Uint8Array,Tc=/\w*$/,Ec=Tu.Symbol,Rc=Ec?Ec.prototype:void 0,Vc=Rc?Rc.valueOf:void 0,Fc="[object Boolean]",Nc="[object Date]",jc="[object Map]",Mc="[object Number]",Ic="[object RegExp]",Bc="[object Set]",Dc="[object String]",Lc="[object Symbol]",zc="[object ArrayBuffer]",qc="[object DataView]",Hc="[object Float32Array]",$c="[object Float64Array]",Kc="[object Int8Array]",Wc="[object Int16Array]",Jc="[object Int32Array]",Uc="[object Uint8Array]",Gc="[object Uint8ClampedArray]",Yc="[object Uint16Array]",Qc="[object Uint32Array]",Xc=Object.create,Zc={function:!0,object:!0},tf=Zc["undefined"==typeof exports?"undefined":Vs(exports)]&&exports&&!exports.nodeType?exports:void 0,ef=Zc["undefined"==typeof module?"undefined":Vs(module)]&&module&&!module.nodeType?module:void 0,nf=ef&&ef.exports===tf?tf:void 0,rf=nf?Tu.Buffer:void 0,of=rf?function(t){return t instanceof rf}:Nn(!1),af="[object Arguments]",sf="[object Array]",uf="[object Boolean]",lf="[object Date]",cf="[object Error]",ff="[object Function]",hf="[object GeneratorFunction]",df="[object Map]",vf="[object Number]",yf="[object Object]",pf="[object RegExp]",mf="[object Set]",gf="[object String]",bf="[object Symbol]",_f="[object WeakMap]",wf="[object ArrayBuffer]",kf="[object DataView]",xf="[object Float32Array]",Of="[object Float64Array]",Sf="[object Int8Array]",Pf="[object Int16Array]",Af="[object Int32Array]",Cf="[object Uint8Array]",Tf="[object Uint8ClampedArray]",Ef="[object Uint16Array]",Rf="[object Uint32Array]",Vf={};Vf[af]=Vf[sf]=Vf[wf]=Vf[kf]=Vf[uf]=Vf[lf]=Vf[xf]=Vf[Of]=Vf[Sf]=Vf[Pf]=Vf[Af]=Vf[df]=Vf[vf]=Vf[yf]=Vf[pf]=Vf[mf]=Vf[gf]=Vf[bf]=Vf[Cf]=Vf[Tf]=Vf[Ef]=Vf[Rf]=!0,Vf[cf]=Vf[ff]=Vf[_f]=!1;var Ff=function(){function t(e){Fs(this,t),this.baseVersion=e}return Ns(t,[{key:"toJSON",value:function(){var t=Mn(this,!0);return t.__className=this.constructor.className,delete t.delta,t}}],[{key:"fromJSON",value:function(t){return new this(t.baseVersion)}},{key:"className",get:function(){return"engine.model.operation.Operation"}}]),t}(),Nf="__lodash_hash_undefined__";Dn.prototype.add=Dn.prototype.push=In,Dn.prototype.has=Bn;var jf=1,Mf=2,If=1,Bf=2,Df="[object Boolean]",Lf="[object Date]",zf="[object Error]",qf="[object Map]",Hf="[object Number]",$f="[object RegExp]",Kf="[object Set]",Wf="[object String]",Jf="[object Symbol]",Uf="[object ArrayBuffer]",Gf="[object DataView]",Yf=Ec?Ec.prototype:void 0,Qf=Yf?Yf.valueOf:void 0,Xf=2,Zf="[object Arguments]",th="[object Array]",eh="[object Boolean]",nh="[object Date]",rh="[object Error]",ih="[object Function]",oh="[object Map]",ah="[object Number]",sh="[object Object]",uh="[object RegExp]",lh="[object Set]",ch="[object String]",fh="[object WeakMap]",hh="[object ArrayBuffer]",dh="[object DataView]",vh="[object Float32Array]",yh="[object Float64Array]",ph="[object Int8Array]",mh="[object Int16Array]",gh="[object Int32Array]",bh="[object Uint8Array]",_h="[object Uint8ClampedArray]",wh="[object Uint16Array]",kh="[object Uint32Array]",xh={};xh[vh]=xh[yh]=xh[ph]=xh[mh]=xh[gh]=xh[bh]=xh[_h]=xh[wh]=xh[kh]=!0,xh[Zf]=xh[th]=xh[hh]=xh[eh]=xh[dh]=xh[nh]=xh[rh]=xh[ih]=xh[oh]=xh[ah]=xh[sh]=xh[uh]=xh[lh]=xh[ch]=xh[fh]=!1;var Oh=Object.prototype,Sh=Oh.toString,Ph=2,Ah="[object Arguments]",Ch="[object Array]",Th="[object Object]",Eh=Object.prototype,Rh=Eh.hasOwnProperty,Vh=function(t){function e(t,n,r,i,o){Fs(this,e);var a=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,o));return a.range=hl.createFromRange(t),a.key=n,a.oldValue=void 0===r?null:r,a.newValue=void 0===i?null:i,a}return Ms(e,t),Ns(e,[{key:"clone",value:function(){return new e(this.range,this.key,this.oldValue,this.newValue,this.baseVersion)}},{key:"getReversed",value:function(){return new e(this.range,this.key,this.newValue,this.oldValue,this.baseVersion+1)}},{key:"_execute",value:function(){var t=!0,e=!1,n=void 0;try{for(var r,i=this.range.getItems()[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var o=r.value;if(null!==this.oldValue&&!Jn(o.getAttribute(this.key),this.oldValue))throw new Qs("attribute-operation-wrong-old-value: Changed node has different attribute value than operation's old attribute value.",{item:o,key:this.key,value:this.oldValue});if(null===this.oldValue&&null!==this.newValue&&o.hasAttribute(this.key))throw new Qs("attribute-operation-attribute-exists: The attribute with given key already exists.",{node:o,key:this.key});if(Jn(this.oldValue,this.newValue))return}}catch(t){e=!0,n=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw n}}return Nl.setAttribute(this.range,this.key,this.newValue),{range:this.range,key:this.key,oldValue:this.oldValue,newValue:this.newValue}}},{key:"type",get:function(){return null===this.oldValue?"addAttribute":null===this.newValue?"removeAttribute":"changeAttribute"}}],[{key:"fromJSON",value:function(t,n){return new e(hl.fromJSON(t.range,n),t.key,t.oldValue,t.newValue,t.baseVersion)}},{key:"className",get:function(){return"engine.model.operation.AttributeOperation"}}]),e}(Ff),Fh=function(t){function e(t,n,r,i){Fs(this,e);var o=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,i));return o.sourcePosition=ll.createFromPosition(t),o.howMany=n,o.targetPosition=ll.createFromPosition(r),o.isSticky=!1,o}return Ms(e,t),Ns(e,[{key:"clone",value:function(){var t=new this.constructor(this.sourcePosition,this.howMany,this.targetPosition,this.baseVersion);return t.isSticky=this.isSticky,t}},{key:"getMovedRangeStart",value:function(){return this.targetPosition._getTransformedByDeletion(this.sourcePosition,this.howMany)}},{key:"getReversed",value:function(){var t=this.sourcePosition._getTransformedByInsertion(this.targetPosition,this.howMany),e=new this.constructor(this.getMovedRangeStart(),this.howMany,t,this.baseVersion+1);return e.isSticky=this.isSticky,e}},{key:"_execute",value:function(){var t=this.sourcePosition.parent,e=this.targetPosition.parent,n=this.sourcePosition.offset,r=this.targetPosition.offset;if(!t||!e)throw new Qs("move-operation-position-invalid: Source position or target position is invalid.");if(n+this.howMany>t.maxOffset)throw new Qs("move-operation-nodes-do-not-exist: The nodes which should be moved do not exist.");if(t===e&&n<r&&r<n+this.howMany)throw new Qs("move-operation-range-into-itself: Trying to move a range of nodes to the inside of that range.");if(this.sourcePosition.root==this.targetPosition.root&&"prefix"==tt(this.sourcePosition.getParentPath(),this.targetPosition.getParentPath())){var i=this.sourcePosition.path.length-1;if(this.targetPosition.path[i]>=n&&this.targetPosition.path[i]<n+this.howMany)throw new Qs("move-operation-node-into-itself: Trying to move a range of nodes into one of nodes from that range.")}var o=Nl.move(hl.createFromPositionAndShift(this.sourcePosition,this.howMany),this.targetPosition);return{sourcePosition:this.sourcePosition,range:o}}},{key:"type",get:function(){return"move"}}],[{key:"fromJSON",value:function(t,e){var n=ll.fromJSON(t.sourcePosition,e),r=ll.fromJSON(t.targetPosition,e),i=new this(n,t.howMany,r,t.baseVersion);return t.isSticky&&(i.isSticky=!0),i}},{key:"className",get:function(){return"engine.model.operation.MoveOperation"}}]),e}(Ff),Nh=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"getReversed",value:function(){return new jh(this.targetPosition,this.howMany,this.baseVersion+1)}},{key:"position",get:function(){return this.targetPosition},set:function(t){this.targetPosition=t}},{key:"type",get:function(){return"reinsert"}}],[{key:"className",get:function(){return"engine.model.operation.ReinsertOperation"}}]),e}(Fh),jh=function(t){function e(t,n,r){Fs(this,e);var i=t.root.document.graveyard,o=new ll(i,[i.maxOffset,0]);return Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,o,r))}return Ms(e,t),Ns(e,[{key:"getReversed",value:function(){return new Nh(this.targetPosition,this.howMany,this.sourcePosition,this.baseVersion+1)}},{key:"clone",value:function(){var t=new e(this.sourcePosition,this.howMany,this.baseVersion);return t.targetPosition=ll.createFromPosition(this.targetPosition),t}},{key:"_execute",value:function(){if(this._needsHolderElement){var t=this.targetPosition.root,n=new sl("$graveyardHolder");t.insertChildren(this._holderElementOffset,n),this.sourcePosition.root==t&&this.sourcePosition.path[0]>=this._holderElementOffset&&this.sourcePosition.path[0]++}return js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_execute",this).call(this)}},{key:"type",get:function(){return"remove"}},{key:"_holderElementOffset",get:function(){return this.targetPosition.path[0]},set:function(t){this.targetPosition.path[0]=t}},{key:"_needsHolderElement",get:function(){if(this.delta){var t=!0,n=!1,r=void 0;try{for(var i,o=this.delta.operations[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if(a instanceof e){if(a==this)return!0;if(a._holderElementOffset==this._holderElementOffset)return!1}}}catch(t){n=!0,r=t}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}return!0}}],[{key:"fromJSON",value:function(t,n){var r=ll.fromJSON(t.sourcePosition,n),i=new e(r,t.howMany,t.baseVersion);return i.targetPosition=ll.fromJSON(t.targetPosition,n),i}},{key:"className",get:function(){return"engine.model.operation.RemoveOperation"}}]),e}(Fh),Mh=function(t){function e(t,n,r){Fs(this,e);var i=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r));return i.position=ll.createFromPosition(t),i.nodes=new ol(se(n)),i}return Ms(e,t),Ns(e,[{key:"clone",value:function(){var t=new ol([].concat(Ds(this.nodes)).map(function(t){return t.clone(!0)}));return new e(this.position,t,this.baseVersion)}},{key:"getReversed",value:function(){return new jh(this.position,this.nodes.maxOffset,this.baseVersion+1)}},{key:"_execute",value:function(){var t=this.nodes;this.nodes=new ol([].concat(Ds(t)).map(function(t){return t.clone(!0)}));var e=Nl.insert(this.position,t);return{range:e}}},{key:"type",get:function(){return"insert"}}],[{key:"fromJSON",value:function(t,n){var r=[],i=!0,o=!1,a=void 0;try{for(var s,u=t.nodes[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;l.name?r.push(sl.fromJSON(l)):r.push(al.fromJSON(l))}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}return new e(ll.fromJSON(t.position,n),r,t.baseVersion)}},{key:"className",get:function(){return"engine.model.operation.InsertOperation"}}]),e}(Ff),Ih=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"clone",value:function(){return new e(this.baseVersion)}},{key:"getReversed",value:function(){return new e(this.baseVersion+1)}},{key:"_execute",value:function(){}}],[{key:"className",get:function(){return"engine.model.operation.NoOperation"}}]),e}(Ff),Bh=function(t){function e(t,n,r,i){Fs(this,e);var o=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,i));return o.position=t,o.oldName=n,o.newName=r,o}return Ms(e,t),Ns(e,[{key:"clone",value:function(){return new e(ll.createFromPosition(this.position),this.oldName,this.newName,this.baseVersion)}},{key:"getReversed",value:function(){return new e(ll.createFromPosition(this.position),this.newName,this.oldName,this.baseVersion+1)}},{key:"_execute",value:function(){var t=this.position.nodeAfter;if(!(t instanceof sl))throw new Qs("rename-operation-wrong-position: Given position is invalid or node after it is not an instance of Element.");if(t.name!==this.oldName)throw new Qs("rename-operation-wrong-name: Element to change has different name than operation's old name.");if(this.oldName!=this.newName)return t.name=this.newName,{element:t,oldName:this.oldName}}},{key:"type",get:function(){return"rename"}}],[{key:"fromJSON",value:function(t,n){return new e(ll.fromJSON(t.position,n),t.oldName,t.newName,t.baseVersion)}},{key:"className",get:function(){return"engine.model.operation.RenameOperation"}}]),e}(Ff),Dh=function(t){function e(t,n,r,i,o){Fs(this,e);var a=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,o));return a.root=t,a.key=n,a.oldValue=r,a.newValue=i,a}return Ms(e,t),Ns(e,[{key:"clone",value:function(){return new e(this.root,this.key,this.oldValue,this.newValue,this.baseVersion)}},{key:"getReversed",value:function(){return new e(this.root,this.key,this.newValue,this.oldValue,this.baseVersion+1)}},{key:"_execute",value:function(){if(null!==this.oldValue&&this.root.getAttribute(this.key)!==this.oldValue)throw new Qs("rootattribute-operation-wrong-old-value: Changed node has different attribute value than operation's old attribute value.",{root:this.root,key:this.key});if(null===this.oldValue&&null!==this.newValue&&this.root.hasAttribute(this.key))throw new Qs("rootattribute-operation-attribute-exists: The attribute with given key already exists.",{root:this.root,key:this.key});return null!==this.newValue?this.root.setAttribute(this.key,this.newValue):this.root.removeAttribute(this.key),{root:this.root,key:this.key,oldValue:this.oldValue,newValue:this.newValue}}},{key:"type",get:function(){return null===this.oldValue?"addRootAttribute":null===this.newValue?"removeRootAttribute":"changeRootAttribute"}}],[{key:"fromJSON",value:function(t,n){if(!n.hasRoot(t.root))throw new Qs("rootattribute-operation-fromjson-no-root: Cannot create RootAttributeOperation. Root with specified name does not exist.",{rootName:t});return new e(n.getRoot(t.root),t.key,t.oldValue,t.newValue,t.baseVersion)}},{key:"className",get:function(){return"engine.model.operation.RootAttributeOperation"}}]),e}(Ff),Lh={};Lh[Vh.className]=Vh,Lh[Mh.className]=Mh,Lh[Fh.className]=Fh,Lh[Ih.className]=Ih,Lh[Ff.className]=Ff,Lh[Nh.className]=Nh,Lh[jh.className]=jh,Lh[Bh.className]=Bh,Lh[Dh.className]=Dh;var zh=function(){function t(){Fs(this,t)}return Ns(t,null,[{key:"fromJSON",value:function(t,e){return Lh[t.__className].fromJSON(t,e)}}]),t}(),qh=new Map,Hh=function(){function t(){Fs(this,t)}return Ns(t,null,[{key:"fromJSON",value:function(t,e){if(!qh.has(t.__className))throw new Qs("delta-fromjson-no-deserializer: This delta has no defined deserializer",{name:t.__className});var n=qh.get(t.__className),r=new n,i=!0,o=!1,a=void 0;try{for(var s,u=t.operations[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;r.addOperation(zh.fromJSON(l,e))}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}return r}},{key:"register",value:function(t){qh.set(t.className,t)}}]),t}(),$h=function(){function t(){Fs(this,t),this.batch=null,this.operations=[]}return Ns(t,[{key:"addOperation",value:function(t){return t.delta=this,this.operations.push(t),t}},{key:"clone",value:function(){var t=new this.constructor,e=!0,n=!1,r=void 0;try{for(var i,o=this.operations[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t.addOperation(a.clone())}}catch(t){n=!0,r=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw r}}return t}},{key:"getReversed",value:function(){var t=new this._reverseDeltaClass,e=!0,n=!1,r=void 0;try{for(var i,o=this.operations[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t.addOperation(a.getReversed())}}catch(t){n=!0,r=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw r}}t.operations.reverse();for(var s=0;s<t.operations.length;s++)t.operations[s].baseVersion=this.operations[this.operations.length-1].baseVersion+s+1;return t}},{key:"toJSON",value:function(){var t=Mn(this);return t.__className=this.constructor.className,delete t.batch,t}},{key:"baseVersion",get:function(){return this.operations.length>0?this.operations[0].baseVersion:null},set:function(t){var e=!0,n=!1,r=void 0;try{for(var i,o=this.operations[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;a.baseVersion=t++}}catch(t){n=!0,r=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw r}}}},{key:"_reverseDeltaClass",get:function(){return t}}],[{key:"className",get:function(){return"engine.model.delta.Delta"}},{key:"_priority",get:function(){return 0}}]),t}();Hh.register($h);var Kh=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";Fs(this,t),this.document=e,this.deltas=[],this.type=n}return Ns(t,[{key:"addDelta",value:function(t){return t.batch=this,this.deltas.push(t),t}},{key:"getOperations",value:regeneratorRuntime.mark(function t(){var e,n,r,i,o,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=!0,n=!1,r=void 0,t.prev=3,i=this.deltas[Symbol.iterator]();case 5:if(e=(o=i.next()).done){t.next=11;break}return a=o.value,t.delegateYield(a.operations,"t0",8);case 8:e=!0,t.next=5;break;case 11:t.next=17;break;case 13:t.prev=13,t.t1=t.catch(3),n=!0,r=t.t1;case 17:t.prev=17,t.prev=18,!e&&i.return&&i.return();case 20:if(t.prev=20,!n){t.next=23;break}throw r;case 23:return t.finish(20);case 24:return t.finish(17);case 25:case"end":return t.stop()}},t,this,[[3,13,17,25],[18,,20,24]])})},{key:"baseVersion",get:function(){return this.deltas.length>0?this.deltas[0].baseVersion:null}}]),t}(),Wh=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"key",get:function(){return this.operations[0]?this.operations[0].key:null}},{key:"value",get:function(){return this.operations[0]?this.operations[0].newValue:null}},{key:"range",get:function(){if(this._range)return this._range;var t=null,e=null,n=!0,r=!1,i=void 0;try{for(var o,a=this.operations[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;(null===t||t.isAfter(s.range.start))&&(t=s.range.start),(null===e||e.isBefore(s.range.end))&&(e=s.range.end)}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return t&&e?(this._range=new hl(t,e),this._range):null}},{key:"_reverseDeltaClass",get:function(){return e}}],[{key:"className",get:function(){return"engine.model.delta.AttributeDelta"}},{key:"_priority",get:function(){return 20}}]),e}($h),Jh=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,null,[{key:"className",get:function(){return"engine.model.delta.RootAttributeDelta"}}]),e}($h);Un("setAttribute",function(t,e,n){return Gn(this,e,n,t),this}),Un("removeAttribute",function(t,e){return Gn(this,e,null,t),this}),Hh.register(Wh),Hh.register(Jh);var Uh=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"howMany",get:function(){return this._moveOperation?this._moveOperation.howMany:null}},{key:"sourcePosition",get:function(){return this._moveOperation?this._moveOperation.sourcePosition:null}},{key:"targetPosition",get:function(){return this._moveOperation?this._moveOperation.targetPosition:null}},{key:"_moveOperation",get:function(){return this.operations[0]||null}},{key:"_reverseDeltaClass",get:function(){return e}}],[{key:"className",get:function(){return"engine.model.delta.MoveDelta"}},{key:"_priority",get:function(){return 20}}]),e}($h);Un("move",function(t,e){var n=new Uh;if(this.addDelta(n),t instanceof hl){if(!t.isFlat)throw new Qs("batch-move-range-not-flat: Range to move is not flat.");Xn(this,n,t.start,t.end.offset-t.start.offset,e)}else Xn(this,n,ll.createBefore(t),1,e);return this}),Hh.register(Uh);var Gh=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,null,[{key:"className",get:function(){return"engine.model.delta.RemoveDelta"}}]),e}(Uh);Un("remove",function(t){var e=new Gh;if(this.addDelta(e),t instanceof hl){var n=t.getMinimalFlatRanges().reverse(),r=!0,i=!1,o=void 0;try{for(var a,s=n[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;Zn(this,e,u.start,u.end.offset-u.start.offset)}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}}else Zn(this,e,ll.createBefore(t),1);return this}),Hh.register(Gh);var Yh=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"position",get:function(){return this._insertOperation?this._insertOperation.position:null}},{key:"nodes",get:function(){return this._insertOperation?this._insertOperation.nodes:null}},{key:"_insertOperation",get:function(){return this.operations[0]||null}},{key:"_reverseDeltaClass",get:function(){return Gh}}],[{key:"className",get:function(){return"engine.model.delta.InsertDelta"}},{key:"_priority",get:function(){return 20}}]),e}($h);Un("insert",function(t,e){var n=new Yh,r=new Mh(t,e,this.document.version);return this.addDelta(n),n.addOperation(r),this.document.applyOperation(r),this}),Hh.register(Yh);var Qh=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"getReversed",value:function(){var t=js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getReversed",this).call(this);return t.operations.length>0&&(t.operations[0].isSticky=!0),t}},{key:"position",get:function(){return this._moveOperation?this._moveOperation.sourcePosition:null}},{key:"_cloneOperation",get:function(){return this.operations[0]||null}},{key:"_moveOperation",get:function(){return this.operations[1]||null}},{key:"_reverseDeltaClass",get:function(){return Xh}}],[{key:"className",get:function(){return"engine.model.delta.SplitDelta"}},{key:"_priority",get:function(){return 5}}]),e}($h);Un("split",function(t){var e=new Qh;this.addDelta(e);var n=t.parent;if(!n.parent)throw new Qs("batch-split-root: Root element can not be split.");var r=new sl(n.name,n.getAttributes()),i=new Mh(ll.createAfter(n),r,this.document.version);e.addOperation(i),this.document.applyOperation(i);var o=new Fh(t,n.maxOffset-t.offset,ll.createFromParentAndOffset(r,0),this.document.version);return o.isSticky=!0,e.addOperation(o),this.document.applyOperation(o),this}),Hh.register(Qh);var Xh=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"getReversed",value:function(){var t=js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getReversed",this).call(this);return t.operations.length>0&&(t.operations[1].isSticky=!1),t}},{key:"position",get:function(){return this._removeOperation?this._removeOperation.sourcePosition:null}},{key:"_removeOperation",get:function(){return this.operations[1]||null}},{key:"_reverseDeltaClass",get:function(){return Qh}}],[{key:"className",get:function(){return"engine.model.delta.MergeDelta"}}]),e}($h);Un("merge",function(t){var e=new Xh;this.addDelta(e);var n=t.nodeBefore,r=t.nodeAfter;if(!(n instanceof sl))throw new Qs("batch-merge-no-element-before: Node before merge position must be an element.");if(!(r instanceof sl))throw new Qs("batch-merge-no-element-after: Node after merge position must be an element.");var i=ll.createFromParentAndOffset(r,0),o=ll.createFromParentAndOffset(n,n.maxOffset),a=new Fh(i,r.maxOffset,o,this.document.version);a.isSticky=!0,e.addOperation(a),this.document.applyOperation(a);var s=new jh(t,1,this.document.version);return e.addOperation(s),this.document.applyOperation(s),
this}),Hh.register(Xh);var Zh=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"_reverseDeltaClass",get:function(){return e}}],[{key:"className",get:function(){return"engine.model.delta.RenameDelta"}}]),e}($h);Un("rename",function(t,e){if(!(t instanceof sl))throw new Qs("batch-rename-not-element-instance: Trying to rename an object which is not an instance of Element.");var n=new Zh;return this.addDelta(n),tr(this,n,new Bh(ll.createBefore(t),t.name,e,this.document.version)),this}),Hh.register(Zh);var td=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"range",get:function(){var t=this._moveOperation;return t?hl.createFromPositionAndShift(t.sourcePosition,t.howMany):null}},{key:"howMany",get:function(){var t=this.range;return t?t.end.offset-t.start.offset:0}},{key:"_insertOperation",get:function(){return this.operations[0]||null}},{key:"_moveOperation",get:function(){return this.operations[1]||null}},{key:"_reverseDeltaClass",get:function(){return ed}}],[{key:"className",get:function(){return"engine.model.delta.WrapDelta"}},{key:"_priority",get:function(){return 10}}]),e}($h);Un("wrap",function(t,e){if(!t.isFlat)throw new Qs("batch-wrap-range-not-flat: Range to wrap is not flat.");var n=e instanceof sl?e:new sl(e);if(n.childCount>0)throw new Qs("batch-wrap-element-not-empty: Element to wrap with is not empty.");if(null!==n.parent)throw new Qs("batch-wrap-element-attached: Element to wrap with is already attached to tree model.");var r=new td;this.addDelta(r);var i=new Mh(t.end,n,this.document.version);r.addOperation(i),this.document.applyOperation(i);var o=ll.createFromParentAndOffset(n,0),a=new Fh(t.start,t.end.offset-t.start.offset,o,this.document.version);return r.addOperation(a),this.document.applyOperation(a),this}),Hh.register(td);var ed=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"position",get:function(){return this._moveOperation?this._moveOperation.targetPosition:null}},{key:"_moveOperation",get:function(){return this.operations[0]||null}},{key:"_reverseDeltaClass",get:function(){return td}}],[{key:"className",get:function(){return"engine.model.delta.UnwrapDelta"}},{key:"_priority",get:function(){return 10}}]),e}($h);Un("unwrap",function(t){if(null===t.parent)throw new Qs("batch-unwrap-element-no-parent: Trying to unwrap an element that has no parent.");var e=new ed;this.addDelta(e);var n=ll.createFromParentAndOffset(t,0),r=new Fh(n,t.maxOffset,ll.createBefore(t),this.document.version);r.isSticky=!0,e.addOperation(r),this.document.applyOperation(r);var i=new jh(ll.createBefore(t),1,this.document.version);return e.addOperation(i),this.document.applyOperation(i),this}),Hh.register(ed);var nd=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,null,[{key:"className",get:function(){return"engine.model.delta.WeakInsertDelta"}}]),e}(Yh);Un("weakInsert",function(t,e){var n=new nd;this.addDelta(n),e=se(e);var r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;u.setAttributesTo(this.document.selection.getAttributes())}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}var l=new Mh(t,e,this.document.version);return n.addOperation(l),this.document.applyOperation(l),this}),Hh.register(nd);var rd={InsertOperation:{InsertOperation:function(t,e,n){var r=t.clone();return r.position=r.position._getTransformedByInsertion(e.position,e.nodes.maxOffset,!n),[r]},AttributeOperation:nr,RootAttributeOperation:nr,RenameOperation:nr,MoveOperation:function(t,e,n){var r=t.clone();return r.position=t.position._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany,!n,e.isSticky),[r]}},AttributeOperation:{InsertOperation:function(t,e){var n=t.range._getTransformedByInsertion(e.position,e.nodes.maxOffset,!0,!1);return n.reverse().map(function(e){return new Vh(e,t.key,t.oldValue,t.newValue,t.baseVersion)})},AttributeOperation:function(t,e,n){if(t.key===e.key){var r=t.range.getDifference(e.range).map(function(e){return new Vh(e,t.key,t.oldValue,t.newValue,t.baseVersion)}),i=t.range.getIntersection(e.range);return i&&(n?r.push(new Vh(i,e.key,e.newValue,t.newValue,t.baseVersion)):0===r.length&&r.push(new Ih(0))),r}return[t.clone()]},RootAttributeOperation:nr,RenameOperation:nr,MoveOperation:function(t,e){var n=hl.createFromPositionAndShift(e.sourcePosition,e.howMany),r=[];e instanceof jh&&e._needsHolderElement&&t.range.root==e.targetPosition.root&&t.range.start.path[0]>=e._holderElementOffset&&(t=t.clone(),t.range.start.path[0]++,t.range.end.path[0]++);var i=or(t.range.getDifference(n)),o=t.range.getIntersection(n);return null!==i&&(i.start=i.start._getTransformedByDeletion(e.sourcePosition,e.howMany),i.end=i.end._getTransformedByDeletion(e.sourcePosition,e.howMany),r=i._getTransformedByInsertion(e.getMovedRangeStart(),e.howMany,!0,!1).reverse()),null!==o&&(o.start=o.start._getCombined(e.sourcePosition,e.getMovedRangeStart()),o.end=o.end._getCombined(e.sourcePosition,e.getMovedRangeStart()),r.push(o)),r.map(function(e){return new Vh(e,t.key,t.oldValue,t.newValue,t.baseVersion)})}},RootAttributeOperation:{InsertOperation:nr,AttributeOperation:nr,RootAttributeOperation:function(t,e,n){return t.root!==e.root||t.key!==e.key||(t.newValue===e.newValue||n)&&t.newValue!==e.newValue?[t.clone()]:[new Ih(t.baseVersion)]},RenameOperation:nr,MoveOperation:nr},RenameOperation:{InsertOperation:function(t,e){var n=t.clone();return n.position=n.position._getTransformedByInsertion(e.position,e.nodes.maxOffset,!0),[n]},AttributeOperation:nr,RootAttributeOperation:nr,RenameOperation:function(t,e,n){var r=t.clone();if(t.position.isEqual(e.position)){if(!n)return[new Ih(t.baseVersion)];r.oldName=e.newName}return[r]},MoveOperation:function(t,e){var n=t.clone(),r=n.position.isEqual(e.sourcePosition);return n.position=n.position._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany,!0,r),[n]}},MoveOperation:{InsertOperation:function(t,e,n){var r=hl.createFromPositionAndShift(t.sourcePosition,t.howMany);r=r._getTransformedByInsertion(e.position,e.nodes.maxOffset,!1,t.isSticky)[0];var i=new t.constructor(r.start,r.end.offset-r.start.offset,t instanceof jh?t.baseVersion:t.targetPosition._getTransformedByInsertion(e.position,e.nodes.maxOffset,!n),t instanceof jh?void 0:t.baseVersion);return i.isSticky=t.isSticky,i._holderElementOffset=t._holderElementOffset,[i]},AttributeOperation:nr,RootAttributeOperation:nr,RenameOperation:nr,MoveOperation:function(t,e,n){if(ir(t,e)&&ir(e,t))return[e.getReversed()];if(t instanceof jh&&e instanceof jh){var r=t.targetPosition.path[0],i=e.targetPosition.path[0];r>=i&&n&&(t=t.clone(),t.targetPosition.path[0]++)}t instanceof jh&&!(e instanceof jh)?n=!0:!(t instanceof jh)&&e instanceof jh&&(n=!1);var o=hl.createFromPositionAndShift(t.sourcePosition,t.howMany),a=hl.createFromPositionAndShift(e.sourcePosition,e.howMany),s=[],u=or(o.getDifference(a));u&&(u.start=u.start._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany,!t.isSticky,!1),u.end=u.end._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany,t.isSticky,!1),s.push(u));var l=o.getIntersection(a),c=tt(t.sourcePosition.getParentPath(),e.sourcePosition.getParentPath()),f=o.containsPosition(e.targetPosition)||o.start.isEqual(e.targetPosition)&&t.isSticky||o.end.isEqual(e.targetPosition)&&t.isSticky,h=a.containsRange(o)&&(a.containsPosition(t.targetPosition)||a.start.isEqual(t.targetPosition)||a.end.isEqual(t.targetPosition));if(null!==l&&("extension"===c||"same"===c&&n||h)&&!f&&(l.start=l.start._getCombined(e.sourcePosition,e.getMovedRangeStart()),l.end=l.end._getCombined(e.sourcePosition,e.getMovedRangeStart()),u&&o.start.isBefore(a.start)?s.push(l):s.unshift(l)),0===s.length)return t instanceof jh?(t=t.clone(),t.howMany=0,t.sourcePosition=e.targetPosition,[t]):[new Ih(t.baseVersion)];var d=t.targetPosition._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany,!n,e.isSticky||h);return s.reverse().map(function(e){var n=new t.constructor(e.start,e.end.offset-e.start.offset,t instanceof jh?t.baseVersion:d,t instanceof jh?void 0:t.baseVersion);return n.isSticky=t.isSticky,n._holderElementOffset=t._holderElementOffset,n})}}},id=Math.ceil,od=Math.max,ad=200,sd=A(function(t,e){return N(t)?br(t,cr(e,1,N,!0)):[]}),ud=1,ld=2,cd="[object Map]",fd="[object Set]",hd=Or(un),dd="Expected a function";Cr.Cache=en;var vd=1/0,yd=Ec?Ec.prototype:void 0,pd=yd?yd.toString:void 0,md=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]/g,gd=/\\(\\)?/g,bd=Cr(function(t){var e=[];return Er(t).replace(md,function(t,n,r,i){e.push(r?i.replace(gd,"$1"):n||t)}),e}),_d=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,wd=/^\w*$/,kd=1/0,xd=1,Od=2,Sd=A(function(t,e){var n=Z(e);return N(n)&&(n=void 0),N(t)?br(t,cr(e,1,N,!0),Hr(n)):[]}),Pd=A(function(t,e){var n=Z(e);return N(n)&&(n=void 0),N(t)?br(t,cr(e,1,N,!0),void 0,n):[]}),Ad=4294967295,Cd=1/0,Td=Math.max,Ed=Math.min,Rd=A(function(t){var e=pr(t,ci);return e.length&&e[0]===t[0]?li(e):[]}),Vd=A(function(t){var e=Z(t),n=pr(t,ci);return e===Z(n)?e=void 0:n.pop(),n.length&&n[0]===t[0]?li(n,Hr(e)):[]}),Fd=A(function(t){var e=Z(t),n=pr(t,ci);return e===Z(n)?e=void 0:n.pop(),n.length&&n[0]===t[0]?li(n,void 0,e):[]}),Nd=Array.prototype,jd=Nd.join,Md=Math.max,Id=Math.min,Bd=Array.prototype,Dd=Bd.splice,Ld=A(mi),zd=Array.prototype,qd=zd.splice,Hd=A(function(t,e){e=cr(e,1);var n=t?t.length:0,r=_i(t,e);return ki(t,pr(e,function(t){return _(t,n)?+t:t}).sort(xi)),r}),$d=Array.prototype,Kd=$d.reverse,Wd=4294967295,Jd=Wd-1,Ud=Math.floor,Gd=Math.min,Yd=4294967295,Qd=Yd>>>1,Xd=1/0,Zd=cc&&1/An(new cc([,-0]))[1]==Xd?function(t){return new cc(t)}:Hi,tv=200,ev=A(function(t){return $i(cr(t,1,N,!0))}),nv=A(function(t){var e=Z(t);return N(e)&&(e=void 0),$i(cr(t,1,N,!0),Hr(e))}),rv=A(function(t){var e=Z(t);return N(e)&&(e=void 0),$i(cr(t,1,N,!0),void 0,e)}),iv=Math.max,ov=A(function(t,e){return N(t)?br(t,e):[]}),av=A(function(t){return Qi(Ui(t,N))}),sv=A(function(t){var e=Z(t);return N(e)&&(e=void 0),Qi(Ui(t,N),Hr(e))}),uv=A(function(t){var e=Z(t);return N(e)&&(e=void 0),Qi(Ui(t,N),void 0,e)}),lv=A(Gi),cv=A(function(t){var e=t.length,n=e>1?t[e-1]:void 0;return n="function"==typeof n?(t.pop(),n):void 0,Yi(t,n)}),fv={chunk:sr,compact:ur,concat:fr,difference:sd,differenceBy:Sd,differenceWith:Pd,drop:$r,dropRight:Kr,dropRightWhile:Jr,dropWhile:Ur,fill:Xr,findIndex:ti,findLastIndex:ei,first:ni,flatten:ri,flattenDeep:ii,flattenDepth:oi,fromPairs:ai,head:ni,indexOf:si,initial:ui,intersection:Rd,intersectionBy:Vd,intersectionWith:Fd,join:fi,last:Z,lastIndexOf:hi,nth:vi,pull:Ld,pullAll:mi,pullAllBy:gi,pullAllWith:bi,pullAt:Hd,remove:Oi,reverse:Si,slice:Pi,sortedIndex:Ti,sortedIndexBy:Ei,sortedIndexOf:Ri,sortedLastIndex:Vi,sortedLastIndexBy:Fi,sortedLastIndexOf:Ni,sortedUniq:Mi,sortedUniqBy:Ii,tail:Bi,take:Di,takeRight:Li,takeRightWhile:zi,takeWhile:qi,union:ev,unionBy:nv,unionWith:rv,uniq:Ki,uniqBy:Wi,uniqWith:Ji,unzip:Gi,unzipWith:Yi,without:ov,xor:av,xorBy:sv,xorWith:uv,zip:lv,zipObject:Zi,zipObjectDeep:eo,zipWith:cv},hv=new Map;oo(Wh,nd,function(t,e,n){var r=io(t,e,n);return t.range.containsPosition(e.position)&&r.push(fo(e,t)),r}),oo(Wh,Qh,function(t,e,n){var r=new ll(e.position.root,e.position.path.slice(0,-1)),i=io(t,e,n),o=!0,a=!1,s=void 0;try{for(var u,l=t.operations[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value;if(c.range.containsPosition(r)||c.range.start.isEqual(r)){var f=new Wh,h=r.getShiftedBy(1),d=ll.createFromPosition(h);d.path.push(0);var v=e._cloneOperation.nodes.getNode(0).getAttribute(c.key);f.addOperation(new Vh(new hl(h,d),c.key,void 0===v?null:v,c.newValue,0)),i.push(f);break}}}catch(t){a=!0,s=t}finally{try{!o&&l.return&&l.return()}finally{if(a)throw s}}return i}),oo(Yh,Xh,function(t,e,n){return t.position.isEqual(e.position)?[e.getReversed(),t.clone()]:io(t,e,n)}),oo(Uh,Xh,function(t,e,n){var r=t.sourcePosition.root==e.position.root&&"same"===tt(t.sourcePosition.getParentPath(),e.position.getParentPath()),i=t.sourcePosition.offset<=e.position.offset&&t.sourcePosition.offset+t.howMany>e.position.offset;return r&&i?[e.getReversed(),t.clone()]:io(t,e,n)}),oo(Xh,Yh,function(t,e,n){return t.position.isEqual(e.position)?[ho()]:io(t,e,n)}),oo(Xh,Uh,function(t,e,n){var r=t.position.root==e.sourcePosition.root&&"same"===tt(t.position.getParentPath(),e.sourcePosition.getParentPath()),i=e.sourcePosition.offset<=t.position.offset&&e.sourcePosition.offset+e.howMany>t.position.offset;return r&&i?[ho()]:io(t,e,n)}),oo(Qh,Qh,function(t,e,n){var r=t.position.getParentPath(),i=e.position.getParentPath();if("same"==tt(r,i)){if(t.position.offset==e.position.offset)return[ho()];if(t.position.offset<e.position.offset){var o=t.clone();return o._moveOperation.howMany=e.position.offset-t.position.offset,t._cloneOperation instanceof Nh&&e._cloneOperation instanceof Nh&&t._cloneOperation.sourcePosition.offset>e._cloneOperation.sourcePosition.offset&&o._cloneOperation.sourcePosition.offset--,[o]}var a=t.clone();return a._cloneOperation.position.offset++,a._moveOperation.sourcePosition.path[a._moveOperation.sourcePosition.path.length-2]++,a._moveOperation.targetPosition.path[a._moveOperation.targetPosition.path.length-2]++,a._moveOperation.sourcePosition.offset=t.position.offset-e.position.offset,t._cloneOperation instanceof Nh&&e._cloneOperation instanceof Nh&&t._cloneOperation.sourcePosition.offset>e._cloneOperation.sourcePosition.offset&&a._cloneOperation.sourcePosition.offset--,[a]}return io(t,e,n)}),oo(Qh,ed,function(t,e,n){return"same"===tt(e.position.path,t.position.getParentPath())?[ho()]:io(t,e,n)}),oo(Qh,td,function(t,e,n){var r="same"===tt(t.position.getParentPath(),e.range.start.getParentPath()),i=e.range.start.offset<t.position.offset&&e.range.end.offset>=t.position.offset;if(r&&i)return[ho()];if("same"===tt(t.position.getParentPath(),e.range.end.getShiftedBy(-1).path)){var o=t.clone(),a=ll.createFromPosition(e.range.start);a.path.push(e.howMany-1);var s=a.getShiftedBy(1);o._cloneOperation.position=s;var u=ll.createFromPosition(a);u.path.push(t.position.offset),o._moveOperation.sourcePosition=u;var l=ll.createFromPosition(s);return l.path.push(0),o._moveOperation.targetPosition=l,[o]}return io(t,e,n)}),oo(Qh,Wh,function(t,e){t=t.clone();var n=new ll(t.position.root,t.position.path.slice(0,-1));if(t._cloneOperation instanceof Mh){var r=!0,i=!1,o=void 0;try{for(var a,s=e.operations[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;if(u.range.containsPosition(n)||u.range.start.isEqual(n)){null!==u.newValue?t._cloneOperation.nodes.getNode(0).setAttribute(u.key,u.newValue):t._cloneOperation.nodes.getNode(0).removeAttribute(u.key);break}}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}}return[t]}),oo(ed,Qh,function(t,e,n){if("same"===tt(t.position.path,e.position.getParentPath())){var r=[e.getReversed(),t.clone()];return r[1].operations[1].targetPosition.path[0]++,r}return io(t,e,n)}),oo(nd,Wh,function(t,e){var n=[t.clone()];return e.range.containsPosition(t.position)&&n.push(fo(t,e)),n}),oo(td,Qh,function(t,e,n){var r="same"===tt(t.range.start.getParentPath(),e.position.getParentPath()),i=t.range.start.offset<e.position.offset&&t.range.end.offset>=e.position.offset;if(r&&i)return[e.getReversed(),t.clone()];if("same"===tt(e.position.getParentPath(),t.range.end.getShiftedBy(-1).path)){var o=t.clone();return o._insertOperation.position.offset++,o._moveOperation.howMany++,o._moveOperation.targetPosition.path[o._moveOperation.targetPosition.path.length-2]++,[o]}return io(t,e,n)}),oo(Zh,Qh,function(t,e,n){var r=new ll(e.position.root,e.position.path.slice(0,-1)),i=io(t,e,n);if(t.operations[0].position.isEqual(r)){var o=t.clone();o.operations[0].position=t.operations[0].position.getShiftedBy(1),i.push(o)}return i}),oo(Qh,Zh,function(t,e){t=t.clone();var n=new ll(t.position.root,t.position.path.slice(0,-1));return t._cloneOperation instanceof Mh&&e.operations[0].position.isEqual(n)&&(t._cloneOperation.nodes.getNode(0).name=e.operations[0].newName),[t]}),oo(Gh,Qh,function(t,e,n){var r=io(t,e,n),i=e._cloneOperation.position,o=!0,a=!1,s=void 0;try{for(var u,l=r[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value,f=!0,h=!1,d=void 0;try{for(var v,y=c.operations[Symbol.iterator]();!(f=(v=y.next()).done);f=!0){var p=v.value,m=p.sourcePosition.getShiftedBy(p.howMany);m.isEqual(i)&&(p.howMany+=1)}}catch(t){h=!0,d=t}finally{try{!f&&y.return&&y.return()}finally{if(h)throw d}}}}catch(t){a=!0,s=t}finally{try{!o&&l.return&&l.return()}finally{if(a)throw s}}return r}),oo(Qh,Gh,function(t,e,n){e=e.clone();var r=t._cloneOperation.position,i=!0,o=!1,a=void 0;try{for(var s,u=e.operations[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value,c=l.sourcePosition.getShiftedBy(l.howMany);c.isEqual(r)&&(l.howMany+=1)}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}return io(t,e,n)});var dv=function(){function t(){Fs(this,t),this._deltas=[],this._historyPoints=new Map}return Ns(t,[{key:"addDelta",value:function(t){if(t.operations.length>0&&!this._historyPoints.has(t.baseVersion)){var e=this._deltas.length;this._deltas[e]=t,this._historyPoints.set(t.baseVersion,e)}}},{key:"getDeltas",value:regeneratorRuntime.mark(function t(){var e,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.POSITIVE_INFINITY;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==this._deltas.length){t.next=2;break}return t.abrupt("return");case 2:if(e=this._getIndex(r),e!=-1){t.next=5;break}return t.abrupt("return");case 5:if(!(e<this._deltas.length)){t.next=13;break}if(n=this._deltas[e++],!(n.baseVersion>=i)){t.next=9;break}return t.abrupt("break",13);case 9:return t.next=11,n;case 11:t.next=5;break;case 13:case"end":return t.stop()}},t,this)})},{key:"getDelta",value:function(t){var e=this._historyPoints.get(t);if(void 0===e)return null;var n=[];for(e;e<this._deltas.length;e++){var r=this._deltas[e];if(r.baseVersion!=t)break;n.push(r)}return 0===n.length?null:n}},{key:"removeDelta",value:function(t){this.updateDelta(t,[])}},{key:"updateDelta",value:function(t,e){var n,r=this.getDelta(t);if(null!==r){var i=!0,o=!1,a=void 0;try{for(var s,u=e[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;l.baseVersion=t}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}(n=this._deltas).splice.apply(n,[this._getIndex(t),r.length].concat(Ds(e)));var c=e.length-r.length,f=!0,h=!1,d=void 0;try{for(var v,y=this._historyPoints.keys()[Symbol.iterator]();!(f=(v=y.next()).done);f=!0){var p=v.value;p>t&&this._historyPoints.set(p,this._historyPoints.get(p)+c)}}catch(t){h=!0,d=t}finally{try{!f&&y.return&&y.return()}finally{if(h)throw d}}}}},{key:"_getIndex",value:function(t){var e=this._historyPoints.get(t);if(void 0===e){var n=this._deltas[this._deltas.length-1],r=n.baseVersion+n.operations.length;if(t<0||t>=r)return-1;throw new Qs("model-history-wrong-version: Given base version points to the middle of a delta.")}return e}}]),t}(),vv=function(t){function e(t,n){Fs(this,e);var r=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return vo.call(r),r}return Ms(e,t),Ns(e,[{key:"detach",value:function(){this.stopListening()}}]),e}(hl);J(vv,qs);var yv=function(){function t(){Fs(this,t),this._lastRangeBackward=!1,this._ranges=[],this._attrs=new Map}return Ns(t,[{key:"isEqual",value:function(t){if(this.rangeCount!=t.rangeCount)return!1;if(0===this.rangeCount)return!0;if(!this.anchor.isEqual(t.anchor)||!this.focus.isEqual(t.focus))return!1;var e=!0,n=!1,r=void 0;try{for(var i,o=this._ranges[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value,s=!1,u=!0,l=!1,c=void 0;try{for(var f,h=t._ranges[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var d=f.value;if(a.isEqual(d)){s=!0;break}}}catch(t){l=!0,c=t}finally{try{!u&&h.return&&h.return()}finally{if(l)throw c}}if(!s)return!1}}catch(t){n=!0,r=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw r}}return!0}},{key:"getRanges",value:regeneratorRuntime.mark(function t(){var e,n,r,i,o,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=!0,n=!1,r=void 0,t.prev=3,i=this._ranges[Symbol.iterator]();case 5:if(e=(o=i.next()).done){t.next=12;break}return a=o.value,t.next=9,hl.createFromRange(a);case 9:e=!0,t.next=5;break;case 12:t.next=18;break;case 14:t.prev=14,t.t0=t.catch(3),n=!0,r=t.t0;case 18:t.prev=18,t.prev=19,!e&&i.return&&i.return();case 21:if(t.prev=21,!n){t.next=24;break}throw r;case 24:return t.finish(21);case 25:return t.finish(18);case 26:case"end":return t.stop()}},t,this,[[3,14,18,26],[19,,21,25]])})},{key:"getFirstRange",value:function(){var t=null,e=!0,n=!1,r=void 0;try{for(var i,o=this._ranges[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t&&!a.start.isBefore(t.start)||(t=a)}}catch(t){n=!0,r=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw r}}return t?hl.createFromRange(t):null}},{key:"getLastRange",value:function(){var t=null,e=!0,n=!1,r=void 0;try{for(var i,o=this._ranges[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t&&!a.end.isAfter(t.end)||(t=a)}}catch(t){n=!0,r=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw r}}return t?hl.createFromRange(t):null}},{key:"getFirstPosition",value:function(){var t=this.getFirstRange();return t?ll.createFromPosition(t.start):null}},{key:"getLastPosition",value:function(){var t=this.getLastRange();return t?ll.createFromPosition(t.end):null}},{key:"addRange",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._pushRange(t),this._lastRangeBackward=!!e,this.fire("change:range",{directChange:!0})}},{key:"removeAllRanges",value:function(){this._ranges.length>0&&(this._removeAllRanges(),this.fire("change:range",{directChange:!0}))}},{key:"setRanges",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t=Array.from(t);var r=t.some(function(t){if(!(t instanceof hl))throw new Qs("model-selection-added-not-range: Trying to add an object that is not an instance of Range.");return e._ranges.every(function(e){return!e.isEqual(t)})});if(t.length!==this._ranges.length||r){this._removeAllRanges();var i=!0,o=!1,a=void 0;try{for(var s,u=t[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;this._pushRange(l)}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}this._lastRangeBackward=!!n,this.fire("change:range",{directChange:!0})}}},{key:"setTo",value:function(t){this.setRanges(t.getRanges(),t.isBackward)}},{key:"collapse",value:function(t,e){var n=ll.createAt(t,e),r=new hl(n,n);this.setRanges([r])}},{key:"collapseToStart",value:function(){var t=this.getFirstPosition();null!==t&&this.setRanges([new hl(t,t)])}},{key:"collapseToEnd",value:function(){var t=this.getLastPosition();null!==t&&this.setRanges([new hl(t,t)])}},{key:"setFocus",value:function(t,e){if(null===this.anchor)throw new Qs("model-selection-setFocus-no-ranges: Cannot set selection focus if there are no ranges in selection.");var n=ll.createAt(t,e);if("same"!=n.compareWith(this.focus)){var r=this.anchor;this._ranges.length&&this._popRange(),"before"==n.compareWith(r)?this.addRange(new hl(n,r),!0):this.addRange(new hl(r,n))}}},{key:"getAttribute",value:function(t){return this._attrs.get(t)}},{key:"getAttributes",value:function(){return this._attrs.entries()}},{key:"getAttributeKeys",value:function(){return this._attrs.keys()}},{key:"hasAttribute",value:function(t){return this._attrs.has(t)}},{key:"clearAttributes",value:function(){if(this._attrs.size>0){var t=Array.from(this._attrs.keys());this._attrs.clear(),this.fire("change:attribute",{attributeKeys:t,directChange:!0})}}},{key:"removeAttribute",value:function(t){this.hasAttribute(t)&&(this._attrs.delete(t),this.fire("change:attribute",{attributeKeys:[t],directChange:!0}))}},{key:"setAttribute",value:function(t,e){this.getAttribute(t)!==e&&(this._attrs.set(t,e),this.fire("change:attribute",{attributeKeys:[t],directChange:!0}))}},{key:"setAttributesTo",value:function(t){if(t=G(t),!po(t,this._attrs)){var e=new Set(Array.from(t.keys()).concat(Array.from(this._attrs.keys()))),n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=Bs(o.value,2),u=s[0],l=s[1];this._attrs.get(u)===l&&e.delete(u)}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}this._attrs=t,this.fire("change:attribute",{attributeKeys:Array.from(e),directChange:!0})}}},{key:"getSelectedElement",value:function(){if(1!==this.rangeCount)return null;var t=this.getFirstRange(),e=t.start.nodeAfter,n=t.end.nodeBefore;return e instanceof sl&&e==n?e:null}},{key:"_pushRange",value:function(t){if(!(t instanceof hl))throw new Qs("model-selection-added-not-range: Trying to add an object that is not an instance of Range.");this._checkRange(t),this._ranges.push(hl.createFromRange(t))}},{key:"_checkRange",value:function(t){for(var e=0;e<this._ranges.length;e++)if(t.isIntersecting(this._ranges[e]))throw new Qs("model-selection-range-intersects: Trying to add a range that intersects with another range from selection.",{addedRange:t,intersectingRange:this._ranges[e]})}},{key:"_popRange",value:function(){this._ranges.pop()}},{key:"_removeAllRanges",value:function(){for(;this._ranges.length>0;)this._popRange()}},{key:"anchor",get:function(){if(this._ranges.length>0){var t=this._ranges[this._ranges.length-1];return this._lastRangeBackward?t.end:t.start}return null}},{key:"focus",get:function(){if(this._ranges.length>0){var t=this._ranges[this._ranges.length-1];return this._lastRangeBackward?t.start:t.end}return null}},{key:"isCollapsed",get:function(){var t=this._ranges.length;return 1===t&&this._ranges[0].isCollapsed}},{key:"rangeCount",get:function(){return this._ranges.length}},{key:"isBackward",get:function(){return!this.isCollapsed&&this._lastRangeBackward}}],[{key:"createFromSelection",value:function(t){var e=new this;return e.setTo(t),e}}]),t}();J(yv,qs);var pv="selection:",mv=new Set(["addAttribute","removeAttribute","changeAttribute","addRootAttribute","removeRootAttribute","changeRootAttribute"]),gv=function(t){function e(t){Fs(this,e);var n=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n._document=t,n._attributePriority=new Map,n.listenTo(n._document,"change",function(t,e){mv.has(e)&&n._updateAttributes(!1)}),n}return Ms(e,t),Ns(e,[{key:"destroy",value:function(){for(var t=0;t<this._ranges.length;t++)this._ranges[t].detach();this.stopListening()}},{key:"getRanges",value:regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._ranges.length){t.next=4;break}return t.delegateYield(js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getRanges",this).call(this),"t0",2);case 2:t.next=6;break;case 4:return t.next=6,this._document._getDefaultRange();case 6:case"end":return t.stop()}},t,this)})},{key:"getFirstRange",value:function(){return js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getFirstRange",this).call(this)||this._document._getDefaultRange()}},{key:"getLastRange",value:function(){return js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getLastRange",this).call(this)||this._document._getDefaultRange()}},{key:"addRange",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"addRange",this).call(this,t,n),this.refreshAttributes()}},{key:"removeAllRanges",value:function(){js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removeAllRanges",this).call(this),this.refreshAttributes()}},{key:"setRanges",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setRanges",this).call(this,t,n),this.refreshAttributes()}},{key:"setAttribute",value:function(t,e){if(this.isCollapsed&&0===this.anchor.parent.childCount&&this._storeAttribute(t,e),this._setAttribute(t,e)){var n=[t];this.fire("change:attribute",{attributeKeys:n,directChange:!0})}}},{key:"removeAttribute",value:function(t){if(this.isCollapsed&&0===this.anchor.parent.childCount&&this._removeStoredAttribute(t),this._removeAttribute(t)){var e=[t];this.fire("change:attribute",{attributeKeys:e,directChange:!0})}}},{key:"setAttributesTo",value:function(t){t=G(t),this.isCollapsed&&0===this.anchor.parent.childCount&&this._setStoredAttributesTo(t);var e=this._setAttributesTo(t);if(e.size>0){var n=Array.from(e);this.fire("change:attribute",{attributeKeys:n,directChange:!0})}}},{key:"clearAttributes",value:function(){this.setAttributesTo([])}},{key:"refreshAttributes",value:function(){this._updateAttributes(!0)}},{key:"_popRange",value:function(){this._ranges.pop().detach()}},{key:"_pushRange",value:function(t){var e=this._prepareRange(t);e&&this._ranges.push(e)}},{key:"_prepareRange",value:function(t){var e=this;if(!(t instanceof hl))throw new Qs("model-selection-added-not-range: Trying to add an object that is not an instance of Range.");if(t.root==this._document.graveyard)return void el.warn("model-selection-range-in-graveyard: Trying to add a Range that is in the graveyard root. Range rejected.");this._checkRange(t);var n=vv.createFromRange(t);return this.listenTo(n,"change",function(t,r){n.root==e._document.graveyard&&e._fixGraveyardSelection(n,r),e.fire("change:range",{directChange:!1})}),n}},{key:"_updateAttributes",value:function(t){var e=G(this._getSurroundingAttributes()),n=G(this.getAttributes());if(t)this._attributePriority=new Map,this._attrs=new Map;else{var r=!0,i=!1,o=void 0;try{for(var a,s=this._attributePriority[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=Bs(a.value,2),l=u[0],c=u[1];"low"==c&&(this._attrs.delete(l),this._attributePriority.delete(l))}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}}this._setAttributesTo(e,!1);var f=[],h=!0,d=!1,v=void 0;try{for(var y,p=this.getAttributes()[Symbol.iterator]();!(h=(y=p.next()).done);h=!0){var m=Bs(y.value,2),g=m[0],b=m[1];n.has(g)&&n.get(g)===b||f.push(g)}}catch(t){d=!0,v=t}finally{try{!h&&p.return&&p.return()}finally{if(d)throw v}}var _=!0,w=!1,k=void 0;try{for(var x,O=n[Symbol.iterator]();!(_=(x=O.next()).done);_=!0){var S=Bs(x.value,1),P=S[0];this.hasAttribute(P)||f.push(P)}}catch(t){w=!0,k=t}finally{try{!_&&O.return&&O.return()}finally{if(w)throw k}}f.length>0&&this.fire("change:attribute",{attributeKeys:f,directChange:!1})}},{key:"_setAttribute",value:function(t,n){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=r?"normal":"low";if("low"==i&&"normal"==this._attributePriority.get(t))return!1;var o=js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getAttribute",this).call(this,t);return o!==n&&(this._attrs.set(t,n),this._attributePriority.set(t,i),!0)}},{key:"_removeAttribute",value:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=n?"normal":"low";return("low"!=r||"normal"!=this._attributePriority.get(t))&&(!!js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"hasAttribute",this).call(this,t)&&(this._attrs.delete(t),this._attributePriority.set(t,r),!0))}},{key:"_setAttributesTo",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=new Set,r=!0,i=!1,o=void 0;try{for(var a,s=this.getAttributes()[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=Bs(a.value,2),l=u[0],c=u[1];t.get(l)!==c&&this._removeAttribute(l,e)&&n.add(l)}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}var f=!0,h=!1,d=void 0;try{for(var v,y=t[Symbol.iterator]();!(f=(v=y.next()).done);f=!0){
var p=Bs(v.value,2),m=p[0],g=p[1],b=this._setAttribute(m,g,e);b&&n.add(m)}}catch(t){h=!0,d=t}finally{try{!f&&y.return&&y.return()}finally{if(h)throw d}}return n}},{key:"_getStoredAttributes",value:regeneratorRuntime.mark(function t(){var e,n,r,i,o,a,s,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.getFirstPosition().parent,!this.isCollapsed||0!==e.childCount){t.next=30;break}n=!0,r=!1,i=void 0,t.prev=5,o=e.getAttributeKeys()[Symbol.iterator]();case 7:if(n=(a=o.next()).done){t.next=16;break}if(s=a.value,0!==s.indexOf(pv)){t.next=13;break}return u=s.substr(pv.length),t.next=13,[u,e.getAttribute(s)];case 13:n=!0,t.next=7;break;case 16:t.next=22;break;case 18:t.prev=18,t.t0=t.catch(5),r=!0,i=t.t0;case 22:t.prev=22,t.prev=23,!n&&o.return&&o.return();case 25:if(t.prev=25,!r){t.next=28;break}throw i;case 28:return t.finish(25);case 29:return t.finish(22);case 30:case"end":return t.stop()}},t,this,[[5,18,22,30],[23,,25,29]])})},{key:"_removeStoredAttribute",value:function(t){var n=e._getStoreAttributeKey(t);this._document.batch().removeAttribute(this.anchor.parent,n)}},{key:"_storeAttribute",value:function(t,n){var r=e._getStoreAttributeKey(t);this._document.batch().setAttribute(this.anchor.parent,r,n)}},{key:"_setStoredAttributesTo",value:function(t){var n=this.anchor.parent,r=this._document.batch(),i=!0,o=!1,a=void 0;try{for(var s,u=this._getStoredAttributes()[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=Bs(s.value,1),c=l[0],f=e._getStoreAttributeKey(c);r.removeAttribute(n,f)}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}var h=!0,d=!1,v=void 0;try{for(var y,p=t[Symbol.iterator]();!(h=(y=p.next()).done);h=!0){var m=Bs(y.value,2),g=m[0],b=m[1],_=e._getStoreAttributeKey(g);r.setAttribute(n,_,b)}}catch(t){d=!0,v=t}finally{try{!h&&p.return&&p.return()}finally{if(d)throw v}}}},{key:"_getSurroundingAttributes",value:function(){var t=this.getFirstPosition(),e=null;if(this.isCollapsed){var n=t.textNode?t.textNode:t.nodeBefore,r=t.textNode?t.textNode:t.nodeAfter;if(e=mo(n),e||(e=mo(r)),!e)for(var i=n;i&&!e;)i=i.previousSibling,e=mo(i);if(!e)for(var o=r;o&&!e;)o=o.nextSibling,e=mo(o);e||(e=this._getStoredAttributes())}else{var a=this.getFirstRange(),s=!0,u=!1,l=void 0;try{for(var c,f=a[Symbol.iterator]();!(s=(c=f.next()).done);s=!0){var h=c.value;"text"==h.type&&null===e&&(e=h.item.getAttributes())}}catch(t){u=!0,l=t}finally{try{!s&&f.return&&f.return()}finally{if(u)throw l}}}return e}},{key:"_fixGraveyardSelection",value:function(t,e){var n=t.start.path,r=e.start.path.length-(n.length-2),i=e.start.path.slice(0,r);i[i.length-1]-=n[1];var o=new ll(e.root,i),a=this._document.getNearestSelectionRange(o);a||(a=new hl(new ll(o.root,[0])));var s=this._prepareRange(a),u=this._ranges.indexOf(t);this._ranges.splice(u,1,s),t.detach()}},{key:"isCollapsed",get:function(){var t=this._ranges.length;return 0===t||js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"isCollapsed",this)}},{key:"anchor",get:function(){return js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"anchor",this)||this._document._getDefaultRange().start}},{key:"focus",get:function(){return js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"focus",this)||this._document._getDefaultRange().start}},{key:"rangeCount",get:function(){return this._ranges.length?this._ranges.length:1}}],[{key:"createFromSelection",value:function(t){var e=new this(t._document);return e.setTo(t),e}},{key:"_getStoreAttributeKey",value:function(t){return pv+t}}]),e}(yv),bv=function(){function t(){Fs(this,t),this.objects=new Set,this._items=new Map,this._extensionChains=new Map,this.registerItem("$root"),this.registerItem("$block"),this.registerItem("$inline"),this.registerItem("$text","$inline"),this.allow({name:"$block",inside:"$root"}),this.allow({name:"$inline",inside:"$block"}),this.registerItem("$clipboardHolder","$root"),this.allow({name:"$inline",inside:"$clipboardHolder"})}return Ns(t,[{key:"allow",value:function(e){this._getItem(e.name).allow(t._normalizeQueryPath(e.inside),e.attributes)}},{key:"disallow",value:function(e){this._getItem(e.name).disallow(t._normalizeQueryPath(e.inside),e.attributes)}},{key:"requireAttributes",value:function(t,e){this._getItem(t).requireAttributes(e)}},{key:"check",value:function(e){var n=this;if(!this.hasItem(e.name))return!1;Lu(e.attributes)?0===e.attributes.length&&e.attributes.push(void 0):e.attributes=[e.attributes];var r=t._normalizeQueryPath(e.inside),i=this._extensionChains.get(e.name).map(function(t){return n._getItem(t)});if(!this._getItem(e.name)._checkRequiredAttributes(e.attributes))return!1;var o=!0,a=!1,s=void 0;try{for(var u,l=e.attributes[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value,f=!0,h=!1,d=void 0;try{for(var v,y=i[Symbol.iterator]();!(f=(v=y.next()).done);f=!0){var p=v.value;if(p._hasMatchingPath("disallow",r,c))return!1}}catch(t){h=!0,d=t}finally{try{!f&&y.return&&y.return()}finally{if(h)throw d}}}}catch(t){a=!0,s=t}finally{try{!o&&l.return&&l.return()}finally{if(a)throw s}}var m=!0,g=!1,b=void 0;try{for(var _,w=e.attributes[Symbol.iterator]();!(m=(_=w.next()).done);m=!0){var k=_.value,x=!1,O=!0,S=!1,P=void 0;try{for(var A,C=i[Symbol.iterator]();!(O=(A=C.next()).done);O=!0){var T=A.value;if(T._hasMatchingPath("allow",r,k)){x=!0;break}}}catch(t){S=!0,P=t}finally{try{!O&&C.return&&C.return()}finally{if(S)throw P}}if(!x)return!1}}catch(t){g=!0,b=t}finally{try{!m&&w.return&&w.return()}finally{if(g)throw b}}return!0}},{key:"hasItem",value:function(t){return this._items.has(t)}},{key:"registerItem",value:function(t,e){if(this.hasItem(t))throw new Qs("model-schema-item-exists: Item with specified name already exists in schema.");if(e&&!this.hasItem(e))throw new Qs("model-schema-no-item: Item with specified name does not exist in schema.");this._items.set(t,new _v(this));var n=this.hasItem(e)?this._extensionChains.get(e).concat(t):[t];this._extensionChains.set(t,n)}},{key:"itemExtends",value:function(t,e){if(!this.hasItem(t)||!this.hasItem(e))throw new Qs("model-schema-no-item: Item with specified name does not exist in schema.");var n=this._extensionChains.get(t);return n.some(function(t){return t==e})}},{key:"_getItem",value:function(t){if(!this.hasItem(t))throw new Qs("model-schema-no-item: Item with specified name does not exist in schema.");return this._items.get(t)}}],[{key:"_normalizeQueryPath",value:function(t){var e=[];if(Lu(t)){var n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;s instanceof sl?e.push(s.name):M(s)&&e.push(s)}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}}else if(t instanceof ll){for(var u=t.parent;null!==u;)e.push(u.name),u=u.parent;e.reverse()}else M(t)&&(e=t.split(" "));return e}}]),t}(),_v=function(){function t(e){Fs(this,t),this._schema=e,this._allowed=[],this._disallowed=[],this._requiredAttributes=[]}return Ns(t,[{key:"allow",value:function(t,e){this._addPath("_allowed",t,e)}},{key:"disallow",value:function(t,e){this._addPath("_disallowed",t,e)}},{key:"requireAttributes",value:function(t){this._requiredAttributes.push(t)}},{key:"_addPath",value:function(t,e,n){e=e.slice(),Lu(n)||(n=[n]);var r=!0,i=!1,o=void 0;try{for(var a,s=n[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;this[t].push({path:e,attribute:u})}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}}},{key:"_getPaths",value:function(t,e){var n="allow"===t?this._allowed:this._disallowed,r=[],i=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;l.attribute===e&&r.push(l.path)}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}return r}},{key:"_checkRequiredAttributes",value:function(t){var e=!0,n=!0,r=!1,i=void 0;try{for(var o,a=this._requiredAttributes[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;e=!0;var u=!0,l=!1,c=void 0;try{for(var f,h=s[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var d=f.value;if(t.indexOf(d)==-1){e=!1;break}}}catch(t){l=!0,c=t}finally{try{!u&&h.return&&h.return()}finally{if(l)throw c}}if(e)break}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return e}},{key:"_hasMatchingPath",value:function(t,e,n){var r=this._getPaths(t,n),i=!0,o=!1,a=void 0;try{for(var s,u=r[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;if(go(this._schema,e,l))return!0}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}return!1}},{key:"toJSON",value:function(){var t=Mn(this);return t._schema="[model.Schema]",t}}]),t}(),wv=function(){function t(){Fs(this,t),this._nameToRange=new Map}return Ns(t,[{key:Symbol.iterator,value:function(){return this._nameToRange.entries()}},{key:"add",value:function(t,e){if(this._nameToRange.has(t))throw new Qs("markers-collection-add-name-exists: Marker with given name is already added.");if(!(e instanceof vv))throw new Qs("markers-collection-add-range-not-live-range: Added range is not an instance of LiveRange.");this._nameToRange.set(t,e),this.fire("add",t,hl.createFromRange(e))}},{key:"get",value:function(t){return this._nameToRange.get(t)||null}},{key:"remove",value:function(t){var e=this._nameToRange.get(t);return!!e&&(this._nameToRange.delete(t),this.fire("remove",t,hl.createFromRange(e)),!0)}},{key:"update",value:function(t,e){var n=this.remove(t);return n&&this.add(t,e),n}},{key:"destroy",value:function(){this.stopListening()}}]),t}();J(wv,qs);var kv=[_o].map(regeneratorRuntime.mark),xv="$graveyard",Ov=function(){function t(){var e=this;Fs(this,t),this.version=0,this.selection=new gv(this),this.schema=new bv,this.history=new dv(this),this.markers=new wv,this._pendingChanges=[],this._roots=new Map,this.selection.on("change:range",function(){var t=!0,n=!1,r=void 0;try{for(var i,o=e.selection.getRanges()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if(!e._validateSelectionRange(a))throw new Qs("document-selection-wrong-position: Range from document selection starts or ends at incorrect position.",{range:a})}}catch(t){n=!0,r=t}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}),this.createRoot("$root",xv)}return Ns(t,[{key:"applyOperation",value:function(t){if(t.baseVersion!==this.version)throw new Qs("model-document-applyOperation-wrong-version: Only operations with matching versions can be applied.",{operation:t});var e=t._execute();this.version++,this.history.addDelta(t.delta);var n=t.delta&&t.delta.batch;e&&this.fire("change",t.type,e,n)}},{key:"batch",value:function(t){return new Kh(this,t)}},{key:"createRoot",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"$root",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"main";if(this._roots.has(e))throw new Qs("model-document-createRoot-name-exists: Root with specified name already exists.",{name:e});var n=new jl(this,t,e);return this._roots.set(e,n),n}},{key:"destroy",value:function(){this.selection.destroy(),this.stopListening()}},{key:"enqueueChanges",value:function(t){if(this._pendingChanges.push(t),1==this._pendingChanges.length){for(;this._pendingChanges.length;)this._pendingChanges[0](),this._pendingChanges.shift();this.fire("changesDone")}}},{key:"getRoot",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";if(!this._roots.has(t))throw new Qs("model-document-getRoot-root-not-exist: Root with specified name does not exist.",{name:t});return this._roots.get(t)}},{key:"hasRoot",value:function(t){return this._roots.has(t)}},{key:"getRootNames",value:function(){return Array.from(this._roots.keys()).filter(function(t){return t!=xv})}},{key:"getNearestSelectionRange",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"both";if(this.schema.check({name:"$text",inside:t}))return new hl(t);var n=void 0,r=void 0;"both"!=e&&"backward"!=e||(n=new fl({startPosition:t,direction:"backward"})),"both"!=e&&"forward"!=e||(r=new fl({startPosition:t}));var i=!0,o=!1,a=void 0;try{for(var s,u=_o(n,r)[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value,c=l.walker==n?"elementEnd":"elementStart",f=l.value;if(f.type==c&&this.schema.objects.has(f.item.name))return hl.createOn(f.item);if(this.schema.check({name:"$text",inside:f.nextPosition}))return new hl(f.nextPosition)}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}return null}},{key:"toJSON",value:function(){var t=Mn(this);return t.selection="[engine.model.LiveSelection]",t}},{key:"_getDefaultRoot",value:function(){var t=!0,e=!1,n=void 0;try{for(var r,i=this._roots.values()[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var o=r.value;if(o!==this.graveyard)return o}}catch(t){e=!0,n=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw n}}return this.graveyard}},{key:"_getDefaultRange",value:function(){var t=this._getDefaultRoot(),e=new ll(t,[0]),n=this.getNearestSelectionRange(e);return n||new hl(e)}},{key:"_validateSelectionRange",value:function(t){return bo(t.start)&&bo(t.end)}},{key:"graveyard",get:function(){return this.getRoot(xv)}}]),t}();J(Ov,qs);var Sv=function(){function t(e){Fs(this,t),this.config=new Ys(e),this.plugins=new nl(this),this.commands=new Map,this.locale=new rl(this.config.get("lang")),this.t=this.locale.t,this.document=new Ov,this.data=new Bl(this.document)}return Ns(t,[{key:"initPlugins",value:function t(){function e(){return r.plugins.load(i.get("plugins")||[])}function t(t,e){return t.reduce(function(t,n){return t.then(n[e].bind(n))},Promise.resolve())}var n=this,r=this,i=this.config;return e().then(function(e){return t(e,"init").then(function(){return t(e,"afterInit")})}).then(function(){return n.fire("pluginsReady")})}},{key:"destroy",value:function(){var t=this;return this.fire("destroy"),this.stopListening(),Promise.resolve().then(function(){t.document.destroy(),t.data.destroy()})}},{key:"execute",value:function(t,e){var n=this.commands.get(t);if(!n)throw new Qs("editor-command-not-found: Specified command has not been added to the editor.");n._execute(e)}}],[{key:"create",value:function(t){var e=this;return new Promise(function(n){var r=new e(t);n(r.initPlugins().then(function(){r.fire("dataReady"),r.fire("ready")}).then(function(){return r}))})}}]),t}();J(Sv,qs);var Pv=navigator.userAgent.toLowerCase(),Av={mac:wo(Pv)},Cv=So(),Tv=function(){function t(e){var n=this;Fs(this,t),this.editor=e,this._listener=Object.create(qs),this._keystrokes=new Map,this._listener.listenTo(e.editing.view,"keydown",function(t,e){var r=n.press(e);r&&e.preventDefault()})}return Ns(t,[{key:"set",value:function(t,e){this._keystrokes.set(xo(t),e)}},{key:"press",value:function(t){var e=ko(t),n=this._keystrokes.get(e);return!!n&&("string"==typeof n?this.editor.execute(n):n(t),!0)}},{key:"destroy",value:function(){this._keystrokes=new Map,this._listener.stopListening()}}]),t}(),Ev=function(){function t(){Fs(this,t),this._ranges=[],this._lastRangeBackward=!1,this._isFake=!1,this._fakeSelectionLabel=""}return Ns(t,[{key:"setFake",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._isFake=t,this._fakeSelectionLabel=t?e.label||"":"",this.fire("change")}},{key:"addRange",value:function(t,e){if(!(t instanceof kl))throw new Qs("view-selection-invalid-range: Invalid Range.");this._pushRange(t),this._lastRangeBackward=!!e,this.fire("change")}},{key:"getRanges",value:regeneratorRuntime.mark(function t(){var e,n,r,i,o,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=!0,n=!1,r=void 0,t.prev=3,i=this._ranges[Symbol.iterator]();case 5:if(e=(o=i.next()).done){t.next=12;break}return a=o.value,t.next=9,kl.createFromRange(a);case 9:e=!0,t.next=5;break;case 12:t.next=18;break;case 14:t.prev=14,t.t0=t.catch(3),n=!0,r=t.t0;case 18:t.prev=18,t.prev=19,!e&&i.return&&i.return();case 21:if(t.prev=21,!n){t.next=24;break}throw r;case 24:return t.finish(21);case 25:return t.finish(18);case 26:case"end":return t.stop()}},t,this,[[3,14,18,26],[19,,21,25]])})},{key:"getFirstRange",value:function(){var t=null,e=!0,n=!1,r=void 0;try{for(var i,o=this._ranges[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t&&!a.start.isBefore(t.start)||(t=a)}}catch(t){n=!0,r=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw r}}return t?kl.createFromRange(t):null}},{key:"getLastRange",value:function(){var t=null,e=!0,n=!1,r=void 0;try{for(var i,o=this._ranges[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t&&!a.end.isAfter(t.end)||(t=a)}}catch(t){n=!0,r=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw r}}return t?kl.createFromRange(t):null}},{key:"getFirstPosition",value:function(){var t=this.getFirstRange();return t?_l.createFromPosition(t.start):null}},{key:"getLastPosition",value:function(){var t=this.getLastRange();return t?_l.createFromPosition(t.end):null}},{key:"isEqual",value:function(t){if(this.isFake!=t.isFake)return!1;if(this.isFake&&this.fakeSelectionLabel!=t.fakeSelectionLabel)return!1;if(this.rangeCount!=t.rangeCount)return!1;if(0===this.rangeCount)return!0;if(!this.anchor.isEqual(t.anchor)||!this.focus.isEqual(t.focus))return!1;var e=!0,n=!1,r=void 0;try{for(var i,o=this._ranges[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value,s=!1,u=!0,l=!1,c=void 0;try{for(var f,h=t._ranges[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var d=f.value;if(a.isEqual(d)){s=!0;break}}}catch(t){l=!0,c=t}finally{try{!u&&h.return&&h.return()}finally{if(l)throw c}}if(!s)return!1}}catch(t){n=!0,r=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw r}}return!0}},{key:"removeAllRanges",value:function(){this._ranges.length&&(this._ranges=[],this.fire("change"))}},{key:"setRanges",value:function(t,e){this._ranges=[];var n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if(!(s instanceof kl))throw new Qs("view-selection-invalid-range: Invalid Range.");this._pushRange(s)}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}this._lastRangeBackward=!!e,this.fire("change")}},{key:"setTo",value:function(t){this._isFake=t._isFake,this._fakeSelectionLabel=t._fakeSelectionLabel,this.setRanges(t.getRanges(),t.isBackward)}},{key:"collapse",value:function(t,e){var n=_l.createAt(t,e),r=new kl(n,n);this.setRanges([r])}},{key:"collapseToStart",value:function(){var t=this.getFirstPosition();null!==t&&this.setRanges([new kl(t,t)])}},{key:"collapseToEnd",value:function(){var t=this.getLastPosition();null!==t&&this.setRanges([new kl(t,t)])}},{key:"setFocus",value:function(t,e){if(null===this.anchor)throw new Qs("view-selection-setFocus-no-ranges: Cannot set selection focus if there are no ranges in selection.");var n=_l.createAt(t,e);if("same"!=n.compareWith(this.focus)){var r=this.anchor;this._ranges.pop(),"before"==n.compareWith(r)?this.addRange(new kl(n,r),!0):this.addRange(new kl(r,n))}}},{key:"getSelectedElement",value:function(){if(1!==this.rangeCount)return null;var t=this.getFirstRange(),e=t.start.nodeAfter,n=t.end.nodeBefore;return e instanceof ml&&e==n?e:null}},{key:"_pushRange",value:function(t){var e=!0,n=!1,r=void 0;try{for(var i,o=this._ranges[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;if(t.isIntersecting(a))throw new Qs("view-selection-range-intersects: Trying to add a range that intersects with another range from selection.",{addedRange:t,intersectingRange:a})}}catch(t){n=!0,r=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw r}}this._ranges.push(kl.createFromRange(t))}},{key:"isFake",get:function(){return this._isFake}},{key:"fakeSelectionLabel",get:function(){return this._fakeSelectionLabel}},{key:"anchor",get:function(){if(!this._ranges.length)return null;var t=this._ranges[this._ranges.length-1],e=this._lastRangeBackward?t.end:t.start;return _l.createFromPosition(e)}},{key:"focus",get:function(){if(!this._ranges.length)return null;var t=this._ranges[this._ranges.length-1],e=this._lastRangeBackward?t.start:t.end;return _l.createFromPosition(e)}},{key:"isCollapsed",get:function(){return 1===this.rangeCount&&this._ranges[0].isCollapsed}},{key:"rangeCount",get:function(){return this._ranges.length}},{key:"isBackward",get:function(){return!this.isCollapsed&&this._lastRangeBackward}},{key:"editableElement",get:function(){return this.anchor?this.anchor.editableElement:null}}],[{key:"createFromSelection",value:function(e){var n=new t;return n.setTo(e),n}}]),t}();J(Ev,qs);for(var Rv=function(t){var e=t.createElement("br");return e.dataset.ckeFiller=!0,e},Vv=function(t){return t.createTextNode(" ")},Fv=7,Nv="",jv=0;jv<Fv;jv++)Nv+="​";var Mv=new WeakMap,Iv=function(){function t(e,n){Fs(this,t),this.domDocuments=new Set,this.domConverter=e,this.markedAttributes=new Set,this.markedChildren=new Set,this.markedTexts=new Set,this.selection=n,this._inlineFiller=null,this.isFocused=!1,this._fakeSelectionContainer=null}return Ns(t,[{key:"markToSync",value:function(t,e){if("text"===t)this.domConverter.getCorrespondingDom(e.parent)&&this.markedTexts.add(e);else{if(!this.domConverter.getCorrespondingDom(e))return;if("attributes"===t)this.markedAttributes.add(e);else{if("children"!==t)throw new Qs("view-renderer-unknown-type: Unknown type passed to Renderer.markToSync.");this.markedChildren.add(e)}}}},{key:"render",value:function(){var t=void 0;this._inlineFiller&&!this._isSelectionInInlineFiller()&&this._removeInlineFiller(),this._inlineFiller?t=this._getInlineFillerPosition():this._needsInlineFillerAtSelection()&&(t=this.selection.getFirstPosition(),this.markedChildren.add(t.parent));var e=!0,n=!1,r=void 0;try{for(var i,o=this.markedTexts[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;!this.markedChildren.has(a.parent)&&this.domConverter.getCorrespondingDom(a.parent)&&this._updateText(a,{inlineFillerPosition:t})}}catch(t){n=!0,r=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw r}}var s=!0,u=!1,l=void 0;try{for(var c,f=this.markedAttributes[Symbol.iterator]();!(s=(c=f.next()).done);s=!0){var h=c.value;this._updateAttrs(h)}}catch(t){u=!0,l=t}finally{try{!s&&f.return&&f.return()}finally{if(u)throw l}}var d=!0,v=!1,y=void 0;try{for(var p,m=this.markedChildren[Symbol.iterator]();!(d=(p=m.next()).done);d=!0){var g=p.value;this._updateChildren(g,{inlineFillerPosition:t})}}catch(t){v=!0,y=t}finally{try{!d&&m.return&&m.return()}finally{if(v)throw y}}this._updateSelection(),this._updateFocus(),this.markedTexts.clear(),this.markedAttributes.clear(),this.markedChildren.clear(),this._inlineFiller=this._getInlineFillerNode(t)}},{key:"_getInlineFillerNode",value:function(t){if(!t)return void(this._inlineFiller=null);var e=this.domConverter.viewPositionToDom(t);if(!e||!Ao(e.parent))throw new Qs("view-renderer-cannot-find-filler: Cannot find filler node by its position.");return e.parent}},{key:"_getInlineFillerPosition",value:function(){var t=this.selection.getFirstPosition();return t.parent instanceof vl?_l.createBefore(this.selection.getFirstPosition().parent):t}},{key:"_isSelectionInInlineFiller",value:function(){if(1!=this.selection.rangeCount||!this.selection.isCollapsed)return!1;var t=this.selection.getFirstPosition(),e=this.domConverter.viewPositionToDom(t);return!!(e&&this.domConverter.isText(e.parent)&&Ao(e.parent))}},{key:"_removeInlineFiller",value:function(){var t=this._inlineFiller;if(!Ao(t))throw new Qs("view-renderer-filler-was-lost: The inline filler node was lost.");Co(t)?t.parentNode.removeChild(t):t.data=t.data.substr(Fv),this._inlineFiller=null}},{key:"_needsInlineFillerAtSelection",value:function(){if(1!=this.selection.rangeCount||!this.selection.isCollapsed)return!1;var t=this.selection.getFirstPosition(),e=t.parent,n=t.offset;if(!this.domConverter.getCorrespondingDomElement(e.root))return!1;if(!(e instanceof ml))return!1;if(n===e.getFillerOffset())return!1;var r=t.nodeBefore,i=t.nodeAfter;return!(r instanceof vl||i instanceof vl)}},{key:"_updateText",value:function(t,e){var n=this.domConverter.getCorrespondingDom(t),r=this.domConverter.viewToDom(t,n.ownerDocument),i=n.data,o=r.data,a=e.inlineFillerPosition;a&&a.parent==t.parent&&a.offset==t.index&&(o=Nv+o),i!=o&&(n.data=o)}},{key:"_updateAttrs",value:function(t){var e=this.domConverter.getCorrespondingDom(t),n=Array.from(e.attributes).map(function(t){return t.name}),r=t.getAttributeKeys(),i=!0,o=!1,a=void 0;try{for(var s,u=r[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;e.setAttribute(l,t.getAttribute(l))}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}var c=!0,f=!1,h=void 0;try{for(var d,v=n[Symbol.iterator]();!(c=(d=v.next()).done);c=!0){var y=d.value;t.hasAttribute(y)||e.removeAttribute(y)}}catch(t){f=!0,h=t}finally{try{!c&&v.return&&v.return()}finally{if(f)throw h}}}},{key:"_updateChildren",value:function(t,e){function n(t,e){return t===e||(r.isText(t)&&r.isText(e)?t.data===e.data:!(!Eo(t,r.blockFiller)||!Eo(e,r.blockFiller)))}var r=this.domConverter,i=r.getCorrespondingDom(t),o=i.ownerDocument,a=e.inlineFillerPosition,s=i.childNodes,u=Array.from(r.viewChildrenToDom(t,o,{bind:!0}));if(a&&a.parent==t){var l=u[a.offset];this.domConverter.isText(l)?l.data=Nv+l.data:u.splice(a.offset,0,o.createTextNode(Nv))}var c=Fo(s,u,n),f=0,h=!0,d=!1,v=void 0;try{for(var y,p=c[Symbol.iterator]();!(h=(y=p.next()).done);h=!0){var m=y.value;"insert"===m?(No(i,f,u[f]),f++):"delete"===m?jo(s[f]):f++}}catch(t){d=!0,v=t}finally{try{!h&&p.return&&p.return()}finally{if(d)throw v}}}},{key:"_updateSelection",value:function(){if(0===this.selection.rangeCount)return this._removeDomSelection(),void this._removeFakeSelection();var t=this.domConverter.getCorrespondingDomElement(this.selection.editableElement);this.isFocused&&t&&(this.selection.isFake?this._updateFakeSelection(t):(this._removeFakeSelection(),this._updateDomSelection(t)))}},{key:"_updateFakeSelection",value:function(t){var e=t.ownerDocument;this._fakeSelectionContainer||(this._fakeSelectionContainer=e.createElement("div"),this._fakeSelectionContainer.style.position="fixed",this._fakeSelectionContainer.style.top=0,this._fakeSelectionContainer.style.left="-9999px",this._fakeSelectionContainer.appendChild(e.createTextNode(" "))),this._fakeSelectionContainer.parentElement||t.appendChild(this._fakeSelectionContainer);var n=this.selection.fakeSelectionLabel||" ";this._fakeSelectionContainer.firstChild.data=n;var r=e.getSelection();r.removeAllRanges();var i=new Range;i.selectNodeContents(this._fakeSelectionContainer),r.addRange(i),this.domConverter.bindFakeSelection(this._fakeSelectionContainer,this.selection)}},{key:"_updateDomSelection",value:function(t){var e=t.ownerDocument.defaultView.getSelection(),n=e&&this.domConverter.domSelectionToView(e);if(!n||!this.selection.isEqual(n)){var r=this.domConverter.viewPositionToDom(this.selection.anchor),i=this.domConverter.viewPositionToDom(this.selection.focus);e.collapse(r.parent,r.offset),e.extend(i.parent,i.offset)}}},{key:"_removeDomSelection",value:function(){var t=!0,e=!1,n=void 0;try{for(var r,i=this.domDocuments[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var o=r.value,a=o.getSelection();if(a.rangeCount){var s=o.activeElement,u=this.domConverter.getCorrespondingViewElement(s);s&&u&&o.getSelection().removeAllRanges()}}}catch(t){e=!0,n=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw n}}}},{key:"_removeFakeSelection",value:function(){var t=this._fakeSelectionContainer;t&&t.remove()}},{key:"_updateFocus",value:function(){if(this.isFocused){var t=this.selection.editableElement;t&&this.domConverter.focus(t)}}}]),t}();J(Iv,Zu);var Bv=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Fs(this,t),this.blockFiller=e.blockFiller||Rv,this.preElements=["pre"],this.blockElements=["p","div","h1","h2","h3","h4","h5","h6"],this._domToViewMapping=new WeakMap,this._viewToDomMapping=new WeakMap,this._fakeSelectionMapping=new WeakMap}return Ns(t,[{key:"bindFakeSelection",value:function(t,e){this._fakeSelectionMapping.set(t,Ev.createFromSelection(e))}},{key:"fakeSelectionToView",value:function(t){return this._fakeSelectionMapping.get(t)}},{key:"bindElements",value:function(t,e){this._domToViewMapping.set(t,e),this._viewToDomMapping.set(e,t)}},{key:"bindDocumentFragments",value:function(t,e){this._domToViewMapping.set(t,e),this._viewToDomMapping.set(e,t)}},{key:"viewToDom",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t instanceof vl){var r=this._processDataFromViewText(t);return e.createTextNode(r)}if(this.getCorrespondingDom(t))return this.getCorrespondingDom(t);var i=void 0;if(t instanceof Tl)i=e.createDocumentFragment(),n.bind&&this.bindDocumentFragments(i,t);else{i=e.createElement(t.name),n.bind&&this.bindElements(i,t);var o=!0,a=!1,s=void 0;try{for(var u,l=t.getAttributeKeys()[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value;i.setAttribute(c,t.getAttribute(c))}}catch(t){a=!0,s=t}finally{try{!o&&l.return&&l.return()}finally{if(a)throw s}}}if(n.withChildren||void 0===n.withChildren){var f=!0,h=!1,d=void 0;try{for(var v,y=this.viewChildrenToDom(t,e,n)[Symbol.iterator]();!(f=(v=y.next()).done);f=!0){var p=v.value;i.appendChild(p)}}catch(t){h=!0,d=t}finally{try{!f&&y.return&&y.return()}finally{if(h)throw d}}}return i}},{key:"viewChildrenToDom",value:regeneratorRuntime.mark(function t(e,n){var r,i,o,a,s,u,l,c,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=e.getFillerOffset&&e.getFillerOffset(),i=0,o=!0,a=!1,s=void 0,t.prev=5,u=e.getChildren()[Symbol.iterator]();case 7:if(o=(l=u.next()).done){t.next=18;break}if(c=l.value,r!==i){t.next=12;break}return t.next=12,this.blockFiller(n);case 12:return t.next=14,this.viewToDom(c,n,f);case 14:i++;case 15:o=!0,t.next=7;break;case 18:t.next=24;break;case 20:t.prev=20,t.t0=t.catch(5),a=!0,s=t.t0;case 24:t.prev=24,t.prev=25,!o&&u.return&&u.return();case 27:if(t.prev=27,!a){t.next=30;break}throw s;case 30:return t.finish(27);case 31:return t.finish(24);case 32:if(r!==i){t.next=35;break}return t.next=35,this.blockFiller(n);case 35:case"end":return t.stop()}},t,this,[[5,20,24,32],[25,,27,31]])})},{key:"viewRangeToDom",value:function(t){var e=this.viewPositionToDom(t.start),n=this.viewPositionToDom(t.end),r=new Range;return r.setStart(e.parent,e.offset),r.setEnd(n.parent,n.offset),r}},{key:"viewPositionToDom",value:function(t){var e=t.parent;if(e instanceof vl){var n=this.getCorrespondingDomText(e);if(!n)return null;var r=t.offset;return Ao(n)&&(r+=Fv),{parent:n,offset:r}}var i=void 0,o=void 0,a=void 0;if(0===t.offset){if(i=this.getCorrespondingDom(t.parent),!i)return null;a=i.childNodes[0]}else{if(o=this.getCorrespondingDom(t.nodeBefore),!o)return null;i=o.parentNode,a=o.nextSibling}if(this.isText(a)&&Ao(a))return{parent:a,offset:Fv};var s=o?Mo(o)+1:0;return{parent:i,offset:s}}},{key:"domToView",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Eo(t,this.blockFiller))return null;if(this.isText(t)){if(Co(t))return null;var n=this._processDataFromDomText(t);return""===n?null:new vl(n)}if(this.getCorrespondingView(t))return this.getCorrespondingView(t);var r=void 0;if(this.isDocumentFragment(t))r=new Tl,e.bind&&this.bindDocumentFragments(t,r);else{var i=e.keepOriginalCase?t.tagName:t.tagName.toLowerCase();r=new ml(i),e.bind&&this.bindElements(t,r);for(var o=t.attributes,a=o.length-1;a>=0;a--)r.setAttribute(o[a].name,o[a].value)}if(e.withChildren||void 0===e.withChildren){var s=!0,u=!1,l=void 0;try{for(var c,f=this.domChildrenToView(t,e)[Symbol.iterator]();!(s=(c=f.next()).done);s=!0){var h=c.value;r.appendChildren(h)}}catch(t){u=!0,l=t}finally{try{!s&&f.return&&f.return()}finally{if(u)throw l}}}return r}},{key:"domChildrenToView",value:regeneratorRuntime.mark(function t(e){var n,r,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(t){
for(;;)switch(t.prev=t.next){case 0:n=0;case 1:if(!(n<e.childNodes.length)){t.next=10;break}if(r=e.childNodes[n],i=this.domToView(r,o),null===i){t.next=7;break}return t.next=7,i;case 7:n++,t.next=1;break;case 10:case"end":return t.stop()}},t,this)})},{key:"domSelectionToView",value:function(t){if(1===t.rangeCount){var e=t.getRangeAt(0).startContainer;this.isText(e)&&(e=e.parentNode);var n=this.fakeSelectionToView(e);if(n)return n}for(var r=new Ev,i=this.isDomSelectionBackward(t),o=0;o<t.rangeCount;o++){var a=t.getRangeAt(o),s=this.domRangeToView(a);s&&r.addRange(s,i)}return r}},{key:"domRangeToView",value:function(t){var e=this.domPositionToView(t.startContainer,t.startOffset),n=this.domPositionToView(t.endContainer,t.endOffset);return e&&n?new kl(e,n):null}},{key:"domPositionToView",value:function(t,e){if(Eo(t,this.blockFiller))return this.domPositionToView(t.parentNode,Mo(t));if(this.isText(t)){if(Co(t))return this.domPositionToView(t.parentNode,Mo(t));var n=this.getCorrespondingViewText(t),r=e;return n?(Ao(t)&&(r-=Fv,r=r<0?0:r),new _l(n,r)):null}if(0===e){var i=this.getCorrespondingView(t);if(i)return new _l(i,0)}else{var o=this.getCorrespondingView(t.childNodes[e-1]);if(o&&o.parent)return new _l(o.parent,o.index+1)}return null}},{key:"getCorrespondingView",value:function(t){return this.isElement(t)?this.getCorrespondingViewElement(t):this.isDocumentFragment(t)?this.getCorrespondingViewDocumentFragment(t):this.isText(t)?this.getCorrespondingViewText(t):null}},{key:"getCorrespondingViewElement",value:function(t){return this._domToViewMapping.get(t)}},{key:"getCorrespondingViewDocumentFragment",value:function(t){return this._domToViewMapping.get(t)}},{key:"getCorrespondingViewText",value:function(t){if(Co(t))return null;var e=t.previousSibling;if(e){if(!this.isElement(e))return null;var n=this.getCorrespondingViewElement(e);if(n){var r=n.nextSibling;return r instanceof vl?n.nextSibling:null}}else{var i=this.getCorrespondingViewElement(t.parentNode);if(i){var o=i.getChild(0);return o instanceof vl?o:null}}return null}},{key:"getCorrespondingDom",value:function(t){return t instanceof ml?this.getCorrespondingDomElement(t):t instanceof Tl?this.getCorrespondingDomDocumentFragment(t):t instanceof vl?this.getCorrespondingDomText(t):null}},{key:"getCorrespondingDomElement",value:function(t){return this._viewToDomMapping.get(t)}},{key:"getCorrespondingDomDocumentFragment",value:function(t){return this._viewToDomMapping.get(t)}},{key:"getCorrespondingDomText",value:function(t){var e=t.previousSibling;return e&&this.getCorrespondingDom(e)?this.getCorrespondingDom(e).nextSibling:!e&&t.parent&&this.getCorrespondingDom(t.parent)?this.getCorrespondingDom(t.parent).childNodes[0]:null}},{key:"focus",value:function(t){var e=this.getCorrespondingDomElement(t);e&&e.ownerDocument.activeElement!==e&&e.focus()}},{key:"isText",value:function(t){return t&&t.nodeType==Node.TEXT_NODE}},{key:"isElement",value:function(t){return t&&t.nodeType==Node.ELEMENT_NODE}},{key:"isDocumentFragment",value:function(t){return t&&t.nodeType==Node.DOCUMENT_FRAGMENT_NODE}},{key:"isDomSelectionBackward",value:function(t){if(t.isCollapsed)return!1;var e=new Range;e.setStart(t.anchorNode,t.anchorOffset),e.setEnd(t.focusNode,t.focusOffset);var n=e.collapsed;return e.detach(),n}},{key:"_processDataFromViewText",value:function(t){var e=this,n=t.data;if(t.getAncestors().some(function(t){return e.preElements.includes(t.name)}))return n;var r=this._getTouchingViewTextNode(t,!1),i=this._getTouchingViewTextNode(t,!0),o=n.match(/ *$/)[0],a=n.substr(0,n.length-o.length);if(r&&" "!=r.data.charAt(r.data.length-1)||(a=a.replace(/^ /," ")),a=a.replace(/  /g,"  "),o.length>0){var s=!1;i?" "!=i.data.charAt(0)&&" "!=i.data.charAt(0)||o.length%2===0&&(s=!0):o.length%2&&(s=!0),s&&(o=" "+o.substr(0,o.length-1)),o=o.replace(/  /g,"  ")}return a+o}},{key:"_getTouchingViewTextNode",value:function(t,e){if(!t.parent)return null;var n=new wl({startPosition:e?_l.createAfter(t):_l.createBefore(t),direction:e?"forward":"backward"}),r=!0,i=!1,o=void 0;try{for(var a,s=n[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;if(u.item instanceof gl)return null;if(u.item instanceof vl)return u.item}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return null}},{key:"_processDataFromDomText",value:function(t){var e=To(t);if(Do(t,this.preElements))return e;e=e.replace(/[^\S\u00A0]{2,}/g," ");var n=this._getTouchingDomTextNode(t,!1),r=this._getTouchingDomTextNode(t,!0);return n&&!/[^\S\u00A0]/.test(n.data.charAt(n.data.length-1))||(e=e.replace(/^ /,"")),r||(e=e.replace(/ $/,"")),e=e.replace(/ \u00A0/g,"  "),n&&!/[^\S\u00A0]/.test(n.data.charAt(n.data.length-1))||(e=e.replace(/^\u00A0/," ")),r&&" "!=r.data.charAt(0)||(e=e.replace(/\u00A0( *)$/," $1")),e}},{key:"_getTouchingDomTextNode",value:function(t,e){if(!t.parentNode)return null;var n=e?"nextNode":"previousNode",r=t.ownerDocument,i=r.createTreeWalker(r.childNodes[0],NodeFilter.SHOW_TEXT);i.currentNode=t;var o=i[n]();if(null!==o){var a=Bo(t,o);if(a&&!Do(t,this.blockElements,a)&&!Do(o,this.blockElements,a))return o}return null}}]),t}(),Dv=function(t){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"main";Fs(this,e);var i=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return i.rootName=r,i}return Ms(e,t),e}(bl),Lv=Gu({},qs,{listenTo:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=e[0];zo(r)&&(e[0]=this._getProxyEmitter(r)||new zv(r)),qs.listenTo.apply(this,e)},stopListening:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=e[0];if(zo(r)){var i=this._getProxyEmitter(r);if(!i)return;e[0]=i}qs.stopListening.apply(this,e)},_getProxyEmitter:function(t){var e=void 0,n=void 0,r=void 0,i=Lo(t);return(n=this._listeningTo)&&(r=n[i])&&(e=r.emitter),e||null}}),zv=function t(e){Fs(this,t),this._emitterId=Lo(e),this._domNode=e};Gu(zv.prototype,qs,{on:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(qs.on.apply(this,arguments),!this._domListeners||!this._domListeners[t]){var r=this._createDomListener(t);this._domNode.addEventListener(t,r,!!n.useCapture),this._domListeners||(this._domListeners={}),this._domListeners[t]=r}},off:function(t){qs.off.apply(this,arguments);var e=void 0;!this._domListeners[t]||(e=this._events[t])&&e.callbacks.length||this._domListeners[t].removeListener()},_createDomListener:function(t){var e=this,n=function(n){e.fire(t,n)};return n.removeListener=function(){e._domNode.removeEventListener(t,n),delete e._domListeners[t]},n}});var qv=function(){function t(e){Fs(this,t),this.document=e,this.isEnabled=!1}return Ns(t,[{key:"enable",value:function(){this.isEnabled=!0}},{key:"disable",value:function(){this.isEnabled=!1}},{key:"destroy",value:function(){this.disable(),this.stopListening()}}]),t}();J(qv,Lv);var Hv=function(t){function e(t){Fs(this,e);var n=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n._config={childList:!0,characterData:!0,characterDataOldValue:!0,subtree:!0},n.domConverter=t.domConverter,n.renderer=t.renderer,n._domElements=[],n._mutationObserver=new window.MutationObserver(n._onMutations.bind(n)),n}return Ms(e,t),Ns(e,[{key:"flush",value:function(){this._onMutations(this._mutationObserver.takeRecords())}},{key:"observe",value:function(t){this._domElements.push(t),this.isEnabled&&this._mutationObserver.observe(t,this._config)}},{key:"enable",value:function(){js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"enable",this).call(this);var t=!0,n=!1,r=void 0;try{for(var i,o=this._domElements[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this._mutationObserver.observe(a,this._config)}}catch(t){n=!0,r=t}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}},{key:"disable",value:function(){js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"disable",this).call(this),this._mutationObserver.disconnect()}},{key:"destroy",value:function(){js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this),this._mutationObserver.disconnect()}},{key:"_onMutations",value:function(t){if(0!==t.length){var e=this.domConverter,n=new Map,r=new Set,i=!0,o=!1,a=void 0;try{for(var s,u=t[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;if("childList"===l.type){var c=e.getCorrespondingViewElement(l.target);c&&r.add(c)}}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}var f=!0,h=!1,d=void 0;try{for(var v,y=t[Symbol.iterator]();!(f=(v=y.next()).done);f=!0){var p=v.value;if("characterData"===p.type){var m=e.getCorrespondingViewText(p.target);m&&!r.has(m.parent)?n.set(m,{type:"text",oldText:m.data,newText:To(p.target),node:m}):!m&&Ao(p.target)&&r.add(e.getCorrespondingViewElement(p.target.parentNode))}}}catch(t){h=!0,d=t}finally{try{!f&&y.return&&y.return()}finally{if(h)throw d}}var g=[],b=!0,_=!1,w=void 0;try{for(var k,x=n.values()[Symbol.iterator]();!(b=(k=x.next()).done);b=!0){var O=k.value;this.renderer.markToSync("text",O.node),g.push(O)}}catch(t){_=!0,w=t}finally{try{!b&&x.return&&x.return()}finally{if(_)throw w}}var S=!0,P=!1,A=void 0;try{for(var C,T=r[Symbol.iterator]();!(S=(C=T.next()).done);S=!0){var E=C.value,R=e.getCorrespondingDomElement(E),V=E.getChildren(),F=e.domChildrenToView(R);this.renderer.markToSync("children",E),g.push({type:"children",oldChildren:Array.from(V),newChildren:Array.from(F),node:E})}}catch(t){P=!0,A=t}finally{try{!S&&T.return&&T.return()}finally{if(P)throw A}}var N=t[0].target.ownerDocument.getSelection(),j=null;if(N&&N.anchorNode){var M=e.domPositionToView(N.anchorNode,N.anchorOffset),I=e.domPositionToView(N.focusNode,N.focusOffset);M&&I&&(j=new Ev,j.collapse(M),j.setFocus(I))}this.document.fire("mutations",g,j),this.document.render()}}}]),e}(qv),$v=function(t){function e(t){Fs(this,e);var n=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.mutationObserver=t.getObserver(Hv),n.document=t,n.selection=t.selection,n.domConverter=t.domConverter,n._documents=new WeakSet,n._clearInfiniteLoopInterval=setInterval(function(){return n._clearInfiniteLoop()},2e3),n}return Ms(e,t),Ns(e,[{key:"observe",value:function(t){var e=this,n=t.ownerDocument;this._documents.has(n)||(this.listenTo(n,"selectionchange",function(){e._handleSelectionChange(n)}),this._documents.add(n))}},{key:"destroy",value:function(){js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this),clearInterval(this._clearInfiniteLoopInterval)}},{key:"_handleSelectionChange",value:function(t){if(this.isEnabled&&this.document.isFocused){this.mutationObserver.flush();var e=t.defaultView.getSelection(),n=this.domConverter.domSelectionToView(e);if(!this.selection.isEqual(n))return this._isInfiniteLoop(n)?void el.warn("selectionchange-infinite-loop: Selection change observer detected an infinite rendering loop."):void this.document.fire("selectionChange",{oldSelection:this.selection,newSelection:n,domSelection:e})}}},{key:"_isInfiniteLoop",value:function(t){return this._lastSelection&&this._lastButOneSelection&&(t.isEqual(this._lastSelection)||t.isEqual(this._lastButOneSelection))?this._loopbackCounter++:(this._lastButOneSelection=this._lastSelection,this._lastSelection=t,this._loopbackCounter=0),this._loopbackCounter>50}},{key:"_clearInfiniteLoop",value:function(){this._lastSelection=null,this._lastButOneSelection=null,this._loopbackCounter=0}}]),e}(qv),Kv=function(){function t(e,n,r){Fs(this,t),this.document=e,this.domEvent=n,this.domTarget=n.target,Gu(this,r)}return Ns(t,[{key:"preventDefault",value:function(){this.domEvent.preventDefault()}},{key:"stopPropagation",value:function(){this.domEvent.stopPropagation()}},{key:"target",get:function(){return this.document.domConverter.getCorrespondingViewElement(this.domTarget)}}]),t}(),Wv=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"observe",value:function(t){var e=this,n="string"==typeof this.domEventType?[this.domEventType]:this.domEventType;n.forEach(function(n){e.listenTo(t,n,function(t,n){e.isEnabled&&e.onDomEvent(n)})})}},{key:"fire",value:function(t,e,n){this.isEnabled&&this.document.fire(t,new Kv(this.document,e,n))}}]),e}(qv),Jv=function(t){function e(t){Fs(this,e);var n=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.domEventType=["focus","blur"],t.on("focus",function(){t.isFocused=!0}),t.on("blur",function(e,n){var r=t.selection.editableElement;null!==r&&r!==n.target||(t.isFocused=!1)}),n}return Ms(e,t),Ns(e,[{key:"onDomEvent",value:function(t){this.fire(t.type,t)}}]),e}(Wv),Uv=function(t){function e(t){Fs(this,e);var n=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.domEventType="keydown",n}return Ms(e,t),Ns(e,[{key:"onDomEvent",value:function(t){this.fire("keydown",t,{keyCode:t.keyCode,altKey:t.altKey,ctrlKey:t.ctrlKey||t.metaKey,shiftKey:t.shiftKey,get keystroke(){return ko(this)}})}}]),e}(Wv),Gv=function(t){function e(t){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return Ms(e,t),Ns(e,[{key:"observe",value:function(){var t=this,e=this.document;e.on("keydown",function(n,r){var i=e.selection;i.isFake&&qo(r.keyCode)&&t.isEnabled&&(r.preventDefault(),t._handleSelectionMove(r.keyCode))},{priority:"lowest"})}},{key:"_handleSelectionMove",value:function(t){var e=this.document.selection,n=Ev.createFromSelection(e);n.setFake(!1),t!=Cv.arrowleft&&t!=Cv.arrowup||n.collapseToStart(),t!=Cv.arrowright&&t!=Cv.arrowdown||n.collapseToEnd(),this.document.fire("selectionChange",{oldSelection:e,newSelection:n,domSelection:null})}}]),e}(qv),Yv=function(){function t(){var e=this;Fs(this,t),this.domRoots=new Map,this.selection=new Ev,this.domConverter=new Bv,this.roots=new Map,this.set("isFocused",!1),this.renderer=new Iv(this.domConverter,this.selection),this.renderer.bind("isFocused").to(this,"isFocused"),this._observers=new Map,this.addObserver(Hv),this.addObserver($v),this.addObserver(Jv),this.addObserver(Uv),this.addObserver(Gv),Ro(this),this.on("render",function(){e.disableObservers(),e.renderer.render(),e.enableObservers()})}return Ns(t,[{key:"addObserver",value:function(t){var e=this._observers.get(t);if(e)return e;e=new t(this),this._observers.set(t,e);var n=!0,r=!1,i=void 0;try{for(var o,a=this.domRoots[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=Bs(o.value,2),u=s[0],l=s[1];e.observe(l,u)}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return e.enable(),e}},{key:"getObserver",value:function(t){return this._observers.get(t)}},{key:"createRoot",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"main",r="string"==typeof t?t:t.tagName,i=new Dv(this,r.toLowerCase(),n);return this.roots.set(n,i),i.on("change:children",function(t,n){return e.renderer.markToSync("children",n)}),i.on("change:attributes",function(t,n){return e.renderer.markToSync("attributes",n)}),i.on("change:text",function(t,n){return e.renderer.markToSync("text",n)}),this.domConverter.isElement(t)&&this.attachDomRoot(t,n),i}},{key:"attachDomRoot",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"main",n=this.getRoot(e);this.domRoots.set(e,t),this.domConverter.bindElements(t,n),this.renderer.markToSync("children",n),this.renderer.domDocuments.add(t.ownerDocument);var r=!0,i=!1,o=void 0;try{for(var a,s=this._observers.values()[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;u.observe(t,e)}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}}},{key:"getRoot",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";return this.roots.get(t)}},{key:"getDomRoot",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";return this.domRoots.get(t)}},{key:"render",value:function(){this.fire("render")}},{key:"focus",value:function(){if(!this.isFocused){var t=this.selection.editableElement;t?(this.domConverter.focus(t),this.render()):el.warn("view-focus-no-selection: There is no selection in any editable to focus.")}}},{key:"disableObservers",value:function(){var t=!0,e=!1,n=void 0;try{for(var r,i=this._observers.values()[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var o=r.value;o.disable()}}catch(t){e=!0,n=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw n}}}},{key:"enableObservers",value:function(){var t=!0,e=!1,n=void 0;try{for(var r,i=this._observers.values()[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var o=r.value;o.enable()}}catch(t){e=!0,n=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw n}}}},{key:"destroy",value:function(){var t=!0,e=!1,n=void 0;try{for(var r,i=this._observers.values()[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var o=r.value;o.destroy()}}catch(t){e=!0,n=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw n}}}}]),t}();J(Yv,Zu);var Qv=function(){function t(e){var n=this;Fs(this,t),this.model=e,this.view=new Yv,this.mapper=new xl,this.modelToView=new Sl({mapper:this.mapper,viewSelection:this.view.selection}),this._listener=Object.create(qs),this._listener.listenTo(this.model,"change",function(t,e,r){n.modelToView.convertChange(e,r)},{priority:"low"}),this._listener.listenTo(this.model,"changesDone",function(){n.modelToView.convertSelection(e.selection),n.view.render()},{priority:"low"}),this._listener.listenTo(this.model.markers,"add",function(t,e,r){n.modelToView.convertMarker("addMarker",e,r)}),this._listener.listenTo(this.model.markers,"remove",function(t,e,r){n.modelToView.convertMarker("removeMarker",e,r)}),this._listener.listenTo(this.view,"selectionChange",Ho(e,this.mapper)),this.modelToView.on("insert:$text",qt(),{priority:"lowest"}),this.modelToView.on("remove",Qt(),{priority:"low"}),this.modelToView.on("move",Yt(),{priority:"low"}),this.modelToView.on("rename",Xt(),{priority:"low"}),this.modelToView.on("insert",Zt(this.model.markers),{priority:"lowest"}),this.modelToView.on("move",te(this.model.markers),{priority:"lowest"}),this.modelToView.on("selection",Jo(),{priority:"low"}),this.modelToView.on("selection",Uo(),{priority:"low"}),this.modelToView.on("selection",$o(),{priority:"low"}),this.modelToView.on("selection",Ko(),{priority:"low"})}return Ns(t,[{key:"createRoot",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"main",n=this.view.createRoot(t,e),r=this.model.getRoot(e);return this.mapper.bindElements(r,n),n}},{key:"destroy",value:function(){this.view.destroy(),this._listener.stopListening()}}]),t}(),Xv=function(t){function e(t,n){Fs(this,e);var r=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n));return r.element=t,r.editing=new Qv(r.document),r.keystrokes=new Tv(r),r}return Ms(e,t),Ns(e,[{key:"destroy",value:function(){var t=this;return Promise.resolve().then(function(){return t.editing.destroy()}).then(js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this))}},{key:"setData",value:function(t){this.data.set(t)}},{key:"getData",value:function(){return this.data.get()}},{key:"updateEditorElement",value:function(){Yo(this.element,this.getData())}},{key:"loadDataFromEditorElement",value:function(){this.setData(Go(this.element))}}],[{key:"create",value:function(t,e){var n=this;return new Promise(function(r){var i=new n(t,e);r(i.initPlugins().then(function(){i.fire("dataReady"),i.fire("ready")}).then(function(){return i}))})}}]),e}(Sv),Zv=function(){function t(){Fs(this,t)}return Ns(t,[{key:"getHtml",value:function(t){var e=document.implementation.createHTMLDocument(""),n=e.createElement("div");return n.appendChild(t),n.innerHTML}}]),t}(),ty=function(){function t(){Fs(this,t),this._domParser=new DOMParser,this._domConverter=new Bv({blockFiller:Vv}),this._htmlWriter=new Zv}return Ns(t,[{key:"toData",value:function(t){var e=this._domConverter.viewToDom(t,document);return this._htmlWriter.getHtml(e)}},{key:"toView",value:function(t){var e=this._toDom(t);return this._domConverter.domToView(e)}},{key:"_toDom",value:function(t){for(var e=this._domParser.parseFromString(t,"text/html"),n=e.createDocumentFragment(),r=e.body.childNodes;r.length>0;)n.appendChild(r[0]);return n}}]),t}(),ey=function(){function t(e){Fs(this,t),this.editor=e,this._components=new Map}return Ns(t,[{key:"add",value:function(t,e){if(this._components.get(t))throw new Qs("componentfactory-item-exists: The item already exists in the component factory.",{name:t});this._components.set(t,e)}},{key:"create",value:function(t){return this._components.get(t)(this.editor.locale)}}]),t}(),ny=function(){function t(){Fs(this,t),this.set("isFocused",!1),this._elements=new Set,this._nextEventLoopTimeout=null,this._focusedElement=null}return Ns(t,[{key:"add",value:function(t){var e=this;if(this._elements.has(t))throw new Qs("focusTracker-add-element-already-exist");this.listenTo(t,"focus",function(){return e._focus(t)},{useCapture:!0}),this.listenTo(t,"blur",function(){return e._blur()},{useCapture:!0}),this._elements.add(t)}},{key:"remove",value:function(t){t===this._focusedElement&&this._blur(t),this._elements.has(t)&&(this.stopListening(t),this._elements.delete(t))}},{key:"_focus",value:function(t){clearTimeout(this._nextEventLoopTimeout),this._focusedElement=t,this.isFocused=!0}},{key:"_blur",value:function(){var t=this;this._nextEventLoopTimeout=setTimeout(function(){t._focusedElement=null,t.isFocused=!1},0)}}]),t}();J(ny,Lv),J(ny,Zu);var ry=function(){function t(e,n){Fs(this,t),this.editor=e,this.view=n,this.componentFactory=new ey(e),this.focusTracker=new ny,n.set("width",e.config.get("ui.width")),n.set("height",e.config.get("ui.height")),n.toolbar.bind("isActive").to(this.focusTracker,"isFocused"),n.toolbar.limiterElement=n.element;var r=e.editing.createRoot("div");n.editable.bind("isReadOnly","isFocused").to(r),n.editable.name=r.rootName,this.focusTracker.add(n.editableElement)}return Ns(t,[{key:"init",value:function(){var t=this,e=this.editor;return this.view.init().then(function(){var n=e.config.get("toolbar"),r=[];if(n){var i=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;r.push(t.view.toolbar.items.add(t.componentFactory.create(l)))}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}return Promise.all(r)})}},{key:"destroy",value:function(){return this.view.destroy()}}]),t}(),iy=function(){function t(e){Fs(this,t),this._items=[],this._itemMap=new Map,this._idProperty=e&&e.idProperty||"id"}return Ns(t,[{key:"add",value:function(t,n){var r=void 0,i=this._idProperty;if(i in t){if(r=t[i],"string"!=typeof r)throw new Qs("collection-add-invalid-id");if(this.get(r))throw new Qs("collection-add-item-already-exists")}else t[i]=r=e();if(void 0===n)n=this._items.length;else if(n>this._items.length||n<0)throw new Qs("collection-add-item-invalid-index");return this._items.splice(n,0,t),this._itemMap.set(r,t),this.fire("add",t,n),this}},{key:"get",value:function(t){var e=void 0;if("string"==typeof t)e=this._itemMap.get(t);else{if("number"!=typeof t)throw new Qs("collection-get-invalid-arg: Index or id must be given.");e=this._items[t]}return e||null}},{key:"remove",value:function(t){var e=void 0,n=void 0,r=void 0,i=!1,o=this._idProperty;if("string"==typeof t?(n=t,r=this._itemMap.get(n),i=!r,r&&(e=this._items.indexOf(r))):"number"==typeof t?(e=t,r=this._items[e],i=!r,r&&(n=r[o])):(r=t,n=r[o],e=this._items.indexOf(r),i=e==-1||!this._itemMap.get(n)),i)throw new Qs("collection-remove-404: Item not found.");return this._items.splice(e,1),this._itemMap.delete(n),this.fire("remove",r),r}},{key:"map",value:function(t,e){return this._items.map(t,e)}},{key:"find",value:function(t,e){return this._items.find(t,e)}},{key:"filter",value:function(t,e){return this._items.filter(t,e)}},{key:"clear",value:function(){for(;this.length;)this.remove(0)}},{key:Symbol.iterator,value:function(){return this._items[Symbol.iterator]()}},{key:"length",get:function(){return this._items.length}}]),t}();J(iy,qs);var oy=function(t){function e(t){Fs(this,e);var n=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,{idProperty:"viewUid"}));return n.on("add",function(t,e,r){n.ready&&e.element&&n._parentElement&&n._parentElement.insertBefore(e.element,n._parentElement.children[r])}),n.on("remove",function(t,e){n.ready&&e.element&&n._parentElement&&e.element.remove()}),n.locale=t,n.set("ready",!1),n._parentElement=null,n._boundItemsToViewsMap=new Map,n}return Ms(e,t),Ns(e,[{key:"init",value:function(){var t=this;if(this.ready)throw new Qs("ui-viewcollection-init-reinit: This ViewCollection has already been initialized.");var e=[],n=!0,r=!1,i=void 0;try{for(var o,a=this[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;this._parentElement&&s.element&&this._parentElement.appendChild(s.element),e.push(s.init())}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return Promise.all(e).then(function(){t.ready=!0})}},{key:"destroy",value:function(){var t=[],e=!0,n=!1,r=void 0;try{for(var i,o=this[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t.push(a.destroy())}}catch(t){n=!0,r=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw r}}return Promise.all(t)}},{key:"add",value:function(t,n){js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"add",this).call(this,t,n);var r=Promise.resolve();return this.ready&&!t.ready&&(r=r.then(function(){return t.init()})),r}},{key:"setParent",value:function(t){this._parentElement=t}},{key:"bindTo",value:function(t){var e=this;return{as:function(n){var r=void 0;r=n.prototype instanceof fy?function(t){var r=new n(e.locale,t);return e._boundItemsToViewsMap.set(t,r),r}:function(t){var r=n(t);return e._boundItemsToViewsMap.set(t,r),r};var i=!0,o=!1,a=void 0;try{for(var s,u=t[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;e.add(r(l))}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}e.listenTo(t,"add",function(t,n,i){e.add(r(n),i)}),e.listenTo(t,"remove",function(t,n){e.remove(e._boundItemsToViewsMap.get(n)),e._boundItemsToViewsMap.delete(n)})}}}},{key:"delegate",value:function(){for(var t=this,e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];if(!n.length||!Qo(n))throw new Qs("ui-viewcollection-delegate-wrong-events: All event names must be strings.");return{to:function(e){var r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value,l=!0,c=!1,f=void 0;try{for(var h,d=n[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var v=h.value;u.delegate(v).to(e)}}catch(t){c=!0,f=t}finally{try{!l&&d.return&&d.return()}finally{if(c)throw f}}}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}t.on("add",function(t,r){var i=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;r.delegate(l).to(e)}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}),t.on("remove",function(t,r){var i=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;r.stopDelegating(l,e)}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}})}}}}]),e}(iy);J(iy,Zu);var ay="http://www.w3.org/1999/xhtml",sy=function(){function t(e){Fs(this,t),Object.assign(this,aa(oa(e)))}return Ns(t,[{key:"render",value:function(){return this._renderNode(void 0,!0)}},{key:"apply",value:function(t){if(!t)throw new Qs("ui-template-wrong-node: No DOM Node specified.");return this._renderNode(t)}},{key:"_renderNode",value:function(t,e){var n=void 0;if(n=t?this.tag&&this.text:this.tag?this.text:!this.text)throw new Qs('ui-template-wrong-syntax: Node definition must have either "tag" or "text" when rendering new Node.');return this.text?this._renderText(t):this._renderElement(t,e)}},{key:"_renderElement",value:function(t,e){var n=t||document.createElementNS(this.ns||ay,this.tag);if(this._renderAttributes(n),e){var r=document.createDocumentFragment();this._renderElementChildren(n,r),n.appendChild(r)}else this._renderElementChildren(n,n,!!t);return this._setUpListeners(n),n}},{key:"_renderText",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.createTextNode("");return Zo(this.text)?this._bindToObservable(this.text,t,na(t)):t.textContent=this.text.join(""),t}},{key:"_renderAttributes",value:function(t){var e=void 0,n=void 0,r=void 0;if(this.attributes)for(e in this.attributes)n=this.attributes[e],r=p(n[0])&&n[0].ns?n[0].ns:null,Zo(n)?this._bindToObservable(r?n[0].value:n,t,ra(t,e,r)):"style"==e&&"string"!=typeof n[0]?this._renderStyleAttribute(n[0],t):(n=n.map(function(t){return t?t.value||t:t}).reduce(function(t,e){return t.concat(e)},[]).reduce(ha,""),ya(n)||t.setAttributeNS(r,e,n))}},{key:"_renderStyleAttribute",value:function(t,e){for(var n in t){var r=t[n];Zo(r)?this._bindToObservable([r],e,ia(e,n)):e.style[n]=r}}},{key:"_renderElementChildren",value:function(t,e,n){var r=0,i=!0,o=!1,a=void 0;try{for(var s,u=this.children[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;if(ma(l)){if(!n){l.setParent(t);var c=!0,f=!1,h=void 0;try{for(var d,v=l[Symbol.iterator]();!(c=(d=v.next()).done);c=!0){var y=d.value;e.appendChild(y.element)}}catch(t){f=!0,h=t}finally{try{!c&&v.return&&v.return()}finally{if(f)throw h}}}}else pa(l)?n||e.appendChild(l.element):n?l._renderNode(e.childNodes[r++]):e.appendChild(l.render())}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}},{key:"_setUpListeners",value:function(t){var e=this;if(this.eventListeners){var n=function(n){var r=n.split("@"),i=Bs(r,2),o=i[0],a=i[1];e.eventListeners[n].forEach(function(e){e.activateDomEventListener(t,o,a)})};for(var r in this.eventListeners)n(r)}}},{key:"_bindToObservable",value:function(t){var e=arguments;t.filter(function(t){return!ya(t)}).filter(function(t){return t.observable}).forEach(function(t){return t.activateAttributeListener.apply(t,e)}),ea.apply(void 0,arguments)}}],[{key:"bind",value:function(t,e){return{to:function(n,r){return new ly({eventNameOrFunction:n,attribute:n,observable:t,emitter:e,callback:r})},if:function(n,r,i){return new cy({observable:t,emitter:e,attribute:n,valueIfTrue:r,callback:i})}}}},{key:"extend",value:function(t,e){va(t,aa(oa(e)))}}]),t}();J(sy,qs);var uy=function(){function t(e){Fs(this,t),Object.assign(this,e)}return Ns(t,[{key:"getValue",value:function(t){var e=this.observable[this.attribute];return this.callback?this.callback(e,t):e}},{key:"activateAttributeListener",value:function(t,e,n){this.emitter.listenTo(this.observable,"change:"+this.attribute,function(){ea(t,e,n)})}}]),t}(),ly=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"activateDomEventListener",value:function(t,e,n){var r=this;this.emitter.listenTo(t,e,function(t,e){n&&!e.target.matches(n)||("function"==typeof r.eventNameOrFunction?r.eventNameOrFunction(e):r.observable.fire(r.eventNameOrFunction,e))})}}]),e}(uy),cy=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"getValue",value:function(t){var n=js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getValue",this).call(this,t);return!ya(n)&&(this.valueIfTrue||!0)}}]),e}(uy),fy=function(){function t(e){Fs(this,t),this.locale=e,this.t=e&&e.t,this.set("ready",!1),this._viewCollections=new iy,this._unboundChildren=this.createCollection(),this._viewCollections.on("add",function(t,n){n.locale=e})}return Ns(t,[{key:"createCollection",value:function(){var t=new oy;return this._viewCollections.add(t),t}},{key:"addChildren",value:function(t){Y(t)||(t=[t]);var e=!0,n=!1,r=void 0;try{for(var i,o=t[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;this._unboundChildren.add(a)}}catch(t){n=!0,r=t}finally{try{!e&&o.return&&o.return();
}finally{if(n)throw r}}}},{key:"init",value:function(){var t=this;if(this.ready)throw new Qs("ui-view-init-reinit: This View has already been initialized.");return Promise.resolve().then(function(){return Promise.all(t._viewCollections.map(function(t){return t.init()}))}).then(function(){t.ready=!0})}},{key:"destroy",value:function(){this.stopListening();var t=this._viewCollections.map(function(t){return t.destroy()});return this._unboundChildren.clear(),this._viewCollections.clear(),this.element&&this.element.remove(),this.element=this.template=this.locale=this.t=this._viewCollections=this._unboundChildren=null,Promise.all(t)}},{key:"element",get:function(){return this._element?this._element:this.template?this._element=this.template.render():null},set:function(t){this._element=t}},{key:"bindTemplate",get:function(){return this._bindTemplate?this._bindTemplate:this._bindTemplate=sy.bind(this,this)}}]),t}();J(fy,Lv),J(fy,Zu);var hy=function(t){function e(t,n){Fs(this,e);var r=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.template=new sy({tag:"svg",ns:"http://www.w3.org/2000/svg",attributes:{class:"ck-icon-manager__sprite"}}),r.sprite=t,r.icons=n,r}return Ms(e,t),Ns(e,[{key:"init",value:function(){var t=document.createElement("div");t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+this.sprite+"</svg>";for(var n=t.firstChild.childNodes,r=0;r<n.length;++r)this.element.appendChild(document.importNode(n[r],!0));return js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this)}}]),e}(fy),dy=function t(e,n){Fs(this,t),n&&Gu(this,n),e&&this.set(e)};J(dy,Zu);var vy=["ck-icon-align-center","ck-icon-align-left","ck-icon-align-right","ck-icon-bold","ck-icon-bold","ck-icon-bulletedlist","ck-icon-image","ck-icon-italic","ck-icon-italic","ck-icon-link","ck-icon-numberedlist","ck-icon-picker","ck-icon-quote","ck-icon-redo","ck-icon-source","ck-icon-table","ck-icon-underline","ck-icon-undo","ck-icon-unlink"],yy="ck-icon-",py=new dy({icons:vy.map(function(t){return t.slice(yy.length)}),sprite:'<symbol viewBox="0 0 20 20" id="ck-icon-align-center"><title>align-center</title><path d="M16 10v1H4v-1h12zm-1 6v1H5v-1h10zm3-3v1H2v-1h16zm-2-9v1H4V4h12zm2 3v1H2V7h16z" fill="#444" fill-rule="evenodd"/></symbol><symbol viewBox="0 0 20 20" id="ck-icon-align-left"><title>align-left</title><path d="M3 10v1h12v-1H3zm0 6v1h10v-1H3zm0-3v1h15v-1H3zm0-9v1h12V4H3zm0 3v1h15V7H3z" fill="#444" fill-rule="evenodd"/></symbol><symbol viewBox="0 0 20 20" id="ck-icon-align-right"><title>align-right</title><path d="M17 10v1H5v-1h12zm0 6v1H7v-1h10zm0-3v1H2v-1h15zm0-9v1H5V4h12zm0 3v1H2V7h15z" fill="#444" fill-rule="evenodd"/></symbol><symbol viewBox="0 0 20 20" id="ck-icon-bold"><title>bold</title><path d="M15.135 10.409c.361.248.654.56.88.934.225.375.338.816.338 1.324 0 .609-.128 1.123-.385 1.543-.256.42-.624.751-1.103.994a5.908 5.908 0 0 1-1.755.55c-.663.107-1.442.16-2.338.16H4.539v-.66a22.5 22.5 0 0 0 .66-.076c.265-.033.45-.073.558-.118.208-.085.35-.196.427-.334.076-.138.114-.317.114-.537V5.732c0-.203-.031-.372-.093-.507s-.211-.254-.448-.355a3.326 3.326 0 0 0-.61-.182 14.136 14.136 0 0 0-.608-.114v-.66h6.52c1.64 0 2.825.226 3.552.677.727.45 1.09 1.116 1.09 1.995 0 .406-.08.763-.244 1.07a2.388 2.388 0 0 1-.702.8 4.214 4.214 0 0 1-.99.54c-.383.153-.795.28-1.234.381v.16c.44.046.896.143 1.37.292.473.15.885.343 1.234.58zm-2.723-3.611c0-.665-.187-1.184-.562-1.556-.375-.372-.937-.558-1.687-.558-.107 0-.247.004-.419.012l-.444.021v4.449h.44c.913 0 1.587-.213 2.021-.639.434-.425.651-1.002.651-1.73zm.592 5.759c0-.835-.248-1.475-.744-1.92-.496-.445-1.21-.668-2.14-.668a22.977 22.977 0 0 0-.82.034v4.389c.05.208.209.385.474.528.265.144.586.216.964.216.67 0 1.216-.225 1.636-.676.42-.452.63-1.086.63-1.903z" fill="#454545" fill-rule="evenodd"/></symbol><symbol viewBox="0 0 20 20" id="ck-icon-bold"><title>bold</title><path d="M15.135 10.409c.361.248.654.56.88.934.225.375.338.816.338 1.324 0 .609-.128 1.123-.385 1.543-.256.42-.624.751-1.103.994a5.908 5.908 0 0 1-1.755.55c-.663.107-1.442.16-2.338.16H4.539v-.66a22.5 22.5 0 0 0 .66-.076c.265-.033.45-.073.558-.118.208-.085.35-.196.427-.334.076-.138.114-.317.114-.537V5.732c0-.203-.031-.372-.093-.507s-.211-.254-.448-.355a3.326 3.326 0 0 0-.61-.182 14.136 14.136 0 0 0-.608-.114v-.66h6.52c1.64 0 2.825.226 3.552.677.727.45 1.09 1.116 1.09 1.995 0 .406-.08.763-.244 1.07a2.388 2.388 0 0 1-.702.8 4.214 4.214 0 0 1-.99.54c-.383.153-.795.28-1.234.381v.16c.44.046.896.143 1.37.292.473.15.885.343 1.234.58zm-2.723-3.611c0-.665-.187-1.184-.562-1.556-.375-.372-.937-.558-1.687-.558-.107 0-.247.004-.419.012l-.444.021v4.449h.44c.913 0 1.587-.213 2.021-.639.434-.425.651-1.002.651-1.73zm.592 5.759c0-.835-.248-1.475-.744-1.92-.496-.445-1.21-.668-2.14-.668a22.977 22.977 0 0 0-.82.034v4.389c.05.208.209.385.474.528.265.144.586.216.964.216.67 0 1.216-.225 1.636-.676.42-.452.63-1.086.63-1.903z" fill="#454545" fill-rule="evenodd"/></symbol><symbol viewBox="0 0 20 20" id="ck-icon-bulletedlist"><title>bulletedlist</title><path d="M6 16v1h10v-1H6zM6 4v1h12V4H6zm0 6v1h11v-1H6zM1 4.5C1 3.672 1.666 3 2.5 3 3.328 3 4 3.666 4 4.5 4 5.328 3.334 6 2.5 6 1.672 6 1 5.334 1 4.5zm0 6C1 9.672 1.666 9 2.5 9c.828 0 1.5.666 1.5 1.5 0 .828-.666 1.5-1.5 1.5-.828 0-1.5-.666-1.5-1.5zm0 6c0-.828.666-1.5 1.5-1.5.828 0 1.5.666 1.5 1.5 0 .828-.666 1.5-1.5 1.5-.828 0-1.5-.666-1.5-1.5z" fill="#454545" fill-rule="evenodd"/></symbol><symbol viewBox="0 0 20 20" id="ck-icon-image"><title>image</title><path d="M2 14.994C2 16.102 2.895 17 3.994 17h12.012A2 2 0 0 0 18 14.994V5.006A2.001 2.001 0 0 0 16.006 3H3.994A2 2 0 0 0 2 5.006v9.988zm1-9.992C3 4.45 3.45 4 4.007 4h11.986A1.01 1.01 0 0 1 17 5.002v9.996C17 15.55 16.55 16 15.993 16H4.007A1.01 1.01 0 0 1 3 14.998V5.002zm1.024 10H16v-3.096l-2.89-4.263-3.096 5.257-3.003-2.103L4 13.96l.024 1.043zM6.406 6A1.4 1.4 0 0 0 5 7.393a1.4 1.4 0 0 0 1.406 1.393 1.4 1.4 0 0 0 1.407-1.393A1.4 1.4 0 0 0 6.406 6z" fill="#454545" fill-rule="evenodd"/></symbol><symbol viewBox="0 0 20 20" id="ck-icon-italic"><title>italic</title><path d="M13.825 3.914l-.126.558a5.701 5.701 0 0 0-.685.076c-.282.045-.49.088-.626.127-.237.073-.406.186-.508.338a1.586 1.586 0 0 0-.22.5l-2.03 8.769a1.24 1.24 0 0 0-.034.27c.001.13.03.24.086.33.056.09.157.17.304.237.085.04.27.086.558.14.288.053.502.086.643.097l-.127.558H5.656l.127-.558.677-.05c.293-.023.501-.057.625-.102a1.11 1.11 0 0 0 .5-.326c.112-.138.188-.306.228-.503l2.02-8.778a1.428 1.428 0 0 0 .035-.305.59.59 0 0 0-.072-.295c-.048-.085-.148-.161-.3-.229a3.457 3.457 0 0 0-.622-.19 5.001 5.001 0 0 0-.58-.106l.128-.558h5.403z" fill="#454545" fill-rule="evenodd"/></symbol><symbol viewBox="0 0 20 20" id="ck-icon-italic"><title>italic</title><path d="M13.825 3.914l-.126.558a5.701 5.701 0 0 0-.685.076c-.282.045-.49.088-.626.127-.237.073-.406.186-.508.338a1.586 1.586 0 0 0-.22.5l-2.03 8.769a1.24 1.24 0 0 0-.034.27c.001.13.03.24.086.33.056.09.157.17.304.237.085.04.27.086.558.14.288.053.502.086.643.097l-.127.558H5.656l.127-.558.677-.05c.293-.023.501-.057.625-.102a1.11 1.11 0 0 0 .5-.326c.112-.138.188-.306.228-.503l2.02-8.778a1.428 1.428 0 0 0 .035-.305.59.59 0 0 0-.072-.295c-.048-.085-.148-.161-.3-.229a3.457 3.457 0 0 0-.622-.19 5.001 5.001 0 0 0-.58-.106l.128-.558h5.403z" fill="#454545" fill-rule="evenodd"/></symbol><symbol viewBox="0 0 20 20" id="ck-icon-link"><title>link</title><g transform="rotate(45 5.793 16.243)" fill="#222" fill-rule="evenodd"><path d="M8 6.56V4.824A3.995 3.995 0 0 0 4 .828a4 4 0 0 0-4 3.997v2.93a3.995 3.995 0 0 0 4 3.997c.551 0 1.077-.112 1.555-.314H5.12v-.903A2.99 2.99 0 0 1 4 10.752c-1.657 0-3-1.336-3-2.997v-2.93a3 3 0 0 1 6 0v1.734h1z"/><path d="M2.636 6.902A3.99 3.99 0 0 1 4 6.662c2.21 0 4 1.786 4 3.997v2.93a4 4 0 0 1-4 3.997c-2.21 0-4-1.785-4-3.996v-1.927h1v1.927a3 3 0 0 0 6 0v-2.931a2.995 2.995 0 0 0-3-2.996c-.49 0-.954.118-1.364.327V6.902z"/></g></symbol><symbol viewBox="0 0 20 20" id="ck-icon-numberedlist"><title>numberedlist</title><g transform="translate(2 2)" fill="#454545" fill-rule="evenodd"><path d="M5 15h10v-1H5v1zM4 2v1h13V2H4zm1 6v1h11V8H5zM0 .5c0 .277.223.5.5.5H1v3.5a.499.499 0 1 0 1 0v-4c0-.277-.223-.5-.5-.5h-1C.223 0 0 .223 0 .5zM.5 6a.499.499 0 1 0 0 1H2v1H.5c-.277 0-.5.223-.5.5v2c0 .277.223.5.5.5h2a.499.499 0 1 0 0-1H1V9h1.5a.46.46 0 0 0 .188-.031.45.45 0 0 0 .28-.281A.461.461 0 0 0 3 8.5v-2a.46.46 0 0 0-.031-.187.45.45 0 0 0-.281-.282.463.463 0 0 0-.126-.03H.5V6zM2.852 16.853a.493.493 0 0 0 .148-.35v-4.005A.493.493 0 0 0 2.505 12H.495a.494.494 0 0 0-.495.5c0 .268.222.5.495.5H2v1H.495a.494.494 0 0 0-.495.5c0 .268.222.5.495.5H2v1H.495a.494.494 0 0 0-.495.5c0 .268.222.5.495.5h2.01a.49.49 0 0 0 .351-.146z"/></g></symbol><symbol viewBox="0 0 20 20" id="ck-icon-picker"><title>picker</title><path d="M9.635 7.529l-6.252 6.474A2 2 0 0 0 6.26 16.78l6.252-6.473-.72-.695-6.251 6.474a1 1 0 0 1-1.439-1.39l6.252-6.473-.72-.695zm5.125.746c.115-.096.238-.21.369-.346 1.332-1.379 1.76-3.127.955-3.903-.805-.777-2.537-.29-3.868 1.09-.131.136-.241.262-.332.38l2.876 2.779zm-4.755-3.27l4.774 4.61-.662.685-4.774-4.61.662-.685z" fill="#454545" fill-rule="evenodd"/></symbol><symbol viewBox="0 0 20 20" id="ck-icon-quote"><title>quote</title><path d="M12.061 15.51v-.882c1.395-.847 2.345-1.633 2.85-2.358.37-.533.554-1.162.554-1.887 0-.437-.082-.759-.246-.964-.15-.205-.328-.307-.533-.307-.137 0-.328.048-.574.143-.37.123-.67.185-.902.185-.547 0-1.033-.205-1.456-.615-.424-.41-.636-.923-.636-1.538 0-.698.212-1.238.636-1.62a3.002 3.002 0 0 1 2.05-.78c.93 0 1.757.39 2.482 1.17.724.778 1.087 1.742 1.087 2.89 0 1.614-.602 3.084-1.805 4.41-.807.875-1.976 1.593-3.507 2.153zm-8.386 0v-.882c1.394-.847 2.345-1.633 2.85-2.358.37-.533.554-1.162.554-1.887 0-.437-.082-.759-.246-.964-.15-.205-.328-.307-.533-.307-.137 0-.328.048-.574.143-.37.123-.67.185-.903.185-.547 0-1.032-.205-1.456-.615-.424-.41-.636-.923-.636-1.538 0-.698.212-1.238.636-1.62a3.002 3.002 0 0 1 2.051-.78c.93 0 1.757.39 2.481 1.17.725.778 1.087 1.742 1.087 2.89 0 1.614-.601 3.084-1.804 4.41-.807.875-1.976 1.593-3.507 2.153z" fill="#454545" fill-rule="evenodd"/></symbol><symbol viewBox="0 0 20 20" id="ck-icon-redo"><title>redo</title><path d="M10 16l1-3.982c-3.417 0-8.616.869-10 3.982 0-5.983 6.601-7.96 10-7.96 0-.85-1-3.32-1-4.04l8 6-8 6z" fill="#454545" fill-rule="evenodd"/></symbol><symbol viewBox="0 0 20 20" id="ck-icon-source"><title>source</title><path d="M15.116 7.961l2.426 2.206-.01-.417-.01-.525-5.87 5.831.916.923 5.87-5.832.485-.482-.506-.46-2.419-2.198-.882.954zm-2.96-2.69l-.483-.44.874-.961.491.446-.882.955zm-7.041 7.612l-2.442-2.22-.507-.46.486-.483 5.87-5.83.915.922-5.87 5.83-.02-.941 2.45 2.227-.882.955zm2.96 2.69l.467.425.875-.962-.46-.417-.882.955zM4.518 17.43L17.475 3.422l-.954-.882L3.564 16.548l.954.882z" fill="#232323" fill-rule="evenodd"/></symbol><symbol viewBox="0 0 20 20" id="ck-icon-table"><title>table</title><path d="M3.994 4A2 2 0 0 0 2 6.006v9.988C2 17.102 2.895 18 3.994 18h12.012A2 2 0 0 0 18 15.994V6.006A2.001 2.001 0 0 0 16.006 4H3.994zM3 6.018h4v3H3v-3zm5 0h4v3H8v-3zm5 0h4v3h-4v-3zm-10 4h4v3H3v-3zm5 0h4v3H8v-3zm5 0h4v3h-4v-3zm-10 4h4v3H3v-3zm5 0h4v3H8v-3zm5 0h4v3h-4v-3z" fill="#454545" fill-rule="evenodd"/></symbol><symbol viewBox="0 0 20 20" id="ck-icon-underline"><title>underline</title><g transform="translate(4 3)" fill="none" fill-rule="evenodd"><path d="M12.628 1.5c-.154.006-.38.039-.678.1a2.11 2.11 0 0 0-.726.272c-.188.127-.317.388-.388.785-.072.396-.108.88-.108 1.453v5.096c0 .65-.135 1.214-.405 1.693-.27.479-.624.873-1.065 1.18a4.49 4.49 0 0 1-1.375.641c-.482.13-.943.194-1.383.194-.705 0-1.333-.092-1.883-.277-.55-.184-1.013-.433-1.388-.747a3.143 3.143 0 0 1-.834-1.078 2.986 2.986 0 0 1-.28-1.268V2.615c0-.192-.032-.353-.096-.483-.063-.13-.191-.249-.384-.359a1.93 1.93 0 0 0-.528-.186A4.137 4.137 0 0 0 .578 1.5V.914H5.46V1.5c-.154.006-.348.03-.582.075a3.874 3.874 0 0 0-.516.124c-.188.066-.313.176-.376.33a1.313 1.313 0 0 0-.095.504v6.475c0 .313.034.642.103.987.069.344.205.664.409.962.215.303.506.55.875.743.37.193.876.29 1.52.29.606 0 1.114-.097 1.524-.29.41-.193.733-.446.97-.76.226-.297.386-.608.48-.933.093-.325.14-.652.14-.983V4.218c0-.612-.045-1.111-.133-1.5-.088-.388-.217-.642-.388-.763-.192-.138-.455-.245-.788-.322a5.096 5.096 0 0 0-.764-.133V.914h4.79V1.5z" fill="#454545"/><path fill="#585858" d="M0 14h12v1H0z"/></g></symbol><symbol viewBox="0 0 20 20" id="ck-icon-undo"><title>undo</title><path d="M2 10l8 6-1-3.982c3.417 0 8.616.869 10 3.982 0-5.983-6.601-7.96-10-7.96 0-.85 1-3.32 1-4.04l-8 6z" fill="#454545" fill-rule="evenodd"/></symbol><symbol viewBox="0 0 20 20" id="ck-icon-unlink"><title>unlink</title><g transform="rotate(45 5.793 16.243)" fill="#222" fill-rule="evenodd"><path d="M8 6.56V4.824A3.995 3.995 0 0 0 4 .828a4 4 0 0 0-4 3.997v2.93a3.995 3.995 0 0 0 4 3.997c.551 0 1.077-.112 1.555-.314H5.12v-.903A2.99 2.99 0 0 1 4 10.752c-1.657 0-3-1.336-3-2.997v-2.93a3 3 0 0 1 6 0v1.734h1z"/><path d="M12.13 9.692V6.076h-1.02v3.616H7.793v1.02h3.317v3.616h1.02v-3.616h3.915v-1.02H12.13zm-4.604-1.05A4.067 4.067 0 0 0 2.689 6.98v1.123c.418-.216.891-.338 1.392-.338 1.166 0 2.18.656 2.697 1.625l.748-.748zm.636 3.752v1.484c0 2.276-1.83 4.122-4.08 4.122C1.825 18 0 16.159 0 13.878v-1.987h1.02v1.987c0 1.713 1.37 3.09 3.061 3.09 1.687 0 3.061-1.383 3.061-3.09v-2.504l1.02 1.02z"/></g></symbol>'}),my=function(t){function e(t){Fs(this,e);var n=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.body=n.createCollection(),n}return Ms(e,t),Ns(e,[{key:"init",value:function(){var t=this;return Promise.resolve().then(function(){return t._renderBodyCollection()}).then(function(){return t._setupIconManager()}).then(function(){return js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",t).call(t)})}},{key:"destroy",value:function(){return this._bodyCollectionContainer.remove(),js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this)}},{key:"_setupIconManager",value:function(){return this.iconManagerView=new hy(py.sprite,py.icons),this.body.add(this.iconManagerView)}},{key:"_renderBodyCollection",value:function(){var t=this._bodyCollectionContainer=new sy({tag:"div",attributes:{class:["ck-body","ck-rounded-corners","ck-reset_all"]},children:this.body}).render();document.body.appendChild(t)}}]),e}(fy),gy=function(t){function n(t){Fs(this,n);var r=Is(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t)),i=r.t,o=e();return r.set("width",null),r.set("height",null),r.top=r.createCollection(),r.main=r.createCollection(),r.template=new sy({tag:"div",attributes:{class:["ck-reset","ck-editor","ck-rounded-corners"],role:"application",dir:"ltr",lang:t.lang,"aria-labelledby":"cke-editor__aria-label_"+o},children:[{tag:"span",attributes:{id:"cke-editor__aria-label_"+o,class:"cke-voice-label"},children:[i("Rich Text Editor")]},{tag:"div",attributes:{class:"ck-editor__top ck-reset_all",role:"presentation"},children:r.top},{tag:"div",attributes:{class:"ck-editor__main",role:"presentation"},children:r.main}]}),r}return Ms(n,t),n}(my),by=function(t){function e(t,n){Fs(this,e);var r=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t)),i=r.bindTemplate;return n&&(r.element=r.editableElement=n),r.template=new sy({tag:"div",attributes:{class:[i.to("isFocused",function(t){return t?"ck-focused":"ck-blurred"}),"ck-editor__editable"],contenteditable:i.to("isReadOnly",function(t){return!t})}}),r.set("isReadOnly",!1),r.set("isFocused",!1),r}return Ms(e,t),Ns(e,[{key:"init",value:function(){return this.editableElement?this.template.apply(this.editableElement):this.editableElement=this.element,js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this)}},{key:"destroy",value:function(){return this.editableElement.contentEditable=!1,js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this)}}]),e}(fy),_y=function(t){function e(t,n){Fs(this,e);var r=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),i=r.bindTemplate,o=r.t;r.set("name",null);var a=function(t){return o("Rich Text Editor, %0",[t])};return sy.extend(r.template,{attributes:{role:"textbox","aria-label":i.to("name",a),title:i.to("name",a),class:"ck-editor__editable_inline"}}),r}return Ms(e,t),e}(by),wy={window:window,document:document},ky=function(t){function e(t){Fs(this,e);var n=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.items=n.createCollection(),n.template=new sy({tag:"div",attributes:{class:["ck-toolbar"]},children:n.items}),n}return Ms(e,t),e}(fy),xy=ga("px"),Oy=function(t){function e(t){Fs(this,e);var n=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t)),r=n.bindTemplate;return n.set("isActive",!1),n.set("isSticky",!1),n.set("limiterElement",null),n.set("limiterOffset",50),n.set("_marginLeft",null),n.set("_isStickyToTheLimiter",!1),sy.extend(n.template,{attributes:{class:[r.if("isSticky","ck-toolbar_sticky"),r.if("_isStickyToTheLimiter","ck-toolbar_sticky_bottom-limit")],style:{width:r.to("isSticky",function(t){return t?xy(n._elementPlaceholder.getBoundingClientRect().width):null}),bottom:r.to("_isStickyToTheLimiter",function(t){return t?xy(n.limiterOffset):null}),marginLeft:r.to("_marginLeft")}}}),n._elementPlaceholder=new sy({tag:"div",attributes:{class:["ck-toolbar__placeholder"],style:{display:r.to("isSticky",function(t){return t?"block":"none"}),height:r.to("isSticky",function(t){return t?xy(n._toolbarRect.height):null})}}}).render(),n}return Ms(e,t),Ns(e,[{key:"init",value:function(){var t=this;js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.element.parentNode.insertBefore(this._elementPlaceholder,this.element),this.listenTo(wy.window,"scroll",function(){t._checkIfShouldBeSticky()}),this.listenTo(this,"change:isActive",function(){t._checkIfShouldBeSticky()})}},{key:"destroy",value:function(){var t=this;return js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this).then(function(){t._elementPlaceholder.remove()})}},{key:"_checkIfShouldBeSticky",value:function(){var t=this._limiterRect=this.limiterElement.getBoundingClientRect(),e=this._toolbarRect=this.element.getBoundingClientRect();this.isSticky=this.isActive&&t.top<0&&this._toolbarRect.height+this.limiterOffset<t.height,this.isSticky?(this._isStickyToTheLimiter=t.bottom<e.height+this.limiterOffset,this._marginLeft=this._isStickyToTheLimiter?null:xy(-wy.window.scrollX)):(this._isStickyToTheLimiter=!1,this._marginLeft=null)}}]),e}(ky),Sy=function(t){function e(t){Fs(this,e);var n=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.toolbar=new Oy(t),n.editable=new _y(t),n.top.add(n.toolbar),n.main.add(n.editable),n}return Ms(e,t),Ns(e,[{key:"editableElement",get:function(){return this.editable.element}}]),e}(gy),Py=function(){function t(){Fs(this,t),this._replacedElements=[]}return Ns(t,[{key:"replace",value:function(t,e){this._replacedElements.push({element:t,newElement:e}),t.style.display="none",e&&t.parentNode.insertBefore(e,t.nextSibling)}},{key:"restore",value:function(){this._replacedElements.forEach(function(t){var e=t.element,n=t.newElement;e.style.display="",n&&n.remove()}),this._replacedElements=[]}}]),t}(),Ay=function(t){function e(t,n){Fs(this,e);var r=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return r.document.createRoot(),r.data.processor=new ty,r.ui=new ry(r,new Sy(r.locale)),r._elementReplacer=new Py,r}return Ms(e,t),Ns(e,[{key:"destroy",value:function(){var t=this;return this.updateEditorElement(),this._elementReplacer.restore(),this.ui.destroy().then(function(){return js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",t).call(t)})}}],[{key:"create",value:function(t,n){return new Promise(function(r){var i=new e(t,n);r(i.initPlugins().then(function(){return i._elementReplacer.replace(t,i.ui.view.element)}).then(function(){return i.ui.init()}).then(function(){return i.fire("uiReady")}).then(function(){return i.editing.view.attachDomRoot(i.ui.view.editableElement)}).then(function(){return i.loadDataFromEditorElement()}).then(function(){i.fire("dataReady"),i.fire("ready")}).then(function(){return i}))})}}]),e}(Xv),Cy=function t(e,n,r){Fs(this,t);var i=void 0;"function"==typeof r?i=r:!function(){var t=r;i=function(n){var r=n.batch;e.execute(t,{batch:r})}}(),e.document.on("change",function(t,r,o){if("insert"==r){var a=o.range.getItems().next().value;if(a instanceof cl){var s=a.textNode,u=s.data;if("paragraph"===s.parent.name&&u){var l=n.exec(u);l&&e.document.enqueueChanges(function(){var t=e.document.batch(),n=hl.createFromParentsAndOffsets(s.parent,0,s.parent,l[0].length);t.remove(n),i({batch:t,match:l})})}}}})},Ty=function t(e,n,r){var i=this;Fs(this,t),this.editor=e;var o=void 0,a=void 0,s=void 0,u=void 0;n instanceof RegExp?o=n:s=n,"string"==typeof r?a=r:u=r,s=s||function(t){for(var e=void 0,n=[],r=[];null!==(e=o.exec(t))&&!(e&&e.length<4);){var i=e,a=i.index,s=i[1],u=i[2],l=i[3],c=s+u+l;a+=e[0].length-c.length;var f=[a,a+s.length],h=[a+s.length+u.length,a+s.length+u.length+l.length];n.push(f),n.push(h),r.push([a+s.length,a+s.length+u.length])}return{remove:n,format:r}},u=u||function(t,e){var n=!0,r=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;t.setAttribute(u,a,!0)}}catch(t){r=!0,i=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}},e.document.on("change",function(t,n){if("insert"===n){var r=i.editor.document.selection;if(r.isCollapsed&&r.focus&&r.focus.parent){var o=r.focus.parent,l=_a(o).slice(0,r.focus.offset),c=s(l),f=[];c.format.forEach(function(t){void 0!==t[0]&&void 0!==t[1]&&f.push(vv.createFromParentsAndOffsets(o,t[0],o,t[1]))});var h=[];if(c.remove.slice().reverse().forEach(function(t){void 0!==t[0]&&void 0!==t[1]&&h.push(vv.createFromParentsAndOffsets(o,t[0],o,t[1]))}),f.length&&h.length){var d=e.document.batch();e.document.enqueueChanges(function(){var t=ba(a,f,e.document.schema);u(d,t);var n=!0,r=!1,i=void 0;try{for(var o,s=h[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value;d.remove(l)}}catch(t){r=!0,i=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}})}}}})},Ey=function(){function t(){Fs(this,t),this._dispatchers=[],this._from=null}return Ns(t,[{key:"for",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return this._dispatchers=e,this}},{key:"fromElement",value:function(t){return this._from={type:"element",name:t,priority:null},this}},{key:"fromAttribute",value:function(t){return this._from={type:"attribute",key:t,priority:null},this}},{key:"fromMarker",value:function(t){return this._from={type:"marker",name:t,priority:null},this}},{key:"withPriority",value:function(t){return this._from.priority=t,this}},{key:"toElement",value:function(t){var e=null===this._from.priority?"normal":this._from.priority,n=!0,r=!1,i=void 0;try{for(var o,a=this._dispatchers[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;"element"==this._from.type?(t="string"==typeof t?new gl(t):t,s.on("insert:"+this._from.name,zt(t),{priority:e})):"attribute"==this._from.type?(t="string"==typeof t?new Al(t):t,s.on("addAttribute:"+this._from.key,Kt(t),{priority:e}),s.on("changeAttribute:"+this._from.key,Kt(t),{priority:e}),s.on("removeAttribute:"+this._from.key,Wt(t),{priority:e}),s.on("selectionAttribute:"+this._from.key,Wo(t),{priority:e})):(t="string"==typeof t?new Al(t):t,s.on("addMarker:"+this._from.name,Jt(t),{priority:e}),s.on("removeMarker:"+this._from.name,Ut(t),{priority:e}))}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}}},{key:"toAttribute",value:function(t,e){if("attribute"!=this._from.type)throw new Qs("build-model-converter-non-attribute-to-attribute: To-attribute conversion is supported only from model attributes.");var n=void 0;n=t?"string"==typeof t?e?function(){return{key:t,value:e}}:function(e){return{key:t,value:e}}:t:void 0;var r=!0,i=!1,o=void 0;try{for(var a,s=this._dispatchers[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value,l={priority:this._from.priority||"normal"};u.on("addAttribute:"+this._from.key,Ht(n),l),u.on("changeAttribute:"+this._from.key,Ht(n),l),u.on("removeAttribute:"+this._from.key,$t(n),l)}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}}}]),t}(),Ry=function(){function t(){Fs(this,t),this._dispatchers=[],this._from=[]}return Ns(t,[{key:"for",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return this._dispatchers=e,this}},{key:"fromElement",value:function(t){return this.from({name:t})}},{key:"fromAttribute",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:/.*/,n={};return n[t]=e,this.from(n)}},{key:"from",value:function(t){return t instanceof pl||(t=new pl(t)),this._from.push({matcher:t,consume:!1,priority:null}),this}},{key:"consuming",value:function(t){var e=this._from[this._from.length-1];return e.consume=t,this}},{key:"withPriority",value:function(t){var e=this._from[this._from.length-1];return e.priority=t,this}},{key:"toElement",value:function(t){var e=function(e){return function(n,r,i,o){var a=e.matcher.matchAll(r.input);if(a){var s=!0,u=!1,l=void 0;try{for(var c,f=a[Symbol.iterator]();!(s=(c=f.next()).done);s=!0){var h=c.value,d=t instanceof Function?t(r.input):new sl(t),v=Array.from(d.getAttributeKeys());if(o.schema.check({name:d.name,attributes:v,inside:r.context})&&i.consume(r.input,e.consume||h.match)){r.context.push(d);var y=o.convertChildren(r.input,i,r),p=ll.createAt(d,"end");Nl.insert(p,y),r.context.pop(),r.output=d;break}}}catch(t){u=!0,l=t}finally{try{!s&&f.return&&f.return()}finally{if(u)throw l}}}}};this._setCallback(e,"normal")}},{key:"toAttribute",value:function(t,e){var n=function(n){return function(r,i,o,a){var s=n.matcher.matchAll(i.input);if(s){var u=!0,l=!1,c=void 0;try{for(var f,h=s[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var d=f.value;if(o.consume(i.input,n.consume||d.match)){i.output||(i.output=a.convertChildren(i.input,o,i));var v=t instanceof Function?t(i.input):{key:t,value:e};ka(i.output,v,i,a);break}}}catch(t){l=!0,c=t}finally{try{!u&&h.return&&h.return()}finally{if(l)throw c}}}}};this._setCallback(n,"low")}},{key:"_setCallback",value:function(t,e){var n=!0,r=!1,i=void 0;try{for(var o,a=this._from[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,u=s.matcher.getElementName(),l=u?"element:"+u:"element",c=t(s),f=null===s.priority?e:s.priority,h=!0,d=!1,v=void 0;try{for(var y,p=this._dispatchers[Symbol.iterator]();!(h=(y=p.next()).done);h=!0){var m=y.value;m.on(l,c,{priority:f})}}catch(t){d=!0,v=t}finally{try{!h&&p.return&&p.return()}finally{if(d)throw v}}}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}}}]),t}(),Vy=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"init",value:function(){var t=this.editor,e=t.document,n=t.data,r=t.editing;e.schema.registerItem("paragraph","$block"),wa().for(n.modelToView,r.modelToView).fromElement("paragraph").toElement("p"),xa().for(n.viewToModel).fromElement("p").toElement("paragraph"),n.viewToModel.on("text",function(t,n,r,i){Oa(e,t,n,r,i)},{priority:"lowest"}),n.viewToModel.on("element",Pa,{priority:"lowest"}),n.viewToModel.on("documentFragment",Pa,{priority:"lowest"}),n.viewToModel.on("element",function(t,n,r,i){Sa(e,t,n,r,i)},{priority:"low"})}}]),e}(tl);Vy.paragraphLikeElements=new Set(["blockquote","dd","div","dt","h1","h2","h3","h4","h5","h6","li","p","td"]);var Fy=new WeakSet,Ny=function(){function t(e){var n=this;Fs(this,t),this.editor=e,this.set("isEnabled",!0),this._checkEnabled&&this.on("refreshState",function(t,e){e.isEnabled=n._checkEnabled()})}return Ns(t,[{key:"destroy",value:function(){this.stopListening()}},{key:"refreshState",value:function(){var t={isEnabled:!0};this.fire("refreshState",t),this.isEnabled=t.isEnabled}},{key:"_execute",value:function(t){this.isEnabled&&this._doExecute(t)}},{key:"_disable",value:function(){this.on("refreshState",Ca),this.refreshState()}},{key:"_enable",value:function(){this.off("refreshState",Ca),this.refreshState()}},{key:"_doExecute",value:function(){}}]),t}();J(Ny,Zu);var jy=function(t){function e(t,n){Fs(this,e);var r=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.formats=n,r.set("value",r.defaultFormat),r.listenTo(t.document,"changesDone",function(){return r._updateValue()}),r}return Ms(e,t),Ns(e,[{key:"_doExecute",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.formatId||this.defaultFormat.id,r=this.editor.document,i=r.selection,o=i.getFirstPosition(),a=[],s=[].concat(Ds(i.getRanges())),u=i.isBackward,l=n===this.value.id;if(i.isCollapsed){var c=Ta(o);c&&a.push(c)}else{var f=!0,h=!1,d=void 0;try{for(var v,y=s[Symbol.iterator]();!(f=(v=y.next()).done);f=!0){var p=v.value,m=Ta(p.start),g=Ta(p.end,!1);for(a.push(m);m!==g;)m=m.nextSibling,a.push(m)}}catch(t){h=!0,d=t}finally{try{!f&&y.return&&y.return()}finally{if(h)throw d}}}r.enqueueChanges(function(){var i=e.batch||r.batch(),o=!0,c=!1,f=void 0;try{for(var h,d=a[Symbol.iterator]();!(o=(h=d.next()).done);o=!0){var v=h.value;l?v.name===n&&i.rename(v,t.defaultFormat.id):i.rename(v,n)}}catch(t){c=!0,f=t}finally{try{!o&&d.return&&d.return()}finally{if(c)throw f}}r.selection.setRanges(s,u)})}},{key:"_getFormatById",value:function(t){return this.formats.find(function(e){return e.id===t})||this.defaultFormat}},{key:"_updateValue",value:function(){var t=this.editor.document.selection.getFirstPosition(),e=Ta(t);e&&(this.value=this._getFormatById(e.name))}},{key:"defaultFormat",get:function(){return this._getFormatById("paragraph")}}]),e}(Ny),My=[{id:"paragraph",viewElement:"p",label:"Paragraph"},{id:"heading1",viewElement:"h2",label:"Heading 1"},{id:"heading2",viewElement:"h3",label:"Heading 2"},{id:"heading3",viewElement:"h4",label:"Heading 3"}],Iy=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"init",value:function(){var t=this.editor,e=t.data,n=t.editing,r=!0,i=!1,o=void 0;try{for(var a,s=My[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;"paragraph"!==u.id&&(t.document.schema.registerItem(u.id,"$block"),wa().for(e.modelToView,n.modelToView).fromElement(u.id).toElement(u.viewElement),xa().for(e.viewToModel).fromElement(u.viewElement).toElement(u.id))}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}var l=new jy(t,My);t.commands.set("heading",l)}},{key:"afterInit",value:function(){var t=this.editor,e=t.commands.get("heading"),n=t.commands.get("enter");n&&this.listenTo(n,"afterExecute",function(n,r){var i=t.document.selection.getFirstPosition().parent,o=r.batch,a=My.some(function(t){return t.id==i.name});a&&i.name!=e.defaultFormat.id&&0===i.childCount&&o.rename(i,e.defaultFormat.id)})}}],[{key:"requires",get:function(){return[Vy]}}]),e}(tl),By=function(t){function e(t,n){Fs(this,e);var r=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));r.type="bulleted"==n?"bulleted":"numbered",r.set("value",!1);var i=function(){r.refreshValue(),r.refreshState()};return r.listenTo(t.document.selection,"change:range",i),r.listenTo(t.document,"changesDone",i),r}return Ms(e,t),Ns(e,[{key:"refreshValue",value:function(){var t=this.editor.document.selection.getFirstPosition(),e=Ea(t);this.value=null!==e&&e.getAttribute("type")==this.type}},{key:"_doExecute",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.editor.document,r=Ra(n.selection,n.schema),i=this.value===!0;n.enqueueChanges(function(){var o=e.batch||n.batch();if(i){for(var a=r[r.length-1].nextSibling,s=Number.POSITIVE_INFINITY,u=[];a&&"listItem"==a.name&&0!==a.getAttribute("indent");){var l=a.getAttribute("indent");l<s&&(s=l);var c=l-s;u.push({element:a,indent:c}),a=a.nextSibling}u=u.reverse();var f=!0,h=!1,d=void 0;try{for(var v,y=u[Symbol.iterator]();!(f=(v=y.next()).done);f=!0){
var p=v.value;o.setAttribute(p.element,"indent",p.indent)}}catch(t){h=!0,d=t}finally{try{!f&&y.return&&y.return()}finally{if(h)throw d}}}var m=!0,g=!1,b=void 0;try{for(var _,w=r[Symbol.iterator]();!(m=(_=w.next()).done);m=!0){var k=_.value;i&&"listItem"==k.name?o.rename(k,"paragraph").removeAttribute(k,"type").removeAttribute(k,"indent"):i||"listItem"==k.name?i||"listItem"!=k.name||k.getAttribute("type")==t.type||o.setAttribute(k,"type",t.type):o.setAttribute(k,"type",t.type).setAttribute(k,"indent",0).rename(k,"listItem")}}catch(t){g=!0,b=t}finally{try{!m&&w.return&&w.return()}finally{if(g)throw b}}})}},{key:"_checkEnabled",value:function(){if(this.value)return!0;var t=this.editor.document.selection,e=this.editor.document.schema,n=Va(t.getFirstPosition(),e);return e.check({name:"listItem",inside:n,attributes:["type","indent"]})}}]),e}(Ny),Dy=function(t){function e(t,n){Fs(this,e);var r=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r._indentBy="forward"==n?1:-1,r.listenTo(t.document.selection,"change:range",function(){r.refreshState()}),r.listenTo(t.document,"changesDone",function(){r.refreshState()}),r}return Ms(e,t),Ns(e,[{key:"_doExecute",value:function(){var t=this,e=this.editor.document,n=e.batch(),r=Ea(e.selection.getFirstPosition());e.enqueueChanges(function(){for(var e=r.getAttribute("indent"),i=[r],o=r.nextSibling;o&&"listItem"==o.name&&o.getAttribute("indent")>e;)i.push(o),o=o.nextSibling;t._indentBy<0&&(i=i.reverse());var a=!0,s=!1,u=void 0;try{for(var l,c=i[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var f=l.value,h=f.getAttribute("indent")+t._indentBy;h<0?n.rename(f,"paragraph").removeAttribute(f,"indent").removeAttribute(f,"type"):n.setAttribute(f,"indent",h)}}catch(t){s=!0,u=t}finally{try{!a&&c.return&&c.return()}finally{if(s)throw u}}})}},{key:"_checkEnabled",value:function(){var t=Ea(this.editor.document.selection.getFirstPosition());if(!t)return!1;var e=t.previousSibling,n=t.getAttribute("indent"),r=n+this._indentBy;if(this._indentBy>0){if(!e||"listItem"!=e.name)return!1;if(e.getAttribute("indent")+1<r)return!1}return!0}}]),e}(Ny),Ly=function(t){function e(t,n){Fs(this,e);var r=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"li",t,n));return r.getFillerOffset=Fa,r}return Ms(e,t),e}(gl),zy=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"init",value:function(){var t=this.editor,e=t.document.schema;e.registerItem("listItem","$block"),e.allow({name:"listItem",inside:"$root",attributes:["type","indent"]}),e.requireAttributes("listItem",["type","indent"]);var n=t.data,r=t.editing;r.mapper.on("modelToViewPosition",Ha),r.mapper.on("viewToModelPosition",$a),n.mapper.on("modelToViewPosition",Ha),r.modelToView.on("insert",Da,{priority:"high"}),r.modelToView.on("insert:listItem",Na),n.modelToView.on("insert",Da,{priority:"high"}),n.modelToView.on("insert:listItem",Na),r.modelToView.on("changeAttribute:type:listItem",ja),n.modelToView.on("changeAttribute:type:listItem",ja),r.modelToView.on("remove:listItem",Ma),r.modelToView.on("remove",La,{priority:"low"}),n.modelToView.on("remove:listItem",Ma),n.modelToView.on("remove",La,{priority:"low"}),r.modelToView.on("move:listItem",Ia),r.modelToView.on("move",La,{priority:"low"}),n.modelToView.on("move:listItem",Ia),n.modelToView.on("move",La,{priority:"low"}),r.modelToView.on("changeAttribute:indent:listItem",Ba),n.modelToView.on("changeAttribute:indent:listItem",Ba),n.viewToModel.on("element:li",za),n.viewToModel.on("element:ul",qa,{priority:"high"}),n.viewToModel.on("element:ol",qa,{priority:"high"}),t.commands.set("numberedList",new By(t,"numbered")),t.commands.set("bulletedList",new By(t,"bulleted")),t.commands.set("indentList",new Dy(t,"forward")),t.commands.set("outdentList",new Dy(t,"backward"))}}]),e}(tl),qy=function(t){function e(t,n){Fs(this,e);var r=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.attributeKey=n,r.set("value",!1),r.listenTo(r.editor.document.selection,"change:attribute",function(){r.value=r.editor.document.selection.hasAttribute(r.attributeKey)}),r}return Ms(e,t),Ns(e,[{key:"_checkEnabled",value:function(){var t=this.editor.document;return Ga(this.attributeKey,t.selection,t.schema)}},{key:"_doExecute",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.editor.document,r=n.selection,i=void 0===e.forceValue?!this.value:e.forceValue;n.enqueueChanges(function(){if(r.isCollapsed)i?r.setAttribute(t.attributeKey,!0):r.removeAttribute(t.attributeKey);else{var o=ba(t.attributeKey,r.getRanges(),n.schema),a=e.batch||n.batch(),s=!0,u=!1,l=void 0;try{for(var c,f=o[Symbol.iterator]();!(s=(c=f.next()).done);s=!0){var h=c.value;i?a.setAttribute(h,t.attributeKey,i):a.removeAttribute(h,t.attributeKey)}}catch(t){u=!0,l=t}finally{try{!s&&f.return&&f.return()}finally{if(u)throw l}}}})}}]),e}(Ny),Hy="bold",$y=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"init",value:function(){var t=this.editor,e=t.data,n=t.editing;t.document.schema.allow({name:"$inline",attributes:[Hy]}),wa().for(e.modelToView,n.modelToView).fromAttribute(Hy).toElement("strong"),xa().for(e.viewToModel).fromElement("strong").fromElement("b").fromAttribute("style",{"font-weight":"bold"}).toAttribute(Hy,!0),t.commands.set(Hy,new qy(t,Hy))}}]),e}(tl),Ky="italic",Wy=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"init",value:function(){var t=this.editor,e=t.data,n=t.editing;t.document.schema.allow({name:"$inline",attributes:[Ky]}),wa().for(e.modelToView,n.modelToView).fromAttribute(Ky).toElement("em"),xa().for(e.viewToModel).fromElement("em").fromElement("i").fromAttribute("style",{"font-style":"italic"}).toAttribute(Ky,!0),t.commands.set(Ky,new qy(t,Ky))}}]),e}(tl),Jy=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"init",value:function(){this._addListAutoformats(),this._addHeadingAutoformats(),this._addInlineAutoformats()}},{key:"_addListAutoformats",value:function(){new Cy(this.editor,/^[\*\-]\s$/,"bulletedList"),new Cy(this.editor,/^\d+[\.|)]?\s$/,"numberedList")}},{key:"_addHeadingAutoformats",value:function(){var t=this;new Cy(this.editor,/^(#{1,3})\s$/,function(e){var n=e.batch,r=e.match,i=r[1].length;t.editor.execute("heading",{batch:n,formatId:"heading"+i})})}},{key:"_addInlineAutoformats",value:function(){new Ty(this.editor,/(\*\*)([^\*]+)(\*\*)$/g,"bold"),new Ty(this.editor,/(__)([^_]+)(__)$/g,"bold"),new Ty(this.editor,/(?:^|[^\*])(\*)([^\*_]+)(\*)$/g,"italic"),new Ty(this.editor,/(?:^|[^_])(_)([^_]+)(_)$/g,"italic")}}],[{key:"requires",get:function(){return[Iy,zy,$y,Wy]}}]),e}(tl),Uy=function(t){function e(){Fs(this,e);var t=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),n=t.bindTemplate;return t.set("content"),t.set("viewBox","0 0 20 20"),t.template=new sy({tag:"svg",ns:"http://www.w3.org/2000/svg",attributes:{class:"ck-icon",viewBox:n.to("viewBox")}}),t.on("change:content",function(e,n,r){if(/</.test(r))for(var i=(new DOMParser).parseFromString(r.trim(),"image/svg+xml").firstChild;i.childNodes.length>0;)t.element.appendChild(i.childNodes[0]);else t.element.innerHTML='<use xlink:href="#ck-icon-'+r+'"></use>'}),t}return Ms(e,t),e}(fy),Gy=function(t){function e(t){Fs(this,e);var n=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));n.set("label"),n.set("keystroke"),n.set("title"),n.set("type","button"),n.set("isOn",!1),n.set("isEnabled",!0),n.set("withText",!1),n.set("icon"),n.bind("_tooltip").to(n,"title",n,"label",n,"keystroke",n._getTooltip.bind(n));var r=n.bindTemplate;return n.template=new sy({tag:"button",attributes:{class:["ck-button","ck-tooltip_s",r.to("isEnabled",function(t){return t?"ck-enabled":"ck-disabled"}),r.to("isOn",function(t){return t?"ck-on":"ck-off"}),r.if("withText","ck-button_with-text")],type:r.to("type",function(t){return t?t:"button"}),"data-ck-tooltip":[r.to("_tooltip")]},children:[{tag:"span",attributes:{class:["ck-button__label"]},children:[{text:r.to("label")}]}],on:{mousedown:r.to(function(t){t.preventDefault()}),click:r.to(function(t){n.isEnabled?n.fire("execute"):t.preventDefault()})}}),n}return Ms(e,t),Ns(e,[{key:"init",value:function(){var t=this,n=Promise.resolve();return this.icon&&!this.iconView&&!function(){var e=t.iconView=new Uy;e.bind("content").to(t,"icon"),t.element.insertBefore(e.element,t.element.firstChild),n=n.then(function(){return t.addChildren(e)})}(),n.then(function(){return js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",t).call(t)})}},{key:"_getTooltip",value:function(t,e,n){return t?t:(n&&(e+=" ("+Oo(n)+")"),e)}}]),e}(fy),Yy=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"init",value:function(){var t=this,e=this.editor,n=e.t,r=e.commands.get("bold"),i="CTRL+B";e.ui.componentFactory.add("bold",function(o){var a=new Gy(o);return a.set({label:n("Bold"),icon:"bold",keystroke:i}),a.bind("isOn","isEnabled").to(r,"value","isEnabled"),t.listenTo(a,"execute",function(){return e.execute("bold")}),a}),e.keystrokes.set(i,"bold")}}],[{key:"requires",get:function(){return[$y]}}]),e}(tl),Qy=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"init",value:function(){var t=this,e=this.editor,n=e.t,r=e.commands.get("italic"),i="CTRL+I";e.ui.componentFactory.add("italic",function(o){var a=new Gy(o);return a.set({label:n("Italic"),icon:"italic",keystroke:i}),a.bind("isOn","isEnabled").to(r,"value","isEnabled"),t.listenTo(a,"execute",function(){return e.execute("italic")}),a}),e.keystrokes.set(i,"italic")}}],[{key:"requires",get:function(){return[Wy]}}]),e}(tl),Xy=function(){function t(e){Fs(this,t),this._native=e}return Ns(t,[{key:"getData",value:function(t){return this._native.getData(t)}},{key:"setData",value:function(t,e){this._native.setData(t,e)}}]),t}(),Zy=function(t){function e(t){Fs(this,e);var n=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.domEventType=["paste","copy","cut"],n}return Ms(e,t),Ns(e,[{key:"onDomEvent",value:function(t){this.fire(t.type,t,{dataTransfer:new Xy(t.clipboardData)})}}]),e}(Wv),tp=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"init",value:function(){var t=this,e=this.editor,n=e.document,r=e.editing.view;this._htmlDataProcessor=new ty,r.addObserver(Zy),this.listenTo(r,"paste",function(e,n){var i=n.dataTransfer,o="";i.getData("text/html")?o=Qa(i.getData("text/html")):i.getData("text/plain")&&(o=Ya(i.getData("text/plain"))),o=t._htmlDataProcessor.toView(o),n.preventDefault(),r.fire("clipboardInput",{dataTransfer:i,content:o})},{priority:"low"}),this.listenTo(r,"clipboardInput",function(e,r){r.content.isEmpty||!function(){var e=t.editor.data,i=e.viewToModel.convert(r.content,{context:["$clipboardHolder"]});n.enqueueChanges(function(){e.insertContent(i,n.selection)})}()},{priority:"low"});var i=function(t,i){var o=i.dataTransfer,a=e.data.toView(e.data.getSelectedContent(n.selection));i.preventDefault(),r.fire("clipboardOutput",{dataTransfer:o,content:a,method:t.name})};this.listenTo(r,"copy",i,{priority:"low"}),this.listenTo(r,"cut",i,{priority:"low"}),this.listenTo(r,"clipboardOutput",function(r,i){i.content.isEmpty||i.dataTransfer.setData("text/html",t._htmlDataProcessor.toData(i.content)),"cut"==i.method&&n.enqueueChanges(function(){e.data.deleteContent(n.selection,n.batch(),{merge:!0})})},{priority:"low"})}}]),e}(tl),ep=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"_doExecute",value:function(){var t=this,e=this.editor.document,n=e.batch();e.enqueueChanges(function(){Xa(t.editor.data,n,e.selection),t.fire("afterExecute",{batch:n})})}}]),e}(Ny),np=function(t){function e(t){Fs(this,e);var n=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return t.on("keydown",function(e,r){n.isEnabled&&r.keyCode==Cv.enter&&t.fire("enter",new Kv(t,r.domEvent))}),n}return Ms(e,t),Ns(e,[{key:"observe",value:function(){}}]),e}(qv),rp=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"init",value:function(){var t=this.editor,e=t.editing.view;e.addObserver(np),t.commands.set("enter",new ep(t)),this.listenTo(e,"enter",function(e,n){t.execute("enter"),n.preventDefault()},{priority:"low"})}}]),e}(tl),ip=function(t){function e(){Fs(this,e);var t=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.items=t.createCollection(),t.template=new sy({tag:"ul",attributes:{class:["ck-reset","ck-list"]},children:t.items}),t}return Ms(e,t),e}(fy),op=function(t){function e(){Fs(this,e);var t=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),n=t.bindTemplate;return t.template=new sy({tag:"li",attributes:{class:["ck-list__item"],style:n.to("style")},children:[{text:n.to("label")}],on:{click:n.to("execute")}}),t}return Ms(e,t),e}(fy),ap=function(t){function e(t,n,r){Fs(this,e);var i=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.addChildren(i.buttonView=n),i.addChildren(i.panelView=r),i.set("isOpen",!1),i.template=new sy({tag:"div",attributes:{class:["ck-dropdown"]},children:[n,r]}),sy.extend(n.template,{attributes:{class:["ck-dropdown__button"]}}),i.listenTo(n,"execute",function(){return i.isOpen=!i.isOpen}),r.bind("isVisible").to(i,"isOpen"),i}return Ms(e,t),e}(fy),sp=function(t){function e(t){Fs(this,e);var n=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t)),r=n.bindTemplate;return n.set("isVisible",!1),n.children=n.createCollection(),n.template=new sy({tag:"div",attributes:{class:["ck-reset","ck-dropdown__panel",r.if("isVisible","ck-dropdown__panel-visible")]},children:n.children}),n}return Ms(e,t),e}(fy),up=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"init",value:function(){var t=this,e=this.editor,n=e.commands.get("heading"),r=n.formats,i=new iy,o=!0,a=!1,s=void 0;try{for(var u,l=r[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value;i.add(new dy({formatId:c.id,label:c.label}))}}catch(t){a=!0,s=t}finally{try{!o&&l.return&&l.return()}finally{if(a)throw s}}var f=new dy({label:"Heading",withText:!0,items:i});f.bind("isEnabled").to(n,"isEnabled"),f.bind("label").to(n,"value",function(t){return t.label}),e.ui.componentFactory.add("headings",function(n){var r=es(f,n);return t.listenTo(r,"execute",function(t){var n=t.source.formatId;e.execute("heading",{formatId:n}),e.editing.view.focus()}),r})}}],[{key:"requires",get:function(){return[Iy]}}]),e}(tl),lp=Symbol("isWidget"),cp="ck-widget",fp="ck-widget_selected",hp=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"init",value:function(){var t=void 0;this.editor.editing.modelToView.on("selection",function(e,n,r,i){t&&t.hasClass(fp)&&t.removeClass(fp);var o=i.viewSelection,a=o.getSelectedElement();a&&rs(a)&&(o.setFake(!0),a.addClass(fp),t=a)},{priority:"low"})}}]),e}(tl),dp=Symbol("isImage"),vp=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"init",value:function(){var t=this.editor,e=t.document,n=e.schema,r=t.data,i=t.editing;n.registerItem("image"),n.requireAttributes("image",["src"]),n.allow({name:"image",attributes:["alt","src"],inside:"$root"}),n.objects.add("image"),wa().for(r.modelToView).fromElement("image").toElement(function(t){return cs(t.item)}),wa().for(i.modelToView).fromElement("image").toElement(function(t){return as(cs(t.item))}),r.viewToModel.on("element:figure",us()),i.modelToView.on("selection",ls(t.t),{priority:"lowest"})}}],[{key:"requires",get:function(){return[hp]}}]),e}(tl),yp=function(t){function e(t){Fs(this,e);var n=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.domEventType="mousedown",n}return Ms(e,t),Ns(e,[{key:"onDomEvent",value:function(t){this.fire(t.type,t)}}]),e}(Wv),pp=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"init",value:function(){var t=this,e=this.editor.editing.view;e.addObserver(yp),this.listenTo(e,"mousedown",function(){return t._onMousedown.apply(t,arguments)}),this.listenTo(e,"keydown",function(){return t._onKeydown.apply(t,arguments)},{priority:"high"})}},{key:"_onMousedown",value:function(t,e){var n=this,r=e.target,i=this.editor,o=i.editing.view;if(rs(r)||(r=r.findAncestor(function(t){return rs(t)}))){e.preventDefault(),o.isFocused||o.focus();var a=i.editing.mapper.toModelElement(r);i.document.enqueueChanges(function(){n._setSelectionOverElement(a)})}}},{key:"_onKeydown",value:function(t,e){var n=e.keyCode,r=n==Cv.delete||n==Cv.arrowdown||n==Cv.arrowright;(hs(n)&&this._handleDelete(r)||fs(n)&&this._handleArrowKeys(r))&&(e.preventDefault(),t.stop())}},{key:"_handleDelete",value:function(t){var e=this,n=this.editor.document,r=n.selection;if(r.isCollapsed){var i=this._getObjectElementNextToSelection(t);return i?(n.enqueueChanges(function(){var t=r.anchor.parent;if(t.isEmpty){var o=n.batch();o.remove(t)}e._setSelectionOverElement(i)}),!0):void 0}}},{key:"_handleArrowKeys",value:function(t){var e=this,n=this.editor.document,r=n.schema,i=n.selection,o=i.getSelectedElement();if(o&&r.objects.has(o.name)){var a=function(){var e=t?i.getLastPosition():i.getFirstPosition(),r=n.getNearestSelectionRange(e,t?"forward":"backward");return r&&n.enqueueChanges(function(){i.setRanges([r])}),{v:!0}}();if("object"===("undefined"==typeof a?"undefined":Vs(a)))return a.v}if(i.isCollapsed){var s=this._getObjectElementNextToSelection(t);return s instanceof sl&&n.schema.objects.has(s.name)?(n.enqueueChanges(function(){e._setSelectionOverElement(s)}),!0):void 0}}},{key:"_setSelectionOverElement",value:function(t){this.editor.document.selection.setRanges([hl.createOn(t)])}},{key:"_getObjectElementNextToSelection",value:function(t){var e=this.editor.document,n=e.schema,r=e.selection,i=this.editor.data,o=yv.createFromSelection(r);i.modifySelection(o,{direction:t?"forward":"backward"});var a=t?o.focus.nodeBefore:o.focus.nodeAfter;return a instanceof sl&&n.objects.has(a.name)?a:null}}],[{key:"requires",get:function(){return[hp]}}]),e}(tl),mp=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,null,[{key:"requires",get:function(){return[vp,pp]}}]),e}(tl),gp=function(t){function e(t){Fs(this,e);var n=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.domEventType="click",n}return Ms(e,t),Ns(e,[{key:"onDomEvent",value:function(t){this.fire(t.type,t)}}]),e}(Wv),bp=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),e}(Al),_p=function(t){function e(t){Fs(this,e);var n=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.set("value",void 0),n.listenTo(n.editor.document.selection,"change:attribute",function(){n.value=n.editor.document.selection.getAttribute("linkHref")}),n}return Ms(e,t),Ns(e,[{key:"_checkEnabled",value:function(){var t=this.editor.document;return Ga("linkHref",t.selection,t.schema)}},{key:"_doExecute",value:function(t){var e=this.editor.document,n=e.selection;e.enqueueChanges(function(){var r=e.batch();if(n.isCollapsed){var i=n.getFirstPosition(),o=i.parent;if(n.hasAttribute("linkHref")){var a=ds(n.getFirstPosition(),n.getAttribute("linkHref"));r.setAttribute(a,"linkHref",t),n.setRanges([a])}else if(e.schema.check({name:"$text",attributes:"linkHref",inside:o.name})){var s=new al(t,{linkHref:t});r.insert(i,s),n.setRanges([hl.createOn(s)])}}else{var u=ba("linkHref",n.getRanges(),e.schema),l=!0,c=!1,f=void 0;try{for(var h,d=u[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var v=h.value;r.setAttribute(v,"linkHref",t)}}catch(t){c=!0,f=t}finally{try{!l&&d.return&&d.return()}finally{if(c)throw f}}}})}}]),e}(Ny),wp=function(t){function e(t){Fs(this,e);var n=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.listenTo(t.document.selection,"change:attribute",function(){return n.refreshState()}),n}return Ms(e,t),Ns(e,[{key:"_doExecute",value:function(){var t=this.editor.document,e=t.selection;t.enqueueChanges(function(){var n=e.isCollapsed?[ds(e.getFirstPosition(),e.getAttribute("linkHref"))]:e.getRanges(),r=t.batch(),i=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;r.removeAttribute(l,"linkHref")}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}})}},{key:"_checkEnabled",value:function(){return this.editor.document.selection.hasAttribute("linkHref")}}]),e}(Ny),kp=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"init",value:function(){var t=this.editor,e=t.data,n=t.editing;t.document.schema.allow({name:"$inline",attributes:"linkHref"}),wa().for(e.modelToView,n.modelToView).fromAttribute("linkHref").toElement(function(t){return new bp("a",{href:t})}),xa().for(e.viewToModel).fromElement("a").toAttribute(function(t){return{key:"linkHref",value:t.getAttribute("href")}}),t.commands.set("link",new _p(t)),t.commands.set("unlink",new wp(t))}}]),e}(tl),xp=["top","right","bottom","left","width","height"],Op=function(){function t(e){var n=this;Fs(this,t),(gs(e)||ms(e))&&(e=e.getBoundingClientRect()),xp.forEach(function(t){return n[t]=e[t]})}return Ns(t,[{key:"clone",value:function(){return new t(this)}},{key:"moveTo",value:function(t,e){return this.top=e,this.right=t+this.width,this.bottom=e+this.height,this.left=t,this}},{key:"moveBy",value:function(t,e){return this.top+=e,this.right+=t,this.left+=t,this.bottom+=e,this}},{key:"getIntersection",value:function(e){var n={top:Math.max(this.top,e.top),right:Math.min(this.right,e.right),bottom:Math.min(this.bottom,e.bottom),left:Math.max(this.left,e.left)};return n.width=n.right-n.left,n.height=n.bottom-n.top,n.width<0||n.height<0?null:new t(n)}},{key:"getIntersectionArea",value:function(t){var e=this.getIntersection(t);return e?e.getArea():0}},{key:"getArea",value:function(){return this.width*this.height}}],[{key:"getViewportRect",value:function(){var e=wy.window,n=e.innerWidth,r=e.innerHeight;return new t({top:0,right:n,bottom:r,left:0,width:n,height:r})}}]),t}(),Sp=ga("px"),Pp=function(t){function e(t){Fs(this,e);var n=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t)),r=n.bindTemplate;return n.set("top",0),n.set("left",0),n.set("position","se"),n.set("isVisible",!1),n.content=n.createCollection(),n.template=new sy({tag:"div",attributes:{class:["ck-balloon-panel",r.to("position",function(t){return"ck-balloon-panel_arrow_"+t}),r.if("isVisible","ck-balloon-panel_visible")],style:{top:r.to("top",Sp),left:r.to("left",Sp),maxWidth:r.to("maxWidth",Sp)},tabindex:-1},children:n.content}),n}return Ms(e,t),Ns(e,[{key:"show",value:function(){this.isVisible=!0}},{key:"hide",value:function(){this.isVisible=!1}},{key:"attachTo",value:function(t){this.show();var n=e.defaultPositions,r=Object.assign({},{element:this.element,positions:[n.se,n.sw,n.ne,n.nw],limiter:document.body,fitInViewport:!0},t),i=_s(r),o=i.top,a=i.left,s=i.name;Object.assign(this,{top:o,left:a,position:s})}}]),e}(fy);Pp.arrowHorizontalOffset=30,Pp.arrowVerticalOffset=15,Pp.defaultPositions={se:function(t){return{top:t.bottom+Pp.arrowVerticalOffset,left:t.left+t.width/2-Pp.arrowHorizontalOffset,name:"se"}},sw:function(t,e){return{top:t.bottom+Pp.arrowVerticalOffset,left:t.left+t.width/2-e.width+Pp.arrowHorizontalOffset,name:"sw"}},ne:function(t,e){return{top:t.top-e.height-Pp.arrowVerticalOffset,left:t.left+t.width/2-Pp.arrowHorizontalOffset,name:"ne"}},nw:function(t,e){return{top:t.top-e.height-Pp.arrowVerticalOffset,left:t.left+t.width/2-e.width+Pp.arrowHorizontalOffset,name:"nw"}}};for(var Ap=function(t){function e(t){Fs(this,e);var n=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));n.set("text"),n.set("for");var r=n.bindTemplate;return n.template=new sy({tag:"label",attributes:{class:["ck-label"],for:r.to("for")},children:[{text:r.to("text")}]}),n}return Ms(e,t),e}(fy),Cp=function(t){function n(t,r){Fs(this,n);var i=Is(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t)),o="ck-input-"+e();return i.set("label"),i.set("value"),i.addChildren(i.labelView=i._createLabelView(o)),i.addChildren(i.inputView=i._createInputView(r,o)),i.template=new sy({tag:"div",children:[i.labelView,i.inputView]}),i}return Ms(n,t),Ns(n,[{key:"_createLabelView",value:function(t){var e=new Ap(this.locale);return e.for=t,e.bind("text").to(this,"label"),e}},{key:"_createInputView",value:function(t,e){var n=new t(this.locale);return n.id=e,n.bind("value").to(this),n}},{key:"select",value:function(){this.inputView.select()}}]),n}(fy),Tp=function(t){function e(t){Fs(this,e);var n=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));n.set("value"),n.set("id");var r=n.bindTemplate;return n.template=new sy({tag:"input",attributes:{type:"text",class:["ck-input","ck-input-text"],id:r.to("id")}}),n.on("change:value",function(t,e,r){return n.element.value=r||""}),n}return Ms(e,t),Ns(e,[{key:"select",value:function(){this.element.select()}}]),e}(fy),Ep=function(t){function e(t){Fs(this,e);var n=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.urlInputView=n._createUrlInput(),n.saveButtonView=n._createButton("Save"),n.saveButtonView.type="submit",n.cancelButtonView=n._createButton("Cancel","cancel"),n.unlinkButtonView=n._createButton("Unlink","unlink"),n.addChildren([n.urlInputView,n.saveButtonView,n.cancelButtonView,n.unlinkButtonView]),sy.extend(n.saveButtonView.template,{attributes:{class:["ck-button-action"]}}),n.template=new sy({tag:"form",attributes:{class:["ck-link-form"]},children:[n.urlInputView,{tag:"div",attributes:{class:["ck-link-form__actions"]},children:[n.saveButtonView,n.cancelButtonView,n.unlinkButtonView]}]}),Os({view:n}),n}return Ms(e,t),Ns(e,[{key:"_createUrlInput",value:function(){var t=this.locale.t,e=new Cp(this.locale,Tp);return e.label=t("Link URL"),e}},{key:"_createButton",value:function(t,e){var n=this.locale.t,r=new Gy(this.locale);return r.label=n(t),r.withText=!0,e&&r.delegate("execute").to(this,e),r}}]),e}(fy),Rp=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"init",value:function(){this.editor.editing.view.addObserver(gp),this.balloonPanelView=this._createBalloonPanel(),this.formView=this._createForm(),this._createToolbarLinkButton(),this._createToolbarUnlinkButton()}},{key:"_createToolbarLinkButton",value:function(){var t=this,e=this.editor,n=e.commands.get("link"),r=e.t;e.keystrokes.set("CTRL+K",function(){return t._showPanel()}),e.ui.componentFactory.add("link",function(e){var i=new Gy(e);return i.isEnabled=!0,i.label=r("Link"),i.icon="link",i.keystroke="CTRL+K",i.bind("isEnabled").to(n,"isEnabled"),t.listenTo(i,"execute",function(){return t._showPanel()}),i})}},{key:"_createToolbarUnlinkButton",value:function(){var t=this,e=this.editor,n=e.t,r=e.commands.get("unlink");e.ui.componentFactory.add("unlink",function(i){var o=new Gy(i);return o.isEnabled=!1,o.label=n("Unlink"),o.icon="unlink",o.bind("isEnabled").to(r,"isEnabled"),t.listenTo(o,"execute",function(){return e.execute("unlink")}),o})}},{key:"_createBalloonPanel",value:function(){var t=this,e=this.editor,n=e.editing.view,r=new Pp(e.locale);return r.maxWidth=300,e.ui.focusTracker.add(r.element),this.listenTo(n,"click",function(){var e=n.selection,i=Ss(e.getFirstPosition());e.isCollapsed&&i&&(t._attachPanelToElement(),t.listenTo(n,"render",function(){var n=Ss(e.getFirstPosition());e.isCollapsed&&i===n?t._attachPanelToElement(i):t._hidePanel()}),t.listenTo(r,"change:isVisible",function(){return t.stopListening(n,"render")}))}),ps({emitter:r,activator:function(){return r.isVisible},callback:function(){return t._hidePanel(!0)}}),ys({emitter:r,activator:function(){return r.isVisible},contextElement:r.element,callback:function(){return t._hidePanel()}}),e.ui.view.body.add(r),r}},{key:"_createForm",value:function(){var t=this,e=this.editor,n=new Ep(e.locale);return n.urlInputView.bind("value").to(e.commands.get("link"),"value"),this.listenTo(n,"submit",function(){e.execute("link",n.urlInputView.inputView.element.value),t._hidePanel(!0)}),this.listenTo(n,"unlink",function(){e.execute("unlink"),t._hidePanel(!0)}),this.listenTo(n,"cancel",function(){return t._hidePanel(!0)}),this.balloonPanelView.content.add(n),n}},{key:"_attachPanelToElement",value:function(t){var e=this.editor.editing.view,n=t||Ss(e.selection.getFirstPosition()),r=n?e.domConverter.getCorrespondingDomElement(n):e.domConverter.viewRangeToDom(e.selection.getFirstRange());this.balloonPanelView.attachTo({target:r,limiter:e.domConverter.getCorrespondingDomElement(e.selection.editableElement)})}},{key:"_hidePanel",value:function(t){this.balloonPanelView.hide(),t&&this.editor.editing.view.focus()}},{key:"_showPanel",value:function(){this._attachPanelToElement(),this.formView.urlInputView.select()}}],[{key:"requires",get:function(){return[kp]}}]),e}(tl),Vp=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"init",value:function(){var t=this,e=this.editor.t;this._addButton("numberedList",e("Numbered List")),this._addButton("bulletedList",e("Bulleted List")),this.listenTo(this.editor.editing.view,"enter",function(e,n){var r=t.editor.document,i=r.selection.getLastPosition().parent;r.selection.isCollapsed&&"listItem"==i.name&&i.isEmpty&&(t.editor.execute("outdentList"),n.preventDefault(),e.stop())}),this.listenTo(this.editor.editing.view,"keydown",function(e,n){var r=null;if(n.keystroke==xo("tab")?r="indentList":n.keystroke==xo("Shift+tab")&&(r="outdentList"),r){var i=t.editor.commands.get(r);i.isEnabled&&(t.editor.execute(r),n.preventDefault(),e.stop())}})}},{key:"_addButton",value:function(t,e){var n=this,r=this.editor,i=r.commands.get(t);r.ui.componentFactory.add(t,function(o){var a=new Gy(o);return a.set({label:e,icon:t.toLowerCase()}),a.bind("isOn","isEnabled").to(i,"value","isEnabled"),n.listenTo(a,"execute",function(){return r.execute(t)}),a})}}],[{key:"requires",get:function(){return[zy]}}]),e}(tl),Fp=function(){function t(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;Fs(this,t),this.document=e,this.size=0,this.limit=r,this._changeCallback=function(t,e,r,i){n._onBatch(i)},e.on("change",this._changeCallback)}return Ns(t,[{key:"input",value:function(t){this.size+=t,this.size>=this.limit&&this._reset()}},{key:"destroy",value:function(){this.document.off("change",this._changeCallback)}},{key:"_onBatch",value:function(t){"transparent"!=t.type&&t!==this._batch&&Ps(t.getOperations())<=1&&this._reset()}},{key:"_reset",value:function(){this._batch=null,this.size=0}},{key:"batch",get:function(){return this._batch||(this._batch=this.document.batch()),this._batch}}]),t}(),Np=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"init",value:function(){var t=this,e=this.editor,n=e.editing.view;this._buffer=new Fp(e.document,e.config.get("typing.undoStep")||20),this.listenTo(n,"keydown",function(e,n){t._handleKeydown(n)},{priority:"lowest"}),this.listenTo(n,"mutations",function(e,n,r){t._handleMutations(n,r);
})}},{key:"destroy",value:function(){js(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this),this._buffer.destroy(),this._buffer=null}},{key:"_handleKeydown",value:function(t){var e=this,n=this.editor.document;Cs(t)||n.selection.isCollapsed||n.enqueueChanges(function(){e.editor.data.deleteContent(n.selection,e._buffer.batch)})}},{key:"_handleMutations",value:function(t,e){var n=this.editor.document,r=new jp(this.editor.editing,this._buffer);n.enqueueChanges(function(){return r.handle(t,e)})}}]),e}(tl),jp=function(){function t(e,n){Fs(this,t),this.editing=e,this.buffer=n,this.insertedCharacterCount=0}return Ns(t,[{key:"handle",value:function(t,e){var n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;this._handleTextMutation(s,e),this._handleTextNodeInsertion(s)}}catch(t){r=!0,i=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}this.buffer.input(Math.max(this.insertedCharacterCount,0))}},{key:"_handleTextMutation",value:function(t,e){if("text"==t.type){for(var n=t.newText.replace(/\u00A0/g," "),r=t.oldText.replace(/\u00A0/g," "),i=Fo(r,n),o=null,a=null,s=0;s<i.length;s++){var u=i[s];"equal"!=u&&(o=null===o?s:o,a=s)}for(var l=0,c=0,f=o;f<=a;f++)"insert"!=i[f]&&l++,"delete"!=i[f]&&c++;var h=null;e&&(h=this.editing.mapper.toModelPosition(e.anchor));var d=new _l(t.node,o),v=this.editing.mapper.toModelPosition(d);if(l>0){var y=hl.createFromPositionAndShift(v,l);this._remove(y,l)}var p=t.newText.substr(o,c);this._insert(v,p),h&&this.editing.model.selection.collapse(h)}}},{key:"_handleTextNodeInsertion",value:function(t){if("children"==t.type&&t.newChildren.length-t.oldChildren.length==1){var e=Fo(t.oldChildren,t.newChildren,Ts),n=As(e,t.newChildren);if(!(n.length>1)){var r=n[0];if(r.values[0]instanceof vl){var i=new _l(t.node,r.index),o=this.editing.mapper.toModelPosition(i),a=r.values[0].data;a=a.replace(/\u00A0/g," "),this._insert(o,a),this.editing.model.selection.collapse(o.getShiftedBy(a.length))}}}}},{key:"_insert",value:function(t,e){this.buffer.batch.weakInsert(t,e),this.insertedCharacterCount+=e.length}},{key:"_remove",value:function(t,e){this.buffer.batch.remove(t),this.insertedCharacterCount-=e}}]),t}(),Mp=[ko("arrowUp"),ko("arrowRight"),ko("arrowDown"),ko("arrowLeft"),16,17,18,20,27,33,34,35,36],Ip=112;Ip<=135;Ip++)Mp.push(Ip);var Bp=function(t){function e(t,n){Fs(this,e);var r=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.direction=n,r._buffer=new Fp(t.document,t.config.get("undo.step")),r}return Ms(e,t),Ns(e,[{key:"_doExecute",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.editor.document,r=this.editor.data;n.enqueueChanges(function(){var i=yv.createFromSelection(n.selection);if(i.isCollapsed&&r.modifySelection(i,{direction:t.direction,unit:e.unit}),!i.isCollapsed){var o=0;i.getFirstRange().getMinimalFlatRanges().forEach(function(t){o+=Ps(t.getWalker({singleCharacters:!0,ignoreElementEnd:!0,shallow:!0}))}),r.deleteContent(i,t._buffer.batch,{merge:!0}),t._buffer.input(o),n.selection.setRanges(i.getRanges(),i.isBackward)}})}}]),e}(Ny),Dp=function(t){function e(t){Fs(this,e);var n=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return t.on("keydown",function(e,n){var r={};if(n.keyCode==Cv.delete)r.direction="forward",r.unit="character";else{if(n.keyCode!=Cv.backspace)return;r.direction="backward",r.unit="codePoint"}r.unit=n.altKey?"word":r.unit,t.fire("delete",new Kv(t,n.domEvent,r))}),n}return Ms(e,t),Ns(e,[{key:"observe",value:function(){}}]),e}(qv),Lp=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"init",value:function(){var t=this.editor,e=t.editing.view;e.addObserver(Dp),t.commands.set("forwardDelete",new Bp(t,"forward")),t.commands.set("delete",new Bp(t,"backward")),this.listenTo(e,"delete",function(e,n){t.execute("forward"==n.direction?"forwardDelete":"delete",{unit:n.unit}),n.preventDefault()})}}]),e}(tl),zp=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,null,[{key:"requires",get:function(){return[Np,Lp]}}]),e}(tl),qp=function(t){function e(t){Fs(this,e);var n=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n._stack=[],n._createdBatches=new WeakSet,n.refreshState(),n}return Ms(e,t),Ns(e,[{key:"addBatch",value:function(t){var e={ranges:Array.from(this.editor.document.selection.getRanges()),isBackward:this.editor.document.selection.isBackward};this._stack.push({batch:t,selection:e}),this.refreshState()}},{key:"clearStack",value:function(){this._stack=[],this.refreshState()}},{key:"_checkEnabled",value:function(){return this._stack.length>0}},{key:"_restoreSelection",value:function(t,e,n){var r=this.editor.document,i=[],o=!0,a=!1,s=void 0;try{for(var u,l=t[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value,f=Es(c,n),h=f.find(function(t){return t.start.root!=r.graveyard});h&&i.push(h)}}catch(t){a=!0,s=t}finally{try{!o&&l.return&&l.return()}finally{if(a)throw s}}i.length&&r.selection.setRanges(i,e)}}]),e}(Ny),Hp=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"_doExecute",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=e?this._stack.findIndex(function(t){return t.batch==e}):this._stack.length-1,r=this._stack.splice(n,1)[0];this.editor.document.enqueueChanges(function(){var e=t._undo(r.batch),n=t.editor.document.history.getDeltas(r.batch.baseVersion);t._restoreSelection(r.selection.ranges,r.selection.isBackward,n),t.fire("revert",r.batch,e)}),this.refreshState()}},{key:"_getItemIndexFromBaseVersion",value:function(t){for(var e=0;e<this._stack.length;e++)if(this._stack[e].batch.baseVersion==t)return e;return null}},{key:"_undo",value:function(t){var e=this.editor.document,n=e.batch();this._createdBatches.add(n);var r=e.history,i=t.deltas.slice();i.reverse();var o=!0,a=!1,s=void 0;try{for(var u,l=i[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value,f=c.baseVersion,h=f+c.operations.length,d=r.getDelta(f);if(null!==d){d.reverse();var v=[],y=!0,p=!1,m=void 0;try{for(var g,b=d[Symbol.iterator]();!(y=(g=b.next()).done);y=!0){var _=g.value;v.push(_.getReversed())}}catch(t){p=!0,m=t}finally{try{!y&&b.return&&b.return()}finally{if(p)throw m}}var w={},k=!0,x=!1,O=void 0;try{for(var S,P=r.getDeltas(h)[Symbol.iterator]();!(k=(S=P.next()).done);k=!0){var A=S.value,C=this._getItemIndexFromBaseVersion(A.baseVersion);null!==C&&(this._stack[C].selection.ranges=Rs(this._stack[C].selection.ranges,v));var T=uo(v,[A],!0);v=T.deltasA;var E=T.deltasB;w[A.baseVersion]||(w[A.baseVersion]=[]),w[A.baseVersion]=w[A.baseVersion].concat(E)}}catch(t){x=!0,O=t}finally{try{!k&&P.return&&P.return()}finally{if(x)throw O}}var R=!0,V=!1,F=void 0;try{for(var N,j=v[Symbol.iterator]();!(R=(N=j.next()).done);R=!0){var M=N.value;M.baseVersion=e.version,n.addDelta(M);var I=!0,B=!1,D=void 0;try{for(var L,z=M.operations[Symbol.iterator]();!(I=(L=z.next()).done);I=!0){var q=L.value;e.applyOperation(q)}}catch(t){B=!0,D=t}finally{try{!I&&z.return&&z.return()}finally{if(B)throw D}}}}catch(t){V=!0,F=t}finally{try{!R&&j.return&&j.return()}finally{if(V)throw F}}r.removeDelta(f);var H=!0,$=!1,K=void 0;try{for(var W,J=v[Symbol.iterator]();!(H=(W=J.next()).done);H=!0){var U=W.value;r.removeDelta(U.baseVersion)}}catch(t){$=!0,K=t}finally{try{!H&&J.return&&J.return()}finally{if($)throw K}}for(var G in w)r.updateDelta(Number(G),w[G])}}}catch(t){a=!0,s=t}finally{try{!o&&l.return&&l.return()}finally{if(a)throw s}}return n}}]),e}(qp),$p=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"_doExecute",value:function(){var t=this,e=this._stack.pop();this.editor.document.enqueueChanges(function(){var n=e.batch.deltas[e.batch.deltas.length-1],r=n.baseVersion+n.operations.length,i=Array.from(t.editor.document.history.getDeltas(r)).filter(function(e){return!t._createdBatches.has(e.batch)});t._restoreSelection(e.selection.ranges,e.selection.isBackward,i),t._redo(e.batch)}),this.refreshState()}},{key:"_redo",value:function(t){var e=this.editor.document,n=e.batch();this._createdBatches.add(n);var r=t.deltas.slice();r.reverse();var i=!0,o=!1,a=void 0;try{for(var s,u=r[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value,c=l.baseVersion+l.operations.length,f=[l.getReversed()],h=!0,d=!1,v=void 0;try{for(var y,p=e.history.getDeltas(c)[Symbol.iterator]();!(h=(y=p.next()).done);h=!0){var m=y.value;this._createdBatches.has(m.batch)||(f=uo(f,[m],!0).deltasA)}}catch(t){d=!0,v=t}finally{try{!h&&p.return&&p.return()}finally{if(d)throw v}}var g=!0,b=!1,_=void 0;try{for(var w,k=f[Symbol.iterator]();!(g=(w=k.next()).done);g=!0){var x=w.value;x.baseVersion=e.version,n.addDelta(x);var O=!0,S=!1,P=void 0;try{for(var A,C=x.operations[Symbol.iterator]();!(O=(A=C.next()).done);O=!0){var T=A.value;e.applyOperation(T)}}catch(t){S=!0,P=t}finally{try{!O&&C.return&&C.return()}finally{if(S)throw P}}}}catch(t){b=!0,_=t}finally{try{!g&&k.return&&k.return()}finally{if(b)throw _}}}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}}]),e}(qp),Kp=function(t){function e(t){Fs(this,e);var n=Is(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n._batchRegistry=new WeakSet,n}return Ms(e,t),Ns(e,[{key:"init",value:function(){var t=this;this._undoCommand=new Hp(this.editor),this._redoCommand=new $p(this.editor),this.editor.commands.set("undo",this._undoCommand),this.editor.commands.set("redo",this._redoCommand),this.listenTo(this.editor.document,"change",function(e,n,r,i){t._batchRegistry.has(i)||"transparent"==i.type||(t._redoCommand._createdBatches.has(i)?t._undoCommand.addBatch(i):t._undoCommand._createdBatches.has(i)||(t._undoCommand.addBatch(i),t._redoCommand.clearStack()),t._batchRegistry.add(i))},{priority:"highest"}),this.listenTo(this._undoCommand,"revert",function(e,n,r){t._redoCommand.addBatch(r)})}}]),e}(tl),Wp=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,[{key:"init",value:function(){var t=this.editor,e=t.t;this._addButton("undo",e("Undo"),"CTRL+Z"),this._addButton("redo",e("Redo"),"CTRL+Y"),t.keystrokes.set("CTRL+Z","undo"),t.keystrokes.set("CTRL+Y","redo"),t.keystrokes.set("CTRL+SHIFT+Z","redo")}},{key:"_addButton",value:function(t,e,n){var r=this,i=this.editor,o=i.commands.get(t);i.ui.componentFactory.add(t,function(a){var s=new Gy(a);return s.set({label:e,icon:t,keystroke:n}),s.bind("isEnabled").to(o,"isEnabled"),r.listenTo(s,"execute",function(){return i.execute(t)}),s})}}],[{key:"requires",get:function(){return[Kp]}}]),e}(tl),Jp=function(t){function e(){return Fs(this,e),Is(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ms(e,t),Ns(e,null,[{key:"create",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.plugins||(e.plugins=[]),e.plugins=[].concat(Ds(e.plugins),[Jy,Yy,Qy,tp,rp,up,mp,Rp,Vp,Vy,zp,Wp]),Ay.create(t,e)}}]),e}(Ay);return Jp}();